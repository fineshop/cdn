!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase,e.firebase.INTERNAL.modularAPIs)}(this,function(Ff,Vf){"use strict";try{!function(){var l,t=(t=Ff)&&"object"==typeof t&&"default"in t?t:{default:t};function n(n){const r=[];let s=0;for(let t=0;t<n.length;t++){let e=n.charCodeAt(t);e<128?r[s++]=e:(e<2048?r[s++]=e>>6|192:(55296==(64512&e)&&t+1<n.length&&56320==(64512&n.charCodeAt(t+1))?(e=65536+((1023&e)<<10)+(1023&n.charCodeAt(++t)),r[s++]=e>>18|240,r[s++]=e>>12&63|128):r[s++]=e>>12|224,r[s++]=e>>6&63|128),r[s++]=63&e|128)}return r}function a(e){return e=n(e),i.encodeByteArray(e,!0).replace(/\./g,"")}const i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();var s=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const i=[];for(let n=0;n<r.length;n+=3){var a=r[n],o=n+1<r.length,u=o?r[n+1]:0,c=n+2<r.length,h=c?r[n+2]:0;let e=(15&u)<<2|h>>6,t=63&h;c||(t=64,o||(e=64)),i.push(s[a>>2],s[(3&a)<<4|u>>4],s[e],s[t])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(n,r){if(this.HAS_NATIVE_SUPPORT&&!r)return atob(n);{var s=this.decodeStringToByteArray(n,r);const u=[];let e=0,t=0;for(;e<s.length;){var i,a,o=s[e++];o<128?u[t++]=String.fromCharCode(o):191<o&&o<224?(i=s[e++],u[t++]=String.fromCharCode((31&o)<<6|63&i)):239<o&&o<365?(a=((7&o)<<18|(63&s[e++])<<12|(63&s[e++])<<6|63&s[e++])-65536,u[t++]=String.fromCharCode(55296+(a>>10)),u[t++]=String.fromCharCode(56320+(1023&a))):(i=s[e++],a=s[e++],u[t++]=String.fromCharCode((15&o)<<12|(63&i)<<6|63&a))}return u.join("")}},decodeStringToByteArray(t,e){this.init_();var n=e?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let e=0;e<t.length;){var s=n[t.charAt(e++)],i=e<t.length?n[t.charAt(e)]:0,a=++e<t.length?n[t.charAt(e)]:64,o=++e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==i||null==a||null==o)throw Error();r.push(s<<2|i>>4),64!==a&&(r.push(i<<4&240|a>>2),64!==o&&r.push(a<<6&192|o))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};function u(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}class c extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,c.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,G.prototype.create)}}class G{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,t=t[0]||{},n=this.service+"/"+e,e=(e=this.errors[e])?(r=t,e.replace(K,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",e=this.serviceName+`: ${e} (${n}).`;return new c(n,e,t)}}const K=/\{\$([^}]+)}/g;function v(e){return e&&e._delegate?e._delegate:e}class j{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}(vr=l=l||{})[vr.DEBUG=0]="DEBUG",vr[vr.VERBOSE=1]="VERBOSE",vr[vr.INFO=2]="INFO",vr[vr.WARN=3]="WARN",vr[vr.ERROR=4]="ERROR",vr[vr.SILENT=5]="SILENT";const Q={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},z=l.INFO,$={[l.DEBUG]:"log",[l.VERBOSE]:"log",[l.INFO]:"info",[l.WARN]:"warn",[l.ERROR]:"error"},W=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),s=$[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${r}]  ${e.name}:`,...n)}};var H="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},w=H||self;function Y(){}function X(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function J(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}Math.random();function Z(e,t,n){return e.call.apply(e.bind,arguments)}function ee(t,n,e){if(t)return 2<arguments.length?(r=Array.prototype.slice.call(arguments,2),function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}):function(){return t.apply(n,arguments)};var r;throw Error()}function te(e,t,n){return(te=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Z:ee).apply(null,arguments)}function ne(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function re(e,i){function t(){}t.prototype=i.prototype,e.X=i.prototype,e.prototype=new t,(e.prototype.constructor=e).Wb=function(e,t,n){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return i.prototype[t].apply(e,r)}}function se(){this.s=this.s,this.o=this.o}se.prototype.s=!1,se.prototype.na=function(){this.s||(this.s=!0,this.M())},se.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ie=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(t,n){if("string"==typeof t)return"string"!=typeof n||1!=n.length?-1:t.indexOf(n,0);for(let e=0;e<t.length;e++)if(e in t&&t[e]===n)return e;return-1};function ae(t){var n=t.length;if(0<n){const r=Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r}return[]}function oe(t){for(let e=1;e<arguments.length;e++){var n=arguments[e];if(X(n)){var r=t.length||0,s=n.length||0;t.length=r+s;for(let e=0;e<s;e++)t[r+e]=n[e]}else t.push(n)}}function ue(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}ue.prototype.h=function(){this.defaultPrevented=!0};var ce=function(){if(!w.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{w.addEventListener("test",Y,t),w.removeEventListener("test",Y,t)}catch(e){}return e}();function he(e){return/^[\s\xa0]*$/.test(e)}var le=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function de(e,t){return e<t?-1:t<e?1:0}function fe(){var e=w.navigator;return(e=e&&e.userAgent)?e:""}function ge(e){return-1!=fe().indexOf(e)}function me(e){return me[" "](e),e}me[" "]=Y;var pe,ye=ge("Opera"),ve=ge("Trident")||ge("MSIE"),e=ge("Edge"),we=e||ve,Ie=ge("Gecko")&&!(-1!=fe().toLowerCase().indexOf("webkit")&&!ge("Edge"))&&!(ge("Trident")||ge("MSIE"))&&!ge("Edge"),be=-1!=fe().toLowerCase().indexOf("webkit")&&!ge("Edge");function Te(){var e=w.document;return e?e.documentMode:void 0}var Ee="",_e=(_e=fe(),Ie?/rv:([^\);]+)(\)|;)/.exec(_e):e?/Edge\/([\d\.]+)/.exec(_e):ve?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(_e):be?/WebKit\/(\S+)/.exec(_e):ye?/(?:Version)[ \/]?(\S+)/.exec(_e):void 0),Se=((_e&&(Ee=_e?_e[1]:""),ve&&null!=(_e=Te())&&_e>parseFloat(Ee))?pe=String(_e):pe=Ee,{});var xe=w.document&&ve&&(Te()||parseInt(pe,10))||void 0;function De(e,t){if(ue.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Ie){e:{try{me(t.nodeName);var s=!0;break e}catch(e){}s=!1}s||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Ae[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&De.X.h.call(this)}}re(De,ue);var Ae={2:"touch",3:"pen",4:"mouse"},Ce=(De.prototype.h=function(){De.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1},"closure_listenable_"+(1e6*Math.random()|0)),Ne=0;function ke(e,t,n,r,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=s,this.key=++Ne,this.ba=this.ea=!1}function Re(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function Le(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function Me(e){const t={};for(const n in e)t[n]=e[n];return t}const Oe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Fe(t){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e])t[n]=r[n];for(let e=0;e<Oe.length;e++)n=Oe[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Ve(e){this.src=e,this.g={},this.h=0}function Pe(e,t){var n,r,s,i=t.type;i in e.g&&(n=e.g[i],(s=0<=(r=ie(n,t)))&&Array.prototype.splice.call(n,r,1),s&&(Re(t),0==e.g[i].length&&(delete e.g[i],e.h--)))}function qe(e,t,n,r){for(var s=0;s<e.length;++s){var i=e[s];if(!i.ba&&i.listener==t&&i.capture==!!n&&i.ha==r)return s}return-1}Ve.prototype.add=function(e,t,n,r,s){var i=e.toString(),a=((e=this.g[i])||(e=this.g[i]=[],this.h++),qe(e,t,r,s));return-1<a?(t=e[a],n||(t.ea=!1)):((t=new ke(t,this.src,i,!!r,s)).ea=n,e.push(t)),t};var Be="closure_lm_"+(1e6*Math.random()|0),Ue={};function Ge(e,t,n,r,s,i){if(!t)throw Error("Invalid event type");var a=J(s)?!!s.capture:!!s,o=ze(e);if(o||(e[Be]=o=new Ve(e)),(n=o.add(t,n,r,a,i)).proxy)return n;if(r=function(){const n=Qe;return function e(t){return n.call(e.src,e.listener,t)}}(),(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(s=ce?s:a)&&(s=!1),e.addEventListener(t.toString(),r,s);else if(e.attachEvent)e.attachEvent(je(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Ke(e){var t,n,r;"number"!=typeof e&&e&&!e.ba&&((t=e.src)&&t[Ce]?Pe(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(je(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ze(t))?(Pe(n,e),0==n.h&&(n.src=null,t[Be]=null)):Re(e)))}function je(e){return e in Ue?Ue[e]:Ue[e]="on"+e}function Qe(e,t){var n,r;return!!e.ba||(t=new De(t,this),n=e.listener,r=e.ha||e.src,e.ea&&Ke(e),n.call(r,t))}function ze(e){return(e=e[Be])instanceof Ve?e:null}var $e="__closure_events_fn_"+(1e9*Math.random()>>>0);function We(t){return"function"==typeof t?t:(t[$e]||(t[$e]=function(e){return t.handleEvent(e)}),t[$e])}function s(){se.call(this),this.i=new Ve(this),(this.P=this).I=null}function He(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t?t=new ue(t,e):t instanceof ue?t.target=t.target||e:(a=t,Fe(t=new ue(r,e),a)),a=!0,n)for(var s=n.length-1;0<=s;s--)var i=t.g=n[s],a=Ye(i,r,!0,t)&&a;if(a=Ye(i=t.g=e,r,!0,t)&&a,a=Ye(i,r,!1,t)&&a,n)for(s=0;s<n.length;s++)a=Ye(i=t.g=n[s],r,!1,t)&&a}function Ye(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,i=0;i<t.length;++i){var a,o,u=t[i];u&&!u.ba&&u.capture==n&&(a=u.listener,o=u.ha||u.src,u.ea&&Pe(e.i,u),s=!1!==a.call(o,r)&&s)}return s&&!r.defaultPrevented}re(s,se),s.prototype[Ce]=!0,s.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,s,i){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,s,i);else s=J(s)?!!s.capture:!!s,r=We(r),t&&t[Ce]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=qe(a=t.g[n],r,s,i))&&(Re(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):(t=t&&ze(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?qe(n,r,s,i):t)?n[t]:null)&&Ke(r))}(this,e,t,n,r)},s.prototype.M=function(){if(s.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Re(n[r]);delete t.g[e],t.h--}}this.I=null},s.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},s.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Xe,Je=w.JSON.stringify,Ze=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new et,e=>e.reset());class et{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function tt(e,t){var n;Xe||(n=w.Promise.resolve(void 0),Xe=function(){n.then(st)}),nt||(Xe(),nt=!0),rt.add(e,t)}var nt=!1,rt=new class{constructor(){this.h=this.g=null}add(e,t){const n=Ze.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function st(){for(var e;e=function(){var e=rt;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){w.setTimeout(()=>{throw e},0)}(e)}var t=Ze;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}nt=!1}function it(e,t){s.call(this),this.h=e||1,this.g=t||w,this.j=te(this.lb,this),this.l=Date.now()}function at(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function ot(e,t,n){if("function"==typeof e)n&&(e=te(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=te(e.handleEvent,e)}return 2147483647<Number(t)?-1:w.setTimeout(e,t||0)}re(it,s),(e=it.prototype).ca=!1,e.R=null,e.lb=function(){var e;this.ca&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),He(this,"tick"),this.ca&&(at(this),this.start())))},e.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},e.M=function(){it.X.M.call(this),at(this),delete this.g};class ut extends se{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=ot(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}M(){super.M(),this.g&&(w.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ct(e){se.call(this),this.h=e,this.g={}}re(ct,se);var ht=[];function lt(e,t,n,r){Array.isArray(n)||(n&&(ht[0]=n.toString()),n=ht);for(var s=0;s<n.length;s++){var i=function e(t,n,r,s,i){if(s&&s.once)return function e(t,n,r,s,i){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,s,i);return null}return r=We(r),t&&t[Ce]?t.O(n,r,J(s)?!!s.capture:!!s,i):Ge(t,n,r,!0,s,i)}(t,n,r,s,i);if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,s,i);return null}return r=We(r),t&&t[Ce]?t.N(n,r,J(s)?!!s.capture:!!s,i):Ge(t,n,r,!1,s,i)}(t,n[s],r||e.handleEvent,!1,e.h||e);if(!i)break;e.g[i.key]=i}}function dt(e){Le(e.g,function(e,t){this.g.hasOwnProperty(t)&&Ke(e)},e),e.g={}}function ft(){this.g=!0}function gt(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var s=r[1];if(Array.isArray(s)&&!(s.length<1)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var a=1;a<s.length;a++)s[a]=""}}}return Je(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}ct.prototype.M=function(){ct.X.M.call(this),dt(this)},ct.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ft.prototype.Aa=function(){this.g=!1},ft.prototype.info=function(){};var mt={},pt=null;function yt(){return pt=pt||new s}function vt(e){ue.call(this,mt.Pa,e)}function wt(){var e=yt();He(e,new vt(e))}function It(e,t){ue.call(this,mt.STAT_EVENT,e),this.stat=t}function bt(e){var t=yt();He(t,new It(t,e))}function Tt(e,t){ue.call(this,mt.Qa,e),this.size=t}function Et(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return w.setTimeout(function(){e()},t)}mt.Pa="serverreachability",re(vt,ue),mt.STAT_EVENT="statevent",re(It,ue),mt.Qa="timingevent",re(Tt,ue);be={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},ye={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function _t(){}function St(e){return e.h||(e.h=e.i())}function xt(){}function Dt(){ue.call(this,"d")}function At(){ue.call(this,"c")}function Ct(){}function Nt(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new ct(this),this.O=Lt,this.T=new it(e=we?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new kt}function kt(){this.i=null,this.g="",this.h=!1}_t.prototype.h=null,H={OPEN:"a",qb:"b",Na:"c",Cb:"d"},re(Dt,ue),re(At,ue),re(Ct,_t),Ct.prototype.g=function(){return new XMLHttpRequest},Ct.prototype.i=function(){return{}};var Rt=new Ct,Lt=45e3,Mt={},Ot={};function Ft(e,t,n){e.K=1,e.v=Zt(Ht(t)),e.s=n,e.P=!0,Vt(e,null)}function Vt(e,t){e.F=Date.now(),Bt(e),e.A=Ht(e.v);var a,o,u,c,h,l,n=e.A,r=e.U;Array.isArray(r)||(r=[String(r)]),fn(n.i,"t",r),e.C=0,n=e.l.H,e.h=new kt,e.g=lr(e.l,n?t:null,!e.s),0<e.N&&(e.L=new ut(te(e.La,e,e.g),e.N)),lt(e.S,e.g,"readystatechange",e.ib),t=e.H?Me(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),wt(),a=e.j,o=e.u,u=e.A,c=e.m,h=e.U,l=e.s,a.info(function(){if(a.g)if(l)for(var e="",t=l.split("&"),n=0;n<t.length;n++){var r,s,i=t[n].split("=");1<i.length&&(r=i[0],i=i[1],e=2<=(s=r.split("_")).length&&"type"==s[1]?e+(r+"=")+i+"&":e+(r+"=redacted&"))}else e=null;else e=l;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+o+"\n"+u+"\n"+e})}function Pt(e){return e.g&&"GET"==e.u&&2!=e.K&&e.l.Da}function qt(e,t,n){let r=!0,s;for(;!e.I&&e.C<n.length;){if((s=(u=void 0,o=(i=e).C,-1==(u=(a=n).indexOf("\n",o))?Ot:(o=Number(a.substring(o,u)),isNaN(o)?Mt:(u+=1)+o>a.length?Ot:(a=a.substr(u,o),i.C=u+o,a))))==Ot){4==t&&(e.o=4,bt(14),r=!1),gt(e.j,e.m,null,"[Incomplete Response]");break}if(s==Mt){e.o=4,bt(15),gt(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}gt(e.j,e.m,s,null),Qt(e,s)}var i,a,o,u;Pt(e)&&s!=Ot&&s!=Mt&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,bt(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),rr(t),t.K=!0,bt(11))):(gt(e.j,e.m,n,"[Invalid Chunked Response]"),jt(e),Kt(e))}function Bt(e){e.V=Date.now()+e.O,Ut(e,e.O)}function Ut(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Et(te(e.gb,e),t)}function Gt(e){e.B&&(w.clearTimeout(e.B),e.B=null)}function Kt(e){0==e.l.G||e.I||ar(e.l,e)}function jt(e){Gt(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,at(e.T),dt(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Qt(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||In(n.h,e)))if(!e.J&&In(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;ir(n),Hn(n)}nr(n),bt(18)}}else n.Ba=s[1],0<n.Ba-n.T&&s[2]<37500&&n.L&&0==n.A&&!n.v&&(n.v=Et(te(n.cb,n),6e3));if(wn(n.h)<=1&&n.ja){try{n.ja()}catch(e){}n.ja=void 0}}else ur(n,11)}else if(!e.J&&n.g!=e||ir(n),!he(t))for(s=n.Fa.g.parse(t),t=0;t<s.length;t++){var i=s[t];if(n.T=i[0],i=i[1],2==n.G)if("c"==i[0]){n.I=i[1],n.ka=i[2];var a=i[3],o=(null!=a&&(n.ma=a,n.j.info("VER="+n.ma)),i[4]);null!=o&&(n.Ca=o,n.j.info("SVER="+n.Ca));var u,c,h=i[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const g=e.g;if(g){const m=g.g?g.g.getResponseHeader("X-Client-Wire-Protocol"):null;!m||(u=r.h).g||-1==m.indexOf("spdy")&&-1==m.indexOf("quic")&&-1==m.indexOf("h2")||(u.j=u.l,u.g=new Set,u.h&&(bn(u,u.h),u.h=null)),r.D&&(c=g.g?g.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.za=c,p(r.F,r.D,c))}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms"));var l,d,f=e;(r=n).sa=hr(r,r.H?r.ka:null,r.V),f.J?(Tn(r.h,f),l=f,(d=r.J)&&l.setTimeout(d),l.B&&(Gt(l),Bt(l)),r.g=f):tr(r),0<n.i.length&&Xn(n)}else"stop"!=i[0]&&"close"!=i[0]||ur(n,7);else 3==n.G&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?ur(n,7):Wn(n):"noop"!=i[0]&&n.l&&n.l.wa(i),n.A=0)}wt()}catch(e){}}function zt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(X(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(X(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(X(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),s=r.length,i=0;i<s;i++)t.call(void 0,r[i],n&&n[i],e)}(e=Nt.prototype).setTimeout=function(e){this.O=e},e.ib=function(e){e=e.target;const t=this.L;t&&3==Gn(e)?t.l():this.La(e)},e.La=function(e){try{if(e==this.g)e:{var t=Gn(this.g),n=this.g.Ea();if(this.g.aa(),!(t<3)&&(3!=t||we||this.g&&(this.h.h||this.g.fa()||Kn(this.g)))){this.I||4!=t||7==n||wt(),Gt(this);var r=this.g.aa();this.Y=r;t:if(Pt(this)){var s=Kn(this.g),i=(e="",s.length),a=4==Gn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){jt(this),Kt(this);var o="";break t}this.h.i=new w.TextDecoder}for(n=0;n<i;n++)this.h.h=!0,e+=this.h.i.decode(s[n],{stream:a&&n==i-1});s.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==r,l=this.j,d=this.u,f=this.A,g=this.m,m=this.U,p=t,y=r,l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+m+"]: "+d+"\n"+f+"\n"+p+" "+y}),this.i){if(this.Z&&!this.J){t:{if(this.g){var u,c=this.g;if((u=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!he(u)){var h=u;break t}}h=null}if(!(r=h)){this.i=!1,this.o=3,bt(12),jt(this),Kt(this);break e}gt(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Qt(this,r)}this.P?(qt(this,t,o),we&&this.i&&3==t&&(lt(this.S,this.T,"tick",this.hb),this.T.start())):(gt(this.j,this.m,o,null),Qt(this,o)),4==t&&jt(this),this.i&&!this.I&&(4==t?ar(this.l,this):(this.i=!1,Bt(this)))}else 400==r&&0<o.indexOf("Unknown SID")?(this.o=3,bt(12)):(this.o=0,bt(13)),jt(this),Kt(this)}}}catch(e){}var l,d,f,g,m,p,y},e.hb=function(){var e,t;this.g&&(e=Gn(this.g),t=this.g.fa(),this.C<t.length&&(Gt(this),qt(this,e,t),this.i&&4!=e&&Bt(this)))},e.cancel=function(){this.I=!0,jt(this)},e.gb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.V?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&(wt(),bt(17)),jt(this),this.o=2,Kt(this)):Ut(this,this.V-n)};var $t=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Wt(e,t){var n;this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Wt?(this.h=void 0!==t?t:e.h,Yt(this,e.j),this.s=e.s,this.g=e.g,Xt(this,e.m),this.l=e.l,t=e.i,(n=new cn).i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Jt(this,n),this.o=e.o):e&&(n=String(e).match($t))?(this.h=!!t,Yt(this,n[1]||"",!0),this.s=en(n[2]||""),this.g=en(n[3]||"",!0),Xt(this,n[4]),this.l=en(n[5]||"",!0),Jt(this,n[6]||"",!0),this.o=en(n[7]||"")):(this.h=!!t,this.i=new cn(null,this.h))}function Ht(e){return new Wt(e)}function Yt(e,t,n){e.j=n?en(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Xt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Jt(e,t,n){var r,s;t instanceof cn?(e.i=t,r=e.i,(s=e.h)&&!r.j&&(hn(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(ln(this,t),fn(this,n,e))},r)),r.j=s):(n||(t=tn(t,on)),e.i=new cn(t,e.h))}function p(e,t,n){e.i.set(t,n)}function Zt(e){return p(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function en(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function tn(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,nn),n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function nn(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Wt.prototype.toString=function(){var e=[],t=this.j,n=(t&&e.push(tn(t,rn,!0),":"),this.g);return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(tn(t,rn,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(tn(n,"/"==n.charAt(0)?an:sn,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",tn(n,un)),e.join("")};var rn=/[#\/\?@]/g,sn=/[#\?:]/g,an=/[#\?]/g,on=/[#\?@]/g,un=/#/g;function cn(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function hn(e){if(!e.g&&(e.g=new Map,e.h=0,e.i)){var t=e.i;if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,s=t[n].indexOf("="),i=null;0<=s?(r=t[n].substring(0,s),i=t[n].substring(s+1)):r=t[n],s=r,i=i?decodeURIComponent(i.replace(/\+/g," ")):"",e.add(decodeURIComponent(s.replace(/\+/g," ")),i)}}}}function ln(e,t){hn(e),t=gn(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function dn(e,t){return hn(e),t=gn(e,t),e.g.has(t)}function fn(e,t,n){ln(e,t),0<n.length&&(e.i=null,e.g.set(gn(e,t),ae(n)),e.h+=n.length)}function gn(e,t){return t=String(t),e.j?t.toLowerCase():t}(e=cn.prototype).add=function(e,t){hn(this),this.i=null,e=gn(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(n,r){hn(this),this.g.forEach(function(e,t){e.forEach(function(e){n.call(r,e,t,this)},this)},this)},e.oa=function(){hn(this);const e=Array.from(this.g.values()),n=Array.from(this.g.keys()),r=[];for(let t=0;t<n.length;t++){var s=e[t];for(let e=0;e<s.length;e++)r.push(n[t])}return r},e.W=function(t){hn(this);let n=[];if("string"==typeof t)dn(this,t)&&(n=n.concat(this.g.get(gn(this,t))));else{t=Array.from(this.g.values());for(let e=0;e<t.length;e++)n=n.concat(t[e])}return n},e.set=function(e,t){return hn(this),this.i=null,dn(this,e=gn(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++)for(var r=t[n],s=encodeURIComponent(String(r)),i=this.W(r),r=0;r<i.length;r++){var a=s;""!==i[r]&&(a+="="+encodeURIComponent(String(i[r]))),e.push(a)}return this.i=e.join("&")};var mn,pn=class{constructor(e,t){this.h=e,this.g=t}};function yn(e){this.l=e||10,e=w.PerformanceNavigationTiming?0<(e=w.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(w.g&&w.g.Ga&&w.g.Ga()&&w.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function vn(e){return e.h||e.g&&e.g.size>=e.j}function wn(e){return e.h?1:e.g?e.g.size:0}function In(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function bn(e,t){e.g?e.g.add(t):e.h=t}function Tn(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function En(t){if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return ae(t.i);{let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}}function _n(){}function Sn(){this.g=new _n}function xn(e,t,n,r,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(r)}catch(e){}}function Dn(e){this.l=e.ac||null,this.j=e.jb||!1}function An(e,t){s.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=Cn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}yn.prototype.cancel=function(){if(this.i=En(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},_n.prototype.stringify=function(e){return w.JSON.stringify(e,void 0)},_n.prototype.parse=function(e){return w.JSON.parse(e,void 0)},re(Dn,_t),Dn.prototype.g=function(){return new An(this.l,this.j)},Dn.prototype.i=(mn={},function(){return mn}),re(An,s);var Cn=0;function Nn(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function kn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Rn(e)}function Rn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(e=An.prototype).open=function(e,t){if(this.readyState!=Cn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Rn(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||w).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,kn(this)),this.readyState=Cn},e.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Rn(this)),this.g&&(this.readyState=3,Rn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==w.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Nn(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))},e.Ta=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?kn:Rn)(this),3==this.readyState&&Nn(this))},e.Va=function(e){this.g&&(this.response=this.responseText=e,kn(this))},e.Ua=function(e){this.g&&(this.response=e,kn(this))},e.ga=function(){this.g&&kn(this)},e.setRequestHeader=function(e,t){this.v.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(An.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Ln=w.JSON.parse;function r(e){s.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Mn,this.K=this.L=!1}re(r,s);var Mn="",On=/^https?$/i,Fn=["POST","PUT"];function Vn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Pn(e),Bn(e)}function Pn(e){e.D||(e.D=!0,He(e,"complete"),He(e,"error"))}function qn(e){if(e.h&&(!e.C[1]||4!=Gn(e)||2!=e.aa()))if(e.v&&4==Gn(e))ot(e.Ha,0,e);else if(He(e,"readystatechange"),4==Gn(e)){e.h=!1;try{var t,n,r,s,i=e.aa();switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break;default:a=!1}if((t=a)||((n=0===i)&&(!(s=String(e.H).match($t)[1]||null)&&w.self&&w.self.location&&(s=(r=w.self.location.protocol).substr(0,r.length-1)),n=!On.test(s?s.toLowerCase():"")),t=n),t)He(e,"complete"),He(e,"success");else{e.m=6;try{var o=2<Gn(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.aa()+"]",Pn(e)}}finally{Bn(e)}}}function Bn(e,t){if(e.g){Un(e);const n=e.g,r=e.C[0]?Y:null;e.g=null,e.C=null,t||He(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Un(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(w.clearTimeout(e.A),e.A=null)}function Gn(e){return e.g?e.g.readyState:0}function Kn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Mn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function jn(e){let n="";return Le(e,function(e,t){n=(n=n+t+":")+e+"\r\n"}),n}function Qn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=jn(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):p(e,t,n))}function zn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function $n(e){this.Ca=0,this.i=[],this.j=new ft,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=zn("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=zn("baseRetryDelayMs",5e3,e),this.bb=zn("retryDelaySeedMs",1e4,e),this.$a=zn("forwardChannelMaxRetries",2,e),this.ta=zn("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new yn(e&&e.concurrentRequestLimit),this.Fa=new Sn,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Wn(e){var t,n;Yn(e),3==e.G&&(t=e.U++,p(n=Ht(e.F),"SID",e.I),p(n,"RID",t),p(n,"TYPE","terminate"),Zn(e,n),(t=new Nt(e,e.j,t,void 0)).K=2,t.v=Zt(Ht(n)),n=!1,!(n=w.navigator&&w.navigator.sendBeacon?w.navigator.sendBeacon(t.v.toString(),""):n)&&w.Image&&((new Image).src=t.v,n=!0),n||(t.g=lr(t.l,null),t.g.da(t.v)),t.F=Date.now(),Bt(t)),cr(e)}function Hn(e){e.g&&(rr(e),e.g.cancel(),e.g=null)}function Yn(e){Hn(e),e.u&&(w.clearTimeout(e.u),e.u=null),ir(e),e.h.cancel(),e.m&&("number"==typeof e.m&&w.clearTimeout(e.m),e.m=null)}function Xn(e){vn(e.h)||e.m||(e.m=!0,tt(e.Ja,e),e.C=0)}function Jn(e,t){var n=t?t.m:e.U++,r=Ht(e.F);p(r,"SID",e.I),p(r,"RID",n),p(r,"AID",e.T),Zn(e,r),e.o&&e.s&&Qn(r,e.o,e.s),n=new Nt(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=er(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),bn(e.h,n),Ft(n,r,t)}function Zn(e,n){e.ia&&Le(e.ia,function(e,t){p(n,t,e)}),e.l&&zt({},function(e,t){p(n,t,e)})}function er(r,e,s){s=Math.min(r.i.length,s);var i=r.l?te(r.l.Ra,r.l,r):null;e:{var a=r.i;let n=-1;for(;;){const c=["count="+s];-1==n?0<s?(n=a[0].h,c.push("ofs="+n)):n=0:c.push("ofs="+n);let t=!0;for(let e=0;e<s;e++){var o=a[e].h,u=a[e].g;if((o-=n)<0)n=Math.max(0,a[e].h-100),t=!1;else try{!function(e,r){const s="req"+o+"_"||"";try{zt(e,function(e,t){let n=e;J(e)&&(n=Je(e)),r.push(s+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(s+"type="+encodeURIComponent("_badmap")),e}}(u,c)}catch(r){i&&i(u)}}if(t){i=c.join("&");break e}}}return r=r.i.splice(0,s),e.D=r,i}function tr(e){e.g||e.u||(e.Z=1,tt(e.Ia,e),e.A=0)}function nr(e){return!(e.g||e.u||3<=e.A)&&(e.Z++,e.u=Et(te(e.Ia,e),or(e,e.A)),e.A++,1)}function rr(e){null!=e.B&&(w.clearTimeout(e.B),e.B=null)}function sr(e){e.g=new Nt(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=Ht(e.sa),n=(p(t,"RID","rpc"),p(t,"SID",e.I),p(t,"CI",e.L?"0":"1"),p(t,"AID",e.T),p(t,"TYPE","xmlhttp"),Zn(e,t),e.o&&e.s&&Qn(t,e.o,e.s),e.J&&e.g.setTimeout(e.J),e.g);e=e.ka,n.K=1,n.v=Zt(Ht(t)),n.s=null,n.P=!0,Vt(n,e)}function ir(e){null!=e.v&&(w.clearTimeout(e.v),e.v=null)}function ar(e,t){var n,r,s,i=null;if(e.g==t){ir(e),rr(e),e.g=null;var a=2}else{if(!In(e.h,t))return;i=t.D,Tn(e.h,t),a=1}if(0!=e.G)if(e.pa=t.Y,t.i)1==a?(i=t.s?t.s.length:0,t=Date.now()-t.F,n=e.C,He(a=yt(),new Tt(a,i)),Xn(e)):tr(e);else if(3==(n=t.o)||0==n&&0<e.pa||(1!=a||(s=t,wn((r=e).h)>=r.h.j-(r.m?1:0)||(r.m?(r.i=s.D.concat(r.i),0):1==r.G||2==r.G||r.C>=(r.Za?0:r.$a)||(r.m=Et(te(r.Ja,r,s),or(r,r.C)),r.C++,0))))&&(2!=a||!nr(e)))switch(i&&0<i.length&&(t=e.h,t.i=t.i.concat(i)),n){case 1:ur(e,5);break;case 4:ur(e,10);break;case 3:ur(e,6);break;default:ur(e,2)}}function or(e,t){let n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function ur(e,t){if(e.j.info("Error code "+t),2==t){n=null,e.l&&(n=null),r=te(e.kb,e),n||(n=new Wt("//www.google.com/images/cleardot.gif"),w.location&&"http"==w.location.protocol||Yt(n,"https"),Zt(n));var n=n.toString(),r,s=new ft;if(w.Image){const i=new Image;i.onload=ne(xn,s,i,"TestLoadImage: loaded",!0,r),i.onerror=ne(xn,s,i,"TestLoadImage: error",!1,r),i.onabort=ne(xn,s,i,"TestLoadImage: abort",!1,r),i.ontimeout=ne(xn,s,i,"TestLoadImage: timeout",!1,r),w.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n}else r(!1)}else bt(2);e.G=0,e.l&&e.l.va(t),cr(e),Yn(e)}function cr(e){var t;e.G=0,e.la=[],e.l&&(0==(t=En(e.h)).length&&0==e.i.length||(oe(e.la,t),oe(e.la,e.i),e.h.i.length=0,ae(e.i),e.i.length=0),e.l.ua())}function hr(e,t,n){var r,s,i=n instanceof Wt?Ht(n):new Wt(n,void 0);return""!=i.g?(t&&(i.g=t+"."+i.g),Xt(i,i.m)):(i=(r=w.location).protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port,s=new Wt(null,void 0),i&&Yt(s,i),t&&(s.g=t),r&&Xt(s,r),n&&(s.l=n),i=s),n=e.D,t=e.za,n&&t&&p(i,n,t),p(i,"VER",e.ma),Zn(e,i),i}function lr(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Da&&!e.ra?new r(new Dn({jb:!0})):new r(e.ra)).Ka(e.H),t}function dr(){}function fr(){if(ve&&!(10<=Number(xe)))throw Error("Environmental error: no available transport.")}function gr(e,t){s.call(this),this.g=new $n(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!he(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!he(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new yr(this)}function mr(e){Dt.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function pr(){At.call(this),this.status=1}function yr(e){this.g=e}(e=r.prototype).Ka=function(e){this.L=e},e.da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||Rt).g(),this.C=this.u?St(this.u):St(Rt),this.g.onreadystatechange=te(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void Vn(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const h of r.keys())n.set(h,r.get(h))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=w.FormData&&e instanceof w.FormData,0<=ie(Fn,t)&&!r&&!s&&n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(var[i,a]of n)this.g.setRequestHeader(i,a);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Un(this),0<this.B&&((this.K=(c=this.g,ve&&(o=function(){let t=0;var n=le(String(pe)).split("."),r=le("9").split("."),s=Math.max(n.length,r.length);for(let e=0;0==t&&e<s;e++)for(var i=n[e]||"",a=r[e]||"";i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],(0!=i[0].length||0!=a[0].length)&&(t=de(0==i[1].length?0:parseInt(i[1],10),0==a[1].length?0:parseInt(a[1],10))||de(0==i[2].length,0==a[2].length)||de(i[2],a[2]),i=i[3],a=a[3],0==t););return 0<=t},u=Se,Object.prototype.hasOwnProperty.call(u,9)?u[9]:u[9]=o())&&"number"==typeof c.timeout&&void 0!==c.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=te(this.qa,this)):this.A=ot(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Vn(this,e)}var o,u,c},e.qa=function(){this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,He(this,"timeout"),this.abort(8))},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,He(this,"complete"),He(this,"abort"),Bn(this))},e.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Bn(this,!0)),r.X.M.call(this)},e.Ha=function(){this.s||(this.F||this.v||this.l?qn(this):this.fb())},e.fb=function(){qn(this)},e.aa=function(){try{return 2<Gn(this)?this.g.status:-1}catch(e){return-1}},e.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Sa=function(e){var t;if(this.g)return t=this.g.responseText,e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Ln(t)},e.Ea=function(){return this.m},e.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(e=$n.prototype).ma=8,e.G=1,e.Ja=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const i=new Nt(this,this.j,t,void 0);let e=this.s;if(this.S&&(e?Fe(e=Me(e),this.S):e=this.S),null!==this.o||this.N||(i.H=e,e=null),this.O)e:{for(var n=0,r=0;r<this.i.length;r++){var s=this.i[r];if(void 0===(s="__data__"in s.g&&"string"==typeof(s=s.g.__data__)?s.length:void 0))break;if(4096<(n+=s)){n=r;break e}if(4096===n||r===this.i.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=er(this,i,n),p(r=Ht(this.F),"RID",t),p(r,"CVER",22),this.D&&p(r,"X-HTTP-Session-Id",this.D),Zn(this,r),e&&(this.N?n="headers="+encodeURIComponent(String(jn(e)))+"&"+n:this.o&&Qn(r,this.o,e)),bn(this.h,i),this.Ya&&p(r,"TYPE","init"),this.O?(p(r,"$req",n),p(r,"SID","null"),i.Z=!0,Ft(i,r,null)):Ft(i,r,n),this.G=2}}else 3==this.G&&(t?Jn(this,t):0==this.i.length||vn(this.h)||Jn(this))},e.Ia=function(){var e;this.u=null,sr(this),this.$&&!(this.K||null==this.g||this.P<=0)&&(e=2*this.P,this.j.info("BP detection timer enabled: "+e),this.B=Et(te(this.eb,this),e))},e.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,bt(10),Hn(this),sr(this))},e.cb=function(){null!=this.v&&(this.v=null,Hn(this),nr(this),bt(19))},e.kb=function(e){e?(this.j.info("Successfully pinged google.com"),bt(2)):(this.j.info("Failed to ping google.com"),bt(1))},(e=dr.prototype).xa=function(){},e.wa=function(){},e.va=function(){},e.ua=function(){},e.Ra=function(){},fr.prototype.g=function(e,t){return new gr(e,t)},re(gr,s),gr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;bt(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=hr(e,null,e.V),Xn(e)},gr.prototype.close=function(){Wn(this.g)},gr.prototype.u=function(e){var t,n=this.g;"string"==typeof e?((t={}).__data__=e,e=t):this.v&&((t={}).__data__=Je(e),e=t),n.i.push(new pn(n.ab++,e)),3==n.G&&Xn(n)},gr.prototype.M=function(){this.g.l=null,delete this.j,Wn(this.g),delete this.g,gr.X.M.call(this)},re(mr,Dt),re(pr,At),re(yr,dr),yr.prototype.xa=function(){He(this.g,"a")},yr.prototype.wa=function(e){He(this.g,new mr(e))},yr.prototype.va=function(e){He(this.g,new pr)},yr.prototype.ua=function(){He(this.g,"b")},fr.prototype.createWebChannel=fr.prototype.g,gr.prototype.send=gr.prototype.u,gr.prototype.open=gr.prototype.m,be.NO_ERROR=0,be.TIMEOUT=8,be.HTTP_ERROR=6,ye.COMPLETE="complete",(xt.EventType=H).OPEN="a",H.CLOSE="b",H.ERROR="c",H.MESSAGE="d",s.prototype.listen=s.prototype.N,r.prototype.listenOnce=r.prototype.O,r.prototype.getLastError=r.prototype.Oa,r.prototype.getLastErrorCode=r.prototype.Ea,r.prototype.getStatus=r.prototype.aa,r.prototype.getResponseJson=r.prototype.Sa,r.prototype.getResponseText=r.prototype.fa,r.prototype.send=r.prototype.da,r.prototype.setWithCredentials=r.prototype.Ka;var d,vr,wr=yt,Ir=be,br=ye,Tr=mt,Er=Dn,_r=xt,Sr=r,_e="@firebase/firestore";class o{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}o.UNAUTHENTICATED=new o(null),o.GOOGLE_CREDENTIALS=new o("google-credentials-uid"),o.FIRST_PARTY=new o("first-party-uid"),o.MOCK_USER=new o("mock-user");let xr="9.15.0-20221206221533";const Dr=new class{constructor(e){this.name=e,this._logLevel=z,this._logHandler=W,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in l))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?Q[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,l.DEBUG,...e),this._logHandler(this,l.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,l.VERBOSE,...e),this._logHandler(this,l.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,l.INFO,...e),this._logHandler(this,l.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,l.WARN,...e),this._logHandler(this,l.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,l.ERROR,...e),this._logHandler(this,l.ERROR,...e)}}("@firebase/firestore");function Ar(){return Dr.logLevel}function f(e,...t){Dr.logLevel<=l.DEBUG&&(t=t.map(Nr),Dr.debug(`Firestore (${xr}): `+e,...t))}function g(e,...t){Dr.logLevel<=l.ERROR&&(t=t.map(Nr),Dr.error(`Firestore (${xr}): `+e,...t))}function Cr(e,...t){Dr.logLevel<=l.WARN&&(t=t.map(Nr),Dr.warn(`Firestore (${xr}): `+e,...t))}function Nr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function T(e="Unexpected state"){e=`FIRESTORE (${xr}) INTERNAL ASSERTION FAILED: `+e;throw g(e),new Error(e)}function y(e){e||T()}const I={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class b extends c{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: `+this.message}}class m{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class kr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer "+e)}}class Rr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(o.UNAUTHENTICATED))}shutdown(){}}class Lr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Mr{constructor(e){this.t=e,this.currentUser=o.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const s=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let i=new m;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new m,t.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const e=i;t.enqueueRetryable(async()=>{await e.promise,await s(this.currentUser)})},o=e=>{f("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(e=>o(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?o(e):(f("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new m))},0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(f("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(y("string"==typeof e.accessToken),new kr(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return y(null===e||"string"==typeof e),new o(e)}}class Or{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r,this.type="FirstParty",this.user=o.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(y(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);var e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Fr{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r}getToken(){return Promise.resolve(new Or(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(o.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Vr{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class Pr{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(t,n){const r=e=>{null!=e.error&&f("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: "+e.error.message);var t=e.token!==this.A;return this.A=e.token,f("FirebaseAppCheckTokenProvider",`Received ${t?"new":"existing"} token.`),t?n(e.token):Promise.resolve()},s=(this.o=e=>{t.enqueueRetryable(()=>r(e))},e=>{f("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)});this.T.onInit(e=>s(e)),setTimeout(()=>{var e;this.appCheck||((e=this.T.getImmediate({optional:!0}))?s(e):f("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(y("string"==typeof e.token),this.A=e.token,new Vr(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class qr{static R(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var s=function(){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(40);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let e=0;e<40;e++)t[e]=Math.floor(256*Math.random());return t}();for(let e=0;e<s.length;++e)r.length<20&&s[e]<n&&(r+=t.charAt(s[e]%t.length))}return r}}function E(e,t){return e<t?-1:t<e?1:0}function Br(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function Ur(e){return e+"\0"}class h{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new b(I.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new b(I.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new b(I.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new b(I.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return h.fromMillis(Date.now())}static fromDate(e){return h.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),e=Math.floor(1e6*(e-1e3*t));return new h(t,e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?E(this.nanoseconds,e.nanoseconds):E(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class _{constructor(e){this.timestamp=e}static fromTimestamp(e){return new _(e)}static min(){return new _(new h(0,0))}static max(){return new _(new h(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Gr{constructor(e,t,n){void 0===t?t=0:t>e.length&&T(),void 0===n?n=e.length-t:n>e.length-t&&T(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Gr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Gr?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(n){for(let e=this.offset,t=this.limit();e<t;e++)n(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,n){const r=Math.min(t.length,n.length);for(let e=0;e<r;e++){const r=t.get(e),s=n.get(e);if(r<s)return-1;if(r>s)return 1}return t.length<n.length?-1:t.length>n.length?1:0}}class S extends Gr{construct(e,t,n){return new S(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new b(I.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new S(t)}static emptyPath(){return new S([])}}const Kr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class x extends Gr{construct(e,t,n){return new x(e,t,n)}static isValidIdentifier(e){return Kr.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=x.isValidIdentifier(e)?e:"`"+e+"`")).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new x(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var s=()=>{if(0===n.length)throw new b(I.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new b(I.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new b(I.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?i=!i:"."!==t||i?n+=t:s(),r++}if(s(),i)throw new b(I.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new x(t)}static emptyPath(){return new x([])}}class D{constructor(e){this.path=e}static fromPath(e){return new D(S.fromString(e))}static fromName(e){return new D(S.fromString(e).popFirst(5))}static empty(){return new D(S.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===S.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return S.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new D(new S(e.slice()))}}class jr{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function Qr(e){return e.fields.find(e=>2===e.kind)}function zr(e){return e.fields.filter(e=>2!==e.kind)}jr.UNKNOWN_ID=-1;class $r{constructor(e,t){this.fieldPath=e,this.kind=t}}class Wr{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Wr(0,Xr.min())}}function Hr(e,t){var n=e.toTimestamp().seconds,e=e.toTimestamp().nanoseconds+1,e=_.fromTimestamp(1e9===e?new h(n+1,0):new h(n,e));return new Xr(e,D.empty(),t)}function Yr(e){return new Xr(e.readTime,e.key,-1)}class Xr{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Xr(_.min(),D.empty(),-1)}static max(){return new Xr(_.max(),D.empty(),-1)}}function Jr(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=D.comparator(e.documentKey,t.documentKey))?n:E(e.largestBatchId,t.largestBatchId)}const Zr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class es{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function ts(e){if(e.code!==I.FAILED_PRECONDITION||e.message!==Zr)throw e;f("LocalStore","Unexpectedly lost primary lease")}class A{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,s){return this.callbackAttached&&T(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(r,this.result):new A((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(s,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof A?t:A.resolve(t)}catch(e){return A.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):A.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):A.reject(t)}static resolve(n){return new A((e,t)=>{e(n)})}static reject(n){return new A((e,t)=>{t(n)})}static waitFor(e){return new A((t,n)=>{let r=0,s=0,i=!1;e.forEach(e=>{++r,e.next(()=>{++s,i&&s===r&&t()},e=>n(e))}),i=!0,s===r&&t()})}static or(e){let t=A.resolve(!1);for(const n of e)t=t.next(e=>e?A.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}static mapArray(o,u){return new A((t,n)=>{const r=o.length,s=new Array(r);let i=0;for(let e=0;e<r;e++){const a=e;u(o[a]).next(e=>{s[a]=e,++i===r&&t(s)},e=>n(e))}})}static doWhile(r,s){return new A((e,t)=>{const n=()=>{!0===r()?s().next(()=>{n()},t):e()};n()})}}class ns{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.P=new m,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{e.error?this.P.reject(new is(t,e.error)):this.P.resolve()},this.transaction.onerror=e=>{e=hs(e.target.error);this.P.reject(new is(t,e))}}static open(e,t,n,r){try{return new ns(t,e.transaction(r,n))}catch(e){throw new is(t,e)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(f("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){e=this.transaction.objectStore(e);return new os(e)}}class rs{constructor(e,t,n){this.name=e,this.version=t,this.S=n,12.2===rs.D(u())&&g("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return f("SimpleDb","Removing database:",e),us(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!function(){try{return"object"==typeof indexedDB}catch(e){return}}())return!1;if(rs.N())return!0;const e=u(),t=rs.D(e),n=0<t&&t<10,r=rs.k(e),s=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||s)}static N(){var e;return"undefined"!=typeof process&&"YES"===(null==(e=process.env)?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static k(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async F(s){return this.db||(f("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{e=e.target.result;t(e)},r.onblocked=()=>{n(new is(s,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{e=e.target.error;"VersionError"===e.name?n(new b(I.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===e.name?n(new b(I.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+e)):n(new is(s,e))},r.onupgradeneeded=e=>{f("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.S.$(t,r.transaction,e.oldVersion,this.version).next(()=>{f("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var s="readonly"===t;let i=0;for(;;){++i;try{this.db=await this.F(e);const t=ns.open(this.db,e,s?"readonly":"readwrite",n),i=r(t).next(e=>(t.V(),e)).catch(e=>(t.abort(e),A.reject(e))).toPromise();return i.catch(()=>{}),await t.v,i}catch(e){const t=e,n="FirebaseError"!==t.name&&i<3;if(f("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class ss{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return us(this.q.delete())}}class is extends b{constructor(e,t){super(I.UNAVAILABLE,`IndexedDB transaction '${e}' failed: `+t),this.name="IndexedDbTransactionError"}}function as(e){return"IndexedDbTransactionError"===e.name}class os{constructor(e){this.store=e}put(e,t){return us(void 0!==t?(f("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(f("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)))}add(e){return f("SimpleDb","ADD",this.store.name,e,e),us(this.store.add(e))}get(t){return us(this.store.get(t)).next(e=>(f("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return f("SimpleDb","DELETE",this.store.name,e),us(this.store.delete(e))}count(){return f("SimpleDb","COUNT",this.store.name),us(this.store.count())}W(e,n){var t=this.options(e,n);if(t.index||"function"!=typeof this.store.getAll){const e=this.cursor(t),n=[];return this.H(e,(e,t)=>{n.push(t)}).next(()=>n)}{const e=this.store.getAll(t.range);return new A((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}J(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new A((t,n)=>{r.onerror=e=>{n(e.target.error)},r.onsuccess=e=>{t(e.target.result)}})}Y(e,t){f("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.X=!1;e=this.cursor(n);return this.H(e,(e,t,n)=>n.delete())}Z(e,t){let n;t?n=e:(n={},t=e);e=this.cursor(n);return this.H(e,t)}tt(r){const e=this.cursor({});return new A((n,t)=>{e.onerror=e=>{e=hs(e.target.error);t(e)},e.onsuccess=e=>{const t=e.target.result;t?r(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}H(e,i){const a=[];return new A((s,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new ss(t),r=i(t.primaryKey,t.value,n);if(r instanceof A){const e=r.catch(e=>(n.done(),A.reject(e)));a.push(e)}n.isDone?s():null===n.G?t.continue():t.continue(n.G)}else s()}}).next(()=>A.waitFor(a))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function us(e){return new A((t,n)=>{e.onsuccess=e=>{e=e.target.result;t(e)},e.onerror=e=>{e=hs(e.target.error);n(e)}})}let cs=!1;function hs(e){const t=rs.D(u());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new b("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return cs||(cs=!0,setTimeout(()=>{throw e},0)),e}}return e}class ls{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){f("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{f("IndexBackiller","Documents written: "+await this.et.st())}catch(e){as(e)?f("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await ts(e)}await this.nt(6e4)})}}class ds{constructor(e,t){this.localStore=e,this.persistence=t}async st(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.it(e,t))}it(e,t){const n=new Set;let r=t,s=!0;return A.doWhile(()=>!0===s&&0<r,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>null===t||n.has(t)?void(s=!1):(f("IndexBackiller","Processing collection: "+t),this.rt(e,t,r).next(e=>{r-=e,n.add(t)})))).next(()=>t-r)}rt(r,s,e){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(r,s).next(n=>this.localStore.localDocuments.getNextDocuments(r,s,n,e).next(e=>{const t=e.changes;return this.localStore.indexManager.updateIndexEntries(r,t).next(()=>this.ot(n,e)).next(e=>(f("IndexBackiller","Updating offset: "+e),this.localStore.indexManager.updateCollectionGroup(r,s,e))).next(()=>t.size)}))}ot(e,t){let n=e;return t.changes.forEach((e,t)=>{t=Yr(t);0<Jr(t,n)&&(n=t)}),new Xr(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class fs{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ut(e),this.ct=e=>t.writeSequenceNumber(e))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.ct&&this.ct(e),e}}fs.at=-1;class gs{constructor(e,t,n,r,s,i,a,o){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=a,this.useFetchStreams=o}}class ms{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ms("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof ms&&e.projectId===this.projectId&&e.database===this.database}}function ps(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ys(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function vs(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function ws(e){return null==e}function Is(e){return 0===e&&1/e==-1/0}function bs(e){return"number"==typeof e&&Number.isInteger(e)&&!Is(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class C{constructor(e){this.binaryString=e}static fromBase64String(e){e=atob(e);return new C(e)}static fromUint8Array(e){e=function(t){let n="";for(let e=0;e<t.length;++e)n+=String.fromCharCode(t[e]);return n}(e);return new C(e)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){{var t=this.binaryString;const n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return E(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}C.EMPTY_BYTE_STRING=new C("");const Ts=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Es(t){if(y(!!t),"string"!=typeof t)return{seconds:N(t.seconds),nanos:N(t.nanos)};{let e=0;var n=Ts.exec(t);y(!!n),n[1]&&(n=(n[1]+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function N(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function _s(e){return"string"==typeof e?C.fromBase64String(e):C.fromUint8Array(e)}function Ss(e){return"server_timestamp"===(null==(e=((null==(e=null==e?void 0:e.mapValue)?void 0:e.fields)||{}).__type__)?void 0:e.stringValue)}function xs(e){e=Es(e.mapValue.fields.__local_write_time__.timestampValue);return new h(e.seconds,e.nanos)}const Ds={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},As={nullValue:"NULL_VALUE"};function Cs(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Ss(e)?4:Gs(e)?9007199254740991:10:T()}function Ns(e,t){if(e===t)return!0;var n,r=Cs(e);if(r!==Cs(t))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return xs(e).isEqual(xs(t));case 3:var s=t;if("string"==typeof e.timestampValue&&"string"==typeof s.timestampValue&&e.timestampValue.length===s.timestampValue.length)return e.timestampValue===s.timestampValue;var i=Es(e.timestampValue),s=Es(s.timestampValue);return i.seconds===s.seconds&&i.nanos===s.nanos;case 5:return e.stringValue===t.stringValue;case 6:return n=t,_s(e.bytesValue).isEqual(_s(n.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return i=t,N((n=e).geoPointValue.latitude)===N(i.geoPointValue.latitude)&&N(n.geoPointValue.longitude)===N(i.geoPointValue.longitude);case 2:return s=t,"integerValue"in(n=e)&&"integerValue"in s?N(n.integerValue)===N(s.integerValue):"doubleValue"in n&&"doubleValue"in s&&((n=N(n.doubleValue))===(s=N(s.doubleValue))?Is(n)===Is(s):isNaN(n)&&isNaN(s));case 9:return Br(e.arrayValue.values||[],t.arrayValue.values||[],Ns);case 10:{var a=e;const o=a.mapValue.fields||{},u=t.mapValue.fields||{};if(ps(o)!==ps(u))return!1;for(const a in o)if(o.hasOwnProperty(a)&&(void 0===u[a]||!Ns(o[a],u[a])))return!1;return!0;return}default:return T()}}function ks(e,t){return void 0!==(e.values||[]).find(e=>Ns(e,t))}function Rs(e,t){if(e===t)return 0;var n=Cs(e),r=Cs(t);if(n!==r)return E(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return E(e.booleanValue,t.booleanValue);case 2:return f=t,(s=N(e.integerValue||e.doubleValue))<(c=N(f.integerValue||f.doubleValue))?-1:c<s?1:s===c?0:isNaN(s)?isNaN(c)?0:-1:1;case 3:return Ls(e.timestampValue,t.timestampValue);case 4:return Ls(xs(e),xs(t));case 5:return E(e.stringValue,t.stringValue);case 6:{var s=e.bytesValue;var i=t.bytesValue;const p=_s(s),y=_s(i);return p.compareTo(y);return}case 7:var i=e.referenceValue,a=t.referenceValue,o=i.split("/"),u=a.split("/");for(let e=0;e<o.length&&e<u.length;e++){const a=E(o[e],u[e]);if(0!==a)return a}return E(o.length,u.length);case 8:return a=e.geoPointValue,f=t.geoPointValue,0!==(c=E(N(a.latitude),N(f.latitude)))?c:E(N(a.longitude),N(f.longitude));case 9:var c=e.arrayValue,h=t.arrayValue,l=c.values||[],d=h.values||[];for(let e=0;e<l.length&&e<d.length;++e){const h=Rs(l[e],d[e]);if(h)return h}return E(l.length,d.length);case 10:{var f=e.mapValue;var g=t.mapValue;if(f===Ds.mapValue&&g===Ds.mapValue)return 0;if(f===Ds.mapValue)return 1;if(g===Ds.mapValue)return-1;const v=f.fields||{},w=Object.keys(v),I=g.fields||{},b=Object.keys(I);w.sort(),b.sort();for(let e=0;e<w.length&&e<b.length;++e){const g=E(w[e],b[e]);if(0!==g)return g;var m=Rs(v[w[e]],I[b[e]]);if(0!==m)return m}return E(w.length,b.length);return}default:throw T()}}function Ls(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return E(e,t);var e=Es(e),t=Es(t),n=E(e.seconds,t.seconds);return 0!==n?n:E(e.nanos,t.nanos)}function Ms(e){return function n(r){{if("nullValue"in r)return"null";if("booleanValue"in r)return""+r.booleanValue;if("integerValue"in r)return""+r.integerValue;if("doubleValue"in r)return""+r.doubleValue;if("timestampValue"in r)return`time(${(e=Es(r.timestampValue)).seconds},${e.nanos})`;if("stringValue"in r)return r.stringValue;if("bytesValue"in r)return _s(r.bytesValue).toBase64();if("referenceValue"in r)return t=r.referenceValue,D.fromName(t).toString();if("geoPointValue"in r)return`geo(${(t=r.geoPointValue).latitude},${t.longitude})`;if("arrayValue"in r){let e="[",t=!0;for(const i of r.arrayValue.values||[])t?t=!1:e+=",",e+=n(i);return e+"]"}if("mapValue"in r){var s=r.mapValue;let e="{",t=!0;for(const a of Object.keys(s.fields||{}).sort())t?t=!1:e+=",",e+=a+":"+n(s.fields[a]);return e+"}"}return T()}var e,t}(e)}function Os(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/`+t.path.canonicalString()}}function Fs(e){return e&&"integerValue"in e}function Vs(e){return!!e&&"arrayValue"in e}function Ps(e){return e&&"nullValue"in e}function qs(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Bs(e){return e&&"mapValue"in e}function Us(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return ys(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=Us(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=Us(t.arrayValue.values[e]);return r}return Object.assign({},t)}function Gs(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Ks(e,t){var n=Rs(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function js(e,t){var n=Rs(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Qs{constructor(e,t){this.position=e,this.inclusive=t}}function zs(t,n,r){let s=0;for(let e=0;e<t.position.length;e++){const i=n[e],a=t.position[e];if(s=i.field.isKeyField()?D.comparator(D.fromName(a.referenceValue),r.key):Rs(a,r.data.field(i.field)),"desc"===i.dir&&(s*=-1),0!==s)break}return s}function $s(t,n){if(null===t)return null===n;if(null===n)return!1;if(t.inclusive!==n.inclusive||t.position.length!==n.position.length)return!1;for(let e=0;e<t.position.length;e++)if(!Ns(t.position[e],n.position[e]))return!1;return!0}class Ws{}class k extends Ws{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new ti(e,t,n):"array-contains"===t?new ii(e,n):"in"===t?new ai(e,n):"not-in"===t?new oi(e,n):"array-contains-any"===t?new ui(e,n):new k(e,t,n)}static createKeyFieldInFilter(e,t,n){return new("in"===t?ni:ri)(e,n)}matches(e){e=e.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(Rs(e,this.value)):null!==e&&Cs(this.value)===Cs(e)&&this.matchesComparison(Rs(e,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return T()}}isInequality(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class R extends Ws{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new R(e,t)}matches(t){return Hs(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null===this.ht&&(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){var e=this.lt(e=>e.isInequality());return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Hs(e){return"and"===e.op}function Ys(e){return"or"===e.op}function Xs(e){return Js(e)&&Hs(e)}function Js(e){for(const t of e.filters)if(t instanceof R)return!1;return!0}function Zs(e,t){t=e.filters.concat(t);return R.create(t,e.op)}function ei(e){return e instanceof k?`${(t=e).field.canonicalString()} ${t.op} `+Ms(t.value):e instanceof R?e.op.toString()+" {"+e.getFilters().map(ei).join(" ,")+"}":"Filter";var t}class ti extends k{constructor(e,t,n){super(e,t,n),this.key=D.fromName(n.referenceValue)}matches(e){e=D.comparator(e.key,this.key);return this.matchesComparison(e)}}class ni extends k{constructor(e,t){super(e,"in",t),this.keys=si(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class ri extends k{constructor(e,t){super(e,"not-in",t),this.keys=si(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function si(e,t){return((null==(t=t.arrayValue)?void 0:t.values)||[]).map(e=>D.fromName(e.referenceValue))}class ii extends k{constructor(e,t){super(e,"array-contains",t)}matches(e){e=e.data.field(this.field);return Vs(e)&&ks(e.arrayValue,this.value)}}class ai extends k{constructor(e,t){super(e,"in",t)}matches(e){e=e.data.field(this.field);return null!==e&&ks(this.value.arrayValue,e)}}class oi extends k{constructor(e,t){super(e,"not-in",t)}matches(e){if(ks(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;e=e.data.field(this.field);return null!==e&&!ks(this.value.arrayValue,e)}}class ui extends k{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Vs(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>ks(this.value.arrayValue,e))}}class ci{constructor(e,t="asc"){this.field=e,this.dir=t}}class L{constructor(e,t){this.comparator=e,this.root=t||li.EMPTY}insert(e,t){return new L(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,li.BLACK,null,null))}remove(e){return new L(this.comparator,this.root.remove(e,this.comparator).copy(null,null,li.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(e+":"+t),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new hi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new hi(this.root,e,this.comparator,!1)}getReverseIterator(){return new hi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new hi(this.root,e,this.comparator,!0)}}class hi{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class li{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=null!=n?n:li.RED,this.left=null!=r?r:li.EMPTY,this.right=null!=s?s:li.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new li(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var s=n(e,r.key);return(r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return li.EMPTY;let e=this;return(e=(e=e.left.isRed()||e.left.left.isRed()?e:e.moveRedLeft()).copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r=(r=r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()?r:r.moveRedLeft()).copy(null,null,null,r.left.remove(e,t),null);else{if(0===t(e,(r=(r=r.left.isRed()?r.rotateRight():r).right.isEmpty()||r.right.isRed()||r.right.left.isRed()?r:r.moveRedRight()).key)){if(r.right.isEmpty())return li.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e=(e=(e=e.right.isRed()&&!e.left.isRed()?e.rotateLeft():e).left.isRed()&&e.left.left.isRed()?e.rotateRight():e).left.isRed()&&e.right.isRed()?e.colorFlip():e}moveRedLeft(){let e=this.colorFlip();return e=e.right.left.isRed()?(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip():e}moveRedRight(){let e=this.colorFlip();return e=e.left.left.isRed()?(e=e.rotateRight()).colorFlip():e}rotateLeft(){var e=this.copy(null,null,li.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,li.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw T();if(this.right.isRed())throw T();var e=this.left.check();if(e!==this.right.check())throw T();return e+(this.isRed()?0:1)}}li.EMPTY=null,li.RED=!0,li.BLACK=!1,li.EMPTY=new class{constructor(){this.size=0}get key(){throw T()}get value(){throw T()}get color(){throw T()}get left(){throw T()}get right(){throw T()}copy(e,t,n,r,s){return this}insert(e,t,n){return new li(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class M{constructor(e){this.comparator=e,this.data=new L(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new di(this.data.getIterator())}getIteratorFrom(e){return new di(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof M))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new M(this.comparator);return t.data=e,t}}class di{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function fi(e){return e.hasNext()?e.getNext():void 0}class gi{constructor(e){(this.fields=e).sort(x.comparator)}static empty(){return new gi([])}unionWith(e){let t=new M(x.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new gi(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Br(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class mi{constructor(e){this.value=e}static empty(){return new mi({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let t=this.value;for(let e=0;e<n.length-1;++e)if(!Bs(t=(t.mapValue.fields||{})[n.get(e)]))return null;return(t=(t.mapValue.fields||{})[n.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Us(t)}setAll(e){let n=x.emptyPath(),r={},s=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,s),r={},s=[],n=t.popLast()}e?r[t.lastSegment()]=Us(e):s.push(t.lastSegment())});e=this.getFieldsMap(n);this.applyChanges(e,r,s)}delete(e){const t=this.field(e.popLast());Bs(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ns(this.value,e.value)}getFieldsMap(n){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let t=0;t<n.length;++t){let e=r.mapValue.fields[n.get(t)];Bs(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},r.mapValue.fields[n.get(t)]=e),r=e}return r.mapValue.fields}applyChanges(n,e,t){ys(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new mi(Us(this.value))}}class O{constructor(e,t,n,r,s,i,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=a}static newInvalidDocument(e){return new O(e,0,_.min(),_.min(),_.min(),mi.empty(),0)}static newFoundDocument(e,t,n,r){return new O(e,1,t,_.min(),n,r,0)}static newNoDocument(e,t){return new O(e,2,t,_.min(),_.min(),mi.empty(),0)}static newUnknownDocument(e,t){return new O(e,3,t,_.min(),_.min(),mi.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(_.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=mi.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=mi.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=_.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof O&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new O(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class pi{constructor(e,t=null,n=[],r=[],s=null,i=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=a,this.ft=null}}function yi(e,t=null,n=[],r=[],s=null,i=null,a=null){return new pi(e,t,n,r,s,i,a)}function vi(e){const t=e;if(null===t.ft){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e=(e=(e+="|f:")+t.filters.map(e=>function t(e){if(e instanceof k)return e.field.canonicalString()+e.op.toString()+Ms(e.value);var n=e.filters.map(e=>t(e)).join(",");return e.op+`(${n})`}(e)).join(",")+"|ob:")+t.orderBy.map(e=>{return e.field.canonicalString()+e.dir}).join(","),ws(t.limit)||(e=(e+="|l:")+t.limit),t.startAt&&(e=(e=(e+="|lb:")+(t.startAt.inclusive?"b:":"a:"))+t.startAt.position.map(e=>Ms(e)).join(",")),t.endAt&&(e=(e=(e+="|ub:")+(t.endAt.inclusive?"a:":"b:"))+t.endAt.position.map(e=>Ms(e)).join(",")),t.ft=e}return t.ft}function wi(t,n){if(t.limit!==n.limit)return!1;if(t.orderBy.length!==n.orderBy.length)return!1;for(let e=0;e<t.orderBy.length;e++)if(r=t.orderBy[e],s=n.orderBy[e],r.dir!==s.dir||!r.field.isEqual(s.field))return!1;var r,s;if(t.filters.length!==n.filters.length)return!1;for(let e=0;e<t.filters.length;e++)if(!function r(e,t){return e instanceof k?(n=e,(i=t)instanceof k&&n.op===i.op&&n.field.isEqual(i.field)&&Ns(n.value,i.value)):e instanceof R?(s=t)instanceof R&&e.op===s.op&&e.filters.length===s.filters.length&&e.filters.reduce((e,t,n)=>e&&r(t,s.filters[n]),!0):void T();var s,n,i}(t.filters[e],n.filters[e]))return!1;return t.collectionGroup===n.collectionGroup&&!!t.path.isEqual(n.path)&&!!$s(t.startAt,n.startAt)&&$s(t.endAt,n.endAt)}function Ii(e){return D.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function bi(e,t){return e.filters.filter(e=>e instanceof k&&e.field.isEqual(t))}function Ti(t,n,r){let s=As,i=!0;for(const r of bi(t,n)){let e=As,t=!0;switch(r.op){case"<":case"<=":e="nullValue"in(a=r.value)?As:"booleanValue"in a?{booleanValue:!1}:"integerValue"in a||"doubleValue"in a?{doubleValue:NaN}:"timestampValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in a?{stringValue:""}:"bytesValue"in a?{bytesValue:""}:"referenceValue"in a?Os(ms.empty(),D.empty()):"geoPointValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in a?{arrayValue:{}}:"mapValue"in a?{mapValue:{}}:T();break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=As}Ks({value:s,inclusive:i},{value:e,inclusive:t})<0&&(s=e,i=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];Ks({value:s,inclusive:i},{value:t,inclusive:r.inclusive})<0&&(s=t,i=r.inclusive);break}return{value:s,inclusive:i}}function Ei(t,n,r){let s=Ds,i=!0;for(const r of bi(t,n)){let e=Ds,t=!0;switch(r.op){case">=":case">":e="nullValue"in(a=r.value)?{booleanValue:!1}:"booleanValue"in a?{doubleValue:NaN}:"integerValue"in a||"doubleValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in a?{stringValue:""}:"stringValue"in a?{bytesValue:""}:"bytesValue"in a?Os(ms.empty(),D.empty()):"referenceValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in a?{arrayValue:{}}:"arrayValue"in a?{mapValue:{}}:"mapValue"in a?Ds:T(),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=Ds}0<js({value:s,inclusive:i},{value:e,inclusive:t})&&(s=e,i=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];0<js({value:s,inclusive:i},{value:t,inclusive:r.inclusive})&&(s=t,i=r.inclusive);break}return{value:s,inclusive:i}}class _i{constructor(e,t=null,n=[],r=[],s=null,i="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=a,this.endAt=o,this.dt=null,this._t=null,this.startAt,this.endAt}}function Si(e,t,n,r,s,i,a,o){return new _i(e,t,n,r,s,i,a,o)}function xi(e){return new _i(e)}function Di(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Ai(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function Ci(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function Ni(e){return null!==e.collectionGroup}function ki(t){const n=t;if(null===n.dt){n.dt=[];const t=Ci(n),e=Ai(n);if(null!==t&&null===e)t.isKeyField()||n.dt.push(new ci(t)),n.dt.push(new ci(x.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n.dt.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.dt.push(new ci(x.keyField(),t))}}}return n.dt}function Ri(e){const t=e;if(!t._t)if("F"===t.limitType)t._t=yi(t.path,t.collectionGroup,ki(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const s of ki(t)){const t="desc"===s.dir?"asc":"desc";e.push(new ci(s.field,t))}var n=t.endAt?new Qs(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Qs(t.startAt.position,t.startAt.inclusive):null;t._t=yi(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t._t}function Li(e,t){t.getFirstInequalityField(),Ci(e);t=e.filters.concat([t]);return new _i(e.path,e.collectionGroup,e.explicitOrderBy.slice(),t,e.limit,e.limitType,e.startAt,e.endAt)}function Mi(e,t,n){return new _i(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Oi(e,t){return wi(Ri(e),Ri(t))&&e.limitType===t.limitType}function Fi(e){return vi(Ri(e))+"|lt:"+e.limitType}function Vi(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>ei(e)).join(", ")}]`),ws(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${e.field.canonicalString()} (${e.dir})`}).join(", ")}]`),e.startAt&&(t=(t=(t+=", startAt: ")+(e.startAt.inclusive?"b:":"a:"))+e.startAt.position.map(e=>Ms(e)).join(",")),`Target(${t=e.endAt?(t=(t+=", endAt: ")+(e.endAt.inclusive?"a:":"b:"))+e.endAt.position.map(e=>Ms(e)).join(","):t})`}(Ri(e))}; limitType=${e.limitType})`}function Pi(n,e){return e.isFoundDocument()&&(a=(i=e).key.path,null!==(s=n).collectionGroup?i.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(a):D.isDocumentKey(s.path)?s.path.isEqual(a):s.path.isImmediateParentOf(a))&&function(e){for(const t of ki(n))if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(s=e,(!(e=n).startAt||(r=zs(t=e.startAt,ki(e),s),t.inclusive?r<=0:r<0))&&(!e.endAt||(r=zs(t=e.endAt,ki(e),s),t.inclusive?0<=r:0<r)));var t,r,s,i,a}function qi(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Bi(s){return(e,t)=>{let n=!1;for(const r of ki(s)){const s=function(e,t,n){var r,s=e.field.isKeyField()?D.comparator(t.key,n.key):(r=e.field,n=n,t=t.data.field(r),n=n.data.field(r),null!==t&&null!==n?Rs(t,n):T());switch(e.dir){case"asc":return s;case"desc":return-1*s;default:return T()}}(r,e,t);if(0!==s)return s;n=n||r.field.isKeyField()}return 0}}function Ui(e,t){if(e.wt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Is(t)?"-0":t}}function Gi(e){return{integerValue:""+e}}function Ki(e,t){return bs(t)?Gi(t):Ui(e,t)}class ji{constructor(){this._=void 0}}function Qi(e,t){return e instanceof Xi?Fs(e=t)||e&&"doubleValue"in e?t:{integerValue:0}:null}class zi extends ji{}class $i extends ji{constructor(e){super(),this.elements=e}}function Wi(e,t){const n=Zi(t);for(const t of e.elements)n.some(e=>Ns(e,t))||n.push(t);return{arrayValue:{values:n}}}class Hi extends ji{constructor(e){super(),this.elements=e}}function Yi(e,t){let n=Zi(t);for(const t of e.elements)n=n.filter(e=>!Ns(e,t));return{arrayValue:{values:n}}}class Xi extends ji{constructor(e,t){super(),this.yt=e,this.gt=t}}function Ji(e){return N(e.integerValue||e.doubleValue)}function Zi(e){return Vs(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class ea{constructor(e,t){this.field=e,this.transform=t}}class ta{constructor(e,t){this.version=e,this.transformResults=t}}class F{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new F}static exists(e){return new F(void 0,e)}static updateTime(e){return new F(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function na(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ra{}function sa(e,n){if(!e.hasLocalMutations||n&&0===n.fields.length)return null;if(null===n)return e.isNoDocument()?new da(e.key,F.none()):new oa(e.key,e.data,F.none());{const s=e.data,i=mi.empty();let t=new M(x.comparator);for(var r of n.fields)if(!t.has(r)){let e=s.field(r);null===e&&1<r.length&&(r=r.popLast(),e=s.field(r)),null===e?i.delete(r):i.set(r,e),t=t.add(r)}return new ua(e.key,i,new gi(t.toArray()),F.none())}}function ia(e,t,n,r){if(e instanceof oa){var s=e,i=t,a=n,o=r;if(!na(s.precondition,i))return a;const u=s.value.clone(),c=la(s.fieldTransforms,o,i);return u.setAll(c),i.convertToFoundDocument(i.version,u).setHasLocalMutations(),null}if(e instanceof ua){a=e,s=t,o=n,i=r;if(!na(a.precondition,s))return o;const h=la(a.fieldTransforms,i,s),l=s.data;return l.setAll(ca(a)),l.setAll(h),s.convertToFoundDocument(s.version,l).setHasLocalMutations(),null===o?null:o.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(e=>e.field))}return na(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function aa(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&Br(n,r,(e,t)=>{return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof $i&&t instanceof $i||e instanceof Hi&&t instanceof Hi?Br(e.elements,t.elements,Ns):e instanceof Xi&&t instanceof Xi?Ns(e.gt,t.gt):e instanceof zi&&t instanceof zi)}))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}class oa extends ra{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class ua extends ra{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function ca(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function ha(t,n,r){const s=new Map;y(t.length===r.length);for(let e=0;e<r.length;e++){var i=t[e],a=i.transform,o=n.data.field(i.field);s.set(i.field,(i=a,a=o,o=r[e],i instanceof $i?Wi(i,a):i instanceof Hi?Yi(i,a):o))}return s}function la(e,t,n){const r=new Map;for(const c of e){const e=c.transform,h=n.data.field(c.field);r.set(c.field,(s=e,i=h,a=t,0,s instanceof zi?function(){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return i&&(e.fields.__previous_value__=i),{mapValue:e}}():s instanceof $i?Wi(s,i):s instanceof Hi?Yi(s,i):(u=Ji(o=Qi(s,i))+Ji(s.gt),Fs(o)&&Fs(s.gt)?Gi(u):Ui(s.yt,u))))}var s,i,a,o,u;return r}class da extends ra{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class fa extends ra{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ga{constructor(e){this.count=e}}function ma(e){switch(e){default:return T(),0;case I.CANCELLED:case I.UNKNOWN:case I.DEADLINE_EXCEEDED:case I.RESOURCE_EXHAUSTED:case I.INTERNAL:case I.UNAVAILABLE:case I.UNAUTHENTICATED:return;case I.INVALID_ARGUMENT:case I.NOT_FOUND:case I.ALREADY_EXISTS:case I.PERMISSION_DENIED:case I.FAILED_PRECONDITION:case I.ABORTED:case I.OUT_OF_RANGE:case I.UNIMPLEMENTED:case I.DATA_LOSS:return 1}}function pa(e){if(void 0===e)return g("GRPC error has no .code"),I.UNKNOWN;switch(e){case d.OK:return I.OK;case d.CANCELLED:return I.CANCELLED;case d.UNKNOWN:return I.UNKNOWN;case d.DEADLINE_EXCEEDED:return I.DEADLINE_EXCEEDED;case d.RESOURCE_EXHAUSTED:return I.RESOURCE_EXHAUSTED;case d.INTERNAL:return I.INTERNAL;case d.UNAVAILABLE:return I.UNAVAILABLE;case d.UNAUTHENTICATED:return I.UNAUTHENTICATED;case d.INVALID_ARGUMENT:return I.INVALID_ARGUMENT;case d.NOT_FOUND:return I.NOT_FOUND;case d.ALREADY_EXISTS:return I.ALREADY_EXISTS;case d.PERMISSION_DENIED:return I.PERMISSION_DENIED;case d.FAILED_PRECONDITION:return I.FAILED_PRECONDITION;case d.ABORTED:return I.ABORTED;case d.OUT_OF_RANGE:return I.OUT_OF_RANGE;case d.UNIMPLEMENTED:return I.UNIMPLEMENTED;case d.DATA_LOSS:return I.DATA_LOSS;default:return T()}}ye=d={OK:0,0:"OK",CANCELLED:1,1:"CANCELLED",UNKNOWN:2,2:"UNKNOWN",INVALID_ARGUMENT:3,3:"INVALID_ARGUMENT",DEADLINE_EXCEEDED:4,4:"DEADLINE_EXCEEDED",NOT_FOUND:5,5:"NOT_FOUND",ALREADY_EXISTS:6,6:"ALREADY_EXISTS",PERMISSION_DENIED:7,7:"PERMISSION_DENIED",UNAUTHENTICATED:16,16:"UNAUTHENTICATED",RESOURCE_EXHAUSTED:8,8:"RESOURCE_EXHAUSTED",FAILED_PRECONDITION:9,9:"FAILED_PRECONDITION",ABORTED:10,10:"ABORTED",OUT_OF_RANGE:11,11:"OUT_OF_RANGE",UNIMPLEMENTED:12,12:"UNIMPLEMENTED",INTERNAL:13,13:"INTERNAL",UNAVAILABLE:14,14:"UNAVAILABLE",DATA_LOSS:15,15:"DATA_LOSS"};class ya{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(t,n){const e=this.mapKeyFn(t),r=this.inner[e];if(void 0===r)return this.inner[e]=[[t,n]],void this.innerSize++;for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return void(r[e]=[t,n]);r.push([t,n]),this.innerSize++}delete(t){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return!1;for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return 1===r.length?delete this.inner[n]:r.splice(e,1),this.innerSize--,!0;return!1}forEach(r){ys(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return vs(this.inner)}size(){return this.innerSize}}const va=new L(D.comparator),wa=new L(D.comparator);function Ia(...e){let t=wa;for(const n of e)t=t.insert(n.key,n);return t}function ba(e){let n=wa;return e.forEach((e,t)=>n=n.insert(e,t.overlayedDocument)),n}function Ta(){return new ya(e=>e.toString(),(e,t)=>e.isEqual(t))}const Ea=new L(D.comparator),_a=new M(D.comparator);function V(...e){let t=_a;for(const n of e)t=t.add(n);return t}const Sa=new M(E);class xa{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Da.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new xa(_.min(),r,Sa,va,V())}}class Da{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Da(n,t,V(),V(),V())}}class Aa{constructor(e,t,n,r){this.It=e,this.removedTargetIds=t,this.key=n,this.Tt=r}}class Ca{constructor(e,t){this.targetId=e,this.Et=t}}class Na{constructor(e,t,n=C.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class ka{constructor(){this.At=0,this.Rt=Ma(),this.bt=C.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return 0!==this.At}get St(){return this.vt}Dt(e){0<e.approximateByteSize()&&(this.vt=!0,this.bt=e)}Ct(){let n=V(),r=V(),s=V();return this.Rt.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:s=s.add(e);break;default:T()}}),new Da(this.bt,this.Pt,n,r,s)}xt(){this.vt=!1,this.Rt=Ma()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){--this.At}Ft(){this.vt=!0,this.Pt=!0}}class Ra{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=va,this.qt=La(),this.Ut=new M(E)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const n of e.removedTargetIds)this.Qt(n,e.key,e.Tt)}jt(n){this.forEachTarget(n,e=>{const t=this.Wt(e);switch(n.state){case 0:this.zt(e)&&t.Dt(n.resumeToken);break;case 1:t.Mt(),t.Vt||t.xt(),t.Dt(n.resumeToken);break;case 2:t.Mt(),t.Vt||this.removeTarget(e);break;case 3:this.zt(e)&&(t.Ft(),t.Dt(n.resumeToken));break;case 4:this.zt(e)&&(this.Ht(e),t.Dt(n.resumeToken));break;default:T()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.Bt.forEach((e,t)=>{this.zt(t)&&n(t)})}Jt(e){const t=e.targetId,n=e.Et.count,r=this.Yt(t);if(r){const e=r.target;if(Ii(e))if(0===n){const n=new D(e.path);this.Qt(t,n,O.newNoDocument(n,_.min()))}else y(1===n);else this.Xt(t)!==n&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(r){const s=new Map;this.Bt.forEach((e,t)=>{var n=this.Yt(t);if(n){if(e.current&&Ii(n.target)){const s=new D(n.target.path);null!==this.Lt.get(s)||this.te(t,s)||this.Qt(t,s,O.newNoDocument(s,r))}e.St&&(s.set(t,e.Ct()),e.xt())}});let i=V();this.qt.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{e=this.Yt(e);return!e||2===e.purpose||(n=!1)}),n&&(i=i.add(e))}),this.Lt.forEach((e,t)=>t.setReadTime(r));var e=new xa(r,s,this.Ut,this.Lt,i);return this.Lt=va,this.qt=La(),this.Ut=new M(E),e}Gt(e,t){var n;this.zt(e)&&(n=this.te(e,t.key)?2:0,this.Wt(e).Nt(t.key,n),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e)))}Qt(e,t,n){if(this.zt(e)){const r=this.Wt(e);this.te(e,t)?r.Nt(t,1):r.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),n&&(this.Lt=this.Lt.insert(t,n))}}removeTarget(e){this.Bt.delete(e)}Xt(e){var t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new ka,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new M(E),this.qt=this.qt.insert(e,t)),t}zt(e){var t=null!==this.Yt(e);return t||f("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){var t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(t){this.Bt.set(t,new ka),this.$t.getRemoteKeysForTarget(t).forEach(e=>{this.Qt(t,e,null)})}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function La(){return new L(D.comparator)}function Ma(){return new L(D.comparator)}const Oa={asc:"ASCENDING",desc:"DESCENDING"},Fa={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Va={and:"AND",or:"OR"};class Pa{constructor(e,t){this.databaseId=e,this.wt=t}}function qa(e,t){return e.wt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ba(e,t){return e.wt?t.toBase64():t.toUint8Array()}function P(e){return y(!!e),_.fromTimestamp((e=Es(e),new h(e.seconds,e.nanos)))}function Ua(e,t){return new S(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function Ga(e){e=S.fromString(e);return y(so(e)),e}function Ka(e,t){return Ua(e.databaseId,t.path)}function ja(e,t){const n=Ga(t);if(n.get(1)!==e.databaseId.projectId)throw new b(I.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new b(I.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new D(Wa(n))}function Qa(e,t){return Ua(e.databaseId,t)}function za(e){e=Ga(e);return 4===e.length?S.emptyPath():Wa(e)}function $a(e){return new S(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Wa(e){return y(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function Ha(e,t,n){return{name:Ka(e,t),fields:n.value.mapValue.fields}}function Ya(e,t,n){const r=ja(e,t.name),s=P(t.updateTime),i=t.createTime?P(t.createTime):_.min(),a=new mi({mapValue:{fields:t.fields}}),o=O.newFoundDocument(r,s,i,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Xa(e,t){let n;if(t instanceof oa)n={update:Ha(e,t.key,t.value)};else if(t instanceof da)n={delete:Ka(e,t.key)};else if(t instanceof ua)n={update:Ha(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof fa))return T();n={verify:Ka(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>{var t=e.transform;if(t instanceof zi)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof $i)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Hi)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Xi)return{fieldPath:e.field.canonicalString(),increment:t.gt};throw T()})),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:qa(e,(t=r.updateTime).toTimestamp())}:void 0!==r.exists?{exists:r.exists}:T()),n;var r}function Ja(r,t){const e=t.currentDocument?void 0!==(s=t.currentDocument).updateTime?F.updateTime(P(s.updateTime)):void 0!==s.exists?F.exists(s.exists):F.none():F.none(),n=t.updateTransforms?t.updateTransforms.map(t=>{{var n=r;let e=null;if("setToServerValue"in t)y("REQUEST_TIME"===t.setToServerValue),e=new zi;else if("appendMissingElements"in t){const n=t.appendMissingElements.values||[];e=new $i(n)}else if("removeAllFromArray"in t){const n=t.removeAllFromArray.values||[];e=new Hi(n)}else"increment"in t?e=new Xi(n,t.increment):T();return n=x.fromServerFormat(t.fieldPath),new ea(n,e)}}):[];if(t.update){t.update.name;var s=ja(r,t.update.name),i=new mi({mapValue:{fields:t.update.fields}});if(t.updateMask){const r=function(){const e=t.updateMask.fieldPaths||[];return new gi(e.map(e=>x.fromServerFormat(e)))}();return new ua(s,i,r,e,n)}return new oa(s,i,e,n)}if(t.delete){const n=ja(r,t.delete);return new da(n,e)}if(t.verify){const n=ja(r,t.verify);return new fa(n,e)}return T()}function Za(e,t){return{documents:[Qa(e,t.path)]}}function eo(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Qa(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Qa(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var s,i=function(e){if(0!==e.length)return function t(e){if(e instanceof k){var n=e;if("=="===n.op){if(qs(n.value))return{unaryFilter:{field:no(n.field),op:"IS_NAN"}};if(Ps(n.value))return{unaryFilter:{field:no(n.field),op:"IS_NULL"}}}else if("!="===n.op){if(qs(n.value))return{unaryFilter:{field:no(n.field),op:"IS_NOT_NAN"}};if(Ps(n.value))return{unaryFilter:{field:no(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:no(n.field),op:(r=n.op,Fa[r]),value:n.value}}}return e instanceof R?1===(n=(r=e).getFilters().map(e=>t(e))).length?n[0]:{compositeFilter:{op:(r=r.op,Va[r]),filters:n}}:T();var r}(R.create(e,"and"))}(t.filters);return i&&(n.structuredQuery.where=i),(i=function(e){if(0!==e.length)return e.map(e=>{return{field:no(e.field),direction:(e=e.dir,Oa[e])}})}(t.orderBy))&&(n.structuredQuery.orderBy=i),s=t.limit,null!==(i=e.wt||ws(s)?s:{value:s})&&(n.structuredQuery.limit=i),t.startAt&&(n.structuredQuery.startAt={before:(i=t.startAt).inclusive,values:i.position}),t.endAt&&(n.structuredQuery.endAt={before:!(t=t.endAt).inclusive,values:t.position}),n}function to(e){let t=za(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let s=null;var i,a,o,u;0<r&&(y(1===r),(i=n.from[0]).allDescendants?s=i.collectionId:t=t.child(i.collectionId));let c=[],h=(n.where&&(c=function(){const e=function t(e){if(void 0!==e.unaryFilter){var n=e;switch(n.unaryFilter.op){case"IS_NAN":var r=ro(n.unaryFilter.field);return k.create(r,"==",{doubleValue:NaN});case"IS_NULL":r=ro(n.unaryFilter.field);return k.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":r=ro(n.unaryFilter.field);return k.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":r=ro(n.unaryFilter.field);return k.create(r,"!=",{nullValue:"NULL_VALUE"});default:return T()}}else{return void 0!==e.fieldFilter?(i=e,k.create(ro(i.fieldFilter.field),function(){switch(i.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return T()}}(),i.fieldFilter.value)):void 0!==e.compositeFilter?(s=e,R.create(s.compositeFilter.filters.map(e=>t(e)),function(){switch(s.compositeFilter.op){case"AND":return"and";case"OR":return"or";default:return T()}}())):T();var s,i}}(n.where);return e instanceof R&&Xs(e)?e.getFilters():[e]}()),[]),l=(n.orderBy&&(h=n.orderBy.map(e=>{var t=e;return new ci(ro(t.field),function(){switch(t.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())})),null),d=(n.limit&&(l=ws(i="object"==typeof(e=n.limit)?e.value:e)?null:i),null),f=(n.startAt&&(d=(u=!!(a=n.startAt).before,o=a.values||[],new Qs(o,u))),null);return n.endAt&&(f=(o=!(a=n.endAt).before,u=a.values||[],new Qs(u,o))),Si(t,s,h,c,l,"F",d,f)}function no(e){return{fieldPath:e.canonicalString()}}function ro(e){return x.fromServerFormat(e.fieldPath)}function so(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function io(t){let s="";for(let e=0;e<t.length;e++)0<s.length&&(s=ao(s)),s=function(t){let n=s;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(t.get(e));return ao(s)}function ao(e){return e+""}function oo(n){const r=n.length;if(y(2<=r),2===r)return y(""===n.charAt(0)&&""===n.charAt(1)),S.emptyPath();r;const s=[];let i="";for(let t=0;t<r;){const r=n.indexOf("",t);switch((r<0||r>a)&&T(),n.charAt(r+1)){case"":const a=n.substring(t,r);let e;0===i.length?e=a:(i+=a,e=i,i=""),s.push(e);break;case"":i=i+n.substring(t,r)+"\0";break;case"":i+=n.substring(t,r+1);break;default:T()}t=r+2}return new S(s)}const uo=["userId","batchId"];function co(e,t){return[e,io(t)]}function ho(e,t,n){return[e,io(t),n]}const lo={},fo=["prefixPath","collectionGroup","readTime","documentId"],go=["prefixPath","collectionGroup","documentId"],mo=["collectionGroup","readTime","prefixPath","documentId"],po=["canonicalId","targetId"],yo=["targetId","path"],vo=["path","targetId"],wo=["collectionId","parent"],Io=["indexId","uid"],bo=["uid","sequenceNumber"],To=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Eo=["indexId","uid","orderedDocumentKey"],_o=["userId","collectionPath","documentId"],So=["userId","collectionPath","largestBatchId"],xo=["userId","collectionGroup","largestBatchId"],Do=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Ao=[...Do,"documentOverlays"],Co=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],No=Co,ko=[...No,"indexConfiguration","indexState","indexEntries"];class Ro extends es{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function Lo(e,t){return rs.M(e.se,t)}class Mo{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){var n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const c=this.mutations[e];if(c.key.isEqual(t.key)){r=void 0;s=void 0;i=void 0;a=void 0;o=void 0;u=void 0;a=void 0;o=void 0;u=void 0;var r=c;var s=t;var i=n[e];if(r instanceof oa){var a=r,o=s,u=i;const h=a.value.clone(),l=ha(a.fieldTransforms,o,u.transformResults);h.setAll(l),o.convertToFoundDocument(u.version,h).setHasCommittedMutations()}else if(r instanceof ua){a=r,o=s,u=i;if(na(a.precondition,o)){const d=ha(a.fieldTransforms,o,u.transformResults),f=o.data;f.setAll(ca(a)),f.setAll(d),o.convertToFoundDocument(u.version,f).setHasCommittedMutations()}else o.convertToUnknownDocument(u.version)}else s.convertToNoDocument(i.version).setHasCommittedMutations()}}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ia(n,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=ia(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(i,a){const o=Ta();return this.mutations.forEach(e=>{const t=i.get(e.key),n=t.overlayedDocument;let r=this.applyToLocalView(n,t.mutatedFields);r=a.has(e.key)?null:r;var s=sa(n,r);null!==s&&o.set(e.key,s),n.isValidDocument()||n.convertToNoDocument(_.min())}),o}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),V())}isEqual(e){return this.batchId===e.batchId&&Br(this.mutations,e.mutations,(e,t)=>aa(e,t))&&Br(this.baseMutations,e.baseMutations,(e,t)=>aa(e,t))}}class Oo{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){y(e.mutations.length===n.length);let r=Ea;var s=e.mutations;for(let e=0;e<s.length;e++)r=r.insert(s[e].key,n[e].version);return new Oo(e,t,n,r)}}class Fo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Vo{constructor(e,t,n,r,s=_.min(),i=_.min(),a=C.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=a}withSequenceNumber(e){return new Vo(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Vo(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Vo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Po{constructor(e){this.ie=e}}function qo(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Bo(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document={name:Ka(s=e.ie,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:qa(s,e.version.toTimestamp()),createTime:qa(s,e.createTime.toTimestamp())};else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Uo(t.version)};else{if(!t.isUnknownDocument())return T();r.unknownDocument={path:n.path.toArray(),version:Uo(t.version)}}var s;return r}function Bo(e){e=e.toTimestamp();return[e.seconds,e.nanoseconds]}function Uo(e){e=e.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Go(e){e=new h(e.seconds,e.nanoseconds);return _.fromTimestamp(e)}function Ko(t,n){const r=(n.baseMutations||[]).map(e=>Ja(t.ie,e));for(let e=0;e<n.mutations.length-1;++e){const r=n.mutations[e];if(e+1<n.mutations.length&&void 0!==n.mutations[e+1].transform){const s=n.mutations[e+1];r.updateTransforms=s.transform.fieldTransforms,n.mutations.splice(e+1,1),++e}}const s=n.mutations.map(e=>Ja(t.ie,e)),e=h.fromMillis(n.localWriteTimeMs);return new Mo(n.batchId,e,r,s)}function jo(e){var t=Go(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Go(e.lastLimboFreeSnapshotVersion):_.min(),r=void 0!==e.query.documents?(y(1===(r=e.query).documents.length),Ri(xi(za(r.documents[0])))):Ri(to(e.query));return new Vo(r,e.targetId,0,e.lastListenSequenceNumber,t,n,C.fromBase64String(e.resumeToken))}function Qo(e,t){var n=Uo(t.snapshotVersion),r=Uo(t.lastLimboFreeSnapshotVersion),e=(Ii(t.target)?Za:eo)(e.ie,t.target),s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:vi(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:e}}function zo(e){var t=to({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Mi(t,t.limit,"L"):t}function $o(e,t){return new Fo(t.largestBatchId,Ja(e.ie,t.overlayMutation))}function Wo(e,t){var n=t.path.lastSegment();return[e,io(t.path.popLast()),n]}function Ho(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Uo(r.readTime),documentKey:io(r.documentKey.path),largestBatchId:r.largestBatchId}}class Yo{getBundleMetadata(e,t){return Xo(e).get(t).next(e=>{if(e)return{id:(e=e).bundleId,createTime:Go(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return Xo(e).put({bundleId:(e=t).id,createTime:Uo(P(e.createTime)),version:e.version})}getNamedQuery(e,t){return Jo(e).get(t).next(e=>{if(e)return{name:(e=e).name,query:zo(e.bundledQuery),readTime:Go(e.readTime)}})}saveNamedQuery(e,t){return Jo(e).put({name:t.name,readTime:Uo(P(t.readTime)),bundledQuery:t.bundledQuery})}}function Xo(e){return Lo(e,"bundles")}function Jo(e){return Lo(e,"namedQueries")}class Zo{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){t=t.uid||"";return new Zo(e,t)}getOverlay(e,t){return eu(e).get(Wo(this.userId,t)).next(e=>e?$o(this.yt,e):null)}getOverlays(e,t){const n=Ta();return A.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(n,r,e){const s=[];return e.forEach((e,t)=>{t=new Fo(r,t);s.push(this.oe(n,t))}),A.waitFor(s)}removeOverlaysForBatchId(t,e,n){const r=new Set,s=(e.forEach(e=>r.add(io(e.getCollectionPath()))),[]);return r.forEach(e=>{e=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);s.push(eu(t).Y("collectionPathOverlayIndex",e))}),A.waitFor(s)}getOverlaysForCollection(e,t,n){const r=Ta(),s=io(t),i=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return eu(e).W("collectionPathOverlayIndex",i).next(e=>{for(const t of e){const e=$o(this.yt,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,s){const i=Ta();let a;n=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return eu(e).Z({index:"collectionGroupOverlayIndex",range:n},(e,t,n)=>{const r=$o(this.yt,t);i.size()<s||r.largestBatchId===a?(i.set(r.getKey(),r),a=r.largestBatchId):n.done()}).next(()=>i)}oe(e,t){return eu(e).put(function(e,t,n){var[,r,s]=Wo(t,n.mutation.key);return{userId:t,collectionPath:r,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Xa(e.ie,n.mutation)}}(this.yt,this.userId,t))}}function eu(e){return Lo(e,"documentOverlays")}class tu{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){var n,r;"nullValue"in e?this.he(t,5):"booleanValue"in e?(this.he(t,10),t.le(e.booleanValue?1:0)):"integerValue"in e?(this.he(t,15),t.le(N(e.integerValue))):"doubleValue"in e?(n=N(e.doubleValue),isNaN(n)?this.he(t,13):(this.he(t,15),Is(n)?t.le(0):t.le(n))):"timestampValue"in e?(r=e.timestampValue,this.he(t,20),"string"==typeof r?t.fe(r):(t.fe(""+(r.seconds||"")),t.le(r.nanos||0))):"stringValue"in e?(this.de(e.stringValue,t),this._e(t)):"bytesValue"in e?(this.he(t,30),t.we(_s(e.bytesValue)),this._e(t)):"referenceValue"in e?this.me(e.referenceValue,t):"geoPointValue"in e?(r=e.geoPointValue,this.he(t,45),t.le(r.latitude||0),t.le(r.longitude||0)):"mapValue"in e?Gs(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):T()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){var n=e.fields||{};this.he(t,55);for(const e of Object.keys(n))this.de(e,t),this.ce(n[e],t)}ye(e,t){var n=e.values||[];this.he(t,50);for(const e of n)this.ce(e,t)}me(e,t){this.he(t,37),D.fromName(e).path.forEach(e=>{this.he(t,60),this.pe(e,t)})}he(e,t){e.le(t)}_e(e){e.le(2)}}function nu(e){e=64-function(t){let n=0;for(let e=0;e<8;++e){var r=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&t[e]);if(n+=r,8!==r)break}return n}(e);return Math.ceil(e/8)}tu.Ie=new tu;class ru{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ee(n.value),n=t.next();this.Ae()}Re(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.be(n.value),n=t.next();this.Pe()}ve(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ee(e);else if(e<2048)this.Ee(960|e>>>6),this.Ee(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ee(480|e>>>12),this.Ee(128|63&e>>>6),this.Ee(128|63&e);else{const e=t.codePointAt(0);this.Ee(240|e>>>18),this.Ee(128|63&e>>>12),this.Ee(128|63&e>>>6),this.Ee(128|63&e)}}this.Ae()}Ve(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.be(e);else if(e<2048)this.be(960|e>>>6),this.be(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.be(480|e>>>12),this.be(128|63&e>>>6),this.be(128|63&e);else{const e=t.codePointAt(0);this.be(240|e>>>18),this.be(128|63&e>>>12),this.be(128|63&e>>>6),this.be(128|63&e)}}this.Pe()}Se(t){var n=this.De(t),t=nu(n);this.Ce(1+t),this.buffer[this.position++]=255&t;for(let e=n.length-t;e<n.length;++e)this.buffer[this.position++]=255&n[e]}xe(t){var n=this.De(t),t=nu(n);this.Ce(1+t),this.buffer[this.position++]=~(255&t);for(let e=n.length-t;e<n.length;++e)this.buffer[this.position++]=~(255&n[e])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}Ee(e){e&=255;0==e?(this.ke(0),this.ke(255)):255==e?(this.ke(255),this.ke(0)):this.ke(e)}be(e){var t=255&e;0==t?(this.Me(0),this.Me(255)):255==t?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(t){t+=this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t);const n=new Uint8Array(e);n.set(this.buffer),this.buffer=n}}}class su{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class iu{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class au{constructor(){this.$e=new ru,this.Be=new su(this.$e),this.Le=new iu(this.$e)}seed(e){this.$e.seed(e)}qe(e){return 0===e?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}class ou{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Ue(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new ou(this.indexId,this.documentKey,this.arrayValue,n)}}function uu(e,t){let n=e.indexId-t.indexId;return 0!==n?n:0!==(n=cu(e.arrayValue,t.arrayValue))?n:0!==(n=cu(e.directionalValue,t.directionalValue))?n:D.comparator(e.documentKey,t.documentKey)}function cu(t,n){for(let e=0;e<t.length&&e<n.length;++e){var r=t[e]-n[e];if(0!=r)return r}return t.length-n.length}class hu{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[];for(const t of e.filters){const e=t;e.isInequality()?this.Qe=e:this.Ge.push(e)}}je(e){y(e.collectionGroup===this.collectionId);var t=Qr(e);if(void 0!==t&&!this.We(t))return!1;var n=zr(e);let r=0,s=0;for(;r<n.length&&this.We(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Qe){const e=n[r];if(!this.ze(this.Qe,e)||!this.He(this.Ke[s++],e))return!1;++r}for(;r<n.length;++r){const e=n[r];if(s>=this.Ke.length||!this.He(this.Ke[s++],e))return!1}return!0}We(e){for(const t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;e="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind==e}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function lu(e){return e instanceof k}function du(e){return e instanceof R&&Xs(e)}function fu(e){return lu(e)||du(e)||function(e){if(e instanceof R&&Ys(e)){for(const t of e.getFilters())if(!lu(t)&&!du(t))return!1;return!0}return!1}(e)}function gu(e,t){var n,r;return y(e instanceof k||e instanceof R),y(t instanceof k||t instanceof R),pu(e instanceof k?t instanceof k?(n=e,r=t,R.create([n,r],"and")):mu(e,t):t instanceof k?mu(t,e):function(e,t){if(y(0<e.filters.length&&0<t.filters.length),Hs(e)&&Hs(t))return Zs(e,t.getFilters());const n=Ys(e)?e:t,r=Ys(e)?t:e,s=n.filters.map(e=>gu(e,r));return R.create(s,"or")}(e,t))}function mu(t,e){if(Hs(e))return Zs(e,t.getFilters());e=e.filters.map(e=>gu(t,e));return R.create(e,"or")}function pu(t){if(y(t instanceof k||t instanceof R),t instanceof k)return t;const e=t.getFilters();if(1===e.length)return pu(e[0]);if(Js(t))return t;const n=e.map(e=>pu(e)),r=[];return n.forEach(e=>{e instanceof k?r.push(e):e instanceof R&&(e.op===t.op?r.push(...e.filters):r.push(e))}),1===r.length?r[0]:R.create(r,t.op)}class yu{constructor(){this.Je=new vu}addToCollectionParentIndex(e,t){return this.Je.add(t),A.resolve()}getCollectionParents(e,t){return A.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return A.resolve()}deleteFieldIndex(e,t){return A.resolve()}getDocumentsMatchingTarget(e,t){return A.resolve(null)}getIndexType(e,t){return A.resolve(0)}getFieldIndexes(e,t){return A.resolve([])}getNextCollectionGroupToUpdate(e){return A.resolve(null)}getMinOffset(e,t){return A.resolve(Xr.min())}getMinOffsetFromCollectionGroup(e,t){return A.resolve(Xr.min())}updateCollectionGroup(e,t,n){return A.resolve()}updateIndexEntries(e,t){return A.resolve()}}class vu{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new M(S.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new M(S.comparator)).toArray()}}const wu=new Uint8Array(0);class Iu{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new vu,this.Xe=new ya(e=>vi(e),(e,t)=>wi(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(this.Ye.has(t))return A.resolve();var n=t.lastSegment(),r=t.popLast();return e.addOnCommittedListener(()=>{this.Ye.add(t)}),r={collectionId:n,parent:io(r)},bu(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[Ur(n),""],!1,!0);return bu(e).W(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(oo(t.parent))}return r})}addFieldIndex(e,t){const n=Eu(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])},s=(delete r.indexId,n.add(r));if(t.indexState){const n=_u(e);return s.next(e=>{n.put(Ho(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const n=Eu(e),r=_u(e),s=Tu(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,c){const h=Tu(e);let l=!0;const n=new Map;return A.forEach(this.Ze(c),t=>this.tn(e,t).next(e=>{l=l&&!!e,n.set(t,e)})).next(()=>{if(l){let u=V();const l=[];return A.forEach(n,(e,t)=>{f("IndexedDbIndexManager",`Using index ${o=e,`id=${o.indexId}|cg=${o.collectionGroup}|f=`+o.fields.map(e=>e.fieldPath+":"+e.kind).join(",")} to execute `+vi(c));var n=function(e,t){var n=Qr(t);if(void 0===n)return null;for(const t of bi(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(t,e),r=function(e,t){const n=new Map;for(const r of zr(t))for(const t of bi(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(t,e),s=function(e,t){const n=[];let r=!0;for(const s of zr(t)){const t=(0===s.kind?Ti:Ei)(e,s.fieldPath,e.startAt);n.push(t.value),r=r&&t.inclusive}return new Qs(n,r)}(t,e),i=function(e,t){const n=[];let r=!0;for(const s of zr(t)){const t=(0===s.kind?Ei:Ti)(e,s.fieldPath,e.endAt);n.push(t.value),r=r&&t.inclusive}return new Qs(n,r)}(t,e),a=this.en(e,t,s),o=this.en(e,t,i),r=this.nn(e,t,r),r=this.sn(e.indexId,n,a,s.inclusive,o,i.inclusive,r);return A.forEach(r,e=>h.J(e,c.limit).next(e=>{e.forEach(e=>{e=D.fromSegments(e.documentKey);u.has(e)||(u=u.add(e),l.push(e))})}))}).next(()=>l)}return A.resolve(null)})}Ze(t){var e;return this.Xe.get(t)||(e=0===t.filters.length?[t]:function(e){if(0===e.getFilters().length)return[];const t=function t(e){if(y(e instanceof k||e instanceof R),e instanceof k)return e;if(1===e.filters.length)return t(e.filters[0]);var n=e.filters.map(e=>t(e));let r=R.create(n,e.op);return fu(r=pu(r))?r:(y(r instanceof R),y(Hs(r)),y(1<r.filters.length),r.filters.reduce((e,t)=>gu(e,t)))}(function t(n){var e;if(y(n instanceof k||n instanceof R),n instanceof k){if(n instanceof ai){const r=(null==(e=null==(e=n.value.arrayValue)?void 0:e.values)?void 0:e.map(e=>k.create(n.field,"==",e)))||[];return R.create(r,"or")}return n}const r=n.filters.map(e=>t(e));return R.create(r,n.op)}(e));return y(fu(t)),lu(t)||du(t)?[t]:t.getFilters()}(R.create(t.filters,"and")).map(e=>yi(t.path,t.collectionGroup,t.orderBy,e.getFilters(),t.limit,t.startAt,t.endAt)),this.Xe.set(t,e),e)}sn(t,n,r,s,i,a,o){const u=(null!=n?n.length:1)*Math.max(r.length,i.length),c=u/(null!=n?n.length:1),h=[];for(let e=0;e<u;++e){const u=n?this.rn(n[e/c]):wu,l=this.on(t,u,r[e%c],s),d=this.un(t,u,i[e%c],a),f=o.map(e=>this.on(t,u,e,!0));h.push(...this.createRange(l,d,f))}return h}on(e,t,n,r){const s=new ou(e,D.empty(),t,n);return r?s:s.Ue()}un(e,t,n,r){const s=new ou(e,D.empty(),t,n);return r?s.Ue():s}tn(e,t){const r=new hu(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(const n of e)r.je(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let n=2;const r=this.Ze(t);return A.forEach(r,t=>this.tn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new M(x.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&1<r.length&&2===n?1:n)}cn(e,t){const n=new au;for(const s of zr(e)){const e=t.data.field(s.fieldPath);if(null==e)return null;var r=n.qe(s.kind);tu.Ie.ue(e,r)}return n.Fe()}rn(e){const t=new au;return tu.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){const n=new au;return tu.Ie.ue(Os(this.databaseId,t),n.qe(0===(t=zr(e)).length?0:t[t.length-1].kind)),n.Fe()}nn(e,t,n){if(null===n)return[];let r=[],s=(r.push(new au),0);for(const i of zr(e)){const e=n[s++];for(const n of r)if(this.hn(t,i.fieldPath)&&Vs(e))r=this.ln(r,i,e);else{const t=n.qe(i.kind);tu.Ie.ue(e,t)}}return this.fn(r)}en(e,t,n){return this.nn(e,t,n.position)}fn(t){const n=[];for(let e=0;e<t.length;++e)n[e]=t[e].Fe();return n}ln(e,t,n){const r=[...e],s=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new au;r.seed(n.Fe()),tu.Ie.ue(e,r.qe(t.kind)),s.push(r)}return s}hn(e,t){return!!e.filters.find(e=>e instanceof k&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const n=Eu(e),i=_u(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next(e=>{const s=[];return A.forEach(e,r=>i.get([r.indexId,this.uid]).next(e=>{var t,n;s.push((t=r,e=e?new Wr(e.sequenceNumber,new Xr(Go(e.readTime),new D(oo(e.documentKey)),e.largestBatchId)):Wr.empty(),n=t.fields.map(([e,t])=>new $r(x.fromServerFormat(e),t)),new jr(t.indexId,t.collectionGroup,n,e)))})).next(()=>s)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!=n?n:E(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,n,r){const s=Eu(e),i=_u(e);return this.dn(e).next(t=>s.W("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(e=>A.forEach(e,e=>i.put(Ho(e.indexId,this.user,t,r)))))}updateIndexEntries(s,e){const n=new Map;return A.forEach(e,(t,r)=>{var e=n.get(t.collectionGroup);return(e?A.resolve(e):this.getFieldIndexes(s,t.collectionGroup)).next(e=>(n.set(t.collectionGroup,e),A.forEach(e,n=>this._n(s,t,n).next(e=>{var t=this.wn(r,n);return e.isEqual(t)?A.resolve():this.mn(s,r,n,e,t)}))))})}gn(e,t,n,r){return Tu(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.an(n,t.key),documentKey:t.key.path.toArray()})}yn(e,t,n,r){return Tu(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.an(n,t.key),t.key.path.toArray()])}_n(e,n,r){const t=Tu(e);let s=new M(uu);return t.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.an(r,n)])},(e,t)=>{s=s.add(new ou(r.indexId,n,t.arrayValue,t.directionalValue))}).next(()=>s)}wn(e,t){let n=new M(uu);var r=this.cn(t,e);if(null==r)return n;const s=Qr(t);if(null!=s){var i=e.data.field(s.fieldPath);if(Vs(i))for(const s of i.arrayValue.values||[])n=n.add(new ou(t.indexId,e.key,this.rn(s),r))}else n=n.add(new ou(t.indexId,e.key,wu,r));return n}mn(t,s,i,e,a){f("IndexedDbIndexManager","Updating index entries for document '%s'",s.key);const o=[];{var u=uu,c=e=>{o.push(this.gn(t,s,i,e))},h=e=>{o.push(this.yn(t,s,i,e))},l=e.getIterator(),d=a.getIterator();let n=fi(l),r=fi(d);for(;n||r;){let e=!1,t=!1;if(n&&r){const c=u(n,r);c<0?t=!0:0<c&&(e=!0)}else null!=n?t=!0:e=!0;e?(c(r),r=fi(d)):t?(h(n),n=fi(l)):(n=fi(l),r=fi(d))}}return A.waitFor(o)}dn(e){let r=1;return _u(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,t,n)=>{n.done(),r=t.sequenceNumber+1}).next(()=>r)}createRange(e,t,n){n=n.sort((e,t)=>uu(e,t)).filter((e,t,n)=>!t||0!==uu(e,n[t-1]));const r=[];r.push(e);for(const s of n){const n=uu(s,e),i=uu(s,t);if(0===n)r[0]=e.Ue();else if(0<n&&i<0)r.push(s),r.push(s.Ue());else if(0<i)break}r.push(t);const s=[];for(let e=0;e<r.length;e+=2){if(this.pn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,wu,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,wu,[]];s.push(IDBKeyRange.bound(t,n))}return s}pn(e,t){return 0<uu(e,t)}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Su)}getMinOffset(t,e){return A.mapArray(this.Ze(e),e=>this.tn(t,e).next(e=>e||T())).next(Su)}}function bu(e){return Lo(e,"collectionParents")}function Tu(e){return Lo(e,"indexEntries")}function Eu(e){return Lo(e,"indexConfiguration")}function _u(e){return Lo(e,"indexState")}function Su(t){y(0!==t.length);let n=t[0].indexState.offset,r=n.largestBatchId;for(let e=1;e<t.length;e++){var s=t[e].indexState.offset;Jr(s,n)<0&&(n=s),r<s.largestBatchId&&(r=s.largestBatchId)}return new Xr(n.readTime,n.documentKey,r)}const xu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Du{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Du(e,Du.DEFAULT_COLLECTION_PERCENTILE,Du.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Au(e,t,n){const r=e.store("mutations"),s=e.store("documentMutations"),i=[],a=IDBKeyRange.only(n.batchId);let o=0;const u=r.Z({range:a},(e,t,n)=>(o++,n.delete())),c=(i.push(u.next(()=>{y(1===o)})),[]);for(const e of n.mutations){const r=ho(t,e.key.path,n.batchId);i.push(s.delete(r)),c.push(e.key)}return A.waitFor(i).next(()=>c)}function Cu(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw T();t=e.noDocument}return JSON.stringify(t).length}Du.DEFAULT_COLLECTION_PERCENTILE=10,Du.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Du.DEFAULT=new Du(41943040,Du.DEFAULT_COLLECTION_PERCENTILE,Du.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Du.DISABLED=new Du(-1,0,0);class Nu{constructor(e,t,n,r){this.userId=e,this.yt=t,this.indexManager=n,this.referenceDelegate=r,this.In={}}static re(e,t,n,r){y(""!==e.uid);e=e.isAuthenticated()?e.uid:"";return new Nu(e,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ru(e).Z({index:"userMutationsIndex",range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(h,l,d,f){const g=Lu(h),m=Ru(h);return m.add({}).next(e=>{y("number"==typeof e);const t=new Mo(e,l,d,f),n=(s=this.yt,i=this.userId,o=(a=t).baseMutations.map(e=>Xa(s.ie,e)),u=a.mutations.map(e=>Xa(s.ie,e)),{userId:i,batchId:a.batchId,localWriteTimeMs:a.localWriteTime.toMillis(),baseMutations:o,mutations:u}),r=[];var s,i,a,o,u;let c=new M((e,t)=>E(e.canonicalString(),t.canonicalString()));for(const h of f){const l=ho(this.userId,h.key.path,e);c=c.add(h.key.path.popLast()),r.push(m.put(n)),r.push(g.put(l,lo))}return c.forEach(e=>{r.push(this.indexManager.addToCollectionParentIndex(h,e))}),h.addOnCommittedListener(()=>{this.In[e]=t.keys()}),A.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return Ru(e).get(t).next(e=>e?(y(e.userId===this.userId),Ko(this.yt,e)):null)}Tn(e,t){return this.In[t]?A.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(e=>{return e?(e=e.keys(),this.In[t]=e):null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Ru(e).Z({index:"userMutationsIndex",range:n},(e,t,n)=>{t.userId===this.userId&&(y(t.batchId>=r),s=Ko(this.yt,t)),n.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Ru(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ru(e).W("userMutationsIndex",t).next(e=>e.map(e=>Ko(this.yt,e)))}getAllMutationBatchesAffectingDocumentKey(i,a){const e=co(this.userId,a.path),t=IDBKeyRange.lowerBound(e),o=[];return Lu(i).Z({range:t},(e,t,n)=>{var[e,r,s]=e,r=oo(r);if(e===this.userId&&a.path.isEqual(r))return Ru(i).get(s).next(e=>{if(!e)throw T();y(e.userId===this.userId),o.push(Ko(this.yt,e))});n.done()}).next(()=>o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let a=new M(E);const n=[];return e.forEach(i=>{var e=co(this.userId,i.path),e=IDBKeyRange.lowerBound(e),e=Lu(t).Z({range:e},(e,t,n)=>{var[e,r,s]=e,r=oo(r);e===this.userId&&i.path.isEqual(r)?a=a.add(s):n.done()});n.push(e)}),A.waitFor(n).next(()=>this.En(t,a))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,a=i.length+1,n=co(this.userId,i),r=IDBKeyRange.lowerBound(n);let o=new M(E);return Lu(e).Z({range:r},(e,t,n)=>{var[e,r,s]=e,r=oo(r);e===this.userId&&i.isPrefixOf(r)?r.length===a&&(o=o.add(s)):n.done()}).next(()=>this.En(e,o))}En(t,e){const n=[],r=[];return e.forEach(e=>{r.push(Ru(t).get(e).next(e=>{if(null===e)throw T();y(e.userId===this.userId),n.push(Ko(this.yt,e))}))}),A.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return Au(t.se,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.An(n.batchId)}),A.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}An(e){delete this.In[e]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return A.resolve();e=IDBKeyRange.lowerBound([this.userId]);const r=[];return Lu(t).Z({range:e},(e,t,n)=>{if(e[0]===this.userId){const t=oo(e[1]);r.push(t)}else n.done()}).next(()=>{y(0===r.length)})})}containsKey(e,t){return ku(e,this.userId,t)}Rn(e){return Mu(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function ku(e,s,t){const n=co(s,t.path),i=n[1],r=IDBKeyRange.lowerBound(n);let a=!1;return Lu(e).Z({range:r,X:!0},(e,t,n)=>{var[e,r]=e;e===s&&r===i&&(a=!0),n.done()}).next(()=>a)}function Ru(e){return Lo(e,"mutations")}function Lu(e){return Lo(e,"documentMutations")}function Mu(e){return Lo(e,"mutationQueues")}class Ou{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new Ou(0)}static vn(){return new Ou(-1)}}class Fu{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(n){return this.Vn(n).next(e=>{const t=new Ou(e.highestTargetId);return e.highestTargetId=t.next(),this.Sn(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(e=>_.fromTimestamp(new h(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.Vn(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.Sn(t,e)))}addTargetData(t,n){return this.Dn(t,n).next(()=>this.Vn(t).next(e=>(e.targetCount+=1,this.Cn(n,e),this.Sn(t,e))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Vu(t).delete(e.targetId)).next(()=>this.Vn(t)).next(e=>(y(0<e.targetCount),--e.targetCount,this.Sn(t,e)))}removeTargets(n,r,s){let i=0;const a=[];return Vu(n).Z((e,t)=>{t=jo(t);t.sequenceNumber<=r&&null===s.get(t.targetId)&&(i++,a.push(this.removeTargetData(n,t)))}).next(()=>A.waitFor(a)).next(()=>i)}forEachTarget(e,n){return Vu(e).Z((e,t)=>{t=jo(t);n(t)})}Vn(e){return Pu(e).get("targetGlobalKey").next(e=>(y(null!==e),e))}Sn(e,t){return Pu(e).put("targetGlobalKey",t)}Dn(e,t){return Vu(e).put(Qo(this.yt,t))}Cn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Vn(e).next(e=>e.targetCount)}getTargetData(e,r){var t=vi(r),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let s=null;return Vu(e).Z({range:t,index:"queryTargetsIndex"},(e,t,n)=>{t=jo(t);wi(r,t.target)&&(s=t,n.done())}).next(()=>s)}addMatchingKeys(n,e,r){const s=[],i=qu(n);return e.forEach(e=>{var t=io(e.path);s.push(i.put({targetId:r,path:t})),s.push(this.referenceDelegate.addReference(n,r,e))}),A.waitFor(s)}removeMatchingKeys(n,e,r){const s=qu(n);return A.forEach(e,e=>{var t=io(e.path);return A.waitFor([s.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=qu(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=qu(e);let s=V();return r.Z({range:n,X:!0},(e,t,n)=>{e=oo(e[1]),e=new D(e);s=s.add(e)}).next(()=>s)}containsKey(e,t){t=io(t.path),t=IDBKeyRange.bound([t],[Ur(t)],!1,!0);let r=0;return qu(e).Z({index:"documentTargetsIndex",X:!0,range:t},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}ne(e,t){return Vu(e).get(t).next(e=>e?jo(e):null)}}function Vu(e){return Lo(e,"targets")}function Pu(e){return Lo(e,"targetGlobal")}function qu(e){return Lo(e,"targetDocuments")}function Bu([e,t],[n,r]){e=E(e,n);return 0===e?E(t,r):e}class Uu{constructor(e){this.xn=e,this.buffer=new M(Bu),this.Nn=0}kn(){return++this.Nn}On(e){var t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Bu(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Gu{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){f("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Mn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){as(e)?f("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await ts(e)}await this.Fn(3e5)})}}class Ku{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return A.resolve(fs.at);const n=new Uu(t);return this.$n.forEachTarget(e,e=>n.On(e.sequenceNumber)).next(()=>this.$n.Ln(e,e=>n.On(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.$n.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(f("LruGarbageCollector","Garbage collection skipped; disabled"),A.resolve(xu)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(f("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold `+this.params.cacheSizeCollectionThreshold),xu):this.qn(t,n))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(t,n){let r,s,i,a,o,u,c;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(s=e>this.params.maximumSequenceNumbersToCollect?(f("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from `+e),this.params.maximumSequenceNumbersToCollect):e,a=Date.now(),this.nthSequenceNumber(t,s))).next(e=>(r=e,o=Date.now(),this.removeTargets(t,r,n))).next(e=>(i=e,u=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(c=Date.now(),Ar()<=l.DEBUG&&f("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-h}ms
	Determined least recently used ${s} in `+(o-a)+"ms\n"+`	Removed ${i} targets in `+(u-o)+"ms\n"+`	Removed ${e} documents in `+(c-u)+"ms\n"+`Total Duration: ${c-h}ms`),A.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:e})))}}class ju{constructor(e,t){this.db=e,this.garbageCollector=(e=this,new Ku(e,t))}Bn(e){const n=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}Un(e){let t=0;return this.Ln(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,n){return this.Kn(e,(e,t)=>n(t))}addReference(e,t,n){return Qu(e,n)}removeReference(e,t,n){return Qu(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Qu(e,t)}Gn(t,n){let r=!1;return Mu(t).tt(e=>ku(t,e,n).next(e=>(e&&(r=!0),A.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let a=0;return this.Kn(n,(t,e)=>{if(e<=r){const r=this.Gn(n,t).next(e=>{if(!e)return a++,s.getEntry(n,t).next(()=>(s.removeEntry(t,_.min()),qu(n).delete([0,io(t.path)])))});i.push(r)}}).next(()=>A.waitFor(i)).next(()=>s.apply(n)).next(()=>a)}removeTarget(e,t){t=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,t)}updateLimboDocument(e,t){return Qu(e,t)}Kn(e,r){const t=qu(e);let s,i=fs.at;return t.Z({index:"documentTargetsIndex"},([e],{path:t,sequenceNumber:n})=>{0===e?(i!==fs.at&&r(new D(oo(s)),i),i=n,s=t):i=fs.at}).next(()=>{i!==fs.at&&r(new D(oo(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Qu(e,t){return qu(e).put((e=e.currentSequenceNumber,{targetId:0,path:io(t.path),sequenceNumber:e}))}class zu{constructor(){this.changes=new ya(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,O.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?A.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class $u{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Xu(e).put(n)}removeEntry(e,n,t){return Xu(e).delete(function(e){const t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],Bo(e),t[t.length-1]]}(t))}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.Qn(t,e)))}getEntry(e,n){let r=O.newInvalidDocument(n);return Xu(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Ju(n))},(e,t)=>{r=this.jn(n,t)}).next(()=>r)}Wn(e,n){let r={size:0,document:O.newInvalidDocument(n)};return Xu(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Ju(n))},(e,t)=>{r={document:this.jn(n,t),size:Cu(t)}}).next(()=>r)}getEntries(e,t){let n=va;return this.zn(e,t,(e,t)=>{t=this.jn(e,t);n=n.insert(e,t)}).next(()=>n)}Hn(e,t){let r=va,s=new L(D.comparator);return this.zn(e,t,(e,t)=>{var n=this.jn(e,t);r=r.insert(e,n),s=s.insert(e,Cu(t))}).next(()=>({documents:r,Jn:s}))}zn(e,t,s){if(t.isEmpty())return A.resolve();let n=new M(ec);t.forEach(e=>n=n.add(e));const r=IDBKeyRange.bound(Ju(n.first()),Ju(n.last())),i=n.getIterator();let a=i.getNext();return Xu(e).Z({index:"documentKeyIndex",range:r},(e,t,n)=>{for(var r=D.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);a&&ec(a,r)<0;)s(a,null),a=i.getNext();a&&a.isEqual(r)&&(s(a,t),a=i.hasNext()?i.getNext():null),a?n.j(Ju(a)):n.done()}).next(()=>{for(;a;)s(a,null),a=i.hasNext()?i.getNext():null})}getAllFromCollection(e,t,n){n=[t.popLast().toArray(),t.lastSegment(),Bo(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],t=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Xu(e).W(IDBKeyRange.bound(n,t,!0)).next(e=>{let t=va;for(const n of e){const e=this.jn(D.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);t=t.insert(e.key,e)}return t})}getAllFromCollectionGroup(e,t,n,r){let s=va;n=Zu(t,n),t=Zu(t,Xr.max());return Xu(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(n,t,!0)},(e,t,n)=>{t=this.jn(D.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(s=s.insert(t.key,t)).size===r&&n.done()}).next(()=>s)}newChangeBuffer(e){return new Hu(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return Yu(e).get("remoteDocumentGlobalKey").next(e=>(y(!!e),e))}Qn(e,t){return Yu(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const e=function(e,t){let n;if(t.document)n=Ya(e.ie,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=D.fromSegments(t.noDocument.path),r=Go(t.noDocument.readTime);n=O.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return T();{const e=D.fromSegments(t.unknownDocument.path),s=Go(t.unknownDocument.version);n=O.newUnknownDocument(e,s)}}return t.readTime&&n.setReadTime((t=t.readTime,e=new h(t[0],t[1]),_.fromTimestamp(e))),n}(this.yt,t);if(!e.isNoDocument()||!e.version.isEqual(_.min()))return e}return O.newInvalidDocument(e)}}function Wu(e){return new $u(e)}class Hu extends zu{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new ya(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(i){const a=[];let o=0,u=new M((e,t)=>E(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.Xn.get(e);if(a.push(this.Yn.removeEntry(i,e,n.readTime)),t.isValidDocument()){var r=qo(this.Yn.yt,t),s=(u=u.add(e.path.popLast()),Cu(r));o+=s-n.size,a.push(this.Yn.addEntry(i,e,r))}else if(o-=n.size,this.trackRemovals){const o=qo(this.Yn.yt,t.convertToNoDocument(_.min()));a.push(this.Yn.addEntry(i,e,o))}}),u.forEach(e=>{a.push(this.Yn.indexManager.addToCollectionParentIndex(i,e))}),a.push(this.Yn.updateMetadata(i,o)),A.waitFor(a)}getFromCache(e,t){return this.Yn.Wn(e,t).next(e=>(this.Xn.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:n,Jn:e})=>(e.forEach((e,t)=>{this.Xn.set(e,{size:t,readTime:n.get(e).readTime})}),n))}}function Yu(e){return Lo(e,"remoteDocumentGlobal")}function Xu(e){return Lo(e,"remoteDocumentsV14")}function Ju(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Zu(e,t){const n=t.documentKey.path.toArray();return[e,Bo(t.readTime),n.slice(0,n.length-2),0<n.length?n[n.length-1]:""]}function ec(e,t){var n=e.path.toArray(),r=t.path.toArray();let s=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(s=E(n[e],r[e]))return s;return(s=E(n.length,r.length))||((s=E(n[n.length-2],r[r.length-2]))||E(n[n.length-1],r[r.length-1]))}class tc{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class nc{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,n){let r=null;return this.documentOverlayCache.getOverlay(t,n).next(e=>(r=e,this.remoteDocumentCache.getEntry(t,n))).next(e=>(null!==r&&ia(r.mutation,e,gi.empty(),h.now()),e))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,V()).next(()=>e))}getLocalViewOfDocuments(e,t,n=V()){const r=Ta();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let n=Ia();return e.forEach((e,t)=>{n=n.insert(e,t.overlayedDocument)}),n}))}getOverlayedDocuments(e,t){const n=Ta();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,V()))}populateOverlays(e,n,t){const r=[];return t.forEach(e=>{n.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,t)=>{n.set(e,t)})})}computeViews(e,t,r,s){let i=va;const a=Ta(),n=Ta();return t.forEach((e,t)=>{const n=r.get(t.key);s.has(t.key)&&(void 0===n||n.mutation instanceof ua)?i=i.insert(t.key,t):void 0!==n&&(a.set(t.key,n.mutation.getFieldMask()),ia(n.mutation,t,n.mutation.getFieldMask(),h.now()))}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>a.set(e,t)),t.forEach((e,t)=>{return n.set(e,new tc(t,null!=(t=a.get(e))?t:null))}),n))}recalculateAndSaveOverlays(i,a){const o=Ta();let u=new L((e,t)=>e-t),c=V();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(i,a).next(e=>{for(const r of e)r.keys().forEach(e=>{var t,n=a.get(e);null!==n&&(t=o.get(e)||gi.empty(),t=r.applyToLocalView(n,t),o.set(e,t),t=(u.get(r.batchId)||V()).add(e),u=u.insert(r.batchId,t))})}).next(()=>{const e=[],t=u.getReverseIterator();for(;t.hasNext();){const u=t.getNext(),n=u.key,r=u.value,s=Ta();r.forEach(e=>{var t;c.has(e)||(null!==(t=sa(a.get(e),o.get(e)))&&s.set(e,t),c=c.add(e))}),e.push(this.documentOverlayCache.saveOverlays(i,n,s))}return A.waitFor(e)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(e,t,n){return r=t,D.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Ni(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n);var r}getNextDocuments(i,t,a,o){return this.remoteDocumentCache.getAllFromCollectionGroup(i,t,a,o).next(n=>{const e=0<o-n.size?this.documentOverlayCache.getOverlaysForCollectionGroup(i,t,a.largestBatchId,o-n.size):A.resolve(Ta());let r=-1,s=n;return e.next(e=>A.forEach(e,(t,e)=>(r<e.largestBatchId&&(r=e.largestBatchId),n.get(t)?A.resolve():this.remoteDocumentCache.getEntry(i,t).next(e=>{s=s.insert(t,e)}))).next(()=>this.populateOverlays(i,e,n)).next(()=>this.computeViews(i,s,e,V())).next(e=>({batchId:r,changes:ba(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new D(t)).next(e=>{let t=Ia();return t=e.isFoundDocument()?t.insert(e.key,e):t})}getDocumentsMatchingCollectionGroupQuery(n,r,s){const i=r.collectionGroup;let a=Ia();return this.indexManager.getCollectionParents(n,i).next(e=>A.forEach(e,e=>{t=r,e=e.child(i);var t,e=new _i(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(n,e,s).next(e=>{e.forEach((e,t)=>{a=a.insert(e,t)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,i,n){let a;return this.remoteDocumentCache.getAllFromCollection(t,i.path,n).next(e=>(a=e,this.documentOverlayCache.getOverlaysForCollection(t,i.path,n.largestBatchId))).next(r=>{r.forEach((e,t)=>{t=t.getKey();null===a.get(t)&&(a=a.insert(t,O.newInvalidDocument(t)))});let s=Ia();return a.forEach((e,t)=>{var n=r.get(e);void 0!==n&&ia(n.mutation,t,gi.empty(),h.now()),Pi(i,t)&&(s=s.insert(e,t))}),s})}}class rc{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return A.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){return this.Zn.set(t.id,{id:t.id,version:t.version,createTime:P(t.createTime)}),A.resolve()}getNamedQuery(e,t){return A.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:t.name,query:zo(t.bundledQuery),readTime:P(t.readTime)}),A.resolve()}}class sc{constructor(){this.overlays=new L(D.comparator),this.es=new Map}getOverlay(e,t){return A.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Ta();return A.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(n,r,e){return e.forEach((e,t)=>{this.oe(n,r,t)}),A.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.es.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.es.delete(n)),A.resolve()}getOverlaysForCollection(e,t,n){const r=Ta(),s=t.length+1,i=new D(t.child("")),a=this.overlays.getIteratorFrom(i);for(;a.hasNext();){const e=a.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===s&&e.largestBatchId>n&&r.set(e.getKey(),e)}return A.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new L((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=Ta(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const a=Ta(),o=s.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return A.resolve(a)}oe(e,t,n){var r=this.overlays.get(n.key);if(null!==r){const e=this.es.get(r.largestBatchId).delete(n.key);this.es.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Fo(t,n));let s=this.es.get(t);void 0===s&&(s=V(),this.es.set(t,s)),this.es.set(t,s.add(n.key))}}class ic{constructor(){this.ns=new M(ac.ss),this.rs=new M(ac.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){e=new ac(e,t);this.ns=this.ns.add(e),this.rs=this.rs.add(e)}us(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.cs(new ac(e,t))}hs(e,t){e.forEach(e=>this.removeReference(e,t))}ls(e){const t=new D(new S([])),n=new ac(t,e),r=new ac(t,e+1),s=[];return this.rs.forEachInRange([n,r],e=>{this.cs(e),s.push(e.key)}),s}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){var t=new D(new S([])),n=new ac(t,e),t=new ac(t,e+1);let r=V();return this.rs.forEachInRange([n,t],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new ac(e,0);return null!==(t=this.ns.firstAfterOrEqual(t))&&e.isEqual(t.key)}}class ac{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return D.comparator(e.key,t.key)||E(e._s,t._s)}static os(e,t){return E(e._s,t._s)||D.comparator(e.key,t.key)}}class oc{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new M(ac.ss)}checkEmpty(e){return A.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){var s=this.ws,t=(this.ws++,0<this.mutationQueue.length&&this.mutationQueue[this.mutationQueue.length-1],new Mo(s,t,n,r));this.mutationQueue.push(t);for(const t of r)this.gs=this.gs.add(new ac(t.key,s)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return A.resolve(t)}lookupMutationBatch(e,t){return A.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){t=(t=this.ps(t+1))<0?0:t;return A.resolve(this.mutationQueue.length>t?this.mutationQueue[t]:null)}getHighestUnacknowledgedBatchId(){return A.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return A.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new ac(t,0),r=new ac(t,Number.POSITIVE_INFINITY),s=[];return this.gs.forEachInRange([n,r],e=>{e=this.ys(e._s);s.push(e)}),A.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new M(E);return t.forEach(e=>{var t=new ac(e,0),e=new ac(e,Number.POSITIVE_INFINITY);this.gs.forEachInRange([t,e],e=>{n=n.add(e._s)})}),A.resolve(this.Is(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;D.isDocumentKey(s)||(s=s.child(""));t=new ac(new D(s),0);let i=new M(E);return this.gs.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(i=i.add(e._s)),!0)},t),A.resolve(this.Is(i))}Is(e){const t=[];return e.forEach(e=>{e=this.ys(e);null!==e&&t.push(e)}),t}removeMutationBatch(n,r){y(0===this.Ts(r.batchId,"removed")),this.mutationQueue.shift();let s=this.gs;return A.forEach(r.mutations,e=>{var t=new ac(e.key,r.batchId);return s=s.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.gs=s})}An(e){}containsKey(e,t){var n=new ac(t,0),n=this.gs.firstAfterOrEqual(n);return A.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,A.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){e=this.ps(e);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class uc{constructor(e){this.Es=e,this.docs=new L(D.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),s=r?r.size:0,i=this.Es(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return A.resolve(n?n.document.mutableCopy():O.newInvalidDocument(t))}getEntries(e,t){let n=va;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():O.newInvalidDocument(e))}),A.resolve(n)}getAllFromCollection(e,t,n){let r=va;const s=new D(t.child("")),i=this.docs.getIteratorFrom(s);for(;i.hasNext();){const{key:e,value:{document:s}}=i.getNext();if(!t.isPrefixOf(e.path))break;e.path.length>t.length+1||Jr(Yr(s),n)<=0||(r=r.insert(s.key,s.mutableCopy()))}return A.resolve(r)}getAllFromCollectionGroup(e,t,n,r){T()}As(e,t){return A.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new cc(this)}getSize(e){return A.resolve(this.size)}}class cc extends zu{constructor(e){super(),this.Yn=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?r.push(this.Yn.addEntry(n,t)):this.Yn.removeEntry(e)}),A.waitFor(r)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class hc{constructor(e){this.persistence=e,this.Rs=new ya(e=>vi(e),wi),this.lastRemoteSnapshotVersion=_.min(),this.highestTargetId=0,this.bs=0,this.Ps=new ic,this.targetCount=0,this.vs=Ou.Pn()}forEachTarget(e,n){return this.Rs.forEach((e,t)=>n(t)),A.resolve()}getLastRemoteSnapshotVersion(e){return A.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return A.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),A.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.bs&&(this.bs=t),A.resolve()}Dn(e){this.Rs.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.vs=new Ou(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,A.resolve()}updateTargetData(e,t){return this.Dn(t),A.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),--this.targetCount,A.resolve()}removeTargets(n,r,s){let i=0;const a=[];return this.Rs.forEach((e,t)=>{t.sequenceNumber<=r&&null===s.get(t.targetId)&&(this.Rs.delete(e),a.push(this.removeMatchingKeysForTargetId(n,t.targetId)),i++)}),A.waitFor(a).next(()=>i)}getTargetCount(e){return A.resolve(this.targetCount)}getTargetData(e,t){t=this.Rs.get(t)||null;return A.resolve(t)}addMatchingKeys(e,t,n){return this.Ps.us(t,n),A.resolve()}removeMatchingKeys(t,e,n){this.Ps.hs(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach(e=>{s.push(r.markPotentiallyOrphaned(t,e))}),A.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),A.resolve()}getMatchingKeysForTargetId(e,t){t=this.Ps.ds(t);return A.resolve(t)}containsKey(e,t){return A.resolve(this.Ps.containsKey(t))}}class lc{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new fs(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new hc(this),this.indexManager=new yu,this.remoteDocumentCache=(e=e=>this.referenceDelegate.xs(e),new uc(e)),this.yt=new Po(t),this.Ns=new rc(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new sc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Vs[e.toKey()];return n||(n=new oc(t,this.referenceDelegate),this.Vs[e.toKey()]=n),n}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,n){f("MemoryPersistence","Starting transaction:",e);const r=new dc(this.Ss.next());return this.referenceDelegate.ks(),n(r).next(e=>this.referenceDelegate.Os(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ms(t,n){return A.or(Object.values(this.Vs).map(e=>()=>e.containsKey(t,n)))}}class dc extends es{constructor(e){super(),this.currentSequenceNumber=e}}class fc{constructor(e){this.persistence=e,this.Fs=new ic,this.$s=null}static Bs(e){return new fc(e)}get Ls(){if(this.$s)return this.$s;throw T()}addReference(e,t,n){return this.Fs.addReference(n,t),this.Ls.delete(n.toString()),A.resolve()}removeReference(e,t,n){return this.Fs.removeReference(n,t),this.Ls.add(n.toString()),A.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),A.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(e=>this.Ls.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Ls.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}ks(){this.$s=new Set}Os(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return A.forEach(this.Ls,e=>{const t=D.fromPath(e);return this.qs(n,t).next(e=>{e||r.removeEntry(t,_.min())})}).next(()=>(this.$s=null,r.apply(n)))}updateLimboDocument(e,t){return this.qs(e,t).next(e=>{e?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}qs(e,t){return A.or([()=>A.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class gc{constructor(e){this.yt=e}$(t,e,n,r){const i=new ns("createOrUpgrade",e);var s;n<1&&1<=r&&(t.createObjectStore("owner"),(s=t).createObjectStore("mutationQueues",{keyPath:"userId"}),s.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",uo,{unique:!0}),s.createObjectStore("documentMutations"),mc(t),t.createObjectStore("remoteDocuments"));let a=A.resolve();return n<3&&3<=r&&(0!==n&&((s=t).deleteObjectStore("targetDocuments"),s.deleteObjectStore("targets"),s.deleteObjectStore("targetGlobal"),mc(t)),a=a.next(()=>{{const e=i.store("targetGlobal"),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:_.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",t)}})),n<4&&4<=r&&(a=(a=0!==n?a.next(()=>{var r=t,s=i;return s.store("mutations").W().next(e=>{r.deleteObjectStore("mutations"),r.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",uo,{unique:!0});const t=s.store("mutations"),n=e.map(e=>t.put(e));return A.waitFor(n)})}):a).next(()=>{t.createObjectStore("clientMetadata",{keyPath:"clientId"})})),n<5&&5<=r&&(a=a.next(()=>this.Us(i))),n<6&&6<=r&&(a=a.next(()=>(t.createObjectStore("remoteDocumentGlobal"),this.Ks(i)))),n<7&&7<=r&&(a=a.next(()=>this.Gs(i))),n<8&&8<=r&&(a=a.next(()=>this.Qs(t,i))),n<9&&9<=r&&(a=a.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&10<=r&&(a=a.next(()=>this.js(i))),n<11&&11<=r&&(a=a.next(()=>{t.createObjectStore("bundles",{keyPath:"bundleId"}),t.createObjectStore("namedQueries",{keyPath:"name"})})),n<12&&12<=r&&(a=a.next(()=>{{const e=t.createObjectStore("documentOverlays",{keyPath:_o});return e.createIndex("collectionPathOverlayIndex",So,{unique:!1}),void e.createIndex("collectionGroupOverlayIndex",xo,{unique:!1})}})),n<13&&13<=r&&(a=a.next(()=>{{const e=t.createObjectStore("remoteDocumentsV14",{keyPath:fo});return e.createIndex("documentKeyIndex",go),void e.createIndex("collectionGroupIndex",mo)}}).next(()=>this.Ws(t,i)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&14<=r&&(a=a.next(()=>this.zs(t,i))),a=n<15&&15<=r?a.next(()=>{var e=t;e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Io}).createIndex("sequenceNumberIndex",bo,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:To}).createIndex("documentKeyIndex",Eo,{unique:!1})}):a}Ks(t){let n=0;return t.store("remoteDocuments").Z((e,t)=>{n+=Cu(t)}).next(()=>{var e={byteSize:n};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",e)})}Us(n){const e=n.store("mutationQueues"),r=n.store("mutations");return e.W().next(e=>A.forEach(e,t=>{var e=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",e).next(e=>A.forEach(e,e=>{y(e.userId===t.userId);e=Ko(this.yt,e);return Au(n,t.userId,e).next(()=>{})}))}))}Gs(e){const a=e.store("targetDocuments"),t=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return t.Z((e,t)=>{const n=new S(e),r=[0,io(n)];i.push(a.get(r).next(e=>e?A.resolve():(e=>a.put({targetId:0,path:io(e),sequenceNumber:s.highestListenSequenceNumber}))(n)))}).next(()=>A.waitFor(i))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:wo});const n=t.store("collectionParents"),r=new vu,s=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:io(r)})}};return t.store("remoteDocuments").Z({X:!0},(e,t)=>{const n=new S(e);return s(n.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([,e],t)=>{const n=oo(e);return s(n.popLast())}))}js(e){const n=e.store("targets");return n.Z((e,t)=>{t=jo(t),t=Qo(this.yt,t);return n.put(t)})}Ws(e,i){const t=i.store("remoteDocuments"),a=[];return t.Z((e,t)=>{const n=i.store("remoteDocumentsV14"),r=((s=t).document?new D(S.fromString(s.document.name).popFirst(5)):s.noDocument?D.fromSegments(s.noDocument.path):s.unknownDocument?D.fromSegments(s.unknownDocument.path):T()).path.toArray();var s={prefixPath:r.slice(0,r.length-2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:t.readTime||[0,0],unknownDocument:t.unknownDocument,noDocument:t.noDocument,document:t.document,hasCommittedMutations:!!t.hasCommittedMutations};a.push(n.put(s))}).next(()=>A.waitFor(a))}zs(e,s){const t=s.store("mutations"),i=Wu(this.yt),a=new lc(fc.Bs,this.yt.ie);return t.W().next(e=>{const r=new Map;return e.forEach(e=>{var t;let n=null!=(t=r.get(e.userId))?t:V();Ko(this.yt,e).keys().forEach(e=>n=n.add(e)),r.set(e.userId,n)}),A.forEach(r,(e,t)=>{var t=new o(t),n=Zo.re(this.yt,t),r=a.getIndexManager(t),t=Nu.re(t,this.yt,r,a.referenceDelegate);return new nc(i,t,n,r).recalculateAndSaveOverlaysForDocumentKeys(new Ro(s,fs.at),e).next()})})}}function mc(e){e.createObjectStore("targetDocuments",{keyPath:yo}).createIndex("documentTargetsIndex",vo,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",po,{unique:!0}),e.createObjectStore("targetGlobal")}const pc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class yc{constructor(e,t,n,r,s,i,a,o,u,c,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Hs=s,this.window=i,this.document=a,this.Js=u,this.Ys=c,this.Xs=h,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=e=>Promise.resolve(),!yc.C())throw new b(I.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ju(this,r),this.ii=t+"main",this.yt=new Po(o),this.ri=new rs(this.ii,this.Xs,new gc(this.yt)),this.Cs=new Fu(this.referenceDelegate,this.yt),this.remoteDocumentCache=Wu(this.yt),this.Ns=new Yo,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===c&&g("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(this.isPrimary||this.allowTabSynchronization)return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e));throw new b(I.FAILED_PRECONDITION,pc)}).then(e=>{this.Ss=new fs(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(t){return this.si=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ri.L(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget(async()=>{this.started&&await this.ui()}))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>wc(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(t).next(e=>{e||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(t)).next(e=>this.isPrimary&&!e?this._i(t).next(()=>!1):!!e&&this.wi(t).next(()=>!0))).catch(e=>{if(as(e))return f("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(this.allowTabSynchronization)return f("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1;throw e}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return vc(e).get("owner").next(e=>A.resolve(this.mi(e)))}gi(e){return wc(e).delete(this.clientId)}async yi(){if(this.isPrimary&&!this.pi(this.ni,18e5)){this.ni=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=Lo(e,"clientMetadata");return r.W().next(e=>{const t=this.Ii(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return A.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.oi)for(const t of e)this.oi.removeItem(this.Ti(t.clientId))}}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(t){return this.Ys?A.resolve(!0):vc(t).get("owner").next(e=>{if(null!==e&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)){if(this.mi(e)&&this.networkEnabled)return!0;if(!this.mi(e)){if(e.allowTabSynchronization)return!1;throw new b(I.FAILED_PRECONDITION,pc)}}return!(!this.networkEnabled||!this.inForeground)||wc(t).W().next(e=>void 0===this.Ii(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,e=this.networkEnabled===e.networkEnabled;if(t||n&&e)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&f("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),await this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Ro(e,fs.at);return this._i(t).next(()=>this.gi(t))}),this.ri.close(),this.Pi()}Ii(e,t){return e.filter(e=>this.pi(e.updateTimeMs,t)&&!this.Ei(e.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>wc(e).W().next(e=>this.Ii(e,18e5).map(e=>e.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return Nu.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Iu(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return Zo.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(t,n,r){f("IndexedDbPersistence","Starting transaction:",t);var e="readonly"===n?"readonly":"readwrite",s=15===(s=this.Xs)?ko:14===s?No:13===s?Co:12===s?Ao:11===s?Do:void T();let i;return this.ri.runTransaction(t,e,s,e=>(i=new Ro(e,this.Ss?this.Ss.next():fs.at),"readwrite-primary"===n?this.fi(i).next(e=>!!e||this.di(i)).next(e=>{if(e)return r(i);throw g(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new b(I.FAILED_PRECONDITION,Zr)}).next(e=>this.wi(i).next(()=>e)):this.Vi(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Vi(e){return vc(e).get("owner").next(e=>{if(null!==e&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)&&!this.mi(e)&&!(this.Ys||this.allowTabSynchronization&&e.allowTabSynchronization))throw new b(I.FAILED_PRECONDITION,pc)})}wi(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return vc(e).put("owner",t)}static C(){return rs.C()}_i(e){const t=vc(e);return t.get("owner").next(e=>this.mi(e)?(f("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):A.resolve())}pi(e,t){var n=Date.now();return!(e<n-t||n<e&&(g(`Detected an update time that is in the future: ${e} > `+n),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null==(e=this.window)?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),!function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{var n=null!==(null==(t=this.oi)?void 0:t.getItem(this.Ti(e)));return f("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return g("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){g("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_`+e}}function vc(e){return Lo(e,"owner")}function wc(e){return Lo(e,"clientMetadata")}function Ic(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class bc{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Si=n,this.Di=r}static Ci(e,t){let n=V(),r=V();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new bc(e,t.fromCache,n,r)}}class Tc{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(t,n,r,s){return this.ki(t,n).next(e=>e||this.Oi(t,n,s,r)).next(e=>e||this.Mi(t,n))}ki(s,i){if(Di(i))return A.resolve(null);let t=Ri(i);return this.indexManager.getIndexType(s,t).next(e=>0===e?null:(null!==i.limit&&1===e&&(i=Mi(i,null,"F"),t=Ri(i)),this.indexManager.getDocumentsMatchingTarget(s,t).next(e=>{const r=V(...e);return this.Ni.getDocuments(s,r).next(n=>this.indexManager.getMinOffset(s,t).next(e=>{var t=this.Fi(i,n);return this.$i(i,t,r,e.readTime)?this.ki(s,Mi(i,null,"F")):this.Bi(s,t,i,e)}))})))}Oi(t,n,r,s){return Di(n)||s.isEqual(_.min())?this.Mi(t,n):this.Ni.getDocuments(t,r).next(e=>{e=this.Fi(n,e);return this.$i(n,e,r,s)?this.Mi(t,n):(Ar()<=l.DEBUG&&f("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Vi(n)),this.Bi(t,e,n,Hr(s,-1)))})}Fi(n,e){let r=new M(Bi(n));return e.forEach((e,t)=>{Pi(n,t)&&(r=r.add(t))}),r}$i(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||0<s.version.compareTo(r))}Mi(e,t){return Ar()<=l.DEBUG&&f("QueryEngine","Using full collection scan to execute query:",Vi(t)),this.Ni.getDocumentsMatchingQuery(e,t,Xr.min())}Bi(e,n,t,r){return this.Ni.getDocumentsMatchingQuery(e,t,r).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t))}}class Ec{constructor(e,t,n,r){this.persistence=e,this.Li=t,this.yt=r,this.qi=new L(E),this.Ui=new ya(e=>vi(e),wi),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(n)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new nc(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.qi))}}function _c(e,t,n,r){return new Ec(e,t,n,r)}async function Sc(e,t){const a=e;return a.persistence.runTransaction("Handle user change","readonly",s=>{let i;return a.mutationQueue.getAllMutationBatches(s).next(e=>(i=e,a.Qi(t),a.mutationQueue.getAllMutationBatches(s))).next(e=>{const t=[],n=[];let r=V();for(const s of i){t.push(s.batchId);for(const e of s.mutations)r=r.add(e.key)}for(const s of e){n.push(s.batchId);for(const e of s.mutations)r=r.add(e.key)}return a.localDocuments.getDocuments(s,r).next(e=>({ji:e,removedBatchIds:t,addedBatchIds:n}))})})}function xc(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Cs.getLastRemoteSnapshotVersion(e))}function Dc(e,i,t){let n=V(),a=V();return t.forEach(e=>n=n.add(e)),i.getEntries(e,n).next(r=>{let s=va;return t.forEach((e,t)=>{const n=r.get(e);t.isFoundDocument()!==n.isFoundDocument()&&(a=a.add(e)),t.isNoDocument()&&t.version.isEqual(_.min())?(i.removeEntry(e,t.readTime),s=s.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(i.addEntry(t),s=s.insert(e,t)):f("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),{Wi:s,zi:a}})}function Ac(e,r){const s=e;return s.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return s.Cs.getTargetData(t,r).next(e=>e?(n=e,A.resolve(n)):s.Cs.allocateTargetId(t).next(e=>(n=new Vo(r,e,0,t.currentSequenceNumber),s.Cs.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=s.qi.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(s.qi=s.qi.insert(e.targetId,e),s.Ui.set(r,e.targetId)),e})}async function Cc(e,t,n){const r=e,s=r.qi.get(t),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,e=>r.persistence.referenceDelegate.removeTarget(e,s))}catch(e){if(!as(e))throw e;f("LocalStore",`Failed to update sequence numbers for target ${t}: `+e)}r.qi=r.qi.remove(t),r.Ui.delete(s.target)}function Nc(e,n,r){const s=e;let i=_.min(),a=V();return s.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,s=r.Ui.get(n);return void 0!==s?A.resolve(r.qi.get(s)):r.Cs.getTargetData(t,n)}(s,t,Ri(n)).next(e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.Cs.getMatchingKeysForTargetId(t,e.targetId).next(e=>{a=e})}).next(()=>s.Li.getDocumentsMatchingQuery(t,n,r?i:_.min(),r?a:V())).next(e=>(Lc(s,qi(n),e),{documents:e,Hi:a})))}function kc(e,t){const n=e,r=n.Cs,s=n.qi.get(t);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",e=>r.ne(e,t).next(e=>e?e.target:null))}function Rc(e,t){const n=e,r=n.Ki.get(t)||_.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.Gi.getAllFromCollectionGroup(e,t,Hr(r,-1),Number.MAX_SAFE_INTEGER)).then(e=>(Lc(n,t,e),e))}function Lc(e,t,n){let r=e.Ki.get(t)||_.min();n.forEach((e,t)=>{0<t.readTime.compareTo(r)&&(r=t.readTime)}),e.Ki.set(t,r)}function Mc(e,t){return`firestore_clients_${e}_`+t}function Oc(e,t,n){let r=`firestore_mutations_${e}_`+n;return t.isAuthenticated()&&(r+="_"+t.uid),r}function Fc(e,t){return`firestore_targets_${e}_`+t}class Vc{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Zi(e,t,n){var r=JSON.parse(n);let s,i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&((i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(s=new b(r.error.code,r.error.message))),i?new Vc(e,t,r.state,s):(g("SharedClientState",`Failed to parse mutation state for ID '${t}': `+n),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Pc{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Zi(e,t){var n=JSON.parse(t);let r,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&((s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new b(n.error.code,n.error.message))),s?new Pc(e,n.state,r):(g("SharedClientState",`Failed to parse target state for ID '${e}': `+t),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class qc{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,s=Sa;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=bs(n.activeTargetIds[e]),s=s.add(n.activeTargetIds[e]);return r?new qc(e,s):(g("SharedClientState",`Failed to parse client data for instance '${e}': `+t),null)}}class Bc{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Bc(t.clientId,t.onlineState):(g("SharedClientState","Failed to parse online state: "+e),null)}}class Uc{constructor(){this.activeTargetIds=Sa}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Gc{constructor(e,t,n,r,s){this.window=e,this.Hs=t,this.persistenceKey=n,this.sr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new L(E),this.started=!1,this.cr=[];e=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ar=Mc(this.persistenceKey,this.sr),this.hr="firestore_sequence_number_"+this.persistenceKey,this.ur=this.ur.insert(this.sr,new Uc),this.lr=new RegExp(`^firestore_clients_${e}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${e}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${e}_(\\d+)$`),this.wr="firestore_online_state_"+this.persistenceKey,this.mr="firestore_bundle_loaded_v2_"+this.persistenceKey,this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.vi();for(const n of e)if(n!==this.sr){const e=this.getItem(Mc(this.persistenceKey,n));var t;e&&(t=qc.Zi(n,e))&&(this.ur=this.ur.insert(t.clientId,t))}this.gr();const n=this.storage.getItem(this.wr);if(n){const e=this.yr(n);e&&this.pr(e)}for(const e of this.cr)this.rr(e);this.cr=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(n){let r=!1;return this.ur.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,n){this.Tr(e,t,n),this.Er(e)}addLocalQueryTarget(e){let t="not-current";var n;return!this.isActiveQueryTarget(e)||(n=this.storage.getItem(Fc(this.persistenceKey,e)))&&(n=Pc.Zi(e,n))&&(t=n.state),this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Fc(this.persistenceKey,e))}updateQueryState(e,t,n){this.Rr(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Er(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return f("SharedClientState","READ",e,t),t}setItem(e,t){f("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){f("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){const s=e;s.storageArea===this.storage&&(f("SharedClientState","EVENT",s.key,s.newValue),s.key!==this.ar?this.Hs.enqueueRetryable(async()=>{var e;if(this.started){if(null!==s.key){if(this.lr.test(s.key))return null==s.newValue?(e=this.vr(s.key),this.Vr(e,null)):(e=this.Sr(s.key,s.newValue))?this.Vr(e.clientId,e):void 0;if(this.dr.test(s.key)){if(null!==s.newValue){var t=this.Dr(s.key,s.newValue);if(t)return this.Cr(t)}}else if(this._r.test(s.key)){if(null!==s.newValue&&(t=this.Nr(s.key,s.newValue)))return this.kr(t)}else if(s.key===this.wr){if(null!==s.newValue){var n=this.yr(s.newValue);if(n)return this.pr(n)}}else if(s.key===this.hr)(n=function(e){let t=fs.at;if(null!=e)try{var n=JSON.parse(e);y("number"==typeof n),t=n}catch(e){g("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(s.newValue))!==fs.at&&this.sequenceNumberHandler(n);else if(s.key===this.mr){const r=this.Or(s.newValue);await Promise.all(r.map(e=>this.syncEngine.Mr(e)))}}}else this.cr.push(s)}):g("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,n){const r=new Vc(this.currentUser,e,t,n),s=Oc(this.persistenceKey,this.currentUser,e);this.setItem(s,r.tr())}Er(e){e=Oc(this.persistenceKey,this.currentUser,e);this.removeItem(e)}br(e){e={clientId:this.sr,onlineState:e};this.storage.setItem(this.wr,JSON.stringify(e))}Rr(e,t,n){const r=Fc(this.persistenceKey,e),s=new Pc(e,t,n);this.setItem(r,s.tr())}Pr(e){e=JSON.stringify(Array.from(e));this.setItem(this.mr,e)}vr(e){e=this.lr.exec(e);return e?e[1]:null}Sr(e,t){e=this.vr(e);return qc.Zi(e,t)}Dr(e,t){var e=this.dr.exec(e),n=Number(e[1]),e=void 0!==e[2]?e[2]:null;return Vc.Zi(new o(e),n,t)}Nr(e,t){e=this._r.exec(e),e=Number(e[1]);return Pc.Zi(e,t)}yr(e){return Bc.Zi(e)}Or(e){return JSON.parse(e)}async Cr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Fr(e.batchId,e.state,e.error);f("SharedClientState","Ignoring mutation for non-active user "+e.user.uid)}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const n=t?this.ur.insert(e,t):this.ur.remove(e),r=this.Ir(this.ur),s=this.Ir(n),i=[],a=[];return s.forEach(e=>{r.has(e)||i.push(e)}),r.forEach(e=>{s.has(e)||a.push(e)}),this.syncEngine.Br(i,a).then(()=>{this.ur=n})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let n=Sa;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class Kc{constructor(){this.Lr=new Uc,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,n){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new Uc,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class jc{Ur(e){}shutdown(){}}class Qc{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){f("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){f("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const zc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class $c{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class Wc extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.oo=t+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(t,e,n,r,s){const i=this.ho(t,e);f("RestConnection","Sending: ",i,n);e={};return this.lo(e,r,s),this.fo(t,i,e,n).then(e=>(f("RestConnection","Received: ",e),e),e=>{throw Cr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})}_o(e,t,n,r,s,i){return this.ao(e,t,n,r,s)}lo(n,e,t){n["X-Goog-Api-Client"]="gl-js/ fire/"+xr,n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>n[t]=e),t&&t.headers.forEach((e,t)=>n[t]=e)}ho(e,t){e=zc[e];return this.oo+`/v1/${t}:`+e}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(o,t,n,r){return new Promise((s,i)=>{const a=new Sr;a.setWithCredentials(!0),a.listenOnce(br.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Ir.NO_ERROR:var e=a.getResponseJson();f("Connection","XHR received:",JSON.stringify(e)),s(e);break;case Ir.TIMEOUT:f("Connection",'RPC "'+o+'" timed out'),i(new b(I.DEADLINE_EXCEEDED,"Request time out"));break;case Ir.HTTP_ERROR:var t=a.getStatus();if(f("Connection",'RPC "'+o+'" failed with status:',t,"response text:",a.getResponseText()),0<t){let e=a.getResponseJson();var n=null==(e=Array.isArray(e)?e[0]:e)?void 0:e.error;if(n&&n.status&&n.message){r=n.status.toLowerCase().replace(/_/g,"-");const o=0<=Object.values(I).indexOf(r)?r:I.UNKNOWN;i(new b(o,n.message))}else i(new b(I.UNKNOWN,"Server responded with status "+a.getStatus()))}else i(new b(I.UNAVAILABLE,"Connection failed."));break;default:T()}}finally{f("Connection",'RPC "'+o+'" completed.')}var r});var e=JSON.stringify(r);a.send(t,"POST",e,n,15)})}wo(e,t,n){const r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=new fr,i=wr(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/`+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new Er({})),this.lo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;e=r.join("");f("Connection","Creating WebChannel: "+e,a);const o=s.createWebChannel(e,a);let u=!1,c=!1;const h=new $c({Hr:e=>{c?f("Connection","Not sending because WebChannel is closed:",e):(u||(f("Connection","Opening WebChannel transport."),o.open(),u=!0),f("Connection","WebChannel sending:",e),o.send(e))},Jr:()=>o.close()}),l=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return l(o,_r.EventType.OPEN,()=>{c||f("Connection","WebChannel transport opened.")}),l(o,_r.EventType.CLOSE,()=>{c||(c=!0,f("Connection","WebChannel transport closed"),h.io())}),l(o,_r.EventType.ERROR,e=>{c||(c=!0,Cr("Connection","WebChannel transport errored:",e),h.io(new b(I.UNAVAILABLE,"The operation could not be completed")))}),l(o,_r.EventType.MESSAGE,n=>{if(!c){var n=n.data[0],r=(y(!!n),n.error||(null==(r=n[0])?void 0:r.error));if(r){f("Connection","WebChannel received error:",r);const n=r.status;let e=function(e){e=d[e];if(void 0!==e)return pa(e)}(n),t=r.message;void 0===e&&(e=I.INTERNAL,t="Unknown error status: "+n+" with message "+r.message),c=!0,h.io(new b(e,t)),o.close()}else f("Connection","WebChannel received:",n),h.ro(n)}}),l(i,Tr.STAT_EVENT,e=>{10===e.stat?f("Connection","Detected buffering proxy"):11===e.stat&&f("Connection","Detected no buffering proxy")}),setTimeout(()=>{h.so()},0),h}}function Hc(){return"undefined"!=typeof window?window:null}function Yc(){return"undefined"!=typeof document?document:null}function Xc(e){return new Pa(e,!0)}class Jc{constructor(e,t,n=1e3,r=1.5,s=6e4){this.Hs=e,this.timerId=t,this.mo=n,this.yo=r,this.po=s,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();var t=Math.floor(this.Io+this.bo()),n=Math.max(0,Date.now()-this.Eo),r=Math.max(0,t-n);0<r&&f("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class Zc{constructor(e,t,n,r,s,i,a,o){this.Hs=e,this.vo=n,this.Vo=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new Jc(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(e,t){this.Lo(),this.qo(),this.xo.cancel(),this.So++,4!==e?this.xo.reset():t&&t.code===I.RESOURCE_EXHAUSTED?(g(t.toString()),g("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):t&&t.code===I.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Uo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(t)}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),n=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.So===n&&this.Go(e,t)},t=>{e(()=>{var e=new b(I.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Qo(e)})})}Go(e,t){const n=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{n(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(e=>{n(()=>this.Qo(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Oo(){this.state=5,this.xo.Ro(async()=>{this.state=0,this.start()})}Qo(e){return f("PersistentStream","close with error: "+e),this.stream=null,this.close(4,e)}Ko(t){return e=>{this.Hs.enqueueAndForget(()=>this.So===t?e():(f("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class eh extends Zc{constructor(e,t,n,r,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,i),this.yt=s}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(f=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:T(),s=t.targetChange.targetIds||[],i=(f=t.targetChange.resumeToken,e.wt?(y(void 0===f||"string"==typeof f),C.fromBase64String(f||"")):(y(void 0===f||f instanceof Uint8Array),C.fromUint8Array(f||new Uint8Array))),a=t.targetChange.cause,o=a&&(o=void 0===(f=a).code?I.UNKNOWN:pa(f.code),new b(o,f.message||""));n=new Na(r,s,i,o||null)}else if("documentChange"in t){t.documentChange;(h=t.documentChange).document,h.document.name,h.document.updateTime;var i=ja(e,h.document.name),o=P(h.document.updateTime),u=h.document.createTime?P(h.document.createTime):_.min(),c=new mi({mapValue:{fields:h.document.fields}}),u=O.newFoundDocument(i,o,u,c),c=h.targetIds||[],h=h.removedTargetIds||[];n=new Aa(c,h,u.key,u)}else if("documentDelete"in t)t.documentDelete,(c=t.documentDelete).document,h=ja(e,c.document),u=c.readTime?P(c.readTime):_.min(),u=O.newNoDocument(h,u),c=c.removedTargetIds||[],n=new Aa([],c,u.key,u);else if("documentRemove"in t){t.documentRemove;(d=t.documentRemove).document;var l=ja(e,d.document),d=d.removedTargetIds||[];n=new Aa([],d,l,null)}else{if(!("filter"in t))return T();{t.filter;const e=t.filter;e.targetId,d=e.count||0,l=new ga(d),d=e.targetId,n=new Ca(d,l)}}var f;return n}(this.yt,e),e=function(e){if(!("targetChange"in e))return _.min();e=e.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?_.min():P(e.readTime)}(e);return this.listener.Wo(t,e)}zo(e){const t={};t.database=$a(this.yt),t.addTarget=function(e,t){let n;var r=t.target;return(n=Ii(r)?{documents:Za(e,r)}:{query:eo(e,r)}).targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=Ba(e,t.resumeToken):0<t.snapshotVersion.compareTo(_.min())&&(n.readTime=qa(e,t.snapshotVersion.toTimestamp())),n}(this.yt,e);this.yt,n=e;var n,e=null==(e=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return T()}}())?null:{"goog-listen-tags":e};e&&(t.labels=e),this.Bo(t)}Ho(e){const t={};t.database=$a(this.yt),t.removeTarget=e,this.Bo(t)}}class th extends Zc{constructor(e,t,n,r,s,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,i),this.yt=s,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){var t,n,r;return y(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo?(this.xo.reset(),n=e.writeResults,r=e.commitTime,n=n&&0<n.length?(y(void 0!==r),n.map(t=>{{var n=r;let e=t.updateTime?P(t.updateTime):P(n);return e.isEqual(_.min())&&(e=P(n)),new ta(e,t.transformResults||[])}})):[],t=P(e.commitTime),this.listener.Zo(t,n)):(y(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu())}eu(){const e={};e.database=$a(this.yt),this.Bo(e)}Xo(e){e={streamToken:this.lastStreamToken,writes:e.map(e=>Xa(this.yt,e))};this.Bo(e)}}class nh extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.yt=r,this.nu=!1}su(){if(this.nu)throw new b(I.FAILED_PRECONDITION,"The client has already been terminated.")}ao(n,r,s){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.ao(n,r,s,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===I.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new b(I.UNKNOWN,e.toString())})}_o(n,r,s,i){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection._o(n,r,s,e,t,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===I.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new b(I.UNKNOWN,e.toString())})}terminate(){this.nu=!0}}class rh{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,1<=this.iu&&(this.lu(),this.au("Connection failed 1 times. Most recent error: "+e.toString()),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){e=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(g(e),this.ou=!1):f("OnlineStateTracker",e)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class sh{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=s,this.mu.Ur(e=>{n.enqueueAndForget(async()=>{if(fh(this)){f("RemoteStore","Restarting streams for network reachability change.");{var e;const t=this;t._u.add(4),await ah(t),t.gu.set("Unknown"),t._u.delete(4),await ih(t)}}})}),this.gu=new rh(n,r)}}async function ih(e){if(fh(e))for(const t of e.wu)await t(!0)}async function ah(e){for(const t of e.wu)await t(!1)}function oh(e,t){const n=e;n.du.has(t.targetId)||(n.du.set(t.targetId,t),dh(n)?lh(n):Th(n).ko()&&ch(n,t))}function uh(e,t){const n=e,r=Th(n);n.du.delete(t),r.ko()&&hh(n,t),0===n.du.size&&(r.ko()?r.Fo():fh(n)&&n.gu.set("Unknown"))}function ch(e,t){e.yu.Ot(t.targetId),Th(e).zo(t)}function hh(e,t){e.yu.Ot(t),Th(e).Ho(t)}function lh(t){t.yu=new Ra({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ne:e=>t.du.get(e)||null}),Th(t).start(),t.gu.uu()}function dh(e){return fh(e)&&!Th(e).No()&&0<e.du.size}function fh(e){return 0===e._u.size}function gh(e){e.yu=void 0}async function mh(e,t,n){if(!as(t))throw t;e._u.add(1),await ah(e),e.gu.set("Offline"),n=n||(()=>xc(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{f("RemoteStore","Retrying IndexedDB access"),await n(),e._u.delete(1),await ih(e)})}function ph(t,n){return n().catch(e=>mh(t,e,n))}async function yh(e){const t=e,n=Eh(t);let r=0<t.fu.length?t.fu[t.fu.length-1].batchId:-1;for(;fh(a=t)&&a.fu.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.fu.length&&n.Fo();break}r=e.batchId;{var s=t;var i=e;s.fu.push(i);const o=Eh(s);o.ko()&&o.Yo&&o.Xo(i.mutations)}}catch(e){await mh(t,e)}var a;vh(t)&&wh(t)}function vh(e){return fh(e)&&!Eh(e).No()&&0<e.fu.length}function wh(e){Eh(e).start()}async function Ih(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),f("RemoteStore","RemoteStore received new credentials");e=fh(n);n._u.add(3),await ah(n),e&&n.gu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n._u.delete(3),await ih(n)}async function bh(e,t){const n=e;t?(n._u.delete(2),await ih(n)):(n._u.add(2),await ah(n),n.gu.set("Unknown"))}function Th(t){return t.pu||(t.pu=function(e,t,n){const r=e;return r.su(),new eh(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,n)}(t.datastore,t.asyncQueue,{Yr:async function(n){n.du.forEach((e,t)=>{ch(n,e)})}.bind(null,t),Zr:async function(e,t){gh(e),dh(e)?(e.gu.hu(t),lh(e)):e.gu.set("Unknown")}.bind(null,t),Wo:async function(e,t,n){if(e.gu.set("Online"),t instanceof Na&&2===t.state&&t.cause)try{var r=e,s=t.cause;for(const o of t.targetIds)r.du.has(o)&&(await r.remoteSyncer.rejectListen(o,s),r.du.delete(o),r.yu.removeTarget(o))}catch(n){f("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await mh(e,n)}else if(t instanceof Aa?e.yu.Kt(t):t instanceof Ca?e.yu.Jt(t):e.yu.jt(t),!n.isEqual(_.min()))try{const t=await xc(e.localStore);if(0<=n.compareTo(t)){var i=e,a=n;const u=i.yu.Zt(a);void await(u.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=i.du.get(t);n&&i.du.set(t,n.withResumeToken(e.resumeToken,a))}}),u.targetMismatches.forEach(e=>{const t=i.du.get(e);t&&(i.du.set(e,t.withResumeToken(C.EMPTY_BYTE_STRING,t.snapshotVersion)),hh(i,e),e=new Vo(t.target,e,1,t.sequenceNumber),ch(i,e))}),i.remoteSyncer.applyRemoteEvent(u))}}catch(t){f("RemoteStore","Failed to raise snapshot:",t),await mh(e,t)}}.bind(null,t)}),t.wu.push(async e=>{e?(t.pu.Mo(),dh(t)?lh(t):t.gu.set("Unknown")):(await t.pu.stop(),gh(t))})),t.pu}function Eh(t){return t.Iu||(t.Iu=function(e,t,n){const r=e;return r.su(),new th(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,n)}(t.datastore,t.asyncQueue,{Yr:async function(e){Eh(e).eu()}.bind(null,t),Zr:async function(e,t){if(t&&Eh(e).Yo){var n=e,r=t,s;if(ma(s=r.code)&&s!==I.ABORTED){const s=n.fu.shift();Eh(n).Mo(),await ph(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,r)),await yh(n)}await 0}vh(e)&&wh(e)}.bind(null,t),tu:async function(e){const t=Eh(e);for(const n of e.fu)t.Xo(n.mutations)}.bind(null,t),Zo:async function(e,t,n){const r=e.fu.shift(),s=Oo.from(r,t,n);await ph(e,()=>e.remoteSyncer.applySuccessfulWrite(s)),await yh(e)}.bind(null,t)}),t.wu.push(async e=>{e?(t.Iu.Mo(),await yh(t)):(await t.Iu.stop(),0<t.fu.length&&(f("RemoteStore",`Stopping write stream with ${t.fu.length} pending writes`),t.fu=[]))})),t.Iu}class _h{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new m,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,s){const i=Date.now()+n,a=new _h(e,t,i,r,s);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new b(I.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Sh(e,t){if(g("AsyncQueue",t+": "+e),as(e))return new b(I.UNAVAILABLE,t+": "+e);throw e}class xh{constructor(n){this.comparator=n?(e,t)=>n(e,t)||D.comparator(e.key,t.key):(e,t)=>D.comparator(e.key,t.key),this.keyedMap=Ia(),this.sortedSet=new L(this.comparator)}static emptySet(e){return new xh(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){e=this.keyedMap.get(e);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof xh))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new xh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Dh{constructor(){this.Tu=new L(D.comparator)}track(e){var t=e.doc.key,n=this.Tu.get(t);!n||0!==e.type&&3===n.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==n.type?this.Tu=this.Tu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Tu=this.Tu.remove(t):1===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):T()}Eu(){const n=[];return this.Tu.inorderTraversal((e,t)=>{n.push(t)}),n}}class Ah{constructor(e,t,n,r,s,i,a,o,u){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=u}static fromInitialDocuments(e,t,n,r,s){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new Ah(e,t,xh.emptySet(t),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Oi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Ch{constructor(){this.Au=void 0,this.listeners=[]}}class Nh{constructor(){this.queries=new ya(e=>Fi(e),Oi),this.onlineState="Unknown",this.Ru=new Set}}async function kh(e,t){const n=e,r=t.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new Ch),s)try{i.Au=await n.onListen(r)}catch(e){const n=Sh(e,`Initialization of query '${Vi(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,i),i.listeners.push(t),t.bu(n.onlineState),i.Au&&t.Pu(i.Au)&&Lh(n)}async function Rh(e,t){const n=e,r=t.query;let s=!1;const i=n.queries.get(r);if(i){const e=i.listeners.indexOf(t);0<=e&&(i.listeners.splice(e,1),s=0===i.listeners.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function Lh(e){e.Ru.forEach(e=>{e.next()})}class Mh{constructor(e,t,n){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=n||{}}Pu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Ah(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){return!e.fromCache||(!this.options.Nu||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){if(0<e.docChanges.length)return!0;var t=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}xu(e){e=Ah.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class Oh{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}class Fh{constructor(e){this.yt=e}Ji(e){return ja(this.yt,e)}Yi(e){return e.metadata.exists?Ya(this.yt,e.document,!1):O.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return P(e)}}class Vh{constructor(e,t,n){this.Mu=e,this.localStore=t,this.yt=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Ph(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;const n=S.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,n=new Fh(this.yt);for(const s of e)if(s.metadata.queries){const e=n.Ji(s.metadata.name);for(const n of s.metadata.queries){var r=(t.get(n)||V()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const s=e;let i=V(),a=va;for(const e of n){const n=t.Ji(e.metadata.name),c=(e.document&&(i=i.add(n)),t.Yi(e));c.setReadTime(t.Xi(e.metadata.readTime)),a=a.insert(n,c)}const o=s.Gi.newChangeBuffer({trackRemovals:!0}),u=await Ac(s,Ri(xi(S.fromString("__bundle__/docs/"+r))));return s.persistence.runTransaction("Apply bundle documents","readwrite",t=>Dc(t,o,a).next(e=>(o.apply(t),e)).next(e=>s.Cs.removeMatchingKeysForTargetId(t,u.targetId).next(()=>s.Cs.addMatchingKeys(t,i,u.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(t,e.Wi,e.zi)).next(()=>e.Wi)))}(this.localStore,new Fh(this.yt),this.documents,this.Mu.id),t=this.$u(this.documents);for(const e of this.queries)await async function(e,n,r=V()){const s=await Ac(e,Ri(zo(n.bundledQuery))),i=e;return i.persistence.runTransaction("Save named query","readwrite",e=>{var t=P(n.readTime);return 0<=s.snapshotVersion.compareTo(t)?i.Ns.saveNamedQuery(e,n):(t=s.withResumeToken(C.EMPTY_BYTE_STRING,t),i.qi=i.qi.insert(t.targetId,t),i.Cs.updateTargetData(e,t).next(()=>i.Cs.removeMatchingKeysForTargetId(e,s.targetId)).next(()=>i.Cs.addMatchingKeys(e,r,s.targetId)).next(()=>i.Ns.saveNamedQuery(e,n)))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Bu:this.collectionGroups,Lu:e}}}function Ph(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class qh{constructor(e){this.key=e}}class Bh{constructor(e){this.key=e}}class Uh{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=V(),this.mutatedKeys=V(),this.Gu=Bi(e),this.Qu=new xh(this.Gu)}get ju(){return this.qu}Wu(e,t){const o=t?t.zu:new Dh,u=(t||this).Qu;let c=(t||this).mutatedKeys,h=u,l=!1;const d="F"===this.query.limitType&&u.size===this.query.limit?u.last():null,f="L"===this.query.limitType&&u.size===this.query.limit?u.first():null;if(e.inorderTraversal((e,t)=>{const n=u.get(e),r=Pi(this.query,t)?t:null,s=!!n&&this.mutatedKeys.has(n.key),i=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let a=!1;n&&r?n.data.isEqual(r.data)?s!==i&&(o.track({type:3,doc:r}),a=!0):this.Hu(n,r)||(o.track({type:2,doc:r}),a=!0,(d&&0<this.Gu(r,d)||f&&this.Gu(r,f)<0)&&(l=!0)):!n&&r?(o.track({type:0,doc:r}),a=!0):n&&!r&&(o.track({type:1,doc:n}),a=!0,(d||f)&&(l=!0)),a&&(c=r?(h=h.add(r),i?c.add(e):c.delete(e)):(h=h.delete(e),c.delete(e)))}),null!==this.query.limit)for(;h.size>this.query.limit;){const e="F"===this.query.limitType?h.last():h.first();h=h.delete(e.key),c=c.delete(e.key),o.track({type:1,doc:e})}return{Qu:h,zu:o,$i:l,mutatedKeys:c}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const s=e.zu.Eu();s.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return T()}};return n(e)-n(t)}(e.type,t.type)||this.Gu(e.doc,t.doc)),this.Ju(n);var t=t?this.Yu():[],i=0===this.Ku.size&&this.current?1:0,a=i!==this.Uu;return this.Uu=i,0!==s.length||a?{snapshot:new Ah(this.query,e.Qu,r,s,e.mutatedKeys,0==i,a,!1,!!n&&0<n.resumeToken.approximateByteSize()),Xu:t}:{Xu:t}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Dh,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(e=>this.qu=this.qu.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.qu=this.qu.delete(e)),this.current=e.current)}Yu(){if(!this.current)return[];const t=this.Ku,n=(this.Ku=V(),this.Qu.forEach(e=>{this.Zu(e.key)&&(this.Ku=this.Ku.add(e.key))}),[]);return t.forEach(e=>{this.Ku.has(e)||n.push(new Bh(e))}),this.Ku.forEach(e=>{t.has(e)||n.push(new qh(e))}),n}tc(e){this.qu=e.Hi,this.Ku=V();e=this.Wu(e.documents);return this.applyChanges(e,!0)}ec(){return Ah.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}class Gh{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Kh{constructor(e){this.key=e,this.nc=!1}}class jh{constructor(e,t,n,r,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.sc={},this.ic=new ya(e=>Fi(e),Oi),this.rc=new Map,this.oc=new Set,this.uc=new L(D.comparator),this.cc=new Map,this.ac=new ic,this.hc={},this.lc=new Map,this.fc=Ou.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}async function Qh(n,e,t,r,s){n._c=(e,s,t)=>async function(e,t,n){let r=t.view.Wu(s);r.$i&&(r=await Nc(e.localStore,t.query,!1).then(({documents:e})=>t.view.Wu(e,r)));n=n&&n.targetChanges.get(t.targetId),n=t.view.applyChanges(r,e.isPrimaryClient,n);return Jh(e,t.targetId,n.Xu),n.snapshot}(n,e,t);const i=await Nc(n.localStore,e,!0),a=new Uh(e,i.Hi),o=a.Wu(i.documents),u=Da.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,s),c=a.applyChanges(o,n.isPrimaryClient,u);Jh(n,t,c.Xu);r=new Gh(e,t,a);return n.ic.set(e,r),n.rc.has(t)?n.rc.get(t).push(e):n.rc.set(t,[e]),c.snapshot}async function zh(e,t){const r=e;try{const e=await function(e,c){const h=e,l=c.snapshotVersion;let d=h.qi;return h.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const e=h.Gi.newChangeBuffer({trackRemovals:!0}),u=(d=h.qi,[]);c.targetChanges.forEach((t,n)=>{const r=d.get(n);if(r){u.push(h.Cs.removeMatchingKeys(o,t.removedDocuments,n).next(()=>h.Cs.addMatchingKeys(o,t.addedDocuments,n)));let e=r.withSequenceNumber(o.currentSequenceNumber);var s,i,a;c.targetMismatches.has(n)?e=e.withResumeToken(C.EMPTY_BYTE_STRING,_.min()).withLastLimboFreeSnapshotVersion(_.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,l)),d=d.insert(n,e),s=r,i=e,a=t,0!==s.resumeToken.approximateByteSize()&&!(3e8<=i.snapshotVersion.toMicroseconds()-s.snapshotVersion.toMicroseconds()||0<a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size)||u.push(h.Cs.updateTargetData(o,e))}});let t=va,n=V();if(c.documentUpdates.forEach(e=>{c.resolvedLimboDocuments.has(e)&&u.push(h.persistence.referenceDelegate.updateLimboDocument(o,e))}),u.push(Dc(o,e,c.documentUpdates).next(e=>{t=e.Wi,n=e.zi})),!l.isEqual(_.min())){const c=h.Cs.getLastRemoteSnapshotVersion(o).next(e=>h.Cs.setTargetsMetadata(o,o.currentSequenceNumber,l));u.push(c)}return A.waitFor(u).next(()=>e.apply(o)).next(()=>h.localDocuments.getLocalViewOfDocuments(o,t,n)).next(()=>t)}).then(e=>(h.qi=d,e))}(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.cc.get(t);n&&(y(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.nc=!0:0<e.modifiedDocuments.size?y(n.nc):0<e.removedDocuments.size&&(y(n.nc),n.nc=!1))}),await el(r,e,t)}catch(e){await ts(e)}}function $h(n,r,e){const t=n;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const n=[];t.ic.forEach((e,t)=>{t=t.view.bu(r);t.snapshot&&n.push(t.snapshot)});{e=t.eventManager;var s=r;const i=e;i.onlineState=s;let n=!1;i.queries.forEach((e,t)=>{for(const e of t.listeners)e.bu(s)&&(n=!0)}),n&&Lh(i)}n.length&&t.sc.Wo(n),t.onlineState=r,t.isPrimaryClient&&t.sharedClientState.setOnlineState(r)}}function Wh(e,t){(e.lc.get(t)||[]).forEach(e=>{e.resolve()}),e.lc.delete(t)}function Hh(e,t,n){const r=e;let s=r.hc[r.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),r.hc[r.currentUser.toKey()]=s}}function Yh(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.rc.get(e))t.ic.delete(r),n&&t.sc.wc(r,n);t.rc.delete(e),t.isPrimaryClient&&t.ac.ls(e).forEach(e=>{t.ac.containsKey(e)||Xh(t,e)})}function Xh(e,t){e.oc.delete(t.path.canonicalString());var n=e.uc.get(t);null!==n&&(uh(e.remoteStore,n),e.uc=e.uc.remove(t),e.cc.delete(n),Zh(e))}function Jh(e,t,n){for(const s of n)if(s instanceof qh){e.ac.addReference(s.key,t);{var r=e;const i=s.key,a=i.path.canonicalString();r.uc.get(i)||r.oc.has(a)||(f("SyncEngine","New document in limbo: "+i),r.oc.add(a),Zh(r))}}else s instanceof Bh?(f("SyncEngine","Document no longer in limbo: "+s.key),e.ac.removeReference(s.key,t),e.ac.containsKey(s.key)||Xh(e,s.key)):T()}function Zh(e){for(;0<e.oc.size&&e.uc.size<e.maxConcurrentLimboResolutions;){var t=e.oc.values().next().value,n=(e.oc.delete(t),new D(S.fromString(t))),t=e.fc.next();e.cc.set(t,new Kh(n)),e.uc=e.uc.insert(n,t),oh(e.remoteStore,new Vo(Ri(xi(n.path)),t,2,fs.at))}}async function el(e,n,r){const s=e,i=[],a=[],o=[];if(!s.ic.isEmpty()){s.ic.forEach((e,t)=>{o.push(s._c(t,n,r).then(e=>{(e||r)&&s.isPrimaryClient&&s.sharedClientState.updateQueryState(t.targetId,null!=e&&e.fromCache?"not-current":"current"),e&&(i.push(e),e=bc.Ci(t.targetId,e),a.push(e))}))}),await Promise.all(o),s.sc.Wo(i);{var t=s.localStore,u=a;const c=t;try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>A.forEach(u,t=>A.forEach(t.Si,e=>c.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>A.forEach(t.Di,e=>c.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(t){if(!as(t))throw t;f("LocalStore","Failed to update sequence numbers: "+t)}for(const t of u){const u=t.targetId;if(!t.fromCache){const t=c.qi.get(u),h=t.snapshotVersion,l=t.withLastLimboFreeSnapshotVersion(h);c.qi=c.qi.insert(u,l)}}}}}async function tl(t,n){const r=t,s=[],i=[];for(const t of n){let e;var a=r.rc.get(t);if(a&&0!==a.length){e=await Ac(r.localStore,Ri(a[0]));for(const t of a){const n=r.ic.get(t),h=(o=n,0,c=await Nc((u=r).localStore,o.query,!0),c=o.view.tc(c),u.isPrimaryClient&&Jh(u,o.targetId,c.Xu),await c);h.snapshot&&i.push(h.snapshot)}}else{a=await kc(r.localStore,t);e=await Ac(r.localStore,a),await Qh(r,nl(a),t,!1,e.resumeToken)}s.push(e)}var o,u,c;return r.sc.Wo(i),s}function nl(e){return Si(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function rl(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=zh.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(e,t){const n=e,r=n.cc.get(t);if(r&&r.nc)return V().add(r.key);{let e=V();const r=n.rc.get(t);if(!r)return e;for(const t of r){const r=n.ic.get(t);e=e.unionWith(r.view.ju)}return e}}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=async function(e,t,n){const r=e,s=(r.sharedClientState.updateQueryState(t,"rejected",n),r.cc.get(t)),i=s&&s.key;if(i){let e=new L(D.comparator);e=e.insert(i,O.newNoDocument(i,_.min()));const n=V().add(i),s=new xa(_.min(),new Map,new M(E),e,n);await zh(r,s),r.uc=r.uc.remove(i),r.cc.delete(t),Zh(r)}else await Cc(r.localStore,t,!1).then(()=>Yh(r,t,n)).catch(ts)}.bind(null,t),t.sc.Wo=function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,s=n.queries.get(t);if(s){for(const t of s.listeners)t.Pu(e)&&(r=!0);s.Au=e}}r&&Lh(n)}.bind(null,t.eventManager),t.sc.wc=function(e,t,n){const r=e,s=r.queries.get(t);if(s)for(const e of s.listeners)e.onError(n);r.queries.delete(t)}.bind(null,t.eventManager),t}function sl(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=async function(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const s=e;return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=s.Gi.newChangeBuffer({trackRemovals:!0});return function(e,t,r,s){const i=r.batch,n=i.keys();let a=A.resolve();return n.forEach(n=>{a=a.next(()=>s.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);y(null!==t),e.version.compareTo(t)<0&&(i.applyToRemoteDocument(e,r),e.isValidDocument()&&(e.setReadTime(r.commitVersion),s.addEntry(e)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}(s,e,r,n).next(()=>n.apply(e)).next(()=>s.mutationQueue.performConsistencyCheck(e)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(e,t,r.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(t){let n=V();for(let e=0;e<t.mutationResults.length;++e)0<t.mutationResults[e].transformResults.length&&(n=n.add(t.batch.mutations[e].key));return n}(r))).next(()=>s.localDocuments.getDocuments(e,t))})}(n.localStore,t);Hh(n,r,null),Wh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await el(n,e)}catch(e){await ts(e)}}.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=async function(e,t,n){const r=e;try{const e=await function(e,r){const s=e;return s.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return s.mutationQueue.lookupMutationBatch(t,r).next(e=>(y(null!==e),n=e.keys(),s.mutationQueue.removeMutationBatch(t,e))).next(()=>s.mutationQueue.performConsistencyCheck(t)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(t,n,r)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,n)).next(()=>s.localDocuments.getDocuments(t,n))})}(r.localStore,t);Hh(r,t,n),Wh(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await el(r,e)}catch(n){await ts(n)}}.bind(null,t),t}class il{constructor(){this.synchronizeTabs=!1}async initialize(e){this.yt=Xc(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return _c(this.persistence,new Tc,e.initialUser,this.yt)}yc(e){return new lc(fc.Bs,this.yt)}gc(e){return new Kc}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class al extends il{constructor(e,t,n){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ac.initialize(this,e),await sl(this.Ac.syncEngine),await yh(this.Ac.remoteStore),await this.persistence.li(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Ic(e){return _c(this.persistence,new Tc,e.initialUser,this.yt)}Tc(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new Gu(n,e.asyncQueue,t)}Ec(e,t){t=new ds(t,this.persistence);return new ls(e.asyncQueue,t)}yc(e){var t=Ic(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Du.withCacheSize(this.cacheSizeBytes):Du.DEFAULT;return new yc(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Hc(),Yc(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new Kc}}class ol extends al{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);e=this.Ac.syncEngine;this.sharedClientState instanceof Gc&&(this.sharedClientState.syncEngine={Fr:async function(e,t,n,r){var s=await function(e,n){const r=e,s=r.mutationQueue;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>s.Tn(t,n).next(e=>e?r.localDocuments.getDocuments(t,e):A.resolve(null)))}(e.localStore,t);null!==s?("pending"===n?await yh(e.remoteStore):"acknowledged"===n||"rejected"===n?(Hh(e,t,r||null),Wh(e,t),e.localStore.mutationQueue.An(t)):T(),await el(e,s)):f("SyncEngine","Cannot apply mutation batch with id: "+t)}.bind(null,e),$r:async function(e,t,n,r){const s=e;if(s.dc)f("SyncEngine","Ignoring unexpected query state notification.");else{var i=s.rc.get(t);if(i&&0<i.length)switch(n){case"current":case"not-current":{const e=await Rc(s.localStore,qi(i[0])),r=xa.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,C.EMPTY_BYTE_STRING);await el(s,e,r);break}case"rejected":await Cc(s.localStore,t,!0),Yh(s,t,r);break;default:T()}}}.bind(null,e),Br:async function(e,t,n){const r=rl(e);if(r.dc){for(const e of t)if(r.rc.has(e))f("SyncEngine","Adding an already active target "+e);else{const t=await kc(r.localStore,e),n=await Ac(r.localStore,t);await Qh(r,nl(t),n.targetId,!1,n.resumeToken),oh(r.remoteStore,n)}for(const e of n)r.rc.has(e)&&await Cc(r.localStore,e,!1).then(()=>{uh(r.remoteStore,e),Yh(r,e)}).catch(ts)}}.bind(null,e),vi:function(e){return e.localStore.persistence.vi()}.bind(null,e),Mr:async function(e,t){const n=e;return Rc(n.localStore,t).then(e=>el(n,e))}.bind(null,e)},await this.sharedClientState.start()),await this.persistence.li(async e=>{{var r=this.Ac.syncEngine,t=e;const s=r;if(rl(s),sl(s),!0===t&&!0!==s.dc){const r=s.sharedClientState.getAllActiveQueryTargets(),t=await tl(s,r.toArray());s.dc=!0,await bh(s.remoteStore,!0);for(const r of t)oh(s.remoteStore,r)}else if(!1===t&&!1!==s.dc){const r=[];let n=Promise.resolve();s.rc.forEach((e,t)=>{s.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(Yh(s,t),Cc(s.localStore,t,!0))),uh(s.remoteStore,t)}),await n,await tl(s,r);{const i=s;i.cc.forEach((e,t)=>{uh(i.remoteStore,t)}),i.ac.fs(),i.cc=new Map,i.uc=new L(D.comparator)}s.dc=!1,await bh(s.remoteStore,!1)}}await 0,this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}gc(e){var t=Hc();if(!Gc.C(t))throw new b(I.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Ic(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Gc(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class ul{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>$h(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=async function(e,t){const n=e;var r;n.currentUser.isEqual(t)||(f("SyncEngine","User change. New user:",t.toKey()),r=await Sc(n.localStore,t),n.currentUser=t,(e=n).lc.forEach(e=>{e.forEach(e=>{e.reject(new b(I.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.lc.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await el(n,r.ji))}.bind(null,this.syncEngine),await bh(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Nh}createDatastore(e){var t=Xc(e.databaseInfo.databaseId),n=(n=e.databaseInfo,new Wc(n)),r=e.authCredentials,s=e.appCheckCredentials;return e=t,new nh(r,s,n,e)}createRemoteStore(e){return t=this.localStore,n=this.datastore,e=e.asyncQueue,r=e=>$h(this.syncEngine,e,0),s=new(Qc.C()?Qc:jc),new sh(t,n,e,r,s);var t,n,r,s}createSyncEngine(e,t){{var n=this.localStore,r=this.remoteStore,s=this.eventManager,i=this.sharedClientState,a=e.initialUser;e=e.maxConcurrentLimboResolutions;const o=new jh(n,r,s,i,a,e);return t&&(o.dc=!0),o}}terminate(){return async function(e){const t=e;f("RemoteStore","RemoteStore shutting down."),t._u.add(5),await ah(t),t.mu.shutdown(),t.gu.set("Unknown")}(this.remoteStore)}}function cl(e,t,n){if(!n)throw new b(I.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function hl(e,t,n,r){if(!0===t&&!0===r)throw new b(I.INVALID_ARGUMENT,e+` and ${n} cannot be used together.`)}function ll(e){if(!D.isDocumentKey(e))throw new b(I.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function dl(e){if(D.isDocumentKey(e))throw new b(I.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function fl(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":T();if(e instanceof Array)return"an array";e=e.constructor?e.constructor.name:null;return e?`a custom ${e} object`:"an object"}function q(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new b(I.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");e=fl(e);throw new b(I.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: `+e)}function gl(e,t){if(t<=0)throw new b(I.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}const ml=new Map;class pl{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new b(I.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new b(I.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,hl("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class yl{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new pl({}),this._settingsFrozen=!1}get app(){if(this._app)return this._app;throw new b(I.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available")}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new b(I.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new pl(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Rr;switch(e.type){case"gapi":var t=e.client;return new Fr(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new b(I.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){{var e=this;const t=ml.get(e);t&&(f("ComponentProvider","Removing Datastore"),ml.delete(e),t.terminate())}return Promise.resolve()}}class B{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new wl(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new B(this.firestore,e,this._key)}}class vl{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new vl(this.firestore,e,this._query)}}class wl extends vl{constructor(e,t,n){super(e,t,xi(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new B(this.firestore,null,new D(e))}withConverter(e){return new wl(this.firestore,e,this._path)}}function Il(e,t,...n){var r;if(e=v(e),cl("collection","path",t),e instanceof yl)return dl(r=S.fromString(t,...n)),new wl(e,null,r);if(e instanceof B||e instanceof wl)return dl(r=e._path.child(S.fromString(t,...n))),new wl(e.firestore,null,r);throw new b(I.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore")}function bl(e,t,...n){var r;if(e=v(e),cl("doc","path",t=1===arguments.length?qr.R():t),e instanceof yl)return ll(r=S.fromString(t,...n)),new B(e,null,new D(r));if(e instanceof B||e instanceof wl)return ll(r=e._path.child(S.fromString(t,...n))),new B(e.firestore,e instanceof wl?e.converter:null,new D(r));throw new b(I.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore")}function Tl(e,t){return e=v(e),t=v(t),(e instanceof B||e instanceof wl)&&(t instanceof B||t instanceof wl)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function El(e,t){return e=v(e),t=v(t),e instanceof vl&&t instanceof vl&&e.firestore===t.firestore&&Oi(e._query,t._query)&&e.converter===t.converter}function _l(t,n=10240){let r=0;return{async read(){var e;return r<t.byteLength?(e={value:t.slice(r,r+n),done:!1},r+=n,e):{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class Sl{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):g("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class xl{constructor(e,t){this.Pc=e,this.yt=t,this.metadata=new m,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(e=>{e&&e.Ou()?this.metadata.resolve(e.ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             `+JSON.stringify(null==e?void 0:e.ku)))},e=>this.metadata.reject(e))}close(){return this.Pc.cancel()}async getMetadata(){return this.metadata.promise}async mc(){return await this.getMetadata(),this.Vc()}async Vc(){var e=await this.Sc();if(null===e)return null;var t=this.vc.decode(e),n=Number(t);return isNaN(n)&&this.Dc(`length string (${t}) is not valid number`),t=await this.Cc(n),new Oh(JSON.parse(t),e.length+n)}xc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async Sc(){for(;this.xc()<0&&!await this.Nc(););if(0===this.buffer.length)return null;var e=this.xc(),t=(e<0&&this.Dc("Reached the end of bundle when a length string is expected."),this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}async Cc(e){for(;this.buffer.length<e;)await this.Nc()&&this.Dc("Reached the end of bundle when more is expected.");var t=this.vc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Dc(e){throw this.Pc.cancel(),new Error("Invalid bundle format: "+e)}async Nc(){var e=await this.Pc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class Dl{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new b(I.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const o=e,n=$a(o.yt)+"/documents",r={documents:t.map(e=>Ka(o.yt,e))},s=await o._o("BatchGetDocuments",n,r,t.length),u=new Map,i=(s.forEach(e=>{a=o.yt;const t="found"in e?(n=a,y(!!(r=e).found),r.found.name,r.found.updateTime,n=ja(n,r.found.name),s=P(r.found.updateTime),i=r.found.createTime?P(r.found.createTime):_.min(),r=new mi({mapValue:{fields:r.found.fields}}),O.newFoundDocument(n,s,i,r)):"missing"in e?function(e,t){y(!!t.missing),y(!!t.readTime);e=ja(e,t.missing),t=P(t.readTime);return O.newNoDocument(e,t)}(a,e):T();var n,r,s,i,a;u.set(t.key.toString(),t)}),[]);return t.forEach(e=>{e=u.get(e.toString());y(!!e),i.push(e)}),i}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new da(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{t=D.fromPath(t);this.mutations.push(new fa(t,this.precondition(t)))});{var e=this.datastore,n=this.mutations;const r=e,s=$a(r.yt)+"/documents",i={writes:n.map(e=>Xa(r.yt,e))};await r.ao("Commit",s,i)}await 0,this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw T();t=_.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new b(I.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(_.min())?F.exists(!1):F.updateTime(t):F.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return F.exists(!0);if(t.isEqual(_.min()))throw new b(I.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return F.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Al{constructor(e,t,n,r,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=s,this.kc=n.maxAttempts,this.xo=new Jc(this.asyncQueue,"transaction_retry")}run(){--this.kc,this.Oc()}Oc(){this.xo.Ro(async()=>{const t=new Dl(this.datastore),e=this.Mc(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.Fc(e)}))}).catch(e=>{this.Fc(e)})})}Mc(e){try{var t=this.updateFunction(e);return!ws(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Fc(e){0<this.kc&&this.$c(e)?(--this.kc,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if("FirebaseError"!==e.name)return!1;e=e.code;return"aborted"===e||"failed-precondition"===e||"already-exists"===e||!ma(e)}}class Cl{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=o.UNAUTHENTICATED,this.clientId=qr.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{f("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(f("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new b(I.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new m;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(e){var t=Sh(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function Nl(e,t){e.asyncQueue.verifyOperationInProgress(),f("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await Sc(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function kl(e,n){e.asyncQueue.verifyOperationInProgress();var t=await Rl(e),r=(f("FirestoreClient","Initializing OnlineComponentProvider"),await e.getConfiguration());await n.initialize(t,r),e.setCredentialChangeListener(e=>Ih(n.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>Ih(n.remoteStore,t)),e.onlineComponents=n}async function Rl(e){return e.offlineComponents||(f("FirestoreClient","Using default OfflineComponentProvider"),await Nl(e,new il)),e.offlineComponents}async function Ll(e){return e.onlineComponents||(f("FirestoreClient","Using default OnlineComponentProvider"),await kl(e,new ul)),e.onlineComponents}function Ml(e){return Rl(e).then(e=>e.persistence)}function Ol(e){return Rl(e).then(e=>e.localStore)}function Fl(e){return Ll(e).then(e=>e.remoteStore)}function Vl(e){return Ll(e).then(e=>e.syncEngine)}async function Pl(e){const t=await Ll(e),n=t.eventManager;return n.onListen=async function(e,t){const n=rl(e);let r,s;const i=n.ic.get(t);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.ec();else{const e=await Ac(n.localStore,Ri(t)),i=(n.isPrimaryClient&&oh(n.remoteStore,e),n.sharedClientState.addLocalQueryTarget(e.targetId));r=e.targetId,s=await Qh(n,t,r,"current"===i,e.resumeToken)}return s}.bind(null,t.syncEngine),n.onUnlisten=async function(e,t){const n=e,r=n.ic.get(t),s=n.rc.get(r.targetId);if(1<s.length)return n.rc.set(r.targetId,s.filter(e=>!Oi(e,t))),void n.ic.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Cc(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),uh(n.remoteStore,r.targetId),Yh(n,r.targetId)}).catch(ts)):(Yh(n,r.targetId),await Cc(n.localStore,r.targetId,!0))}.bind(null,t.syncEngine),n}function ql(t,u,c={}){const h=new m;return t.asyncQueue.enqueueAndForget(async()=>{{var n=await Pl(t),r=t.asyncQueue,s=u,i=c,a=h;const e=new Sl({next:e=>{r.enqueueAndForget(()=>Rh(n,o));var t=e.docs.has(s);!t&&e.fromCache?a.reject(new b(I.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&i&&"server"===i.source?a.reject(new b(I.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):a.resolve(e)},error:e=>a.reject(e)}),o=new Mh(xi(s.path),e,{includeMetadataChanges:!0,Nu:!0});return kh(n,o)}}),h.promise}function Bl(o,u,c={}){const h=new m;return o.asyncQueue.enqueueAndForget(async()=>{{var t=await Pl(o),n=o.asyncQueue,e=u,r=c,s=h;const i=new Sl({next:e=>{n.enqueueAndForget(()=>Rh(t,a)),e.fromCache&&"server"===r.source?s.reject(new b(I.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(e)},error:e=>s.reject(e)}),a=new Mh(e,i,{includeMetadataChanges:!0,Nu:!0});return kh(t,a)}}),h.promise}function Ul(r,e,t,s){e=Xc(e),t=function(e){if(e instanceof Uint8Array)return _l(e,void 0);if(e instanceof ArrayBuffer)return _l(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof t?(new TextEncoder).encode(t):t);const i=new xl(t,e);r.asyncQueue.enqueueAndForget(async()=>{{var e=await Vl(r),t=i;const n=e;return void async function(t,n,r){try{var s=await n.getMetadata();if(await function(e,t){const n=e,r=P(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Ns.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,s))return await n.close(),r._completeWith({taskState:"Success",documentsLoaded:s.totalDocuments,bytesLoaded:s.totalBytes,totalDocuments:s.totalDocuments,totalBytes:s.totalBytes}),Promise.resolve(new Set);r._updateProgress(Ph(s));const a=new Vh(s,t.localStore,n.yt);let e=await n.mc();for(;e;){const t=await a.Fu(e);t&&r._updateProgress(t),e=await n.mc()}var i=await a.complete();return await el(t,i.Lu,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Ns.saveBundleMetadata(e,t))}(t.localStore,s),r._completeWith(i.progress),Promise.resolve(i.Bu)}catch(t){return Cr("SyncEngine","Loading bundle failed with "+t),r._failWith(t),Promise.resolve(new Set)}}(n,t,s).then(e=>{n.sharedClientState.notifyBundleLoaded(e)})}})}class Gl{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new Jc(this,"async_queue_retry"),this.Wc=()=>{var e=Yc();e&&f("AsyncQueue","Visibility state changed to "+e.visibilityState),this.xo.Po()};const e=Yc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=Yc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});const t=new m;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}async Jc(){if(0!==this.Lc.length){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(e){if(!as(e))throw e;f("AsyncQueue","Operation failed with retryable error: "+e)}0<this.Lc.length&&this.xo.Ro(()=>this.Jc())}}Hc(e){var t=this.Bc.then(()=>(this.Gc=!0,e().catch(e=>{throw this.Kc=e,this.Gc=!1,g("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return t=e.stack?e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack:t}(e)),e}).then(e=>(this.Gc=!1,e))));return this.Bc=t}enqueueAfterDelay(e,t,n){this.zc(),-1<this.jc.indexOf(e)&&(t=0);e=_h.createAndSchedule(this,e,t,n,e=>this.Yc(e));return this.Uc.push(e),e}zc(){this.Kc&&T()}verifyOperationInProgress(){}async Xc(){for(var e;await(e=this.Bc),e!==this.Bc;);}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(t){return this.Xc().then(()=>{this.Uc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this.Uc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){e=this.Uc.indexOf(e);this.Uc.splice(e,1)}}function Kl(e){var t=e;if("object"==typeof t&&null!==t){var n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return 1}}class jl{constructor(){this._progressObserver={},this._taskCompletionResolver=new m,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class U extends yl{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Gl,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||zl(this),this._firestoreClient.terminate()}}function Ql(e){return e._firestoreClient||zl(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function zl(e){var t,n,r,s,i=e._freezeSettings(),i=(t=e._databaseId,n=(null==(n=e._app)?void 0:n.options.appId)||"",r=e._persistenceKey,s=i,new gs(t,n,r,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams));e._firestoreClient=new Cl(e._authCredentials,e._appCheckCredentials,e._queue,i)}function $l(e,n,r){const s=new m;return e.asyncQueue.enqueue(async()=>{try{await Nl(e,r),await kl(e,n),s.resolve()}catch(e){const n=e;if(!("FirebaseError"===(t=n).name?t.code===I.FAILED_PRECONDITION||t.code===I.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw n;Cr("Error enabling offline persistence. Falling back to persistence disabled: "+n),s.reject(n)}var t}).then(()=>s.promise)}function Wl(e){return(r=Ql(e=q(e,U))).asyncQueue.enqueue(async()=>{const e=await Ml(r),t=await Fl(r);e.setNetworkEnabled(!0);{const n=t;return n._u.delete(0),ih(n)}});var r}function Hl(t,e){return r=Ql(t=q(t,U)),s=e,r.asyncQueue.enqueue(async()=>{{var e=await Ol(r),t=s;const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Ns.getNamedQuery(e,t))}}).then(e=>e?new vl(t,null,e.query):null);var r,s}function Yl(e){if(e._initialized||e._terminated)throw new b(I.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Xl{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Xl(C.fromBase64String(e))}catch(e){throw new b(I.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Xl(C.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Jl{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new b(I.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new x(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Zl{constructor(e){this._methodName=e}}class ed{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new b(I.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new b(I.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return E(this._lat,e._lat)||E(this._long,e._long)}}const td=/^__.*__$/;class nd{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new ua(e,this.data,this.fieldMask,t,this.fieldTransforms):new oa(e,this.data,t,this.fieldTransforms)}}class rd{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new ua(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function sd(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw T()}}class id{constructor(e,t,n,r,s,i){this.settings=e,this.databaseId=t,this.yt=n,this.ignoreUndefinedProperties=r,void 0===s&&this.na(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new id(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const n=null==(t=this.path)?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.ua(e),r}ca(e){var t;const n=null==(t=this.path)?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.na(),r}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return Sd(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(sd(this.sa)&&td.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class ad{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=n||Xc(e)}da(e,t,n,r=!1){return new id({sa:e,methodName:t,fa:n,path:x.emptyPath(),oa:!1,la:r},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function od(e){var t=e._freezeSettings(),n=Xc(e._databaseId);return new ad(e._databaseId,!!t.ignoreUndefinedProperties,n)}function ud(e,t,n,r,s,i={}){const a=e.da(i.merge||i.mergeFields?2:0,t,n,s);bd("Data must be an object, but it was:",a,r);e=wd(r,a);let o,u;if(i.merge)o=new gi(a.fieldMask),u=a.fieldTransforms;else if(i.mergeFields){const e=[];for(const r of i.mergeFields){const s=Td(t,r,n);if(!a.contains(s))throw new b(I.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);xd(e,s)||e.push(s)}o=new gi(e),u=a.fieldTransforms.filter(e=>o.covers(e.field))}else o=null,u=a.fieldTransforms;return new nd(new mi(e),o,u)}class cd extends Zl{_toFieldTransform(e){if(2!==e.sa)throw 1===e.sa?e.ha(this._methodName+"() can only appear at the top level of your update data"):e.ha(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof cd}}function hd(e,t,n){return new id({sa:3,fa:t.settings.fa,methodName:e._methodName,oa:n},t.databaseId,t.yt,t.ignoreUndefinedProperties)}class ld extends Zl{_toFieldTransform(e){return new ea(e.path,new zi)}isEqual(e){return e instanceof ld}}class dd extends Zl{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=hd(this,e,!0),n=this._a.map(e=>vd(e,t)),r=new $i(n);return new ea(e.path,r)}isEqual(e){return this===e}}class fd extends Zl{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=hd(this,e,!0),n=this._a.map(e=>vd(e,t)),r=new Hi(n);return new ea(e.path,r)}isEqual(e){return this===e}}class gd extends Zl{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){var t=new Xi(e.yt,Ki(e.yt,this.wa));return new ea(e.path,t)}isEqual(e){return this===e}}function md(e,s,i,t){const a=e.da(1,s,i),o=(bd("Data must be an object, but it was:",a,t),[]),u=mi.empty();ys(t,(e,t)=>{var n=_d(s,e,i),r=(t=v(t),a.ca(n));if(t instanceof cd)o.push(n);else{const e=vd(t,r);null!=e&&(o.push(n),u.set(n,e))}});e=new gi(o);return new rd(u,e,a.fieldTransforms)}function pd(t,n,e,r,s,i){const a=t.da(1,n,e),o=[Td(n,r,e)],u=[s];if(i.length%2!=0)throw new b(I.INVALID_ARGUMENT,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<i.length;e+=2)o.push(Td(n,i[e])),u.push(i[e+1]);const c=[],h=mi.empty();for(let e=o.length-1;0<=e;--e)if(!xd(c,o[e])){const n=o[e];var l=v(u[e]);const r=a.ca(n);if(l instanceof cd)c.push(n);else{const t=vd(l,r);null!=t&&(c.push(n),h.set(n,t))}}t=new gi(c);return new rd(h,t,a.fieldTransforms)}function yd(e,t,n,r=!1){return vd(n,e.da(r?4:3,t))}function vd(e,n){if(Id(e=v(e)))return bd("Unsupported field value:",n,e),wd(e,n);if(e instanceof Zl){{var t=e;var r=n;if(!sd(r.sa))throw r.ha(t._methodName+"() can only be used with update() and set()");if(!r.path)throw r.ha(t._methodName+"() is not currently supported inside arrays");t=t._toFieldTransform(r);t&&r.fieldTransforms.push(t)}return null}if(void 0===e&&n.ignoreUndefinedProperties)return null;if(n.path&&n.fieldMask.push(n.path),e instanceof Array){if(n.settings.oa&&4!==n.sa)throw n.ha("Nested arrays are not supported");{var s=n;const a=[];let t=0;for(const o of e){let e=vd(o,s.aa(t));null==e&&(e={nullValue:"NULL_VALUE"}),a.push(e),t++}return{arrayValue:{values:a}}}}var i,r=0,t=n;if(null===(r=v(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return Ki(t.yt,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date)return i=h.fromDate(r),{timestampValue:qa(t.yt,i)};if(r instanceof h)return i=new h(r.seconds,1e3*Math.floor(r.nanoseconds/1e3)),{timestampValue:qa(t.yt,i)};if(r instanceof ed)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Xl)return{bytesValue:Ba(t.yt,r._byteString)};if(r instanceof B){const u=t.databaseId,c=r.firestore._databaseId;if(c.isEqual(u))return{referenceValue:Ua(r.firestore._databaseId||t.databaseId,r._key.path)};throw t.ha(`Document reference is for database ${c.projectId}/${c.database} but should be for database ${u.projectId}/`+u.database)}throw t.ha("Unsupported field value: "+fl(r))}function wd(e,n){const r={};return vs(e)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):ys(e,(e,t)=>{t=vd(t,n.ra(e));null!=t&&(r[e]=t)}),{mapValue:{fields:r}}}function Id(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof h||e instanceof ed||e instanceof Xl||e instanceof B||e instanceof Zl)}function bd(e,t,n){var r;if(!Id(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))throw"an object"===(r=fl(n))?t.ha(e+" a custom object"):t.ha(e+" "+r)}function Td(e,t,n){if((t=v(t))instanceof Jl)return t._internalPath;if("string"==typeof t)return _d(e,t);throw Sd("Field path arguments must be of type string or ",e,!1,void 0,n)}const Ed=new RegExp("[~\\*/\\[\\]]");function _d(t,n,r){if(0<=n.search(Ed))throw Sd(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new Jl(...n.split("."))._internalPath}catch(e){throw Sd(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function Sd(e,t,n,r,s){var i=r&&!r.isEmpty(),a=void 0!==s;let o=`Function ${t}() called with invalid data`,u=(n&&(o+=" (via `toFirestore()`)"),o+=". ","");return(i||a)&&(u+=" (found",i&&(u+=" in field "+r),a&&(u+=" in document "+s),u+=")"),new b(I.INVALID_ARGUMENT,o+e+u)}function xd(e,t){return e.some(e=>e.isEqual(t))}class Dd{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new B(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){var e;if(this._document)return this._converter?(e=new Ad(this._firestore,this._userDataWriter,this._key,this._document,null),this._converter.fromFirestore(e)):this._userDataWriter.convertValue(this._document.data.value)}get(e){if(this._document){e=this._document.data.field(Cd("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Ad extends Dd{data(){return super.data()}}function Cd(e,t){return"string"==typeof t?_d(e,t):(t instanceof Jl?t:t._delegate)._internalPath}function Nd(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new b(I.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class kd{}class Rd extends kd{}function Ld(e,t,...n){let r=[];t instanceof kd&&r.push(t),r=r.concat(n);n=(t=r).filter(e=>e instanceof Od).length,t=t.filter(e=>e instanceof Md).length;if(1<n||0<n&&0<t)throw new b(I.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.");for(const t of r)e=t._apply(e);return e}class Md extends Rd{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Md(e,t,n)}_apply(e){var t=this._parse(e);return Kd(e._query,t),new vl(e.firestore,e.converter,Li(e._query,t))}_parse(t){var n=od(t.firestore);{var r=t._query,s="where",i=n,a=t.firestore._databaseId,o=(n=this._field,t=this._op,this._value);let e;if(n.isKeyField()){if("array-contains"===t||"array-contains-any"===t)throw new b(I.INVALID_ARGUMENT,`Invalid Query. You can't perform '${t}' queries on documentId().`);if("in"===t||"not-in"===t){Gd(o,t);const s=[];for(const i of o)s.push(Ud(a,r,i));e={arrayValue:{values:s}}}else e=Ud(a,r,o)}else"in"!==t&&"not-in"!==t&&"array-contains-any"!==t||Gd(o,t),e=yd(i,s,o,"in"===t||"not-in"===t);return k.create(n,t,e)}}}class Od extends kd{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Od(e,t)}_parse(t){var e=this._queryConstraints.map(e=>e._parse(t)).filter(e=>0<e.getFilters().length);return 1===e.length?e[0]:R.create(e,this._getOperator())}_apply(t){const n=this._parse(t);{if(0===n.getFilters().length)return t;{var r=t._query;let e=r;for(const r of n.getFlattenedFilters())Kd(e,r),e=Li(e,r)}return new vl(t.firestore,t.converter,Li(t._query,n))}}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Fd extends Rd{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Fd(e,t)}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new b(I.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new b(I.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");t=new ci(t,n);return n=t,null===Ai(e)&&null!==(e=Ci(e))&&jd(0,e,n.field),t}(e._query,this._field,this._direction);return new vl(e.firestore,e.converter,(t=(e=e._query).explicitOrderBy.concat([t]),new _i(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class Vd extends Rd{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Vd(e,t,n)}_apply(e){return new vl(e.firestore,e.converter,Mi(e._query,this._limit,this._limitType))}}class Pd extends Rd{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Pd(e,t,n)}_apply(e){var t,n=Bd(e,this.type,this._docOrFields,this._inclusive);return new vl(e.firestore,e.converter,(t=e._query,e=n,new _i(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}class qd extends Rd{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new qd(e,t,n)}_apply(e){var t,n=Bd(e,this.type,this._docOrFields,this._inclusive);return new vl(e.firestore,e.converter,(t=e._query,e=n,new _i(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function Bd(e,t,n,r){if(n[0]=v(n[0]),n[0]instanceof Dd){var s=e._query,i=e.firestore._databaseId,a=t,o=n[0]._document,u=r;if(!o)throw new b(I.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const g=[];for(const a of ki(s))if(a.field.isKeyField())g.push(Os(i,o.key));else{const s=o.data.field(a.field);if(Ss(s))throw new b(I.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){const s=a.field.canonicalString();throw new b(I.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${s}' (used as the orderBy) does not exist.`)}g.push(s)}return new Qs(g,u)}a=od(e.firestore);{var c=e._query,h=e.firestore._databaseId,l=a,d=t,f=n,s=r;const m=c.explicitOrderBy;if(f.length>m.length)throw new b(I.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const p=[];for(let e=0;e<f.length;e++){const y=f[e];if(m[e].field.isKeyField()){if("string"!=typeof y)throw new b(I.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a `+typeof y);if(!Ni(c)&&-1!==y.indexOf("/"))throw new b(I.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${y}' contains a slash.`);const l=c.path.child(S.fromString(y));if(!D.isDocumentKey(l))throw new b(I.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${l}' is not because it contains an odd number of segments.`);const f=new D(l);p.push(Os(h,f))}else{const c=yd(l,d,y);p.push(c)}}return new Qs(p,s)}}function Ud(e,t,n){if("string"==typeof(n=v(n))){if(""===n)throw new b(I.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ni(t)&&-1!==n.indexOf("/"))throw new b(I.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);t=t.path.child(S.fromString(n));if(D.isDocumentKey(t))return Os(e,new D(t));throw new b(I.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${t}' is not because it has an odd number of segments (${t.length}).`)}if(n instanceof B)return Os(e,n._key);throw new b(I.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${fl(n)}.`)}function Gd(e,t){if(!Array.isArray(e)||0===e.length)throw new b(I.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(10<e.length)throw new b(I.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function Kd(e,t){if(t.isInequality()){const r=Ci(e),s=t.field;if(null!==r&&!r.isEqual(s))throw new b(I.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${s.toString()}'`);var n=Ai(e);null!==n&&jd(0,s,n)}const r=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(0<=t.indexOf(e.op))return e.op;return null}(e.filters,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new b(I.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new b(I.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function jd(e,t,n){if(!n.isEqual(t))throw new b(I.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Qd{convertValue(e,t="none"){switch(Cs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return N(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(_s(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw T()}}convertObject(e,n){const r={};return ys(e.fields,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new ed(N(e.latitude),N(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=function e(t){t=t.mapValue.fields.__previous_value__;return Ss(t)?e(t):t}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(xs(e));default:return null}}convertTimestamp(e){e=Es(e);return new h(e.seconds,e.nanos)}convertDocumentKey(e,t){const n=S.fromString(e),r=(y(so(n)),new ms(n.get(1),n.get(3))),s=new D(n.popFirst(5));return r.isEqual(t)||g(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function zd(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class $d extends Qd{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xl(e)}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new B(this.firestore,null,e)}}class Wd{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Hd extends Dd{constructor(e,t,n,r,s,i){super(e,t,n,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){var t;if(this._document)return this._converter?(t=new Yd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null),this._converter.fromFirestore(t,e)):this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}get(e,t={}){if(this._document){e=this._document.data.field(Cd("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e,t.serverTimestamps)}}}class Yd extends Hd{data(e={}){return super.data(e)}}class Xd{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Wd(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new Yd(this._firestore,this._userDataWriter,e.key,e,new Wd(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){e=!!e.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new b(I.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,t){if(i._snapshot.oldDocs.isEmpty()){let n=0;return i._snapshot.docChanges.map(e=>{var t=new Yd(i._firestore,i._userDataWriter,e.doc.key,e.doc,new Wd(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query.converter);return e.doc,{type:"added",doc:t,oldIndex:-1,newIndex:n++}})}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new Yd(i._firestore,i._userDataWriter,e.doc.key,e.doc,new Wd(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=s.indexOf(e.doc.key),s=s.delete(e.doc.key)),1!==e.type&&(s=s.add(e.doc),r=s.indexOf(e.doc.key)),{type:function(){switch(e.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return T()}}(),doc:t,oldIndex:n,newIndex:r}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Jd(e,t){return e instanceof Hd&&t instanceof Hd?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Xd&&t instanceof Xd&&e._firestore===t._firestore&&El(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class Zd extends Qd{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xl(e)}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new B(this.firestore,null,e)}}function ef(e,t,n){e=q(e,B);var r=q(e.firestore,U),t=zd(e.converter,t,n);return sf(r,[ud(od(r),"setDoc",e._key,t,null!==e.converter,n).toMutation(e._key,F.none())])}function tf(e,t,n,...r){e=q(e,B);var s=q(e.firestore,U),i=od(s);let a;return sf(s,[(a="string"==typeof(t=v(t))||t instanceof Jl?pd(i,"updateDoc",e._key,t,n,r):md(i,"updateDoc",e._key,t)).toMutation(e._key,F.exists(!0))])}function nf(t,...n){t=v(t);let e={includeMetadataChanges:!1},r=0;"object"!=typeof n[r]||Kl(n[r])||(e=n[r],r++);var s={includeMetadataChanges:e.includeMetadataChanges};if(Kl(n[r])){const t=n[r];n[r]=null==(c=t.next)?void 0:c.bind(t),n[r+1]=null==(c=t.error)?void 0:c.bind(t),n[r+2]=null==(c=t.complete)?void 0:c.bind(t)}let i,a,o;if(t instanceof B)a=q(t.firestore,U),o=xi(t._key.path),i={next:e=>{n[r]&&n[r](af(a,t,e))},error:n[r+1],complete:n[r+2]};else{const l=q(t,vl),d=(a=q(l.firestore,U),o=l._query,new Zd(a));i={next:e=>{n[r]&&n[r](new Xd(a,d,l,e))},error:n[r+1],complete:n[r+2]},Nd(t._query)}{var u=Ql(a),c=o,h=i;const f=new Sl(h),g=new Mh(c,f,s);return u.asyncQueue.enqueueAndForget(async()=>kh(await Pl(u),g)),()=>{f.bc(),u.asyncQueue.enqueueAndForget(async()=>Rh(await Pl(u),g))}}}function rf(e,t){{var n=Ql(e=q(e,U));e=Kl(t)?t:{next:t};const r=new Sl(e);return n.asyncQueue.enqueueAndForget(async()=>{var e=await Pl(n),t=r;e.Ru.add(t),t.next()}),()=>{r.bc(),n.asyncQueue.enqueueAndForget(async()=>{var e=await Pl(n),t=r;e.Ru.delete(t)})}}}function sf(e,t){{var n=Ql(e),r=t;const s=new m;return n.asyncQueue.enqueueAndForget(async()=>async function(t,e,n){const r=sl(t);try{const t=await function(e,s){const i=e,a=h.now(),o=s.reduce((e,t)=>e.add(t.key),V());let u,c;return i.persistence.runTransaction("Locally write mutations","readwrite",n=>{let t=va,r=V();return i.Gi.getEntries(n,o).next(e=>{(t=e).forEach((e,t)=>{t.isValidDocument()||(r=r.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(n,t)).next(e=>{u=e;const t=[];for(const n of s){const s=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),s=Qi(r.transform,e||null);null!=s&&(n=null===n?mi.empty():n).set(r.field,s)}return n||null}(n,u.get(n.key).overlayedDocument);null!=s&&t.push(new ua(n.key,s,function r(e){const s=[];return ys(e.fields,(e,t)=>{const n=new x([e]);if(Bs(t)){const e=r(t.mapValue).fields;if(0===e.length)s.push(n);else for(const t of e)s.push(n.child(t))}else s.push(n)}),new gi(s)}(s.value.mapValue),F.exists(!0)))}return i.mutationQueue.addMutationBatch(n,a,t,s)}).next(e=>{var t=(c=e).applyToLocalDocumentSet(u,r);return i.documentOverlayCache.saveOverlays(n,e.batchId,t)})}).then(()=>({batchId:c.batchId,changes:ba(u)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId);{var s=r;var i=t.batchId;var a=n;let e=s.hc[s.currentUser.toKey()];e=(e=e||new L(E)).insert(i,a),s.hc[s.currentUser.toKey()]=e}await el(r,t.changes),await yh(r.remoteStore)}catch(t){const e=Sh(t,"Failed to persist write");n.reject(e)}}(await Vl(n),r,s)),s.promise}}function af(e,t,n){var r=n.docs.get(t._key),s=new Zd(e);return new Hd(e,s,t._key,r,new Wd(n.hasPendingWrites,n.fromCache),t.converter)}const of={maxAttempts:5};class uf{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=od(e)}set(e,t,n){this._verifyNotCommitted();const r=cf(e,this._firestore),s=zd(r.converter,t,n),i=ud(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,F.none())),this}update(e,t,n,...r){this._verifyNotCommitted();e=cf(e,this._firestore);let s;return s="string"==typeof(t=v(t))||t instanceof Jl?pd(this._dataReader,"WriteBatch.update",e._key,t,n,r):md(this._dataReader,"WriteBatch.update",e._key,t),this._mutations.push(s.toMutation(e._key,F.exists(!0))),this}delete(e){this._verifyNotCommitted();e=cf(e,this._firestore);return this._mutations=this._mutations.concat(new da(e._key,F.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new b(I.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function cf(e,t){if((e=v(e)).firestore!==t)throw new b(I.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class hf extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=od(e)}get(e){const n=cf(e,this._firestore),r=new $d(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return T();const t=e[0];if(t.isFoundDocument())return new Dd(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new Dd(this._firestore,r,n._key,null,n.converter);throw T()})}set(e,t,n){e=cf(e,this._firestore),t=zd(e.converter,t,n),t=ud(this._dataReader,"Transaction.set",e._key,t,null!==e.converter,n);return this._transaction.set(e._key,t),this}update(e,t,n,...r){e=cf(e,this._firestore),n="string"==typeof(t=v(t))||t instanceof Jl?pd(this._dataReader,"Transaction.update",e._key,t,n,r):md(this._dataReader,"Transaction.update",e._key,t);return this._transaction.update(e._key,n),this}delete(e){e=cf(e,this._firestore);return this._transaction.delete(e._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=cf(e,this._firestore),n=new Zd(this._firestore);return super.get(e).then(e=>new Hd(this._firestore,n,t._key,e._document,new Wd(!1,!1),t.converter))}}function lf(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new b("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function df(){if("undefined"==typeof Uint8Array)throw new b("unimplemented","Uint8Arrays are not available in this environment.")}function ff(){if("undefined"==typeof atob)throw new b("unimplemented","Blobs are unavailable in Firestore in this environment.")}vr=Vf.SDK_VERSION,xr=vr,Vf._registerComponent(new j("firestore",(e,{instanceIdentifier:t,options:n})=>{const r=e.getProvider("app").getImmediate(),s=new U(new Mr(e.getProvider("auth-internal")),new Pr(e.getProvider("app-check-internal")),function(e,t){if(Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))return new ms(e.options.projectId,t);throw new b(I.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.')}(r,t),r);return n=Object.assign({useFetchStreams:!0},n),s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),Vf.registerVersion(_e,"3.8.0-20221206221533",void 0),Vf.registerVersion(_e,"3.8.0-20221206221533","esm2017");class gf{constructor(e){this._delegate=e}static fromBase64String(e){return ff(),new gf(Xl.fromBase64String(e))}static fromUint8Array(e){return df(),new gf(Xl.fromUint8Array(e))}toBase64(){return ff(),this._delegate.toBase64()}toUint8Array(){return df(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function mf(e){if("object"==typeof e&&null!==e){var t=e;for(const n of["next","error","complete"])if(n in t&&"function"==typeof t[n])return 1}}class pf{enableIndexedDbPersistence(e,t){return e=e._delegate,t={forceOwnership:t},Yl(e=q(e,U)),n=Ql(e),e=e._freezeSettings(),r=new ul,$l(n,r,new al(r,e.cacheSizeBytes,null==t?void 0:t.forceOwnership));var n,r}enableMultiTabIndexedDbPersistence(e){return Yl(e=q(e=e._delegate,U)),t=Ql(e),e=e._freezeSettings(),n=new ul,$l(t,n,new ol(n,e.cacheSizeBytes));var t,n}clearIndexedDbPersistence(e){{var t=e._delegate;if(t._initialized&&!t._terminated)throw new b(I.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const n=new m;return t._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!rs.C())return Promise.resolve();e+="main";await rs.delete(e)}(Ic(t._databaseId,t._persistenceKey)),n.resolve()}catch(e){n.reject(e)}}),n.promise}}}class yf{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof ms||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||Cr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(n,r,e={}){{var[n,r,e,s={}]=[this._delegate,n,r,e];const i=(n=q(n,yl))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==r&&Cr("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:r+":"+e,ssl:!1})),s.mockUserToken){let e,t;if("string"==typeof s.mockUserToken)e=s.mockUserToken,t=o.MOCK_USER;else{e=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var t=t||"demo-project",n=e.iat||0,r=e.sub||e.user_id;if(r)return r=Object.assign({iss:"https://securetoken.google.com/"+t,aud:t,iat:n,exp:n+3600,auth_time:n,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e),[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(r)),""].join(".");throw new Error("mockUserToken must contain 'sub' or 'user_id' field!")}(s.mockUserToken,null==(r=n._app)?void 0:r.options.projectId);const i=s.mockUserToken.sub||s.mockUserToken.user_id;if(!i)throw new b(I.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new o(i)}n._authCredentials=new Lr(new kr(e,t))}return}}enableNetwork(){return Wl(this._delegate)}disableNetwork(){return e=this._delegate,(n=Ql(e=q(e,U))).asyncQueue.enqueue(async()=>{const e=await Ml(n),t=await Fl(n);return e.setNetworkEnabled(!1),async function(){const e=t;e._u.add(0),await ah(e),e.gu.set("Offline")}()});var e,n}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,hl("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){var e=this._delegate;{var t=Ql(e=q(e,U));const n=new m;return t.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;fh(n.remoteStore)||f("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.lc.get(e)||[];r.push(t),n.lc.set(e,r)}catch(e){const n=Sh(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await Vl(t),n)),n.promise}}onSnapshotsInSync(e){return rf(this._delegate,e)}get app(){if(this._appCompat)return this._appCompat;throw new b("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available")}collection(e){try{return new kf(this,Il(this._delegate,e))}catch(e){throw Ef(e,"collection()","Firestore.collection()")}}doc(e){try{return new Tf(this,bl(this._delegate,e))}catch(e){throw Ef(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Af(this,function(e,t){if(e=q(e,yl),cl("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new b(I.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new vl(e,null,new _i(S.emptyPath(),t))}(this._delegate,e))}catch(e){throw Ef(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){var n=this._delegate,r=e=>t(new wf(this,e)),e=void 0;if(n=q(n,U),(e=Object.assign(Object.assign({},of),e)).maxAttempts<1)throw new b(I.INVALID_ARGUMENT,"Max attempts must be at least 1");{var s=Ql(n),i=e=>r(new hf(n,e)),a=e;const o=new m;return s.asyncQueue.enqueueAndForget(async()=>{var e=await Ll(s).then(e=>e.datastore);new Al(s.asyncQueue,e,a,i,o).run()}),o.promise}}batch(){return Ql(this._delegate),new If(new uf(this._delegate,e=>sf(this._delegate,e)))}loadBundle(e){return n=Ql(t=q(this._delegate,U)),r=new jl,Ul(n,t._databaseId,e,r),r;var t,n,r}namedQuery(e){return Hl(this._delegate,e).then(e=>e?new Af(this,e):null)}}class vf extends Qd{constructor(e){super(),this.firestore=e}convertBytes(e){return new gf(new Xl(e))}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return Tf.forKey(e,this.firestore,null)}}class wf{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new vf(e)}get(e){const t=Rf(e);return this._delegate.get(t).then(e=>new xf(this._firestore,new Hd(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){e=Rf(e);return n?(lf("Transaction.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){e=Rf(e);return 2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){e=Rf(e);return this._delegate.delete(e),this}}class If{constructor(e){this._delegate=e}set(e,t,n){e=Rf(e);return n?(lf("WriteBatch.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){e=Rf(e);return 2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){e=Rf(e);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class bf{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){e=new Yd(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Df(this._firestore,e),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=bf.INSTANCES;let r=n.get(e),s=(r||(r=new WeakMap,n.set(e,r)),r.get(t));return s||(s=new bf(e,new vf(e),t),r.set(t,s)),s}}bf.INSTANCES=new WeakMap;class Tf{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new vf(e)}static forPath(e,t,n){if(e.length%2!=0)throw new b("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new Tf(t,new B(t._delegate,n,new D(e)))}static forKey(e,t,n){return new Tf(t,new B(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new kf(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new kf(this.firestore,Il(this._delegate,e))}catch(e){throw Ef(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=v(e))instanceof B&&Tl(this._delegate,e)}set(e,t){t=lf("DocumentReference.set",t);try{return t?ef(this._delegate,e,t):ef(this._delegate,e)}catch(e){throw Ef(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?tf(this._delegate,e):tf(this._delegate,e,t,...n)}catch(e){throw Ef(e,"updateDoc()","DocumentReference.update()")}}delete(){return sf(q((e=this._delegate).firestore,U),[new da(e._key,F.none())]);var e}onSnapshot(...e){var t=_f(e),e=Sf(e,e=>new xf(this.firestore,new Hd(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return nf(this._delegate,t,e)}get(e){let t;return(t=("cache"===(null==e?void 0:e.source)?function(t){t=q(t,B);const n=q(t.firestore,U),e=Ql(n),r=new Zd(n);return function(e,t){const n=new m;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}(t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new b(I.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){t=Sh(e,`Failed to get document '${t} from cache`);n.reject(t)}}(await Ol(e),t,n)),n.promise}(e,t._key).then(e=>new Hd(n,r,t._key,e,new Wd(null!==e&&e.hasLocalMutations,!0),t.converter))}:"server"===(null==e?void 0:e.source)?function(t){t=q(t,B);const n=q(t.firestore,U);return ql(Ql(n),t._key,{source:"server"}).then(e=>af(n,t,e))}:function(t){t=q(t,B);const n=q(t.firestore,U);return ql(Ql(n),t._key).then(e=>af(n,t,e))})(this._delegate)).then(e=>new xf(this.firestore,new Hd(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new Tf(this.firestore,e?this._delegate.withConverter(bf.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Ef(e,t,n){return e.message=e.message.replace(t,n),e}function _f(e){for(const t of e)if("object"==typeof t&&!mf(t))return t;return{}}function Sf(e,t){let n;return{next:e=>{n.next&&n.next(t(e))},error:null==(e=(n=mf(e[0])?e[0]:mf(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)?void 0:e.bind(n),complete:null==(e=n.complete)?void 0:e.bind(n)}}class xf{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Tf(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Jd(this._delegate,e._delegate)}}class Df extends xf{data(e){e=this._delegate.data(e);return void 0===e&&T(),e}}class Af{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new vf(e)}where(e,t,n){try{return new Af(this.firestore,Ld(this._delegate,(r=n,s=t,i=Cd("where",e),Md._create(i,s,r))))}catch(e){throw Ef(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,s,i}orderBy(e,t){try{return new Af(this.firestore,Ld(this._delegate,([n,r="asc"]=[e,t],s=r,i=Cd("orderBy",n),Fd._create(i,s))))}catch(e){throw Ef(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r,s,i}limit(e){try{return new Af(this.firestore,Ld(this._delegate,(gl("limit",t=e),Vd._create("limit",t,"F"))))}catch(e){throw Ef(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new Af(this.firestore,Ld(this._delegate,(gl("limitToLast",t=e),Vd._create("limitToLast",t,"L"))))}catch(e){throw Ef(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new Af(this.firestore,Ld(this._delegate,([...t]=[...e],Pd._create("startAt",t,!0))))}catch(e){throw Ef(e,"startAt()","Query.startAt()")}var t}startAfter(...e){try{return new Af(this.firestore,Ld(this._delegate,([...t]=[...e],Pd._create("startAfter",t,!1))))}catch(e){throw Ef(e,"startAfter()","Query.startAfter()")}var t}endBefore(...e){try{return new Af(this.firestore,Ld(this._delegate,([...t]=[...e],qd._create("endBefore",t,!1))))}catch(e){throw Ef(e,"endBefore()","Query.endBefore()")}var t}endAt(...e){try{return new Af(this.firestore,Ld(this._delegate,([...t]=[...e],qd._create("endAt",t,!0))))}catch(e){throw Ef(e,"endAt()","Query.endAt()")}var t}isEqual(e){return El(this._delegate,e._delegate)}get(e){let t;return(t=("cache"===(null==e?void 0:e.source)?function(t){t=q(t,vl);const n=q(t.firestore,U),e=Ql(n),r=new Zd(n);return function(e,t){const n=new m;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await Nc(e,t,!0),s=new Uh(t,r.Hi),i=s.Wu(r.documents),a=s.applyChanges(i,!1);n.resolve(a.snapshot)}catch(e){t=Sh(e,`Failed to execute query '${t} against cache`);n.reject(t)}}(await Ol(e),t,n)),n.promise}(e,t._query).then(e=>new Xd(n,r,t,e))}:"server"===(null==e?void 0:e.source)?function(t){t=q(t,vl);const n=q(t.firestore,U),e=Ql(n),r=new Zd(n);return Bl(e,t._query,{source:"server"}).then(e=>new Xd(n,r,t,e))}:function(t){t=q(t,vl);const n=q(t.firestore,U),e=Ql(n),r=new Zd(n);return Nd(t._query),Bl(e,t._query).then(e=>new Xd(n,r,t,e))})(this._delegate)).then(e=>new Nf(this.firestore,new Xd(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=_f(e),e=Sf(e,e=>new Nf(this.firestore,new Xd(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return nf(this._delegate,t,e)}withConverter(e){return new Af(this.firestore,e?this._delegate.withConverter(bf.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class Cf{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Df(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Nf{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Af(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Df(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new Cf(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new Df(this._firestore,e))})}isEqual(e){return Jd(this._delegate,e._delegate)}}class kf extends Af{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new Tf(this.firestore,e):null}doc(e){try{return void 0===e?new Tf(this.firestore,bl(this._delegate)):new Tf(this.firestore,bl(this._delegate,e))}catch(e){throw Ef(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=q(e.firestore,U),r=bl(e),s=zd(e.converter,t);return sf(n,[ud(od(e.firestore),"addDoc",r._key,s,null!==e.converter,{}).toMutation(r._key,F.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new Tf(this.firestore,e))}isEqual(e){return Tl(this._delegate,e._delegate)}withConverter(e){return new kf(this.firestore,e?this._delegate.withConverter(bf.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Rf(e){return q(e,B)}var Ee={Firestore:yf,GeoPoint:ed,Timestamp:h,Blob:gf,Transaction:wf,WriteBatch:If,DocumentReference:Tf,DocumentSnapshot:xf,Query:Af,QueryDocumentSnapshot:Df,QuerySnapshot:Nf,CollectionReference:kf,FieldPath:class Mf{constructor(...e){this._delegate=new Jl(...e)}static documentId(){return new Mf(x.keyField().canonicalString())}isEqual(e){return(e=v(e))instanceof Jl&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class Of{constructor(e){this._delegate=e}static serverTimestamp(){const e=new ld("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Of(e)}static delete(){const e=new cd("deleteField");return e._methodName="FieldValue.delete",new Of(e)}static arrayUnion(...e){[...e]=[...e];const t=new dd("arrayUnion",e);return t._methodName="FieldValue.arrayUnion",new Of(t)}static arrayRemove(...e){[...e]=[...e];const t=new fd("arrayRemove",e);return t._methodName="FieldValue.arrayRemove",new Of(t)}static increment(e){const t=new gd("increment",e);return t._methodName="FieldValue.increment",new Of(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){Dr.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1},e=t.default,Lf=(e,t)=>new yf(e,t,new pf);e.INTERNAL.registerComponent(new j("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("firestore").getImmediate();return Lf(t,e)},"PUBLIC").setServiceProps(Object.assign({},Ee))),e.registerVersion("@firebase/firestore-compat","0.3.0-20221206221533")}.apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-firestore-compat.js - be sure to load firebase-app.js first.")}});