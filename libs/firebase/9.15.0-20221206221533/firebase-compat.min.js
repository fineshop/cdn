!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).firebase=t()}(this,function(){"use strict";function n(e){e=i(e);return a.encodeByteArray(e,!0)}function i(n){const r=[];let i=0;for(let t=0;t<n.length;t++){let e=n.charCodeAt(t);e<128?r[i++]=e:(e<2048?r[i++]=e>>6|192:(55296==(64512&e)&&t+1<n.length&&56320==(64512&n.charCodeAt(t+1))?(e=65536+((1023&e)<<10)+(1023&n.charCodeAt(++t)),r[i++]=e>>18|240,r[i++]=e>>12&63|128):r[i++]=e>>12|224,r[i++]=e>>6&63|128),r[i++]=63&e|128)}return r}const s={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},y=function(e,t){if(!e)throw d(t)},d=function(e){return new Error("Firebase Database ("+s.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();var i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const s=[];for(let n=0;n<r.length;n+=3){var a=r[n],o=n+1<r.length,c=o?r[n+1]:0,l=n+2<r.length,u=l?r[n+2]:0;let e=(15&c)<<2|u>>6,t=63&u;l||(t=64,o||(e=64)),s.push(i[a>>2],i[(3&a)<<4|c>>4],i[e],i[t])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(n,r){if(this.HAS_NATIVE_SUPPORT&&!r)return atob(n);{var i=this.decodeStringToByteArray(n,r);const c=[];let e=0,t=0;for(;e<i.length;){var s,a,o=i[e++];o<128?c[t++]=String.fromCharCode(o):191<o&&o<224?(s=i[e++],c[t++]=String.fromCharCode((31&o)<<6|63&s)):239<o&&o<365?(a=((7&o)<<18|(63&i[e++])<<12|(63&i[e++])<<6|63&i[e++])-65536,c[t++]=String.fromCharCode(55296+(a>>10)),c[t++]=String.fromCharCode(56320+(1023&a))):(s=i[e++],a=i[e++],c[t++]=String.fromCharCode((15&o)<<12|(63&s)<<6|63&a))}return c.join("")}},decodeStringToByteArray(t,e){this.init_();var n=e?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let e=0;e<t.length;){var i=n[t.charAt(e++)],s=e<t.length?n[t.charAt(e)]:0,a=++e<t.length?n[t.charAt(e)]:64,o=++e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==s||null==a||null==o)throw Error();r.push(i<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==o&&r.push(a<<6&192|o))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},l=function(e){return n(e).replace(/\./g,"")},u=function(e){try{return a.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function K(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:const n=t;return new Date(n.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const r in t)t.hasOwnProperty(r)&&"__proto__"!==r&&(e[r]=K(e[r],t[r]));return e}function W(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function z(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(W())}function G(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return}}function H(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function $(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Q(){const e=W();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}function Y(){return!0===s.NODE_ADMIN}function J(){try{return"object"==typeof indexedDB}catch(e){return!1}}function X(){return new Promise((t,n)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),e||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{e=!1},i.onerror=()=>{var e;n((null==(e=i.error)?void 0:e.message)||"")}}catch(e){n(e)}})}function Z(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}function ee(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}const te=()=>{try{return ee().__FIREBASE_DEFAULTS__||(()=>{var e;if("undefined"!=typeof process&&void 0!==process.env)return(e=process.env.__FIREBASE_DEFAULTS__)?JSON.parse(e):void 0})()||(()=>{if("undefined"!=typeof document){let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}var t=e&&u(e[1]);return t&&JSON.parse(t)}})()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: "+e)}},ne=()=>{var e;return null==(e=te())?void 0:e.config};var h,re;class ie{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(n){return(e,t)=>{e?this.reject(e):this.resolve(t),"function"==typeof n&&(this.promise.catch(()=>{}),1===n.length?n(e):n(e,t))}}}function se(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var t=t||"demo-project",n=e.iat||0,r=e.sub||e.user_id;if(r)return r=Object.assign({iss:"https://securetoken.google.com/"+t,aud:t,iat:n,exp:n+3600,auth_time:n,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e),[l(JSON.stringify({alg:"none",type:"JWT"})),l(JSON.stringify(r)),""].join(".");throw new Error("mockUserToken must contain 'sub' or 'user_id' field!")}class ae extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,ae.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,oe.prototype.create)}}class oe{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,t=t[0]||{},n=this.service+"/"+e,e=(e=this.errors[e])?(r=t,e.replace(ce,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",e=this.serviceName+`: ${e} (${n}).`;return new ae(n,e,t)}}const ce=/\{\$([^}]+)}/g;function le(e){return JSON.parse(e)}function ue(e){return JSON.stringify(e)}function he(e){let t={},n={},r={},i="";try{var s=e.split(".");t=le(u(s[0])||""),n=le(u(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}}function de(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function pe(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function fe(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function ge(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function me(e,t){if(e===t)return 1;const n=Object.keys(e),r=Object.keys(t);for(const a of n){if(!r.includes(a))return;var i=e[a],s=t[a];if(ve(i)&&ve(s)){if(!me(i,s))return}else if(i!==s)return}for(const o of r)if(!n.includes(o))return;return 1}function ve(e){return null!==e&&"object"==typeof e}function ye(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function _e(e){const n={},t=e.replace(/^\?/,"").split("&");return t.forEach(e=>{var t;e&&([e,t]=e.split("="),n[decodeURIComponent(e)]=decodeURIComponent(t))}),n}function we(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,0<n?n:void 0)}class be{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,n){n=n||0;const r=this.W_;if("string"==typeof t)for(let e=0;e<16;e++)r[e]=t.charCodeAt(n)<<24|t.charCodeAt(n+1)<<16|t.charCodeAt(n+2)<<8|t.charCodeAt(n+3),n+=4;else for(let e=0;e<16;e++)r[e]=t[n]<<24|t[n+1]<<16|t[n+2]<<8|t[n+3],n+=4;for(let e=16;e<80;e++){var i=r[e-3]^r[e-8]^r[e-14]^r[e-16];r[e]=4294967295&(i<<1|i>>>31)}let s=this.chain_[0],a=this.chain_[1],o=this.chain_[2],c=this.chain_[3],l=this.chain_[4],u,h;for(let e=0;e<80;e++){h=e<40?e<20?(u=c^a&(o^c),1518500249):(u=a^o^c,1859775393):e<60?(u=a&o|c&(a|o),2400959708):(u=a^o^c,3395469782);var d=(s<<5|s>>>27)+u+l+h+r[e]&4294967295;l=c,c=o,o=4294967295&(a<<30|a>>>2),a=s,s=d}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+a&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(n,r){if(null!=n){var i=(r=void 0===r?n.length:r)-this.blockSize;let e=0;const s=this.buf_;let t=this.inbuf_;for(;e<r;){if(0===t)for(;e<=i;)this.compress_(n,e),e+=this.blockSize;if("string"==typeof n){for(;e<r;)if(s[t]=n.charCodeAt(e),++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}else for(;e<r;)if(s[t]=n[e],++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}this.inbuf_=t,this.total_+=r}}digest(){const n=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;56<=e;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let r=0;for(let t=0;t<5;t++)for(let e=24;0<=e;e-=8)n[r]=this.chain_[t]>>e&255,++r;return n}}function Ie(e,t){const n=new Te(e,t);return n.subscribe.bind(n)}class Te{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e){if("object"==typeof e&&null!==e)for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return 1}(e)?e:{next:e,error:t,complete:n}).next&&(r.next=Ee),void 0===r.error&&(r.error=Ee),void 0===r.complete&&(r.complete=Ee);e=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),e}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Ee(){}function c(e,t,n,r){let i;if(r<t?i="at least "+t:n<r&&(i=0===n?"none":"no more than "+n),i)throw t=e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".",new Error(t)}function ke(e,t){return e+` failed: ${t} argument `}function Se(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(ke(e,t)+"must be a valid function.")}function Ce(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(ke(e,t)+"must be a valid context object.")}const Ae=function(t){let n=0;for(let e=0;e<t.length;e++){var r=t.charCodeAt(e);r<128?n++:r<2048?n+=2:55296<=r&&r<=56319?(n+=4,e++):n+=3}return n},Ne=1e3,Re=2,xe=144e5,De=.5;function Pe(e,t=Ne,n=Re){t*=Math.pow(n,e),n=Math.round(De*t*(Math.random()-.5)*2);return Math.min(xe,t+n)}function _(e){return e&&e._delegate?e._delegate:e}class o{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Oe="[DEFAULT]";class Me{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new ie;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&r.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!=(n=null==e?void 0:e.optional)&&n;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:Oe})}catch(e){}for(var[t,n]of this.instancesDeferred.entries()){t=this.normalizeInstanceIdentifier(t);try{var r=this.getOrInitializeService({instanceIdentifier:t});n.resolve(r)}catch(e){}}}}clearInstance(e=Oe){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=Oe){return this.instances.has(e)}getOptions(e=Oe){return this.instancesOptions.get(e)||{}}initialize(e={}){var{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(this.name+`(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);var r,i,s=this.getOrInitializeService({instanceIdentifier:n,options:t});for([r,i]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(r)&&i.resolve(s);return s}onInit(e,t){t=this.normalizeInstanceIdentifier(t);const n=null!=(r=this.onInitCallbacks.get(t))?r:new Set;n.add(e),this.onInitCallbacks.set(t,n);var r=this.instances.get(t);return r&&e(r,t),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){var n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===Oe?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=Oe){return!this.component||this.component.multipleInstances?e:Oe}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Le{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with `+this.name);t.setComponent(e)}addOrOverwriteComponent(e){const t=this.getProvider(e.name);t.isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);var t=new Me(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Fe=[],Ue=((e=h=h||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT",{debug:h.DEBUG,verbose:h.VERBOSE,info:h.INFO,warn:h.WARN,error:h.ERROR,silent:h.SILENT}),qe=h.INFO,Ve={[h.DEBUG]:"log",[h.VERBOSE]:"log",[h.INFO]:"info",[h.WARN]:"warn",[h.ERROR]:"error"},Be=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),i=Ve[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)}};class je{constructor(e){this.name=e,this._logLevel=qe,this._logHandler=Be,this._userLogHandler=null,Fe.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in h))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?Ue[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,h.DEBUG,...e),this._logHandler(this,h.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,h.VERBOSE,...e),this._logHandler(this,h.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,h.INFO,...e),this._logHandler(this,h.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,h.WARN,...e),this._logHandler(this,h.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,h.ERROR,...e),this._logHandler(this,h.ERROR,...e)}}const Ke=(t,e)=>e.some(e=>t instanceof e);let We,ze;const Ge=new WeakMap,He=new WeakMap,$e=new WeakMap,Qe=new WeakMap,Ye=new WeakMap;let Je={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return He.get(e);if("objectStoreNames"===t)return e.objectStoreNames||$e.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ze(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function Xe(e){return"function"==typeof e?(n=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ze=ze||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(n)?function(...e){return n.apply(et(this),e),Ze(Ge.get(this))}:function(...e){return Ze(n.apply(et(this),e))}:function(e,...t){t=n.call(et(this),e,...t);return $e.set(t,e.sort?e.sort():[e]),Ze(t)}:(e instanceof IDBTransaction&&(s=e,He.has(s)||(t=new Promise((e,t)=>{const n=()=>{s.removeEventListener("complete",r),s.removeEventListener("error",i),s.removeEventListener("abort",i)},r=()=>{e(),n()},i=()=>{t(s.error||new DOMException("AbortError","AbortError")),n()};s.addEventListener("complete",r),s.addEventListener("error",i),s.addEventListener("abort",i)}),He.set(s,t))),Ke(e,We=We||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])?new Proxy(e,Je):e);var n,s,t}function Ze(e){if(e instanceof IDBRequest){var s=e;const n=new Promise((e,t)=>{const n=()=>{s.removeEventListener("success",r),s.removeEventListener("error",i)},r=()=>{e(Ze(s.result)),n()},i=()=>{t(s.error),n()};s.addEventListener("success",r),s.addEventListener("error",i)});return n.then(e=>{e instanceof IDBCursor&&Ge.set(e,s)}).catch(()=>{}),Ye.set(n,s),n}if(Qe.has(e))return Qe.get(e);var t=Xe(e);return t!==e&&(Qe.set(e,t),Ye.set(t,e)),t}const et=e=>Ye.get(e);function tt(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(e,t),o=Ze(a);return r&&a.addEventListener("upgradeneeded",e=>{r(Ze(a.result),e.oldVersion,e.newVersion,Ze(a.transaction))}),n&&a.addEventListener("blocked",()=>n()),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",()=>i())}).catch(()=>{}),o}function nt(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",()=>t()),Ze(n).then(()=>{})}const rt=["get","getKey","getAll","getAllKeys","count"],it=["put","add","delete","clear"],st=new Map;function at(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(st.get(t))return st.get(t);const r=t.replace(/FromIndex$/,""),i=t!==r,s=it.includes(r);return r in(i?IDBIndex:IDBObjectStore).prototype&&(s||rt.includes(r))?(e=async function(e,...t){e=this.transaction(e,s?"readwrite":"readonly");let n=e.store;return i&&(n=n.index(t.shift())),(await Promise.all([n[r](...t),s&&e.done]))[0]},st.set(t,e),e):void 0}}Je={...re=Je,get:(e,t,n)=>at(e,t)||re.get(e,t,n),has:(e,t)=>!!at(e,t)||re.has(e,t)};class ot{constructor(e){this.container=e}getPlatformInfoString(){const e=this.container.getProviders();return e.map(e=>{if("VERSION"!==(null==(t=e.getComponent())?void 0:t.type))return null;var t=e.getImmediate();return t.library+"/"+t.version}).filter(e=>e).join(" ")}}const ct="@firebase/app",lt="0.9.0-20221206221533",ut=new je("@firebase/app"),ht="[DEFAULT]",dt={"@firebase/app":"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},pt=new Map,ft=new Map;function gt(t,n){try{t.container.addComponent(n)}catch(e){ut.debug(`Component ${n.name} failed to register with FirebaseApp `+t.name,e)}}function mt(e,t){e.container.addOrOverwriteComponent(t)}function vt(e){var t=e.name;if(ft.has(t))return ut.debug(`There were multiple attempts to register component ${t}.`),!1;ft.set(t,e);for(const n of pt.values())gt(n,e);return!0}function yt(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const _t=new oe("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class wt{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new o("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw _t.create("app-deleted",{appName:this._name})}}const bt="9.15.0-20221206221533";function It(e,t={}){if("object"!=typeof t){const n=t;t={name:n}}t=Object.assign({name:ht,automaticDataCollectionEnabled:!1},t);const n=t.name;if("string"!=typeof n||!n)throw _t.create("bad-app-name",{appName:String(n)});if(!(e=e||ne()))throw _t.create("no-options");var r=pt.get(n);if(r){if(me(e,r.options)&&me(t,r.config))return r;throw _t.create("duplicate-app",{appName:n})}const i=new Le(n);for(const s of ft.values())i.addComponent(s);return t=new wt(e,t,i),pt.set(n,t),t}function Tt(e=ht){var t=pt.get(e);if(!t&&e===ht)return It();if(t)return t;throw _t.create("no-app",{appName:e})}async function Et(e){var t=e.name;pt.has(t)&&(pt.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function r(e,t,n){let r=null!=(i=dt[e])?i:e;n&&(r+="-"+n);var e=r.match(/\s|\//),i=t.match(/\s|\//);if(e||i){const s=[`Unable to register library "${r}" with version "${t}":`];return e&&s.push(`library name "${r}" contains illegal characters (whitespace or "/")`),e&&i&&s.push("and"),i&&s.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void ut.warn(s.join(" "))}vt(new o(r+"-version",()=>({library:r,version:t}),"VERSION"))}function kt(e,t){if(null!==e&&"function"!=typeof e)throw _t.create("invalid-log-argument");var s=e,n=t;for(const r of Fe){let i=null;n&&n.level&&(i=Ue[n.level]),r.userLogHandler=null===s?null:(e,t,...n)=>{var r=n.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");t>=(null!==i&&void 0!==i?i:e.logLevel)&&s({level:h[t].toLowerCase(),message:r,args:n,type:e.name})}}}function St(e){var t=e;Fe.forEach(e=>{e.setLogLevel(t)})}const Ct="firebase-heartbeat-store";let At=null;function Nt(){return At=At||tt("firebase-heartbeat-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Ct)}}).catch(e=>{throw _t.create("idb-open",{originalErrorMessage:e.message})})}async function Rt(e,t){try{const n=await Nt(),r=n.transaction(Ct,"readwrite"),i=r.objectStore(Ct);return await i.put(t,xt(e)),r.done}catch(e){e instanceof ae?ut.warn(e.message):(t=_t.create("idb-set",{originalErrorMessage:null==e?void 0:e.message}),ut.warn(t.message))}}function xt(e){return e.name+"!"+e.options.appId}class Dt{constructor(e){this.container=e,this._heartbeatsCache=null;e=this.container.getProvider("app").getImmediate();this._storage=new Ot(e),this._heartbeatsCachePromise=this._storage.read().then(e=>this._heartbeatsCache=e)}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate();var t=e.getPlatformInfoString();const n=Pt();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==n&&!this._heartbeatsCache.heartbeats.some(e=>e.date===n))return this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{e=new Date(e.date).valueOf();return Date.now()-e<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";var e=Pt(),{heartbeatsToSend:t,unsentEntries:n}=function(e){const t=[];let n=e.slice();for(const r of e){const i=t.find(e=>e.agent===r.agent);if(i){if(i.dates.push(r.date),1024<Mt(t)){i.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),1024<Mt(t)){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}(this._heartbeatsCache.heartbeats),t=l(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,0<n.length?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),t}}function Pt(){const e=new Date;return e.toISOString().substring(0,10)}class Ot{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!J()&&X().then(()=>!0).catch(()=>!1)}async read(){return await this._canUseIndexedDBPromise&&await async function(e){try{const n=await Nt();return n.transaction(Ct).objectStore(Ct).get(xt(e))}catch(e){var t;e instanceof ae?ut.warn(e.message):(t=_t.create("idb-get",{originalErrorMessage:null==e?void 0:e.message}),ut.warn(t.message))}}(this.app)||{heartbeats:[]}}async overwrite(e){var t,n;if(await this._canUseIndexedDBPromise)return n=await this.read(),Rt(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}async add(e){var t,n;if(await this._canUseIndexedDBPromise)return n=await this.read(),Rt(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}function Mt(e){return l(JSON.stringify({version:2,heartbeats:e})).length}vt(new o("platform-logger",e=>new ot(e),"PRIVATE")),vt(new o("heartbeat",e=>new Dt(e),"PRIVATE")),r(ct,lt,""),r(ct,lt,"esm2017"),r("fire-js","");var Lt=Object.freeze({__proto__:null,SDK_VERSION:bt,_DEFAULT_ENTRY_NAME:ht,_addComponent:gt,_addOrOverwriteComponent:mt,_apps:pt,_clearComponents:function(){ft.clear()},_components:ft,_getProvider:yt,_registerComponent:vt,_removeServiceInstance:function(e,t,n=ht){yt(e,t).clearInstance(n)},deleteApp:Et,getApp:Tt,getApps:function(){return Array.from(pt.values())},initializeApp:It,onLog:kt,registerVersion:r,setLogLevel:St,FirebaseError:ae});class Ft{constructor(e,t){this._delegate=e,this.firebase=t,gt(e,new o("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),Et(this._delegate)))}_getService(e,t=ht){this._delegate.checkDestroyed();const n=this._delegate.container.getProvider(e);return n.isInitialized()||"EXPLICIT"!==(null==(e=n.getComponent())?void 0:e.instantiationMode)||n.initialize(),n.getImmediate({identifier:t})}_removeServiceInstance(e,t=ht){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){gt(this._delegate,e)}_addOrOverwriteComponent(e){mt(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const Ut=new oe("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});var e=function e(){const t=function(i){const n={},s={__esModule:!0,initializeApp:function(e,t={}){e=It(e,t);if(de(n,e.name))return n[e.name];t=new i(e,s);return n[e.name]=t},app:a,registerVersion:r,setLogLevel:St,onLog:kt,apps:null,SDK_VERSION:bt,INTERNAL:{registerComponent:function(n){const r=n.name,t=r.replace("-compat","");var e;return vt(n)&&"PUBLIC"===n.type&&(e=(e=a())=>{if("function"!=typeof e[t])throw Ut.create("invalid-app-argument",{appName:r});return e[t]()},void 0!==n.serviceProps&&K(e,n.serviceProps),s[t]=e,i.prototype[t]=function(...e){const t=this._getService.bind(this,r);return t.apply(this,n.multipleInstances?e:[])}),"PUBLIC"===n.type?s[t]:null},removeApp:function(e){delete n[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:Lt}};function a(e){if(e=e||ht,de(n,e))return n[e];throw Ut.create("no-app",{appName:e})}return s.default=s,Object.defineProperty(s,"apps",{get:function(){return Object.keys(n).map(e=>n[e])}}),a.App=i,s}(Ft);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){K(t,e)},createSubscribe:Ie,ErrorFactory:oe,deepExtend:K}),t}();const qt=new je("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){qt.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const KR=self.firebase.SDK_VERSION;KR&&0<=KR.indexOf("LITE")&&qt.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const Vt=e;r("@firebase/app-compat","0.2.0-20221206221533",void 0),Vt.registerVersion("firebase","9.15.0-20221206221533","app-compat");var t="@firebase/installations",Bt="0.6.0-20221206221533";const jt=1e4,Kt="w:"+Bt,Wt="FIS_v2",zt="https://firebaseinstallations.googleapis.com/v1",Gt=36e5,Ht=new oe("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function $t(e){return e instanceof ae&&e.code.includes("request-failed")}function Qt({projectId:e}){return zt+`/projects/${e}/installations`}function Yt(e){return{token:e.token,requestStatus:2,expiresIn:(e=e.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()}}async function Jt(e,t){t=(await t.json()).error;return Ht.create("request-failed",{requestName:e,serverCode:t.code,serverMessage:t.message,serverStatus:t.status})}function Xt({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function Zt(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function en(t){return new Promise(e=>{setTimeout(e,t)})}const tn=/^[cdef][\w-]{21}$/,nn="";function rn(e){return e.appName+"!"+e.appId}const sn=new Map;function an(e,t){e=rn(e);on(e,t);{!cn&&"BroadcastChannel"in self&&((cn=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{on(e.data.key,e.data.fid)});const n=cn;return n&&n.postMessage({key:e,fid:t}),void(0===sn.size&&cn&&(cn.close(),cn=null))}}function on(e,t){e=sn.get(e);if(e)for(const n of e)n(t)}let cn=null;const ln="firebase-installations-store";let un=null;function hn(){return un=un||tt("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(ln)}})}async function dn(e,t){var n=rn(e);const r=await hn(),i=r.transaction(ln,"readwrite"),s=i.objectStore(ln);var a=await s.get(n);return await s.put(t,n),await i.done,a&&a.fid===t.fid||an(e,t.fid),t}async function pn(e){e=rn(e);const t=await hn(),n=t.transaction(ln,"readwrite");await n.objectStore(ln).delete(e),await n.done}async function fn(e,t){var n=rn(e);const r=await hn(),i=r.transaction(ln,"readwrite"),s=i.objectStore(ln);var a=await s.get(n),t=t(a);return void 0===t?await s.delete(n):await s.put(t,n),await i.done,!t||a&&a.fid===t.fid||an(e,t.fid),t}async function gn(t){let n;var e=await fn(t.appConfig,e=>{e=vn(e||{fid:function(){try{const t=new Uint8Array(17),n=self.crypto||self.msCrypto;n.getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){const e=function(){const e=btoa(String.fromCharCode(...t));return e.replace(/\+/g,"-").replace(/\//g,"_")}();return e.substr(0,22)}(t);return tn.test(e)?e:nn}catch(e){return nn}}(),registrationStatus:0}),e=function(e,t){if(0!==t.registrationStatus)return 1===t.registrationStatus?{installationEntry:t,registrationPromise:async function(e){let t=await mn(e.appConfig);for(;1===t.registrationStatus;)await en(100),t=await mn(e.appConfig);if(0!==t.registrationStatus)return t;var{installationEntry:n,registrationPromise:r}=await gn(e);return r||n}(e)}:{installationEntry:t};if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(Ht.create("app-offline"))};t={fid:t.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:t,registrationPromise:async function(e,t){try{var n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=Qt(e),i=Xt(e),s=t.getImmediate({optional:!0});s&&(a=await s.getHeartbeatsHeader())&&i.append("x-firebase-client",a);var a={fid:n,authVersion:Wt,appId:e.appId,sdkVersion:Kt};const o={method:"POST",headers:i,body:JSON.stringify(a)},c=await Zt(()=>fetch(r,o));if(c.ok)return{fid:(a=await c.json()).fid||n,registrationStatus:2,refreshToken:a.refreshToken,authToken:Yt(a.authToken)};throw await Jt("Create Installation",c)}(e,t);return dn(e.appConfig,n)}catch(n){throw $t(n)&&409===n.customData.serverCode?await pn(e.appConfig):await dn(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,t)}}(t,e);return n=e.registrationPromise,e.installationEntry});return e.fid===nn?{installationEntry:await n}:{installationEntry:e,registrationPromise:n}}function mn(e){return fn(e,e=>{if(e)return vn(e);throw Ht.create("installation-not-found")})}function vn(e){return 1===e.registrationStatus&&e.registrationTime+jt<Date.now()?{fid:e.fid,registrationStatus:0}:e}async function yn({appConfig:e,heartbeatServiceProvider:t},n){[i,s]=[e,n.fid];const r=Qt(i)+`/${s}/authTokens:generate`;var i,s;const a=function(e,{refreshToken:t}){const n=Xt(e);return n.append("Authorization",Wt+" "+t),n}(e,n),o=t.getImmediate({optional:!0});o&&(c=await o.getHeartbeatsHeader())&&a.append("x-firebase-client",c);var c={installation:{sdkVersion:Kt,appId:e.appId}};const l={method:"POST",headers:a,body:JSON.stringify(c)},u=await Zt(()=>fetch(r,l));if(u.ok)return Yt(await u.json());throw await Jt("Generate Auth Token",u)}async function _n(s,a=!1){let o;var e=await fn(s.appConfig,e=>{if(!bn(e))throw Ht.create("not-registered");var t,n,r,i=e.authToken;if(a||2!==(t=i).requestStatus||(n=t,(r=Date.now())<n.creationTime||n.creationTime+n.expiresIn<r+Gt)){if(1===i.requestStatus)return o=async function(e,t){let n=await wn(e.appConfig);for(;1===n.authToken.requestStatus;)await en(100),n=await wn(e.appConfig);var r=n.authToken;return 0===r.requestStatus?_n(e,t):r}(s,a),e;if(navigator.onLine)return t=e,i={requestStatus:1,requestTime:Date.now()},i=Object.assign(Object.assign({},t),{authToken:i}),o=async function(e,t){try{var n=await yn(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await dn(e.appConfig,r),n}catch(r){throw!$t(r)||401!==r.customData.serverCode&&404!==r.customData.serverCode?(n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}),await dn(e.appConfig,n)):await pn(e.appConfig),r}}(s,i),i;throw Ht.create("app-offline")}return e});return o?await o:e.authToken}function wn(e){return fn(e,e=>{if(!bn(e))throw Ht.create("not-registered");var t=e.authToken;return 1===t.requestStatus&&t.requestTime+jt<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function bn(e){return void 0!==e&&2===e.registrationStatus}function In(e){return Ht.create("missing-app-config-values",{valueName:e})}const Tn="installations",En=(vt(new o(Tn,e=>{e=e.getProvider("app").getImmediate();return{app:e,appConfig:function(e){if(!e||!e.options)throw In("App Configuration");if(!e.name)throw In("App Name");for(const t of["projectId","apiKey","appId"])if(!e.options[t])throw In(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(e),heartbeatServiceProvider:yt(e,"heartbeat"),_delete:()=>Promise.resolve()}},"PUBLIC")),vt(new o("installations-internal",e=>{const t=yt(e.getProvider("app").getImmediate(),Tn).getImmediate();return{getId:()=>async function(e){const{installationEntry:t,registrationPromise:n}=await gn(e);return(n||_n(e)).catch(console.error),t.fid}(t),getToken:e=>async function(e,t=!1){var n;return await((n=(await gn(e)).registrationPromise)&&await n),(await _n(e,t)).token}(t,e)}},"PRIVATE")),r(t,Bt),r(t,Bt,"esm2017"),"analytics"),kn="firebase_id",Sn="origin",Cn="https://www.googletagmanager.com/gtag/js",An=new je("@firebase/analytics");function Nn(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function Rn(w,b,I,T){return async function(e,t,n){try{if("event"===e){{var r=w;var i=b;var s=I;var a=t;var o=n;try{let t=[];if(o&&o.send_to){let e=o.send_to;Array.isArray(e)||(e=[e]);const v=await Nn(s);for(const y of e){var c=v.find(e=>e.measurementId===y),l=c&&i[c.appId];if(!l){t=[];break}t.push(l)}}0===t.length&&(t=Object.values(i)),await Promise.all(t),r("event",a,o||{})}catch(r){An.error(r)}}await 0}else if("config"===e){{var u=w;var h=b;var d=I;var p=t;var f=n;var g=T[p];try{if(g)await h[g];else{const _=await Nn(d);var m=_.find(e=>e.measurementId===p);m&&await h[m.appId]}}catch(u){An.error(u)}u("config",p,f)}await 0}else"consent"===e?w("consent","update",n):w("set",t)}catch(e){An.error(e)}}}const xn=new oe("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),Dn=30,Pn=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function On(e,t=Pn,n){var{appId:e,apiKey:r,measurementId:i}=e.options;if(!e)throw xn.create("no-app-id");if(!r){if(i)return{measurementId:i,appId:e};throw xn.create("no-api-key")}var s=t.getThrottleMetadata(e)||{backoffCount:0,throttleEndTimeMillis:Date.now()};const a=new Mn;return setTimeout(async()=>{a.abort()},void 0!==n?n:6e4),async function e(t,{throttleEndTimeMillis:n,backoffCount:r},i,s=Pn){var a,o,{appId:c,measurementId:l}=t;try{a=i,o=n,await new Promise((e,t)=>{var n=Math.max(o-Date.now(),0);const r=setTimeout(e,n);a.addEventListener(()=>{clearTimeout(r),t(xn.create("fetch-throttle",{throttleEndTimeMillis:o}))})})}catch(n){if(l)return An.warn("Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID "+l+` provided in the "measurementId" field in the local Firebase config. [${null==n?void 0:n.message}]`),{appId:c,measurementId:l};throw n}try{var u=await async function(t){var n,{appId:e,apiKey:r}=t,r={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":r})},e="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",e);const i=await fetch(e,r);if(200===i.status||304===i.status)return i.json();{let e="";try{var s=await i.json();null!=(n=s.error)&&n.message&&(e=s.error.message)}catch(t){}throw xn.create("config-fetch-failed",{httpStatus:i.status,responseMessage:e})}}(t);return s.deleteThrottleMetadata(c),u}catch(n){u=n;if(!function(e){if(!(e instanceof ae&&e.customData))return;e=Number(e.customData.httpStatus);return 429===e||500===e||503===e||504===e}(u)){if(s.deleteThrottleMetadata(c),l)return An.warn("Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID "+l+` provided in the "measurementId" field in the local Firebase config. [${null==u?void 0:u.message}]`),{appId:c,measurementId:l};throw n}u=503===Number(null==(l=null==u?void 0:u.customData)?void 0:l.httpStatus)?Pe(r,s.intervalMillis,Dn):Pe(r,s.intervalMillis),l={throttleEndTimeMillis:Date.now()+u,backoffCount:r+1};return s.setThrottleMetadata(c,l),An.debug(`Calling attemptFetch again in ${u} millis`),e(t,l,i,s)}}({appId:e,apiKey:r,measurementId:i},s,a,t)}class Mn{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}class Ln{constructor(e){this.app=e}_delete(){return delete Fn[this.app.options.appId],Promise.resolve()}}let Fn={},Un=[];const qn={};let Vn="dataLayer",Bn="gtag",jn,Kn,Wn=!1;function zn(e,t,n){{const a=[];H()&&a.push("This is a browser extension environment."),Z()||a.push("Cookies are not available."),0<a.length&&(i=a.map((e,t)=>`(${t+1}) `+e).join(" "),i=xn.create("invalid-analytics-context",{errorInfo:i}),An.warn(i.message))}var r,i=e.options.appId;if(!i)throw xn.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw xn.create("no-api-key");An.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID '+e.options.measurementId+' provided in the "measurementId" field in the local Firebase config.')}if(null!=Fn[i])throw xn.create("already-exists",{id:i});if(!Wn){{var s=Vn;let e=[];Array.isArray(window[s])?e=window[s]:window[s]=e,e}({wrappedGtag:s,gtagCore:r}=function(e,t,n,r,i){let s=function(){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=Rn(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(Fn,Un,qn,Vn,Bn)),Kn=s,jn=r,Wn=!0}return Fn[i]=async function(t,e,n,r,i,s,a){const o=On(t);o.then(e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&An.warn(`The measurement ID in the local Firebase config (${t.options.measurementId})`+` does not match the measurement ID fetched from the server (${e.measurementId}).`+" To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(e=>An.error(e)),e.push(o);var e=async function(){if(!J())return An.warn(xn.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await X()}catch(e){return An.warn(xn.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then(e=>{if(e)return r.getId()}),[c,l]=await Promise.all([o,e]);if(!function(e){var t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(Cn)&&n.src.includes(e))return n}(s)){var u=c.measurementId;const d=document.createElement("script");d.src=Cn+`?l=${s}&id=`+u,d.async=!0,document.head.appendChild(d)}i("js",new Date);const h=null!=(e=null==a?void 0:a.config)?e:{};return h[Sn]="firebase",h.update=!0,null!=l&&(h[kn]=l),i("config",c.measurementId,h),c.measurementId}(e,Un,qn,t,jn,Vn,n),new Ln(e)}function Gn(e,t,n,i){e=_(e),async function(e,t,n,r){i&&i.global?e("event",n,r):(t=await t,e("event",n,Object.assign(Object.assign({},r),{send_to:t})))}(Kn,Fn[e.app.options.appId],t,n).catch(e=>An.error(e))}var Hn="@firebase/analytics",$n="0.9.0-20221206221533";vt(new o(En,(e,{options:t})=>zn(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),vt(new o("analytics-internal",function(e){try{const r=e.getProvider(En).getImmediate();return{logEvent:(e,t,n)=>Gn(r,e,t,n)}}catch(e){throw xn.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),r(Hn,$n),r(Hn,$n,"esm2017");class Qn{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,n){Gn(this._delegate,e,t,n)}setCurrentScreen(e,t){var n,r;n=this._delegate,e=e,r=t,n=_(n),async function(e,t,n){return r&&r.global?(e("set",{screen_name:n}),Promise.resolve()):void e("config",await t,{update:!0,screen_name:n})}(Kn,Fn[n.app.options.appId],e).catch(e=>An.error(e))}setUserId(e,t){var n,r;n=this._delegate,e=e,r=t,n=_(n),async function(e,t,n){return r&&r.global?(e("set",{user_id:n}),Promise.resolve()):void e("config",await t,{update:!0,user_id:n})}(Kn,Fn[n.app.options.appId],e).catch(e=>An.error(e))}setUserProperties(e,t){var n,s;n=this._delegate,e=e,s=t,n=_(n),async function(e,t,n){if(s&&s.global){const r={};for(const i of Object.keys(n))r["user_properties."+i]=n[i];return e("set",r),Promise.resolve()}e("config",await t,{update:!0,user_properties:n})}(Kn,Fn[n.app.options.appId],e).catch(e=>An.error(e))}setAnalyticsCollectionEnabled(e){var t;t=this._delegate,e=e,t=_(t),async function(e,t){e=await e;window["ga-disable-"+e]=!t}(Fn[t.app.options.appId],e).catch(e=>An.error(e))}}$n=Hn={ADD_SHIPPING_INFO:"add_shipping_info",ADD_PAYMENT_INFO:"add_payment_info",ADD_TO_CART:"add_to_cart",ADD_TO_WISHLIST:"add_to_wishlist",BEGIN_CHECKOUT:"begin_checkout",CHECKOUT_PROGRESS:"checkout_progress",EXCEPTION:"exception",GENERATE_LEAD:"generate_lead",LOGIN:"login",PAGE_VIEW:"page_view",PURCHASE:"purchase",REFUND:"refund",REMOVE_FROM_CART:"remove_from_cart",SCREEN_VIEW:"screen_view",SEARCH:"search",SELECT_CONTENT:"select_content",SELECT_ITEM:"select_item",SELECT_PROMOTION:"select_promotion",SET_CHECKOUT_OPTION:"set_checkout_option",SHARE:"share",SIGN_UP:"sign_up",TIMING_COMPLETE:"timing_complete",VIEW_CART:"view_cart",VIEW_ITEM:"view_item",VIEW_ITEM_LIST:"view_item_list",VIEW_PROMOTION:"view_promotion",VIEW_SEARCH_RESULTS:"view_search_results"},Hn={Analytics:Qn,settings:function(e){if(Wn)throw xn.create("already-initialized");e.dataLayerName&&(Vn=e.dataLayerName),e.gtagName&&(Bn=e.gtagName)},isSupported:async function(){if(H())return!1;if(!Z())return!1;if(!J())return!1;try{return await X()}catch(e){return!1}},EventName:Hn};Vt.INTERNAL.registerComponent(new o("analytics-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("analytics").getImmediate();return new Qn(t,e)},"PUBLIC").setServiceProps(Hn).setMultipleInstances(!0)),Vt.registerVersion("@firebase/analytics-compat","0.2.0-20221206221533");const Yn=new Map,Jn={activated:!1,tokenObservers:[]},Xn={initialized:!1,enabled:!1};function Zn(e){return Yn.get(e)||Object.assign({},Jn)}const er="https://content-firebaseappcheck.googleapis.com/v1",tr="exchangeDebugToken",nr={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class rr{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,i<(this.nextErrorWaitInterval=r))throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new ie,t=this.getNextRun(e),await new Promise(e=>{setTimeout(e,t)}),this.pending.resolve(),await this.pending.promise,this.pending=new ie,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}var t}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}const ir=new oe("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function sr(e=!1){return e?null==(e=self.grecaptcha)?void 0:e.enterprise:self.grecaptcha}function ar(e){if(!Zn(e).activated)throw ir.create("use-before-activation",{appName:e.name})}function or(e){var e=Math.round(e/1e3),t=Math.floor(e/86400),n=Math.floor((e-3600*t*24)/3600),r=Math.floor((e-3600*t*24-3600*n)/60),e=e-3600*t*24-3600*n-60*r;let i="";return t&&(i+=cr(t)+"d:"),n&&(i+=cr(n)+"h:"),i+=cr(r)+"m:"+cr(e)+"s"}function cr(e){return 0===e?"00":10<=e?e.toString():"0"+e}async function lr({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});i&&(o=await i.getHeartbeatsHeader())&&(r["X-Firebase-Client"]=o);n={method:"POST",body:JSON.stringify(t),headers:r};let s;try{s=await fetch(e,n)}catch(e){throw ir.create("fetch-network-error",{originalErrorMessage:null==e?void 0:e.message})}if(200!==s.status)throw ir.create("fetch-status-error",{httpStatus:s.status});let a;try{a=await s.json()}catch(e){throw ir.create("fetch-parse-error",{originalErrorMessage:null==e?void 0:e.message})}var o=a.ttl.match(/^([\d.]+)(s)$/);if(o&&o[2]&&!isNaN(Number(o[1])))return n=1e3*Number(o[1]),o=Date.now(),{token:a.token,expireTimeMillis:o+n,issuedAtTimeMillis:o};throw ir.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration format: "+a.ttl})}const ur="firebase-app-check-store",hr="debug-token";let dr=null;function pr(){return dr||(dr=new Promise((t,n)=>{try{const e=indexedDB.open("firebase-app-check-database",1);e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(ir.create("storage-open",{originalErrorMessage:null==(e=e.target.error)?void 0:e.message}))},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(ur,{keyPath:"compositeKey"})}}catch(e){n(ir.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}}))}async function fr(e,t){const n=await pr(),r=n.transaction(ur,"readwrite"),i=r.objectStore(ur),s=i.put({compositeKey:e,value:t});return new Promise((t,n)=>{s.onsuccess=e=>{t()},r.onerror=e=>{n(ir.create("storage-set",{originalErrorMessage:null==(e=e.target.error)?void 0:e.message}))}})}async function gr(e){const t=await pr(),r=t.transaction(ur,"readonly"),n=r.objectStore(ur),i=n.get(e);return new Promise((t,n)=>{i.onsuccess=e=>{e=e.target.result;t(e?e.value:void 0)},r.onerror=e=>{n(ir.create("storage-get",{originalErrorMessage:null==(e=e.target.error)?void 0:e.message}))}})}function mr(e){return e.options.appId+"-"+e.name}const vr=new je("@firebase/app-check");function yr(e,t){return J()?fr(mr(e),t).catch(e=>{vr.warn("Failed to write token to IndexedDB. Error: "+e)}):Promise.resolve()}async function _r(){let e=void 0;try{e=await gr(hr)}catch(e){}if(e)return e;var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)}),n=t;return fr(hr,n).catch(e=>vr.warn("Failed to persist debug token to IndexedDB. Error: "+e)),t}function wr(){return Xn.enabled}async function br(){var e=Xn;if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}const Ir={error:"UNKNOWN_ERROR"};async function Tr(e,t=!1){var n,r=e.app;ar(r);const i=Zn(r);let s=i.token,a=void 0;if(s&&!Ar(s)&&(i.token=void 0,s=void 0),s||(n=await i.cachedTokenPromise)&&(Ar(n)?s=n:await yr(r,void 0)),!t&&s&&Ar(s))return{token:s.token};let o=!1;if(wr())return i.exchangeTokenPromise||(i.exchangeTokenPromise=lr(function(e,t){var{projectId:e,appId:n,apiKey:r}=e.options;return{url:`${er}/projects/${e}/apps/${n}:${tr}?key=`+r,body:{debug_token:t}}}(r,await br()),e.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),await yr(r,n=await i.exchangeTokenPromise),{token:(i.token=n).token};try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),s=await Zn(r).exchangeTokenPromise}catch(e){"appCheck/throttled"===e.code?vr.warn(e.message):vr.error(e),a=e}let c;return s?a?c=Ar(s)?{token:s.token,internalError:a}:Nr(a):(c={token:s.token},await yr(r,i.token=s)):c=Nr(a),o&&Cr(r,c),c}function Er(e,t,n,r){const i=Zn(e.app);if(r={next:n,error:r,type:t},i.tokenObservers=[...i.tokenObservers,r],i.token&&Ar(i.token)){const s=i.token;Promise.resolve().then(()=>{n({token:s.token}),Sr(e)}).catch(()=>{})}i.cachedTokenPromise.then(()=>Sr(e))}function kr(e,t){const n=Zn(e);e=n.tokenObservers.filter(e=>e.next!==t);0===e.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),n.tokenObservers=e}function Sr(e){const t=Zn(e.app);let n=t.tokenRefresher;n||(n=function(t){const n=t.app;return new rr(async()=>{var e=Zn(n).token?await Tr(t,!0):await Tr(t);if(e.error)throw e.error;if(e.internalError)throw e.internalError},()=>!0,()=>{var e,t=Zn(n);return t.token?(e=t.token.issuedAtTimeMillis+.5*(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)+3e5,t=t.token.expireTimeMillis-3e5,e=Math.min(e,t),Math.max(0,e-Date.now())):0},nr.RETRIAL_MIN_WAIT,nr.RETRIAL_MAX_WAIT)}(e),t.tokenRefresher=n),!n.isRunning()&&t.isTokenAutoRefreshEnabled&&n.start()}function Cr(e,t){for(const n of Zn(e).tokenObservers)try{"EXTERNAL"===n.type&&null!=t.error?n.error(t.error):n.next(t)}catch(e){}}function Ar(e){return 0<e.expireTimeMillis-Date.now()}function Nr(e){return{token:(t=Ir,a.encodeString(JSON.stringify(t),!1)),error:e};var t}class Rr{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){for(const e of Zn(this.app).tokenObservers)kr(this.app,e.next);return Promise.resolve()}}function xr(t,n){const r=new ie,e=Zn(t),i=(e.reCAPTCHAState={initialized:r},Or(t));var s=sr(!1);if(s)Pr(t,n,s,i,r);else{const a=document.createElement("script");a.src="https://www.google.com/recaptcha/api.js",a.onload=()=>{var e=sr(!1);if(!e)throw new Error("no recaptcha");Pr(t,n,e,i,r)},document.head.appendChild(a)}return r.promise}function Dr(t,n){const r=new ie,e=Zn(t),i=(e.reCAPTCHAState={initialized:r},Or(t));var s=sr(!0);if(s)Pr(t,n,s,i,r);else{const a=document.createElement("script");a.src="https://www.google.com/recaptcha/enterprise.js",a.onload=()=>{var e=sr(!0);if(!e)throw new Error("no recaptcha");Pr(t,n,e,i,r)},document.head.appendChild(a)}return r.promise}function Pr(r,i,s,a,o){s.ready(()=>{{var e=r;const t=s.render(a,{sitekey:i,size:"invisible"}),n=Zn(e);n.reCAPTCHAState=Object.assign(Object.assign({},n.reCAPTCHAState),{widgetId:t})}o.resolve(s)})}function Or(e){e="fire_app_check_"+e.name;const t=document.createElement("div");return t.id=e,t.style.display="none",document.body.appendChild(t),e}async function Mr(r){ar(r);const i=await Zn(r).reCAPTCHAState.initialized.promise;return new Promise((e,t)=>{const n=Zn(r).reCAPTCHAState;i.ready(()=>{e(i.execute(n.widgetId,{action:"fire_app_check"}))})})}class Lr{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){Vr(this._throttleData);var e=await Mr(this._app).catch(e=>{throw ir.create("recaptcha-error")});let t;try{t=await lr(function(e,t){var{projectId:e,appId:n,apiKey:r}=e.options;return{url:er+`/projects/${e}/apps/${n}:exchangeRecaptchaV3Token?key=`+r,body:{recaptcha_v3_token:t}}}(this._app,e),this._heartbeatServiceProvider)}catch(t){throw null!=(e=t.code)&&e.includes("fetch-status-error")?(this._throttleData=qr(Number(null==(e=t.customData)?void 0:e.httpStatus),this._throttleData),ir.create("throttled",{time:or(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):t}return this._throttleData=null,t}initialize(e){this._app=e,this._heartbeatServiceProvider=yt(e,"heartbeat"),xr(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Lr&&this._siteKey===e._siteKey}}class Fr{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){Vr(this._throttleData);var e=await Mr(this._app).catch(e=>{throw ir.create("recaptcha-error")});let t;try{t=await lr(function(e,t){var{projectId:e,appId:n,apiKey:r}=e.options;return{url:er+`/projects/${e}/apps/${n}:exchangeRecaptchaEnterpriseToken?key=`+r,body:{recaptcha_enterprise_token:t}}}(this._app,e),this._heartbeatServiceProvider)}catch(t){throw null!=(e=t.code)&&e.includes("fetch-status-error")?(this._throttleData=qr(Number(null==(e=t.customData)?void 0:e.httpStatus),this._throttleData),ir.create("throttled",{time:or(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):t}return this._throttleData=null,t}initialize(e){this._app=e,this._heartbeatServiceProvider=yt(e,"heartbeat"),Dr(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Fr&&this._siteKey===e._siteKey}}class Ur{constructor(e){this._customProviderOptions=e}async getToken(){var t=await this._customProviderOptions.getToken(),e=null!==(e=function(){const e=he(t.token).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?e.iat:null}())&&e<Date.now()&&0<e?1e3*e:Date.now();return Object.assign(Object.assign({},t),{issuedAtTimeMillis:e})}initialize(e){this._app=e}isEqual(e){return e instanceof Ur&&this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString()}}function qr(e,t){if(404===e||403===e)return{backoffCount:1,allowRequestsAfter:Date.now()+864e5,httpStatus:e};var t=t?t.backoffCount:0,n=Pe(t,1e3,2);return{backoffCount:t+1,allowRequestsAfter:Date.now()+n,httpStatus:e}}function Vr(e){if(e&&Date.now()-e.allowRequestsAfter<=0)throw ir.create("throttled",{time:or(e.allowRequestsAfter-Date.now()),httpStatus:e.httpStatus})}function Br(e=Tt(),t){const n=yt(e=_(e),"app-check");if(!Xn.initialized){var r=ee();const c=Xn;if(c.initialized=!0,"string"==typeof r.FIREBASE_APPCHECK_DEBUG_TOKEN||!0===r.FIREBASE_APPCHECK_DEBUG_TOKEN){c.enabled=!0;const l=new ie;c.token=l,"string"==typeof r.FIREBASE_APPCHECK_DEBUG_TOKEN?l.resolve(r.FIREBASE_APPCHECK_DEBUG_TOKEN):l.resolve(_r())}}if(wr()&&br().then(e=>console.log(`App Check debug token: ${e}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),n.isInitialized()){var i=n.getImmediate();const u=n.getOptions();if(u.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&u.provider.isEqual(t.provider))return i;throw ir.create("already-initialized",{appName:e.name})}i=n.initialize({options:t});{var s=e,a,o;r=t.provider,t=t.isTokenAutoRefreshEnabled,a=s,o=Object.assign({},Jn),Yn.set(a,o);const h=Yn.get(a);h.activated=!0,h.provider=r,h.cachedTokenPromise=async function(t){if(J()){let e=void 0;try{e=await gr(mr(t))}catch(e){vr.warn("Failed to read token from IndexedDB. Error: "+e)}return e}}(s).then(e=>(e&&Ar(e)&&(h.token=e,Cr(s,{token:e.token})),e)),h.isTokenAutoRefreshEnabled=void 0===t?s.automaticDataCollectionEnabled:t,h.provider.initialize(s)}return Zn(e).isTokenAutoRefreshEnabled&&Er(i,"INTERNAL",()=>{}),i}const jr="app-check-internal",Kr=(vt(new o("app-check",e=>{var t=e.getProvider("app").getImmediate();return e=e.getProvider("heartbeat"),new Rr(t,e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(jr).initialize()})),vt(new o(jr,e=>{var t=e.getProvider("app-check").getImmediate();return{getToken:e=>Tr(t,e),addTokenListener:e=>Er(t,"INTERNAL",e),removeTokenListener:e=>kr(t.app,e)}},"PUBLIC").setInstantiationMode("EXPLICIT")),r("@firebase/app-check","0.6.0-20221206221533"),new oe("appCheck","AppCheck",{"use-before-activation":"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."}));class Wr{constructor(e){this.app=e}activate(e,t){e="string"==typeof e?new Lr(e):e instanceof Fr||e instanceof Lr||e instanceof Ur?e:new Ur({getToken:e.getToken});this._delegate=Br(this.app,{provider:e,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw Kr.create("use-before-activation",{appName:this.app.name});{var t;const n=Zn(this._delegate.app);return n.tokenRefresher&&(!0===e?n.tokenRefresher.start():n.tokenRefresher.stop()),void(n.isTokenAutoRefreshEnabled=e)}}getToken(t){if(this._delegate)return async function(e){e=await Tr(e,t);if(e.error)throw e.error;return{token:e.token}}(this._delegate);throw Kr.create("use-before-activation",{appName:this.app.name})}onTokenChanged(n,r,e){if(this._delegate){var i=this._delegate;let e,t=()=>{};return e=null!=n.next?n.next.bind(n):n,null!=n.error?t=n.error.bind(n):r&&(t=r),Er(i,"EXTERNAL",e,t),()=>kr(i.app,e)}throw Kr.create("use-before-activation",{appName:this.app.name})}}function zr(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}Vt.INTERNAL.registerComponent(new o("appCheck-compat",e=>{e=e.getProvider("app-compat").getImmediate();return new Wr(e)},"PUBLIC").setServiceProps({ReCaptchaEnterpriseProvider:Fr,ReCaptchaV3Provider:Lr,CustomProvider:Ur})),Vt.registerVersion("@firebase/app-check-compat","0.3.0-20221206221533");const Gr={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Hr="EMAIL_SIGNIN",$r="PASSWORD_RESET",Qr="RECOVER_EMAIL",Yr="REVERT_SECOND_FACTOR_ADDITION",Jr="VERIFY_AND_CHANGE_EMAIL",Xr="VERIFY_EMAIL";function Zr(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}function ei(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}}const ti=Zr,ni=new oe("auth","Firebase",Zr()),ri=new je("@firebase/auth");function ii(e,...t){ri.logLevel<=h.ERROR&&ri.error(`Auth (${bt}): `+e,...t)}function si(e,...t){throw li(e,...t)}function ai(e,...t){return li(e,...t)}function oi(e,t,n){n=Object.assign(Object.assign({},ti()),{[t]:n});const r=new oe("auth","Firebase",n);return r.create(t,{appName:e.name})}function ci(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&si(e,"argument-error"),oi(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.`+"Did you pass a reference from a different Auth SDK?")}function li(e,...t){if("string"==typeof e)return ni.create(e,...t);{var n=t[0];const r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}}function v(e,t,...n){if(!e)throw li(t,...n)}function ui(e){e="INTERNAL ASSERTION FAILED: "+e;throw ii(e),new Error(e)}function hi(e,t){e||ui(t)}const di=new Map;function pi(e){hi(e instanceof Function,"Expected a class definition");let t=di.get(e);return t?hi(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,di.set(e,t)),t}function fi(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function gi(){return"http:"===mi()||"https:"===mi()}function mi(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}class vi{constructor(e,t){hi((this.shortDelay=e)<(this.longDelay=t),"Short delay should be less than long delay!"),this.isMobile=z()||$()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(gi()||H()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function yi(e,t){hi(e.emulator,"Emulator should always be set here");e=e.emulator.url;return t?""+e+(t.startsWith("/")?t.slice(1):t):e}class _i{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl||("undefined"!=typeof self&&"fetch"in self?self.fetch:void ui("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static headers(){return this.headersImpl||("undefined"!=typeof self&&"Headers"in self?self.Headers:void ui("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static response(){return this.responseImpl||("undefined"!=typeof self&&"Response"in self?self.Response:void ui("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}}const wi={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},bi=new vi(3e4,6e4);function Ii(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Ti(i,s,a,o,e={}){return Ei(i,e,async()=>{let e={},t={};o&&("GET"===s?t=o:e={body:JSON.stringify(o)});var n=ye(Object.assign({key:i.config.apiKey},t)).slice(1);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/json",i.languageCode&&(r["X-Firebase-Locale"]=i.languageCode),_i.fetch()(Si(i,i.config.apiHost,a,n),Object.assign({method:s,headers:r,referrerPolicy:"no-referrer"},e))})}async function Ei(e,t,n){e._canInitEmulator=!1;var r=Object.assign(Object.assign({},wi),t);try{const a=new Ci(e),o=await Promise.race([n(),a.promise]);a.clearNetworkTimeout();var i=await o.json();if("needConfirmation"in i)throw Ai(e,"account-exists-with-different-credential",i);if(o.ok&&!("errorMessage"in i))return i;{const c=o.ok?i.errorMessage:i.error.message,[l,u]=c.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===l)throw Ai(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===l)throw Ai(e,"email-already-in-use",i);if("USER_DISABLED"===l)throw Ai(e,"user-disabled",i);var s=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw oi(e,s,u);si(e,s)}}catch(t){if(t instanceof ae)throw t;si(e,"network-request-failed")}}async function ki(e,t,n,r,i={}){t=await Ti(e,t,n,r,i);return"mfaPendingCredential"in t&&si(e,"multi-factor-auth-required",{_serverResponse:t}),t}function Si(e,t,n,r){t=""+t+n+"?"+r;return e.config.emulator?yi(e.config,t):e.config.apiScheme+"://"+t}class Ci{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(ai(this.auth,"network-request-failed")),bi.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ai(e,t,n){const r={appName:e.name},i=(n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber),ai(e,t,r));return i.customData._tokenResponse=n,i}function Ni(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Ri(e){return 1e3*Number(e)}function xi(e){var[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return ii("JWT malformed, contained fewer than 3 sections"),null;try{var i=u(n);return i?JSON.parse(i):(ii("Failed to decode base64 JWT payload"),null)}catch(e){return ii("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function Di(e,t,n=!1){if(n)return t;try{return t}catch(n){throw n instanceof ae&&("auth/user-disabled"===(t=n.code)||"auth/user-token-expired"===t)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class Pi{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;return e?(t=this.errorBackoff,this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t):(this.errorBackoff=3e4,t=(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5,Math.max(0,t))}schedule(e=!1){this.isRunning&&(e=this.getInterval(e),this.timerId=setTimeout(async()=>{await this.iteration()},e))}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Oi{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ni(this.lastLoginAt),this.creationTime=Ni(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Mi(e){var t=e.auth,n=await e.getIdToken(),r=(v(null==(a=await Di(e,async function(){return Ti(t,"POST","/v1/accounts:lookup",{idToken:n})}()))?void 0:a.users.length,t,"internal-error"),a.users[0]);e._notifyReloadListener(r);var i,s,t=null!=(n=r.providerUserInfo)&&n.length?r.providerUserInfo.map(e=>{var t=e.providerId,e=zr(e,["providerId"]);return{providerId:t,uid:e.rawId||"",displayName:e.displayName||null,email:e.email||null,phoneNumber:e.phoneNumber||null,photoURL:e.photoUrl||null}}):[],a=(i=e.providerData,s=t,[...i.filter(t=>!s.some(e=>e.providerId===t.providerId)),...s]),n=e.isAnonymous,t=!(e.email&&r.passwordHash||null!==a&&a.length),t=!!n&&t,t={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new Oi(r.createdAt,r.lastLoginAt),isAnonymous:t};Object.assign(e,t)}class Li{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){v(e.idToken,"internal-error"),v(void 0!==e.idToken,"internal-error"),v(void 0!==e.refreshToken,"internal-error");var t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):(v(t=xi(e.idToken),"internal-error"),v(void 0!==t.exp,"internal-error"),v(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat));this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return v(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){s=t;var i,s,{accessToken:e,refreshToken:n,expiresIn:t}=await{accessToken:(t=await Ei(i=e,{},async()=>{var e=ye({grant_type:"refresh_token",refresh_token:s}).slice(1),{tokenApiHost:t,apiKey:n}=i.config,n=Si(i,t,"/v1/token","key="+n);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/x-www-form-urlencoded",_i.fetch()(n,{method:"POST",headers:r,body:e})})).access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token};this.updateTokensAndExpiration(e,n,Number(t))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){var{refreshToken:t,accessToken:n,expirationTime:r}=t;const i=new Li;return t&&(v("string"==typeof t,"internal-error",{appName:e}),i.refreshToken=t),n&&(v("string"==typeof n,"internal-error",{appName:e}),i.accessToken=n),r&&(v("number"==typeof r,"internal-error",{appName:e}),i.expirationTime=r),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Li,this.toJSON())}_performRefresh(){return ui("not implemented")}}function Fi(e,t){v("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Ui{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,e=zr(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Pi(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=e.displayName||null,this.email=e.email||null,this.emailVerified=e.emailVerified||!1,this.phoneNumber=e.phoneNumber||null,this.photoURL=e.photoURL||null,this.isAnonymous=e.isAnonymous||!1,this.tenantId=e.tenantId||null,this.providerData=e.providerData?[...e.providerData]:[],this.metadata=new Oi(e.createdAt||void 0,e.lastLoginAt||void 0)}async getIdToken(e){e=await Di(this,this.stsTokenManager.getToken(this.auth,e));return v(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(e){return async function(e,t=!1){const n=_(e);var e=await n.getIdToken(t),t=xi(e),r=(v(t&&t.exp&&t.auth_time&&t.iat,n.auth,"internal-error"),"object"==typeof t.firebase?t.firebase:void 0),i=null==r?void 0:r.sign_in_provider;return{claims:t,token:e,authTime:Ni(Ri(t.auth_time)),issuedAtTime:Ni(Ri(t.iat)),expirationTime:Ni(Ri(t.exp)),signInProvider:i||null,signInSecondFactor:(null==r?void 0:r.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=_(e);await Mi(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(v(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Ui(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){v(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Mi(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){var t=await this.getIdToken();return await Di(this,async function(e){return Ti(e,"POST","/v1/accounts:delete",{idToken:t})}(this.auth)),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n=null!=(a=t.displayName)?a:void 0,r=null!=(g=t.email)?g:void 0,i=null!=(o=t.phoneNumber)?o:void 0,s=null!=(l=t.photoURL)?l:void 0,a=null!=(c=t.tenantId)?c:void 0,o=null!=(g=t._redirectEventId)?g:void 0,c=null!=(l=t.createdAt)?l:void 0,l=null!=(g=t.lastLoginAt)?g:void 0;const{uid:u,emailVerified:h,isAnonymous:d,providerData:p,stsTokenManager:f}=t;v(u&&f,e,"internal-error");var g=Li.fromJSON(this.name,f);v("string"==typeof u,e,"internal-error"),Fi(n,e.name),Fi(r,e.name),v("boolean"==typeof h,e,"internal-error"),v("boolean"==typeof d,e,"internal-error"),Fi(i,e.name),Fi(s,e.name),Fi(a,e.name),Fi(o,e.name),Fi(c,e.name),Fi(l,e.name);const m=new Ui({uid:u,auth:e,email:r,emailVerified:h,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:g,createdAt:c,lastLoginAt:l});return p&&Array.isArray(p)&&(m.providerData=p.map(e=>Object.assign({},e))),o&&(m._redirectEventId=o),m}static async _fromIdTokenResponse(e,t,n=!1){const r=new Li;r.updateFromServerResponse(t);t=new Ui({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Mi(t),t}}class qi{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){e=this.storage[e];return void 0===e?null:e}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}qi.type="NONE";const Vi=qi;function Bi(e,t,n){return`firebase:${e}:${t}:`+n}class ji{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;var{config:e,name:n}=this.auth;this.fullUserKey=Bi(this.userKey,e.apiKey,n),this.fullPersistenceKey=Bi("persistence",e.apiKey,n),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){var e=await this.persistence._get(this.fullUserKey);return e?Ui._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){var t;if(this.persistence!==e)return t=await this.getCurrentUser(),await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ji(pi(Vi),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||pi(Vi);const s=Bi(n,e.config.apiKey,e.name);let a=null;for(const u of t)try{var o=await u._get(s);if(o){var c=Ui._fromJSON(e,o);u!==i&&(a=c),i=u;break}}catch(e){}var l=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&l.length&&(i=l[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new ji(i,e,n)}}function Ki(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Hi(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Wi(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Qi(t))return"Blackberry";if(Yi(t))return"Webos";if(zi(t))return"Safari";if((t.includes("chrome/")||Gi(t))&&!t.includes("edge/"))return"Chrome";if($i(t))return"Android";e=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);return 2===(null==e?void 0:e.length)?e[1]:"Other"}function Wi(e=W()){return/firefox\//i.test(e)}function zi(e=W()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Gi(e=W()){return/crios\//i.test(e)}function Hi(e=W()){return/iemobile/i.test(e)}function $i(e=W()){return/android/i.test(e)}function Qi(e=W()){return/blackberry/i.test(e)}function Yi(e=W()){return/webos/i.test(e)}function Ji(e=W()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Xi(e=W()){return Ji(e)||$i(e)||Yi(e)||Qi(e)||/windows phone/i.test(e)||Hi(e)}function Zi(e,t=[]){let n;switch(e){case"Browser":n=Ki(W());break;case"Worker":n=Ki(W())+"-"+e;break;default:n=e}t=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${bt}/`+t}class es{constructor(e){this.auth=e,this.queue=[]}pushCallback(r,e){var t=n=>new Promise((e,t)=>{try{e(r(n))}catch(e){t(e)}});t.onAbort=e,this.queue.push(t);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser!==e){const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const r of t)try{r()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}}class ts{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new rs(this),this.idTokenSubscription=new rs(this),this.beforeStateQueue=new es(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ni,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=pi(n)),this._initializationPromise=this.queue(async()=>{var e;if(!this._deleted&&(this.persistenceManager=await ji.create(this,t),!this._deleted)){if(null!=(e=this._popupRedirectResolver)&&e._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(n),this.lastNotifiedUid=(null==(e=this.currentUser)?void 0:e.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(!this._deleted){var e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e)return this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t,n,r,i=await this.assertedPersistence.getCurrentUser();let s=i,a=!1;if(e&&this.config.authDomain&&(await this.getOrInitRedirectPersistenceManager(),t=null==(r=this.redirectUser)?void 0:r._redirectEventId,n=null===s||void 0===s?void 0:s._redirectEventId,r=await this.tryRedirectSignIn(e),t&&t!==n||null==r||!r.user||(s=r.user,a=!0)),!s)return this.directlySetCurrentUser(null);if(s._redirectEventId)return v(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s);if(a)try{await this.beforeStateQueue.runMiddleware(s)}catch(e){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Mi(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;var e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?_(e):null;return t&&v(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&v(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(pi(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new oe("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){return this.redirectPersistenceManager||(v(e=e&&pi(e)||this._popupRedirectResolver,this,"argument-error"),this.redirectPersistenceManager=await ji.create(this,[pi(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()),this.redirectPersistenceManager}async _redirectUserForId(e){var t;return this._isInitialized&&await this.queue(async()=>{}),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e?this._currentUser:(null==(t=this.redirectUser)?void 0:t._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:`+this.name}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;this._isInitialized&&(this.idTokenSubscription.next(this.currentUser),e=null!=(e=null==(e=this.currentUser)?void 0:e.uid)?e:null,this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser)))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return v(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),(this.currentUser=e)?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return v(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Zi(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);var t=await(null==(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:t.getHeartbeatsHeader());return t&&(e["X-Firebase-Client"]=t),e}}function ns(e){return _(e)}class rs{constructor(e){this.auth=e,this.observer=null,this.addObserver=Ie(e=>this.observer=e)}get next(){return v(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function is(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function ss(e){if(!e)return null;e=Number(e);return isNaN(e)?null:e}class as{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ui("not implemented")}_getIdTokenResponse(e){return ui("not implemented")}_linkToIdToken(e,t){return ui("not implemented")}_getReauthenticationResolver(e){return ui("not implemented")}}async function os(e,t){return Ti(e,"POST","/v1/accounts:resetPassword",Ii(e,t))}async function cs(e,t){return Ti(e,"POST","/v1/accounts:update",t)}async function ls(e,t){return Ti(e,"POST","/v1/accounts:sendOobCode",Ii(e,t))}class us extends as{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new us(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new us(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){e="string"==typeof e?JSON.parse(e):e;if(null!=e&&e.email&&null!=e&&e.password){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":return async function(e){return ki(t,"POST","/v1/accounts:signInWithPassword",Ii(t,e))}({returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e){return ki(t,"POST","/v1/accounts:signInWithEmailLink",Ii(t,e))}({email:this._email,oobCode:this._password});default:si(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":return cs(t,{idToken:e,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e){return ki(t,"POST","/v1/accounts:signInWithEmailLink",Ii(t,e))}({idToken:e,email:this._email,oobCode:this._password});default:si(t,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function hs(e,t){return ki(e,"POST","/v1/accounts:signInWithIdp",Ii(e,t))}class ds extends as{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ds(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):si("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){var{providerId:t,signInMethod:n}=e="string"==typeof e?JSON.parse(e):e,e=zr(e,["providerId","signInMethod"]);if(!t||!n)return null;const r=new ds(t,n);return r.idToken=e.idToken||void 0,r.accessToken=e.accessToken||void 0,r.secret=e.secret,r.nonce=e.nonce,r.pendingToken=e.pendingToken||null,r}_getIdTokenResponse(e){return hs(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,hs(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,hs(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ye(t)}return e}}const ps={USER_NOT_FOUND:"user-not-found"};class fs extends as{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new fs({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new fs({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return ki(e,"POST","/v1/accounts:signInWithPhoneNumber",Ii(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){t=await ki(e,"POST","/v1/accounts:signInWithPhoneNumber",Ii(e,t));if(t.temporaryProof)throw Ai(e,"account-exists-with-different-credential",t);return t}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return ki(e,"POST","/v1/accounts:signInWithPhoneNumber",Ii(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),ps)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){var{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){var{verificationId:e,verificationCode:t,phoneNumber:n,temporaryProof:r}=e="string"==typeof e?JSON.parse(e):e;return t||e||n||r?new fs({verificationId:e,verificationCode:t,phoneNumber:n,temporaryProof:r}):null}}class gs{constructor(e){var t=_e(we(e)),n=null!=(e=t.apiKey)?e:null,e=null!=(r=t.oobCode)?r:null,r=function(){switch(null!==(r=t.mode)&&void 0!==r?r:null){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}();v(n&&e&&r,"argument-error"),this.apiKey=n,this.operation=r,this.code=e,this.continueUrl=null!=(e=t.continueUrl)?e:null,this.languageCode=null!=(e=t.languageCode)?e:null,this.tenantId=null!=(t=t.tenantId)?t:null}static parseLink(e){t=(r=_e(we(e)).link)?_e(we(r)).deep_link_id:null;var t,n,r=((n=_e(we(e)).deep_link_id)?_e(we(n)).link:null)||n||t||r||e;try{return new gs(r)}catch(e){return null}}}class ms{constructor(){this.providerId=ms.PROVIDER_ID}static credential(e,t){return us._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){t=gs.parseLink(t);return v(t,"argument-error"),us._fromEmailAndCode(e,t.code,t.tenantId)}}ms.PROVIDER_ID="password",ms.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ms.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class vs{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ys extends vs{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class _s extends ys{static credentialFromJSON(e){e="string"==typeof e?JSON.parse(e):e;return v("providerId"in e&&"signInMethod"in e,"argument-error"),ds._fromParams(e)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return v(e.idToken||e.accessToken,"argument-error"),ds._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return _s.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return _s.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:a}=e;if(!(n||r||t||i))return null;if(!a)return null;try{return new _s(a)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class ws extends ys{constructor(){super("facebook.com")}static credential(e){return ds._fromParams({providerId:ws.PROVIDER_ID,signInMethod:ws.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ws.credentialFromTaggedObject(e)}static credentialFromError(e){return ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return ws.credential(e.oauthAccessToken)}catch(e){return null}}}ws.FACEBOOK_SIGN_IN_METHOD="facebook.com",ws.PROVIDER_ID="facebook.com";class bs extends ys{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ds._fromParams({providerId:bs.PROVIDER_ID,signInMethod:bs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return bs.credentialFromTaggedObject(e)}static credentialFromError(e){return bs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return bs.credential(t,n)}catch(e){return null}}}bs.GOOGLE_SIGN_IN_METHOD="google.com",bs.PROVIDER_ID="google.com";class Is extends ys{constructor(){super("github.com")}static credential(e){return ds._fromParams({providerId:Is.PROVIDER_ID,signInMethod:Is.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Is.credentialFromTaggedObject(e)}static credentialFromError(e){return Is.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Is.credential(e.oauthAccessToken)}catch(e){return null}}}Is.GITHUB_SIGN_IN_METHOD="github.com",Is.PROVIDER_ID="github.com";class Ts extends as{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return hs(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,hs(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,hs(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){var{providerId:e,signInMethod:t,pendingToken:n}="string"==typeof e?JSON.parse(e):e;return e&&t&&n&&e===t?new Ts(e,n):null}static _create(e,t){return new Ts(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Es extends vs{constructor(e){v(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return Es.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Es.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){e=Ts.fromJSON(e);return v(e,"argument-error"),e}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return Ts._create(n,t)}catch(e){return null}}}class ks extends ys{constructor(){super("twitter.com")}static credential(e,t){return ds._fromParams({providerId:ks.PROVIDER_ID,signInMethod:ks.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ks.credentialFromTaggedObject(e)}static credentialFromError(e){return ks.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return ks.credential(t,n)}catch(e){return null}}}async function Ss(e,t){return ki(e,"POST","/v1/accounts:signUp",Ii(e,t))}ks.TWITTER_SIGN_IN_METHOD="twitter.com",ks.PROVIDER_ID="twitter.com";class Cs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){e=await Ui._fromIdTokenResponse(e,n,r),r=As(n);return new Cs({user:e,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);var r=As(n);return new Cs({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function As(e){return e.providerId||("phoneNumber"in e?"phone":null)}class Ns extends ae{constructor(e,t,n,r){super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Ns.prototype),this.customData={appName:e.name,tenantId:null!=(r=e.tenantId)?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Ns(e,t,n,r)}}function Rs(t,n,e,r){const i="reauthenticate"===n?e._getReauthenticationResolver(t):e._getIdTokenResponse(t);return i.catch(e=>{if("auth/multi-factor-auth-required"===e.code)throw Ns._fromErrorAndOperation(t,e,n,r);throw e})}function xs(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function Ds(e,t,n=!1){t=await Di(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Cs._forOperation(e,"link",t)}async function Ps(e,t,n){await Mi(t);const r=xs(t.providerData);var i=!1===e?"provider-already-linked":"no-such-provider";v(r.has(n)===e,t.auth,i)}async function Os(e,t,n=!1){var r=e.auth,i="reauthenticate";try{var s=await Di(e,Rs(r,i,t,e),n),a=(v(s.idToken,r,"internal-error"),xi(s.idToken)),o=(v(a,r,"internal-error"),a.sub);return v(e.uid===o,r,"user-mismatch"),Cs._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&si(r,"user-mismatch"),e}}async function Ms(e,t,n=!1){t=await Rs(e,"signIn",t),t=await Cs._fromIdTokenResponse(e,"signIn",t);return n||await e._updateCurrentUser(t.user),t}async function Ls(e,t){return Ms(ns(e),t)}async function Fs(e,t){e=_(e);return await Ps(!1,e,t.providerId),Ds(e,t)}async function Us(e,t){return Os(_(e),t)}class qs{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Vs._fromServerResponse(e,t):si(e,"internal-error")}}class Vs extends qs{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Vs(t)}}function Bs(e,t,n){var r;v(0<(null==(r=n.url)?void 0:r.length),e,"invalid-continue-uri"),v(void 0===n.dynamicLinkDomain||0<n.dynamicLinkDomain.length,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(v(0<n.iOS.bundleId.length,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(v(0<n.android.packageName.length,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function js(e,t){var n=_(e),r=await os(n,{oobCode:t}),e=r.requestType;switch(v(e,n,"internal-error"),e){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":v(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":v(r.mfaInfo,n,"internal-error");default:v(r.email,n,"internal-error")}let i=null;return r.mfaInfo&&(i=qs._fromServerResponse(ns(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:i},operation:e}}async function Ks(e,t,n){var r=e.auth;const i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n),r=await Di(e,cs(r,i)),await e._updateTokensIfNecessary(r,!0)}class Ws{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class zs extends Ws{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Gs extends Ws{constructor(e,t){super(e,"facebook.com",t)}}class Hs extends zs{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class $s extends Ws{constructor(e,t){super(e,"google.com",t)}}class Qs extends zs{constructor(e,t,n){super(e,"twitter.com",t,n)}}class Ys{constructor(e,t,n){this.type=e,this.credential=t,this.auth=n}static _fromIdtoken(e,t){return new Ys("enroll",e,t)}static _fromMfaPendingCredential(e){return new Ys("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t;if(null!=e&&e.multiFactorSession){if(null!=(t=e.multiFactorSession)&&t.pendingCredential)return Ys._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!=(t=e.multiFactorSession)&&t.idToken)return Ys._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Js{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,r){const i=ns(e),s=r.customData._serverResponse;e=(s.mfaInfo||[]).map(e=>qs._fromServerResponse(i,e));v(s.mfaPendingCredential,i,"internal-error");const a=Ys._fromMfaPendingCredential(s.mfaPendingCredential);return new Js(a,e,async e=>{var e=await e._process(i,a),t=(delete s.mfaInfo,delete s.mfaPendingCredential,Object.assign(Object.assign({},s),{idToken:e.idToken,refreshToken:e.refreshToken}));switch(r.operationType){case"signIn":var n=await Cs._fromIdTokenResponse(i,r.operationType,t);return await i._updateCurrentUser(n.user),n;case"reauthenticate":return v(r.user,i,"internal-error"),Cs._forOperation(r.user,r.operationType,t);default:si(i,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class Xs{constructor(t){this.user=t,this.enrolledFactors=[],t._onReload(e=>{e.mfaInfo&&(this.enrolledFactors=e.mfaInfo.map(e=>qs._fromServerResponse(t.auth,e)))})}static _fromUser(e){return new Xs(e)}async getSession(){return Ys._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){const n=e;e=await this.getSession(),e=await Di(this.user,n._process(this.user.auth,e,t));return await this.user._updateTokensIfNecessary(e),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid;var n,r=await this.user.getIdToken(),r=await Di(this.user,Ti(n=this.user.auth,"POST","/v2/accounts/mfaEnrollment:withdraw",Ii(n,e={idToken:r,mfaEnrollmentId:t})));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(r);try{await this.user.reload()}catch(e){if("auth/user-token-expired"!==(null==e?void 0:e.code))throw e}}}const Zs=new WeakMap,ea="__sak";class ta{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ea,"1"),this.storage.removeItem(ea),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){e=this.storage.getItem(e);return Promise.resolve(e?JSON.parse(e):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class na extends ta{constructor(){var e;super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=(zi(e=W())||Ji(e))&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Xi(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){var t=this.storage.getItem(r),n=this.localCache[r];t!==n&&e(r,n,t)}}onStorageEvent(e,t=!1){if(e.key){const i=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){var n=this.storage.getItem(i);if(e.newValue!==n)null!==e.newValue?this.storage.setItem(i,e.newValue):this.storage.removeItem(i);else if(this.localCache[i]===e.newValue&&!t)return}var n=()=>{var e=this.storage.getItem(i);!t&&this.localCache[i]===e||this.notifyListeners(i,e)},r=this.storage.getItem(i);Q()&&10===document.documentMode&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}else this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)})}notifyListeners(e,t){this.localCache[e]=t;e=this.listeners[e];if(e)for(const n of Array.from(e))n(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){var t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}na.type="LOCAL";const ra=na;class ia extends ta{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ia.type="SESSION";const sa=ia;class aa{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){var e=this.receivers.find(e=>e.isListeningto(t));return e||(e=new aa(t),this.receivers.push(e),e)}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data;e=this.handlersMap[r];null!=e&&e.size&&(t.ports[0].postMessage({status:"ack",eventId:n,eventType:r}),e=Array.from(e).map(async e=>e(t.origin,i)),e=await Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})),t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:e}))}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function oa(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}aa.receivers=[];class ca{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,a=50){const o="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!o)throw new Error("connection_unavailable");let c,l;return new Promise((n,r)=>{const i=oa("",20),s=(o.port1.start(),setTimeout(()=>{r(new Error("unsupported_event"))},a));l={messageChannel:o,onMessage(e){var t=e;if(t.data.eventId===i)switch(t.data.status){case"ack":clearTimeout(s),c=setTimeout(()=>{r(new Error("timeout"))},3e3);break;case"done":clearTimeout(c),n(t.data.response);break;default:clearTimeout(s),clearTimeout(c),r(new Error("invalid_response"))}}},this.handlers.add(l),o.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:i,data:t},[o.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function la(){return window}function ua(){return void 0!==la().WorkerGlobalScope&&"function"==typeof la().importScripts}const ha="firebaseLocalStorageDb",da="firebaseLocalStorage";class pa{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function fa(e,t){return e.transaction([da],t?"readwrite":"readonly").objectStore(da)}function ga(){const r=indexedDB.open(ha,1);return new Promise((n,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const e=r.result;try{e.createObjectStore(da,{keyPath:"fbase_key"})}catch(e){t(e)}}),r.addEventListener("success",async()=>{const e=r.result;var t;e.objectStoreNames.contains(da)?n(e):(e.close(),t=indexedDB.deleteDatabase(ha),await new pa(t).toPromise(),n(await ga()))})})}async function ma(e,t,n){e=fa(e,!0).put({fbase_key:t,value:n});return new pa(e).toPromise()}function va(e,t){e=fa(e,!0).delete(t);return new pa(e).toPromise()}class ya{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await ga(),this.db)}async _withRetries(e){let t=0;for(;;)try{return e(await this._openDb())}catch(e){if(3<t++)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ua()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=aa._getInstance(ua()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>{const n=await this._poll();return{keyProcessed:n.includes(t.key)}}),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;this.activeServiceWorker=await async function(){if(null===navigator||void 0===navigator||!navigator.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),this.activeServiceWorker&&(this.sender=new ca(this.activeServiceWorker),(t=await this.sender._send("ping",{},800))&&null!=(e=t[0])&&e.fulfilled&&null!=(e=t[0])&&e.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0))}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;var e=await ga();return await ma(e,ea,"1"),await va(e,ea),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(t,n){return this._withPendingWrite(async()=>(await this._withRetries(e=>ma(e,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)))}async _get(e){var t=await this._withRetries(t=>async function(e){e=fa(t,!1).get(e);return void 0===(e=await new pa(e).toPromise())?null:e.value}(e));return this.localCache[e]=t}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>va(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){var e,t,n=await this._withRetries(e=>{e=fa(e,!1).getAll();return new pa(e).toPromise()});if(!n)return[];if(0!==this.pendingWrites)return[];const r=[],i=new Set;for({fbase_key:e,value:t}of n)i.add(e),JSON.stringify(this.localCache[e])!==JSON.stringify(t)&&(this.notifyListeners(e,t),r.push(e));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r}notifyListeners(e,t){this.localCache[e]=t;e=this.listeners[e];if(e)for(const n of Array.from(e))n(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}ya.type="LOCAL";const _a=ya;function wa(r){return new Promise((e,n)=>{const t=document.createElement("script");t.setAttribute("src",r),t.onload=e,t.onerror=e=>{const t=ai("internal-error");t.customData=e,n(t)},t.type="text/javascript",t.charset="UTF-8",(null!=(e=null==(e=document.getElementsByTagName("head"))?void 0:e[0])?e:document).appendChild(t)})}function ba(e){return"__"+e+Math.floor(1e6*Math.random())}class Ia{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){var n=this.counter;return this._widgets.set(n,new Ta(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t,e=e||1e12;null!=(t=this._widgets.get(e))&&t.delete(),this._widgets.delete(e)}getResponse(e){return(null==(e=this._widgets.get(e||1e12))?void 0:e.getResponse())||""}async execute(e){return null!=(e=this._widgets.get(e||1e12))&&e.execute(),""}}class Ta{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};n="string"==typeof e?document.getElementById(e):e;v(n,"argument-error",{appName:t}),this.container=n,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<50;e++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}();const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Ea=ba("rcb"),ka=new vi(3e4,6e4);class Sa{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null==(e=la().grecaptcha)||!e.render)}load(s,a=""){return v(a.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(a),s,"argument-error"),this.shouldResolveImmediately(a)?Promise.resolve(la().grecaptcha):new Promise((t,r)=>{const i=la().setTimeout(()=>{r(ai(s,"network-request-failed"))},ka.get());la()[Ea]=()=>{la().clearTimeout(i),delete la()[Ea];const e=la().grecaptcha;if(e){const n=e.render;e.render=(e,t)=>{e=n(e,t);return this.counter++,e},this.hostLanguage=a,t(e)}else r(ai(s,"internal-error"))},wa("https://www.google.com/recaptcha/api.js??"+ye({onload:Ea,render:"explicit",hl:a})).catch(()=>{clearTimeout(i),r(ai(s,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!(null==(t=la().grecaptcha)||!t.render)&&(e===this.hostLanguage||0<this.counter||this.librarySeparatelyLoaded)}}class Ca{async load(e){return new Ia(e)}clearedOneInstance(){}}const Aa="recaptcha",Na={theme:"light",type:"image"};class Ra{constructor(e,t=Object.assign({},Na),n){this.parameters=t,this.type=Aa,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ns(n),this.isInvisible="invisible"===this.parameters.size,v("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");t="string"==typeof e?document.getElementById(e):e;v(t,this.auth,"argument-error"),this.container=t,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=new(this.auth.settings.appVerificationDisabledForTesting?Ca:Sa),this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),r=this.getAssertedRecaptcha();return r.getResponse(e)||new Promise(t=>{const n=e=>{e&&(this.tokenChangeListeners.delete(n),t(e))};this.tokenChangeListeners.add(n),this.isInvisible&&r.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){v(!this.parameters.sitekey,this.auth,"argument-error"),v(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),v("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(n){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof n)n(t);else if("string"==typeof n){const e=la()[n];"function"==typeof e&&e(t)}}}assertNotDestroyed(){v(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;var t;this.isInvisible||(t=document.createElement("div"),e.appendChild(t),e=t),this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){v(gi()&&!ua(),this.auth,"internal-error"),await function(){let t=null;return new Promise(e=>{"complete"!==document.readyState?(t=()=>e(),window.addEventListener("load",t)):e()}).catch(e=>{throw t&&window.removeEventListener("load",t),e})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);var e=await((await Ti(this.auth,"GET","/v1/recaptchaParams")).recaptchaSiteKey||"");v(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return v(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class xa{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){e=fs._fromVerification(this.verificationId,e);return this.onConfirmation(e)}}async function Da(e,t,n){var r,i,s=await n.verify();try{if(v("string"==typeof s,e,"argument-error"),v(n.type===Aa,e,"argument-error"),"session"in(i="string"==typeof t?{phoneNumber:t}:t)){var a=i.session;if("phoneNumber"in i)return v("enroll"===a.type,e,"internal-error"),(await Ti(e,"POST","/v2/accounts/mfaEnrollment:start",Ii(e,{idToken:a.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}}))).phoneSessionInfo.sessionInfo;v("signin"===a.type,e,"internal-error");var o=(null==(r=i.multiFactorHint)?void 0:r.uid)||i.multiFactorUid;return v(o,e,"missing-multi-factor-info"),(await Ti(e,"POST","/v2/accounts/mfaSignIn:start",Ii(e,{mfaPendingCredential:a.credential,mfaEnrollmentId:o,phoneSignInInfo:{recaptchaToken:s}}))).phoneResponseInfo.sessionInfo}return(await Ti(e,"POST","/v1/accounts:sendVerificationCode",Ii(e,{phoneNumber:i.phoneNumber,recaptchaToken:s}))).sessionInfo}finally{n._reset()}}class Pa{constructor(e){this.providerId=Pa.PROVIDER_ID,this.auth=ns(e)}verifyPhoneNumber(e,t){return Da(this.auth,e,_(t))}static credential(e,t){return fs._fromVerification(e,t)}static credentialFromResult(e){return Pa.credentialFromTaggedObject(e)}static credentialFromError(e){return Pa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{phoneNumber:e,temporaryProof:t}=e;return e&&t?fs._fromTokenResponse(e,t):null}}function Oa(e,t){return t?pi(t):(v(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Pa.PROVIDER_ID="phone",Pa.PHONE_SIGN_IN_METHOD="phone";class Ma extends as{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return hs(e,this._buildIdpRequest())}_linkToIdToken(e,t){return hs(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return hs(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function La(e){return Ms(e.auth,new Ma(e),e.bypassAuthState)}function Fa(e){var{auth:t,user:n}=e;return v(n,t,"internal-error"),Os(n,new Ma(e),e.bypassAuthState)}async function Ua(e){var{auth:t,user:n}=e;return v(n,t,"internal-error"),Ds(n,new Ma(e),e.bypassAuthState)}class qa{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){var{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:a}=e;if(s)this.reject(s);else{r={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(r))}catch(e){this.reject(e)}}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return La;case"linkViaPopup":case"linkViaRedirect":return Ua;case"reauthViaPopup":case"reauthViaRedirect":return Fa;default:si(this.auth,"internal-error")}}resolve(e){hi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){hi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Va=new vi(2e3,1e4);class Ba extends qa{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Ba.currentPopupAction&&Ba.currentPopupAction.cancel(),Ba.currentPopupAction=this}async executeNotNull(){var e=await this.execute();return v(e,this.auth,"internal-error"),e}async onExecution(){hi(1===this.filter.length,"Popup operations only handle one event");var e=oa();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(ai(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(ai(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ba.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e;null!=(e=null==(e=this.authWindow)?void 0:e.window)&&e.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ai(this.auth,"popup-closed-by-user"))},2e3):this.pollId=window.setTimeout(t,Va.get())};t()}}Ba.currentPopupAction=null;const ja="pendingRedirect",Ka=new Map;class Wa extends qa{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let t=Ka.get(this.auth._key());if(!t){try{const e=await async function(e,t){const n=$a(t),r=Ha(e);if(!await r._isAvailable())return!1;t="true"===await r._get(n);return await r._remove(n),t}(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(e)}catch(e){t=()=>Promise.reject(e)}Ka.set(this.auth._key(),t)}return this.bypassAuthState||Ka.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){var t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function za(e,t){return Ha(e)._set($a(t),"true")}function Ga(e,t){Ka.set(e._key(),t)}function Ha(e){return pi(e._redirectPersistence)}function $a(e){return Bi(ja,e.config.apiKey,e.name)}async function Qa(e,t,n=!1){const r=ns(e);e=Oa(r,t);const i=new Wa(r,e,n),s=await i.execute();return s&&!n&&(delete s.user._redirectEventId,await r._persistUserIfCurrent(s.user),await r._setRedirectUser(null,t)),s}async function Ya(e){var t=oa(e.uid+":::");return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class Ja{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let n=!1;return this.consumers.forEach(e=>{this.isEventForConsumer(t,e)&&(n=!0,this.sendToConsumer(t,e),this.saveEventToCache(t))}),!this.hasHandledPotentialRedirect&&function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return 1;case"unknown":return Za(e);default:return}}(t)&&(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=t,n=!0)),n}sendToConsumer(e,t){var n;e.error&&!Za(e)?(n=(null==(n=e.error.code)?void 0:n.split("auth/")[1])||"internal-error",t.onError(ai(this.auth,n))):t.onAuthEvent(e)}isEventForConsumer(e,t){var n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return 6e5<=Date.now()-this.lastProcessedEventTime&&this.cachedEventUids.clear(),this.cachedEventUids.has(Xa(e))}saveEventToCache(e){this.cachedEventUids.add(Xa(e)),this.lastProcessedEventTime=Date.now()}}function Xa(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Za({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function eo(e,t={}){return Ti(e,"GET","/v1/projects",t)}const to=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,no=/^https?/;const ro=new vi(3e4,6e4);function io(){const t=la().___jsl;if(null!==t&&void 0!==t&&t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let so=null;const ao=new vi(5e3,15e3),oo={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},co=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function lo(a){t=a;const e=await(so=so||(i=t,new Promise((e,t)=>{function n(){io(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{io(),t(ai(i,"network-request-failed"))},timeout:ro.get()})}if(null!=(r=null==(r=la().gapi)?void 0:r.iframes)&&r.Iframe)e(gapi.iframes.getContext());else{var r;if(null==(r=la().gapi)||!r.load)return r=ba("iframefcb"),la()[r]=()=>{gapi.load?n():t(ai(i,"network-request-failed"))},wa("https://apis.google.com/js/api.js?onload="+r).catch(e=>t(e));n()}}).catch(e=>{throw so=null,e})));var i,t=la().gapi;return v(t,a,"internal-error"),e.open({where:document.body,url:function(e){var t=e.config,n=(v(t.authDomain,e,"auth-domain-config-required"),t.emulator?yi(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`);const r={apiKey:t.apiKey,appName:e.name,v:bt},i=((t=co.get(e.config.apiHost))&&(r.eid=t),e._getFrameworks());return i.length&&(r.fw=i.join(",")),n+"?"+ye(r).slice(1)}(a),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:oo,dontclear:!0},s=>new Promise(async(e,t)=>{await s.restyle({setHideOnLeave:!1});const n=ai(a,"network-request-failed"),r=la().setTimeout(()=>{t(n)},ao.get());function i(){la().clearTimeout(r),e(s)}s.ping(i).then(i,()=>{t(n)})}))}const uo={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class ho{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function po(e,t,n,r,i,s){v(e.config.authDomain,e,"auth-domain-config-required"),v(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:bt,eventId:i};if(t instanceof vs){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",fe(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(var[o,c]of Object.entries(s||{}))a[o]=c}if(t instanceof ys){const u=t.getScopes().filter(e=>""!==e);0<u.length&&(a.scopes=u.join(","))}e.tenantId&&(a.tid=e.tenantId);const l=a;for(const h of Object.keys(l))void 0===l[h]&&delete l[h];return`${e=e.config,e.emulator?yi(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}?`+ye(l).slice(1)}const fo="webStorageSupport",go=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=sa,this._completeRedirectFn=Qa,this._overrideRedirectResult=Ga}async _openPopup(t,n,r,i){hi(null==(a=this.eventManagers[t._key()])?void 0:a.manager,"_initialize() not called before _openPopup()");{var[s,a,t,n=500,r=600]=[t,po(t,n,r,fi(),i),oa()],i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let e="";const c=Object.assign(Object.assign({},uo),{width:n.toString(),height:r.toString(),top:i,left:o});if(i=W().toLowerCase(),t&&(e=Gi(i)?"_blank":t),Wi(i)&&(a=a||"http://localhost",c.scrollbars="yes"),o=Object.entries(c).reduce((e,[t,n])=>""+e+t+`=${n},`,""),[t=W()]=[i],Ji(t)&&null!=(n=window.navigator)&&n.standalone&&"_self"!==e){{r=a||"";i=e;const u=document.createElement("a"),h=(u.href=r,u.target=i,document.createEvent("MouseEvent"));h.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),u.dispatchEvent(h)}return new ho(null)}const l=window.open(a||"",e,o);v(l,s,"popup-blocked");try{l.focus()}catch(s){}return new ho(l)}}async _openRedirect(e,t,n,r){return await this._originValidation(e),r=po(e,t,n,fi(),r),la().location.href=r,new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:n}=this.eventManagers[t];return r?Promise.resolve(r):(hi(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(t){const e=await lo(t),n=new Ja(t);return e.register("authEvent",e=>(v(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,n){const e=this.iframes[t._key()];e.send(fo,{type:fo},e=>{e=null==(e=null==e?void 0:e[0])?void 0:e[fo];void 0!==e&&n(!!e),si(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(!e.config.emulator){for(const t of(await eo(e)).authorizedDomains)try{if(function(e){const t=fi(),{protocol:n,hostname:r}=new URL(t);var i;if(e.startsWith("chrome-extension://"))return""===(i=new URL(e)).hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r;if(no.test(n)){if(to.test(e))return r===e;const s=e.replace(/\./g,"\\."),a=new RegExp("^(.+\\."+s+"|"+s+")$","i");return a.test(r)}}(t))return}catch(e){}si(e,"unauthorized-domain")}}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Xi()||zi()||Ji()}};class mo extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return ui("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new mo(e)}_finalizeEnroll(e,t,n){return Ti(e,"POST","/v2/accounts/mfaEnrollment:finalize",Ii(e,n={idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}_finalizeSignIn(e,t){return Ti(e,"POST","/v2/accounts/mfaSignIn:finalize",Ii(e,t={mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}}class vo{constructor(){}static assertion(e){return mo._fromCredential(e)}}vo.FACTOR_ID="phone";var yo,Hn="@firebase/auth",_o="0.21.0-20221206221533";class wo{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(t){var e;this.assertAuthConfigured(),this.internalListeners.has(t)||(e=this.auth.onIdTokenChanged(e=>{t((null==e?void 0:e.stsTokenManager.accessToken)||null)}),this.internalListeners.set(t,e),this.updateProactiveRefresh())}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){v(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){0<this.internalListeners.size?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function bo(){return window}null!=(ic=te())&&ic._authIdTokenMaxAge,yo="Browser",vt(new o("auth",(e,{options:t})=>{var n=e.getProvider("app").getImmediate(),e=e.getProvider("heartbeat");const{apiKey:r,authDomain:i}=n.options;v(r&&!r.includes(":"),"invalid-api-key",{appName:n.name}),v(!(null!==i&&void 0!==i&&i.includes(":")),"argument-error",{appName:n.name});var s={apiKey:r,authDomain:i,clientPlatform:yo,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Zi(yo)},s=new ts(n,e,s);{n=s;const a=(null==(e=t)?void 0:e.persistence)||[];t=(Array.isArray(a)?a:[a]).map(pi);null!=e&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(t,null==e?void 0:e.popupRedirectResolver)}return s},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{const r=e.getProvider("auth-internal");r.initialize()})),vt(new o("auth-internal",e=>{return e=ns(e.getProvider("auth").getImmediate()),new wo(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),r(Hn,_o,void 0),r(Hn,_o,"esm2017");class Io extends Ja{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(t){return this.resolveInialized(),this.passiveListeners.forEach(e=>e(t)),super.onEvent(t)}async initialized(){await this.initPromise}}async function To(e){var t=await Eo()._get(ko(e));return t&&await Eo()._remove(ko(e)),t}function Eo(){return pi(ra)}function ko(e){return Bi("authEvent",e.config.apiKey,e.name)}function So(e){if(null==e||!e.includes("?"))return{};const[,...t]=e.split("?");return _e(t.join("?"))}const Co=class{constructor(){this._redirectPersistence=sa,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Qa,this._overrideRedirectResult=Ga}async _initialize(e){var t=e._key();let n=this.eventManagers.get(t);return n||(n=new Io(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){si(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){var i=e;v("function"==typeof(null==(a=null==(c=bo())?void 0:c.universalLinks)?void 0:a.subscribe),i,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),v(void 0!==(null==(a=null==c?void 0:c.BuildInfo)?void 0:a.packageName),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),v("function"==typeof(null==(a=null==(a=null==(a=null==c?void 0:c.cordova)?void 0:a.plugins)?void 0:a.browsertab)?void 0:a.openUrl),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),v("function"==typeof(null==(a=null==(a=null==(a=null==c?void 0:c.cordova)?void 0:a.plugins)?void 0:a.browsertab)?void 0:a.isAvailable),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),v("function"==typeof(null==(c=null==(c=null==c?void 0:c.cordova)?void 0:c.InAppBrowser)?void 0:c.open),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"});const s=await this._initialize(e);await s.initialized(),s.resetRedirect(),Ka.clear(),await this._originValidation(e);[a,i,o=null]=[e,n,r];var a,o,c={type:i,eventId:o,urlResponse:null,sessionId:function(){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<20;e++){var r=Math.floor(Math.random()*n.length);t.push(n.charAt(r))}return t.join("")}(),postBody:null,tenantId:a.tenantId,error:ai(a,"no-auth-event")};return n=e,r=c,await Eo()._set(ko(n),r),c=await function(r){const i=bo().cordova;return new Promise(n=>{i.plugins.browsertab.isAvailable(e=>{let t=null;e?i.plugins.browsertab.openUrl(r):t=i.InAppBrowser.open(r,(e=W(),/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)?"_blank":"_system"),"location=yes"),n(t)})})}(await async function(e,t,n){var r=bo().BuildInfo,i=(hi(t.sessionId,"AuthEvent did not contain a session ID"),await async function(e){const t=function(t){if(hi(/[0-9a-zA-Z]+/.test(t),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(t);const e=new ArrayBuffer(t.length),n=new Uint8Array(e);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(e),n=await crypto.subtle.digest("SHA-256",t),r=Array.from(new Uint8Array(n));return r.map(e=>e.toString(16).padStart(2,"0")).join("")}(t.sessionId));const s={};return Ji()?s.ibi=r.packageName:$i()?s.apn=r.packageName:si(e,"operation-not-supported-in-this-environment"),r.displayName&&(s.appDisplayName=r.displayName),s.sessionId=i,po(e,n,t.type,void 0,null!=(i=t.eventId)?i:void 0,s)}(e,c,t)),async function(a,o,c){const l=bo().cordova;let u=()=>{};try{await new Promise((n,e)=>{let t=null;function r(){var e;n();const t=null==(e=l.plugins.browsertab)?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==c?void 0:c.close)&&c.close()}function i(){t=t||window.setTimeout(()=>{e(ai(a,"redirect-cancelled-by-user"))},2e3)}function s(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&i()}o.addPassiveListener(r),document.addEventListener("resume",i,!1),$i()&&document.addEventListener("visibilitychange",s,!1),u=()=>{o.removePassiveListener(r),document.removeEventListener("resume",i,!1),document.removeEventListener("visibilitychange",s,!1),t&&window.clearTimeout(t)}})}finally{u()}}(e,s,c)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){var t=bo().BuildInfo;const n={};Ji()?n.iosBundleId=t.packageName:$i()?n.androidPackageName=t.packageName:si(e,"operation-not-supported-in-this-environment"),await eo(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(r,i){const{universalLinks:e,handleOpenURL:t,BuildInfo:n}=bo(),s=setTimeout(async()=>{await To(r),i.onEvent(Ao())},500),a=async e=>{clearTimeout(s);var t=await To(r);let n=null;t&&null!=e&&e.url&&(n=function(e,t){var n,r,i,s;n=So(t),r=So(s=n.link?decodeURIComponent(n.link):void 0).link;const a=(n=So(i=n.deep_link_id?decodeURIComponent(n.deep_link_id):void 0).link)||i||r||s||t;return a.includes("/__/auth/callback")?(s=(s=null==(s=null==(s=null==(s=(s=So(a)).firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(s.firebaseError)):null)?void 0:s.code)?void 0:s.split("auth/"))?void 0:s[1])?ai(s):null)?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:s,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:a,postBody:null}:null}(t,e.url)),i.onEvent(n||Ao())},o=(void 0!==e&&"function"==typeof e.subscribe&&e.subscribe(null,a),t),c=n.packageName.toLowerCase()+"://";bo().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&a({url:e}),"function"==typeof o)try{o(e)}catch(e){console.error(e)}}}};function Ao(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:ai("no-auth-event")}}function No(){var e;return(null==(e=null===self||void 0===self?void 0:self.location)?void 0:e.protocol)||null}function Ro(e=W()){return!("file:"!==No()&&"ionic:"!==No()&&"capacitor:"!==No()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function xo(){try{const n=self.localStorage;var e=oa();if(n)return n.setItem(e,"1"),n.removeItem(e),t=W(),!(Q()&&11===(null===document||void 0===document?void 0:document.documentMode)||([t=W()]=[t],/Edge\/\d+/.test(t)))||J()}catch(e){return Do()&&J()}var t;return!1}function Do(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function Po(){return("http:"===No()||"https:"===No()||H()||Ro())&&!($()||G())&&xo()&&!Do()}function Oo(){return Ro()&&"undefined"!=typeof document}const Mo={LOCAL:"local",NONE:"none",SESSION:"session"},Lo=v,Fo="persistence";async function Uo(e){await e._initializationPromise;const t=qo();var n=Bi(Fo,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function qo(){var e;try{return(null===(e="undefined"!=typeof window?window:null)?void 0:e.sessionStorage)||null}catch(e){return null}}const Vo=v;class Bo{constructor(){this.browserResolver=pi(go),this.cordovaResolver=pi(Co),this.underlyingResolver=null,this._redirectPersistence=sa,this._completeRedirectFn=Qa,this._overrideRedirectResult=Ga}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Oo()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Vo(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){var e;this.underlyingResolver||(e=await(!!Oo()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})),this.underlyingResolver=e?this.cordovaResolver:this.browserResolver)}}function jo(e){return e.unwrap()}function Ko(e){var t=(e instanceof ae?e.customData:e)._tokenResponse;if(!t)return null;if(!(e instanceof ae)&&"temporaryProof"in t&&"phoneNumber"in t)return Pa.credentialFromResult(e);const n=t.providerId;if(!n||n===Gr.PASSWORD)return null;let r;switch(n){case Gr.GOOGLE:r=bs;break;case Gr.FACEBOOK:r=ws;break;case Gr.GITHUB:r=Is;break;case Gr.TWITTER:r=ks;break;default:var{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:a,pendingToken:o,nonce:c}=t;return s||a||i||o?o?n.startsWith("saml.")?Ts._create(n,o):ds._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:i,accessToken:s}):new _s(n).credential({idToken:i,accessToken:s,rawNonce:c}):null}return e instanceof ae?r.credentialFromError(e):r.credentialFromResult(e)}function Wo(t,e){return e.catch(e=>{throw e instanceof ae&&function(e,t){var n,r=null==(n=t.customData)?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===(null==t?void 0:t.code)){const s=t;s.resolver=new Go(e,(e=_(e),v((i=t).customData.operationType,e,"argument-error"),v(null==(n=i.customData._serverResponse)?void 0:n.mfaPendingCredential,e,"argument-error"),Js._fromError(e,i)))}else if(r){var i=Ko(t);const a=t;i&&(a.credential=i,a.tenantId=r.tenantId||void 0,a.email=r.email||void 0,a.phoneNumber=r.phoneNumber||void 0)}}(t,e),e}).then(e=>{var t=e.operationType,n=e.user;return{operationType:t,credential:Ko(e),additionalUserInfo:function(e){var{user:e,_tokenResponse:t}=e;if(e.isAnonymous&&!t)return{providerId:null,isNewUser:!1,profile:null};var n=t;if(!n)return null;var r=n.providerId,i=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},s=n.isNewUser||"identitytoolkit#SignupNewUserResponse"===n.kind;if(!r&&null!=n&&n.idToken){e=null==(e=null==(e=xi(n.idToken))?void 0:e.firebase)?void 0:e.sign_in_provider;if(e)return e="anonymous"!==e&&"custom"!==e?e:null,new Ws(s,e)}if(!r)return null;switch(r){case"facebook.com":return new Gs(s,i);case"github.com":return new Hs(s,i);case"google.com":return new $s(s,i);case"twitter.com":return new Qs(s,i,n.screenName||null);case"custom":case"anonymous":return new Ws(s,null);default:return new Ws(s,r,i)}}(e),user:Ho.getOrCreate(n)}})}async function zo(t,e){const n=await e;return{verificationId:n.verificationId,confirm:e=>Wo(t,n.confirm(e))}}class Go{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Wo(jo(this.auth),this.resolver.resolveSignIn(e))}}class Ho{constructor(e){this._delegate=e,this.multiFactor=(e=_(e),Zs.has(e)||Zs.set(e,Xs._fromUser(e)),Zs.get(e))}static getOrCreate(e){return Ho.USER_MAP.has(e)||Ho.USER_MAP.set(e,new Ho(e)),Ho.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Wo(this.auth,Fs(this._delegate,e))}async linkWithPhoneNumber(e,t){return zo(this.auth,async function(e,t,n){const r=_(e);await Ps(!1,r,"phone");e=await Da(r.auth,t,_(n));return new xa(e,e=>Fs(r,e))}(this._delegate,e,t))}async linkWithPopup(e){return Wo(this.auth,async function(e,t,n){e=_(e),ci(e.auth,t,vs),n=Oa(e.auth,n);const r=new Ba(e.auth,"linkViaPopup",t,n,e);return r.executeNotNull()}(this._delegate,e,Bo))}async linkWithRedirect(e){return await Uo(ns(this.auth)),i=this._delegate,e=e,t=Bo,async function(e,t){var n=_(i);ci(n.auth,e,vs);const r=Oa(n.auth,t);await Ps(!1,n,e.providerId),await za(r,n.auth);t=await Ya(n);return r._openRedirect(n.auth,e,"linkViaRedirect",t)}(e,t);var i,t}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Wo(this.auth,Us(this._delegate,e))}reauthenticateWithPhoneNumber(n,r){return zo(this.auth,async function(e){const t=_(e);e=await Da(t.auth,n,_(r));return new xa(e,e=>Us(t,e))}(this._delegate))}reauthenticateWithPopup(e){return Wo(this.auth,async function(e,t,n){e=_(e),ci(e.auth,t,vs),n=Oa(e.auth,n);const r=new Ba(e.auth,"reauthViaPopup",t,n,e);return r.executeNotNull()}(this._delegate,e,Bo))}async reauthenticateWithRedirect(e){return await Uo(ns(this.auth)),i=this._delegate,e=e,t=Bo,async function(e,t){var n=_(i);ci(n.auth,e,vs);const r=Oa(n.auth,t);await za(r,n.auth);t=await Ya(n);return r._openRedirect(n.auth,e,"reauthViaRedirect",t)}(e,t);var i,t}sendEmailVerification(e){return async function(e,t){var n=_(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&Bs(n.auth,r,t),(r=(await ls(n.auth,r)).email)!==e.email&&await e.reload()}(this._delegate,e)}async unlink(e){return await async function(e,t){const n=_(e),r=(await Ps(!0,n,t),xs((await Ti(e=n.auth,"POST","/v1/accounts:update",t={idToken:await n.getIdToken(),deleteProvider:[t]})).providerUserInfo||[]));return n.providerData=n.providerData.filter(e=>r.has(e.providerId)),r.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}(this._delegate,e),this}updateEmail(e){return Ks(_(this._delegate),e,null)}updatePassword(e){return Ks(_(this._delegate),null,e)}updatePhoneNumber(t){return async function(e){await Ds(_(e),t)}(this._delegate)}updateProfile(e){return async function(e,{displayName:t,photoURL:n}){if(void 0!==t||void 0!==n){const i=_(e);var r=await i.getIdToken(),r=await Di(i,async function(e){return Ti(e,"POST","/v1/accounts:update",{idToken:r,displayName:t,photoUrl:n,returnSecureToken:!0})}(i.auth));i.displayName=r.displayName||null,i.photoURL=r.photoUrl||null;const s=i.providerData.find(({providerId:e})=>"password"===e);s&&(s.displayName=i.displayName,s.photoURL=i.photoURL),await i._updateTokensIfNecessary(r)}}(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return async function(e,t,n){var r=_(e),t={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&Bs(r.auth,t,n),(t=(await ls(r.auth,t)).email)!==e.email&&await e.reload()}(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Ho.USER_MAP=new WeakMap;const $o=v;class Qo{constructor(n,e){if(this.app=n,e.isInitialized())return this._delegate=e.getImmediate(),void this.linkUnderlyingAuth();var r=n.options.apiKey,t=($o(r,"invalid-api-key",{appName:n.name}),$o(r,"invalid-api-key",{appName:n.name}),"undefined"!=typeof window?Bo:void 0);this._delegate=e.initialize({options:{persistence:function(){const e=function(e,t){const n=qo();if(!n)return[];e=Bi(Fo,e,t);switch(n.getItem(e)){case Mo.NONE:return[Vi];case Mo.LOCAL:return[_a,sa];case Mo.SESSION:return[sa];default:return[]}}(r,n.name);if("undefined"==typeof self||e.includes(_a)||e.push(_a),"undefined"!=typeof window)for(const t of[ra,sa])e.includes(t)||e.push(t);return e.includes(Vi)||e.push(Vi),e}(),popupRedirectResolver:t}}),this._delegate._updateErrorMap(ei),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Ho.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){{var n=this._delegate;const i=ns(n),s=(v(i._canInitEmulator,i,"emulator-config-failed"),v(/^https?:\/\//.test(e),i,"invalid-emulator-scheme"),n=!(null==t||!t.disableWarnings),is(e));var{host:t,port:e}=function(e){const t=is(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i)return{host:s=i[1],port:ss(r.substr(s.length+1))};var[e,s]=r.split(":");return{host:e,port:ss(s)}}(e);function r(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}return i.config.emulator={url:s+`//${t}${null===e?"":":"+e}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:t,port:e,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:n})}),void(n||("undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",r):r())))}}applyActionCode(e){return async function(e,t){await Ti(e=_(e),"POST","/v1/accounts:update",Ii(e,{oobCode:t}))}(this._delegate,e)}checkActionCode(e){return js(this._delegate,e)}confirmPasswordReset(t,n){return async function(e){await os(_(e),{oobCode:t,newPassword:n})}(this._delegate)}async createUserWithEmailAndPassword(n,r){return Wo(this._delegate,async function(e){const t=ns(e);e=await Ss(t,{returnSecureToken:!0,email:n,password:r}),e=await Cs._fromIdTokenResponse(t,"signIn",e);return await t._updateCurrentUser(e.user),e}(this._delegate))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return async function(e,t){var n=gi()?fi():"http://localhost";return(await Ti(e=_(e),"POST","/v1/accounts:createAuthUri",Ii(e,{identifier:t,continueUri:n}))).signinMethods||[]}(this._delegate,e)}isSignInWithEmailLink(e){return this._delegate,"EMAIL_SIGNIN"===(null==(e=gs.parseLink(e))?void 0:e.operation)}async getRedirectResult(){$o(Po(),this._delegate,"operation-not-supported-in-this-environment");t=this._delegate,e=Bo,await ns(t)._initializationPromise;var e,t=await Qa(t,e,!1);return t?Wo(this._delegate,Promise.resolve(t)):{credential:null,user:null}}addFrameworkForLogging(e){ns(this._delegate)._logFramework(e)}onAuthStateChanged(e,t,n){var{next:e,error:t,complete:n}=Yo(e,t,n);return this._delegate.onAuthStateChanged(e,t,n)}onIdTokenChanged(e,t,n){var{next:e,error:t,complete:n}=Yo(e,t,n);return this._delegate.onIdTokenChanged(e,t,n)}sendSignInLinkToEmail(e,t){return async function(e,t,n){e=_(e),t={requestType:"EMAIL_SIGNIN",email:t},v(n.handleCodeInApp,e,"argument-error"),n&&Bs(e,t,n),await ls(e,t)}(this._delegate,e,t)}sendPasswordResetEmail(e,t){return async function(e,t,n){e=_(e),t={requestType:"PASSWORD_RESET",email:t},n&&Bs(e,t,n),await ls(e,t)}(this._delegate,e,t||void 0)}async setPersistence(e){var t=this._delegate,n=e;Lo(Object.values(Mo).includes(n),t,"invalid-persistence-type"),$()?Lo(n!==Mo.SESSION,t,"unsupported-persistence-type"):G()?Lo(n===Mo.NONE,t,"unsupported-persistence-type"):Do()?Lo(n===Mo.NONE||n===Mo.LOCAL&&J(),t,"unsupported-persistence-type"):Lo(n===Mo.NONE||xo(),t,"unsupported-persistence-type");let r;switch(e){case Mo.SESSION:r=sa;break;case Mo.LOCAL:var i=await pi(_a)._isAvailable();r=i?_a:ra;break;case Mo.NONE:r=Vi;break;default:return si("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(r)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Wo(this._delegate,async function(e){const t=ns(e);if(await t._initializationPromise,null!=(e=t.currentUser)&&e.isAnonymous)return new Cs({user:t.currentUser,providerId:null,operationType:"signIn"});e=await Ss(t,{returnSecureToken:!0}),e=await Cs._fromIdTokenResponse(t,"signIn",e,!0);return await t._updateCurrentUser(e.user),e}(this._delegate))}signInWithCredential(e){return Wo(this._delegate,Ls(this._delegate,e))}signInWithCustomToken(e){return Wo(this._delegate,async function(e,t){const n=ns(e);return e=await ki(n,"POST","/v1/accounts:signInWithCustomToken",Ii(n,{token:t,returnSecureToken:!0})),e=await Cs._fromIdTokenResponse(n,"signIn",e),await n._updateCurrentUser(e.user),e}(this._delegate,e))}signInWithEmailAndPassword(e,t){return Wo(this._delegate,Ls(_(this._delegate),ms.credential(e,t)))}signInWithEmailLink(e,t){return Wo(this._delegate,async function(e,t,n){e=_(e),t=ms.credentialWithLink(t,n||fi());return v(t._tenantId===(e.tenantId||null),e,"tenant-id-mismatch"),Ls(e,t)}(this._delegate,e,t))}signInWithPhoneNumber(n,r){return zo(this._delegate,async function(e){const t=ns(e);e=await Da(t,n,_(r));return new xa(e,e=>Ls(t,e))}(this._delegate))}async signInWithPopup(e){return $o(Po(),this._delegate,"operation-not-supported-in-this-environment"),Wo(this._delegate,async function(e,t,n){var r=ns(e),e=(ci(e,t,vs),Oa(r,n));const i=new Ba(r,"signInViaPopup",t,e);return i.executeNotNull()}(this._delegate,e,Bo))}async signInWithRedirect(e){return $o(Po(),this._delegate,"operation-not-supported-in-this-environment"),await Uo(this._delegate),i=this._delegate,e=e,t=Bo,async function(e,t){var n=ns(i);ci(i,e,vs);const r=Oa(n,t);return await za(r,n),r._openRedirect(n,e,"signInViaRedirect")}(e,t);var i,t}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(t){return async function(e){return(await js(_(e),t)).data.email}(this._delegate)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function Yo(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&Ho.getOrCreate(e)),error:t,complete:n}}Qo.Persistence=Mo;class Jo{constructor(){this.providerId="phone",this._delegate=new Pa(jo(Vt.auth()))}static credential(e,t){return Pa.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Jo.PHONE_SIGN_IN_METHOD=Pa.PHONE_SIGN_IN_METHOD,Jo.PROVIDER_ID=Pa.PROVIDER_ID;const Xo=v;(ic=Vt).INTERNAL.registerComponent(new o("auth-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("auth");return new Qo(t,e)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Hr,PASSWORD_RESET:$r,RECOVER_EMAIL:Qr,REVERT_SECOND_FACTOR_ADDITION:Yr,VERIFY_AND_CHANGE_EMAIL:Jr,VERIFY_EMAIL:Xr}},EmailAuthProvider:ms,FacebookAuthProvider:ws,GithubAuthProvider:Is,GoogleAuthProvider:bs,OAuthProvider:_s,SAMLAuthProvider:Es,PhoneAuthProvider:Jo,PhoneMultiFactorGenerator:vo,RecaptchaVerifier:class{constructor(e,t,n=Vt.app()){var r;Xo(null==(r=n.options)?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new Ra(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}},TwitterAuthProvider:ks,Auth:Qo,AuthCredential:as,Error:ae}).setInstantiationMode("LAZY").setMultipleInstances(!1)),ic.registerVersion("@firebase/auth-compat","0.3.0-20221206221533");Hn="@firebase/database",_o="0.14.0-20221206221533";let Zo="";function ec(e){Zo=e}class tc{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ue(t))}get(e){e=this.domStorage_.getItem(this.prefixedName_(e));return null==e?null:le(e)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class nc{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return de(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}var rc,ic=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new tc(t)}}catch(e){}return new nc};function sc(e){e=function(n){const r=[];let i=0;for(let t=0;t<n.length;t++){let e=n.charCodeAt(t);var s,a;55296<=e&&e<=56319&&(s=e-55296,t++,y(t<n.length,"Surrogate pair missing trail surrogate."),a=n.charCodeAt(t)-56320,e=65536+(s<<10)+a),e<128?r[i++]=e:(e<2048?r[i++]=e>>6|192:(e<65536?r[i++]=e>>12|224:(r[i++]=e>>18|240,r[i++]=e>>12&63|128),r[i++]=e>>6&63|128),r[i++]=63&e|128)}return r}(e);const t=new be;return t.update(e),e=t.digest(),a.encodeByteArray(e)}const ac=ic("localStorage"),oc=ic("sessionStorage"),cc=new je("@firebase/database"),lc=function(){let e=1;return function(){return e++}}(),uc=function(...t){let n="";for(let e=0;e<t.length;e++){var r=t[e];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?n+=uc.apply(null,r):n+="object"==typeof r?ue(r):r,n+=" "}return n};let hc=null,dc=!0;function pc(t){return function(...e){wc(t,...e)}}function fc(...e){e="FIREBASE INTERNAL ERROR: "+uc(...e);cc.error(e)}function gc(e,t){return e===t?0:e<t?-1:1}function mc(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+ue(t))}function vc(t){if("object"!=typeof t||null===t)return ue(t);const n=[];for(const e in t)n.push(e);n.sort();let r="{";for(let e=0;e<n.length;e++)0!==e&&(r+=","),r=(r=r+ue(n[e])+":")+vc(t[n[e]]);return r+="}"}function yc(t,n){var r=t.length;if(r<=n)return[t];const i=[];for(let e=0;e<r;e+=n)e+n>r?i.push(t.substring(e,r)):i.push(t.substring(e,e+n));return i}function _c(e,t){y(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(cc.logLevel=h.VERBOSE,hc=cc.log.bind(cc),t&&oc.set("logging_enabled",!0)):"function"==typeof e?hc=e:(hc=null,oc.remove("logging_enabled"))}const wc=function(...e){!0===dc&&(dc=!1,null===hc&&!0===oc.get("logging_enabled")&&_c(!0)),hc&&(e=uc.apply(null,e),hc(e))},bc=function(...e){e="FIREBASE FATAL ERROR: "+uc(...e);throw cc.error(e),new Error(e)},Ic=function(...e){e="FIREBASE WARNING: "+uc(...e);cc.warn(e)},Tc=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Ic("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Ec=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},kc="[MIN_NAME]",Sc="[MAX_NAME]",Cc=function(e,t){if(e===t)return 0;if(e===kc||t===Sc)return-1;if(t===kc||e===Sc)return 1;var n=Rc(e),r=Rc(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null===r&&e<t?-1:1};function Ac(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}function Nc(e){y(!Ec(e),"Invalid JSON number");let t,n,r,i,s;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,e=Math.abs(e),r=e>=Math.pow(2,-1022)?(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=i+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(e/Math.pow(2,-1074))));const a=[];for(s=52;s;--s)a.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;--s)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse();const o=a.join("");let c="";for(s=0;s<64;s+=8){let e=parseInt(o.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()}function Rc(e){if(Dc.test(e)){e=Number(e);if(e>=Pc&&e<=Oc)return e}return null}function xc(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n}const Dc=new RegExp("^-?(0*)\\d{1,10}$"),Pc=-2147483648,Oc=2147483647,Mc=function(e){try{e()}catch(t){setTimeout(()=>{var e=t.stack||"";throw Ic("Exception was thrown by user callback.",e),t},Math.floor(0))}};class Lc{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null!=t&&t.get().then(e=>this.appCheck=e)}getToken(n){return this.appCheck?this.appCheck.getToken(n):new Promise((e,t)=>{setTimeout(()=>{this.appCheck?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){var e;null!=(e=this.appCheckProvider)&&e.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){Ic(`Provided AppCheck credentials for the app named "${this.appName_}" `+"are invalid. This usually indicates your app was not initialized correctly.")}}class Fc{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(n){return this.auth_?this.auth_.getToken(n).catch(e=>e&&"auth/token-not-initialized"===e.code?(wc("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,t)=>{setTimeout(()=>{this.auth_?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ic(e)}}class Uc{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Uc.OWNER="owner";const qc=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Vc="websocket",Bc="long_polling";class jc{constructor(e,t,n,r,i=!1,s="",a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ac.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ac.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return e+this.host+"/"+t}}function Kc(e,t,n){y("string"==typeof t,"typeof type must == string"),y("object"==typeof n,"typeof params must == object");let r;if(t===Vc)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Bc)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}((t=e).host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams)&&(n.ns=e.namespace);const i=[];return Ac(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class Wc{constructor(){this.counters_={}}incrementCounter(e,t=1){de(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return K(void 0,this.counters_)}}const zc={},Gc={};function Hc(e){e=e.toString();return zc[e]||(zc[e]=new Wc),zc[e]}class $c{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<n.length;++e)n[e]&&Mc(()=>{this.onMessage_(n[e])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Qc{constructor(e,t,n,r,i,s,a){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=pc(e),this.stats_=Hc(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Kc(t,Bc,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new $c(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4));var n=()=>{if(!this.isClosed_){this.scriptTagHolder=new Yc((...e)=>{var[t,n,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{var[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const t={start:"t"};t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&qc.test(location.hostname)&&(t.r="f");var e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,()=>{})}};if("complete"===document.readyState)n();else{let e=!1;const r=function(){document.body?e||(e=!0,n()):setTimeout(r,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",r,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&r()}),window.attachEvent("onload",r))}}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Qc.forceAllow_=!0}static forceDisallow(){Qc.forceDisallow_=!0}static isAvailable(){return!!Qc.forceAllow_||!(Qc.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){e=ue(e);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var t=yc(n(e),1840);for(let e=0;e<t.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,t.length,t[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){e=ue(e).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class Yc{constructor(t,n,r,e){this.onDisconnect=r,this.urlFn=e,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=lc(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=Yc.createIFrame_();let e="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i=document.domain,e='<script>document.domain="'+i+'";<\/script>');var i="<html><body>"+e+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(r){wc("frame writing exception"),r.stack&&wc(r.stack),wc(r)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||wc("No IE domain setting required")}catch(e){var n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;const i={};i.id=this.myID,i.pw=this.myPW,i.ser=this.currentSerial;var n=this.urlFn(i);let e="",t=0;for(;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+e.length<=1870;){var r=this.pendingSegs.shift();e=e+"&seg"+t+"="+r.seg+"&ts"+t+"="+r.ts+"&d"+t+"="+r.d,t++}return n+=e,this.addLongPollTag_(n,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const t=this.myIFrame.doc.createElement("script");t.type="text/javascript",t.async=!0,t.src=e,t.onload=t.onreadystatechange=function(){var e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),n())},t.onerror=()=>{wc("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(t)}catch(e){}},Math.floor(1))}}let Jc=null;"undefined"!=typeof MozWebSocket?Jc=MozWebSocket:"undefined"!=typeof WebSocket&&(Jc=WebSocket);class Xc{constructor(e,t,n,r,i,s,a){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=pc(this.connId),this.stats_=Hc(t),this.connURL=Xc.connectionURL_(t,s,a,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){const s={v:"5"};return"undefined"!=typeof location&&location.hostname&&qc.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s.ac=r),i&&(s.p=i),Kc(e,Vc,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ac.set("previous_websocket_failure",!0);try{Y(),this.mySock=new Jc(this.connURL,[],void 0)}catch(e){this.log_("Error instantiating WebSocket.");t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");e=e.message||e.data;e&&this.log_(e),this.onClosed_()}}start(){}static forceDisallow(){Xc.forceDisallow_=!0}static isAvailable(){let e=!1;var t;return!(e="undefined"!=typeof navigator&&navigator.userAgent&&(t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<t.length&&parseFloat(t[1])<4.4?!0:e)&&null!==Jc&&!Xc.forceDisallow_}static previouslyFailed(){return ac.isInMemoryStorage||!0===ac.get("previous_websocket_failure")}markConnectionHealthy(){ac.remove("previous_websocket_failure")}appendFrame_(e){this.frames.push(e),this.frames.length===this.totalFrames&&(e=this.frames.join(""),this.frames=null,e=le(e),this.onMessage(e))}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(y(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){null!==this.mySock&&(e=e.data,this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null===this.frames&&null===(e=this.extractFrameCount_(e))||this.appendFrame_(e))}send(e){this.resetKeepAlive();var e=ue(e),t=(this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length),yc(e,16384));1<t.length&&this.sendString_(String(t.length));for(let e=0;e<t.length;e++)this.sendString_(t[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Xc.responsesRequiredToBeHealthy=2,Xc.healthyTimeout=3e4;class Zc{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Qc,Xc]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){var t=Xc&&Xc.isAvailable();let n=t&&!Xc.previouslyFailed();if(e.webSocketOnly&&(t||Ic("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Xc];else{const r=this.transports_=[];for(const i of Zc.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i);Zc.globalTransportInitialized_=!0}}initialTransport(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return 1<this.transports_.length?this.transports_[1]:null}}Zc.globalTransportInitialized_=!1;class el{constructor(e,t,n,r,i,s,a,o,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=a,this.onDisconnect_=o,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=pc("c:"+this.id+":"),this.transportManager_=new Zc(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport(),t=(this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0,this.connReceiver_(this.conn_)),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));var r=e.healthyTimeout||0;0<r&&(this.healthyTimeout_=xc(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&102400<this.conn_.bytesReceived?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&10240<this.conn_.bytesSent?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){"t"in e&&("a"===(e=e.t)?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))}onSecondaryMessageReceived_(e){var t=mc("t",e),e=mc("d",e);if("c"===t)this.onSecondaryControl_(e);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(e)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){var t=mc("t",e),e=mc("d",e);"c"===t?this.onControl_(e):"d"===t&&this.onDataMessage_(e)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){var t=mc("t",e);if("d"in e){e=e.d;if("h"===t)this.onHandshake_(e);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(e):"r"===t?this.onReset_(e):"e"===t?fc("Server Error: "+e):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):fc("Unknown control packet command: "+t)}}onHandshake_(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&Ic("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var e=this.connReceiver_(this.secondaryConn_),t=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,t),xc(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):xc(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ac.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class tl{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class nl{constructor(e){this.allowedEvents_=e,this.listeners_={},y(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});e=this.getInitialEvent(e);e&&t.apply(n,e)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context))return void r.splice(e,1)}validateEventType_(t){y(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class rl extends nl{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||z()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new rl}getInitialEvent(e){return y("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class m{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)0<this.pieces_[e].length&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function f(){return new m("")}function g(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function il(e){return e.pieces_.length-e.pieceNum_}function w(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new m(e.pieces_,t)}function sl(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function al(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function ol(t){if(t.pieceNum_>=t.pieces_.length)return null;const n=[];for(let e=t.pieceNum_;e<t.pieces_.length-1;e++)n.push(t.pieces_[e]);return new m(n,0)}function b(t,n){const r=[];for(let e=t.pieceNum_;e<t.pieces_.length;e++)r.push(t.pieces_[e]);if(n instanceof m)for(let e=n.pieceNum_;e<n.pieces_.length;e++)r.push(n.pieces_[e]);else{var i=n.split("/");for(let e=0;e<i.length;e++)0<i[e].length&&r.push(i[e])}return new m(r,0)}function I(e){return e.pieceNum_>=e.pieces_.length}function cl(e,t){var n=g(e),r=g(t);if(null===n)return t;if(n===r)return cl(w(e),w(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function ll(e,t){var n=al(e,0),r=al(t,0);for(let e=0;e<n.length&&e<r.length;e++){var i=Cc(n[e],r[e]);if(0!==i)return i}return n.length===r.length?0:n.length<r.length?-1:1}function ul(n,r){if(il(n)!==il(r))return!1;for(let e=n.pieceNum_,t=r.pieceNum_;e<=n.pieces_.length;e++,t++)if(n.pieces_[e]!==r.pieces_[t])return!1;return!0}function hl(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(il(e)>il(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class dl{constructor(e,t){this.errorPrefix_=t,this.parts_=al(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=Ae(this.parts_[e]);pl(this)}}function pl(e){if(768<e.byteLength_)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(32<e.parts_.length)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+fl(e))}function fl(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class gl extends nl{constructor(){super(["visible"]);let t,e;"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{var e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))},!1)}static getInstance(){return new gl}getInitialEvent(e){return y("visible"===e,"Unknown event type: "+e),[this.visible_]}}class ml extends tl{constructor(e,t,n,r,i,s,a,o){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=a,this.authOverride_=o,this.id=ml.nextPersistentConnectionId_++,this.log_=pc("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,o&&!Y())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");gl.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&rl.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){var r=++this.requestNumber_,e={r:r,a:e,b:t};this.log_(ue(e)),y(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(e),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const n=new ie;e={p:e._path.toString(),q:e._queryObject};return this.outstandingGets_.push({action:"g",request:e,onComplete:e=>{var t=e.d;"ok"===e.s?n.resolve(t):n.reject(t)}}),this.outstandingGetCount_++,e=this.outstandingGets_.length-1,this.connected_&&this.sendGet_(e),n.promise}listen(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,s=e._path.toString(),r=(this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),y(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),y(!this.listens.get(s).has(i),"listen() called twice for same path/queryId."),{onComplete:r,hashFn:t,query:e,tag:n});this.listens.get(s).set(i,r),this.connected_&&this.sendListen_(r)}sendGet_(t){const n=this.outstandingGets_[t];this.sendRequest("g",n.request,e=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(e)})}sendListen_(r){const i=r.query,s=i._path.toString(),a=i._queryIdentifier,e=(this.log_("Listen on "+s+" for "+a),{p:s});r.tag&&(e.q=i._queryObject,e.t=r.tag),e.h=r.hashFn(),this.sendRequest("q",e,e=>{var t=e.d,n=e.s;ml.warnOnListenWarnings_(t,i),(this.listens.get(s)&&this.listens.get(s).get(a))===r&&(this.log_("listen response",e),"ok"!==n&&this.removeListen_(s,a),r.onComplete&&r.onComplete(n,t))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&de(e,"w")){const n=pe(e,"w");Array.isArray(n)&&~n.indexOf("no_index")&&(e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',t=t._path.toString(),Ic("Using an unspecified index. Your data will be downloaded and "+`filtered on the client. Consider adding ${e} at `+t+" to your security rules for better performance."))}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||"object"==typeof(e=he(e).claims)&&!0===e.admin)&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const n=this.authToken_;var e=function(){const e=he(n),t=e.claims;return t&&"object"==typeof t&&t.hasOwnProperty("iat")}()?"auth":"gauth";const t={cred:n};null===this.authOverride_?t.noauth=!0:"object"==typeof this.authOverride_&&(t.authvar=this.authOverride_),this.sendRequest(e,t,e=>{var t=e.s,e=e.d||"error";this.authToken_===n&&("ok"===t?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(t,e))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{var t=e.s,e=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,e)})}unlisten(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),y(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){t={p:t,d:n};this.log_("onDisconnect "+e,t),this.sendRequest(e,t,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;n=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(n):this.log_("Buffering put: "+t)}sendPut_(t){const n=this.outstandingPuts_[t].action;var e=this.outstandingPuts_[t].request;const r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,e,e=>{this.log_(n+" response",e),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(e.s,e.d)})}reportStats(e){this.connected_&&(this.log_("reportStats",e={c:e}),this.sendRequest("s",e,e=>{"ok"!==e.s&&(e=e.d,this.log_("reportStats","Error sending stats: "+e))}))}onDataMessage_(e){if("r"in e){this.log_("from server: "+ue(e));var t=e.r;const n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):fc("Unrecognized action received from server: "+ue(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){y(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)),this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var n=this.onDataMessage_.bind(this),r=this.onReady_.bind(this);const u=this.onRealtimeDisconnect_.bind(this);var i=this.id+":"+ml.nextConnectionId_++,s=this.lastSessionId;let e=!1,t=null;var a=function(){t?t.close():(e=!0,u())},o=(this.realtime_={close:a,sendRequest:function(e){y(t,"sendRequest call when we're not connected not allowed."),t.sendRequest(e)}},this.forceTokenRefresh_);this.forceTokenRefresh_=!1;try{var[c,l]=await Promise.all([this.authTokenProvider_.getToken(o),this.appCheckTokenProvider_.getToken(o)]);e?wc("getToken() completed but was canceled"):(wc("getToken() completed. Creating connection."),this.authToken_=c&&c.accessToken,this.appCheckToken_=l&&l.token,t=new el(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,n,r,u,e=>{Ic(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(n){this.log_("Failed to get token: "+n),e||(this.repoInfo_.nodeAdmin&&Ic(n),a())}}}interrupt(e){wc("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){wc("Resuming connection for reason: "+e),delete this.interruptReasons_[e],fe(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){e-=(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){t=t?t.map(e=>vc(e)).join("$"):"default";const n=this.removeListen_(e,t);n&&n.onComplete&&n.onComplete("permission_denied")}removeListen_(e,t){e=new m(e).toString();let n;if(this.listens.has(e)){const r=this.listens.get(e);n=r.get(t),r.delete(t),0===r.size&&this.listens.delete(e)}else n=void 0;return n}onAuthRevoked_(e,t){wc("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){wc("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,3<=this.invalidAppCheckTokenCount_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const n of t.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){var e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};e["sdk.js."+Zo.replace(/\./g,"-")]=1,z()?e["framework.cordova"]=1:$()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){var e=rl.getInstance().currentlyOnline();return fe(this.interruptReasons_)&&e}}ml.nextPersistentConnectionId_=0,ml.nextConnectionId_=0;class T{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new T(e,t)}}class vl{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){e=new T(kc,e),t=new T(kc,t);return 0!==this.compare(e,t)}minPost(){return T.MIN}}let yl;class _l extends vl{static get __EMPTY_NODE(){return yl}static set __EMPTY_NODE(e){yl=e}compare(e,t){return Cc(e.name,t.name)}isDefinedOn(e){throw d("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return T.MIN}maxPost(){return new T(Sc,yl)}makePost(e,t){return y("string"==typeof e,"KeyIndex indexValue must always be a string."),new T(e,yl)}toString(){return".key"}}const wl=new _l;class bl{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_.pop(),t;if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack_.length}peek(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Il{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Il.RED,this.left=null!=r?r:Tl.EMPTY_NODE,this.right=null!=i?i:Tl.EMPTY_NODE}copy(e,t,n,r,i){return new Il(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return Tl.EMPTY_NODE;let e=this;return(e=(e=e.left.isRed_()||e.left.left.isRed_()?e:e.moveRedLeft_()).copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,r;if(t(e,(n=this).key)<0)n=(n=n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()?n:n.moveRedLeft_()).copy(null,null,null,n.left.remove(e,t),null);else{if(0===t(e,(n=(n=n.left.isRed_()?n.rotateRight_():n).right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()?n:n.moveRedRight_()).key)){if(n.right.isEmpty())return Tl.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e=(e=(e=e.right.isRed_()&&!e.left.isRed_()?e.rotateLeft_():e).left.isRed_()&&e.left.left.isRed_()?e.rotateRight_():e).left.isRed_()&&e.right.isRed_()?e.colorFlip_():e}moveRedLeft_(){let e=this.colorFlip_();return e=e.right.left.isRed_()?(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_():e}moveRedRight_(){let e=this.colorFlip_();return e=e.left.left.isRed_()?(e=e.rotateRight_()).colorFlip_():e}rotateLeft_(){var e=this.copy(null,null,Il.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){var e=this.copy(null,null,Il.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Il.RED=!0,Il.BLACK=!1;class Tl{constructor(e,t=Tl.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Tl(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Il.BLACK,null,null))}remove(e){return new Tl(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Il.BLACK,null,null))}get(e){var t;let n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:0<t&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:0<t&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new bl(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new bl(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new bl(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new bl(this.root_,null,this.comparator_,!0,e)}}function El(e,t){return Cc(e.name,t.name)}function kl(e,t){return Cc(e,t)}Tl.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new Il(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let Sl;function Cl(e){return"number"==typeof e?"number:"+Nc(e):"string:"+e}function Al(e){var t;e.isLeafNode()?(t=e.val(),y("string"==typeof t||"number"==typeof t||"object"==typeof t&&de(t,".sv"),"Priority must be a string or number.")):y(e===Sl||e.isEmpty(),"priority of unexpected type."),y(e===Sl||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}let Nl;class Rl{constructor(e,t=Rl.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,y(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Al(this.priorityNode_)}static set __childrenNodeConstructor(e){Nl=e}static get __childrenNodeConstructor(){return Nl}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Rl(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Rl.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return I(e)?this:".priority"===g(e)?this.priorityNode_:Rl.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Rl.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){var n=g(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(y(".priority"!==n||1===il(e),".priority must be the last token in a path"),this.updateImmediateChild(n,Rl.__childrenNodeConstructor.EMPTY_NODE.updateChild(w(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Cl(this.priorityNode_.val())+":");var t=typeof this.value_;e=(e+=t+":")+("number"==t?Nc(this.value_):this.value_),this.lazyHash_=sc(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Rl.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Rl.__childrenNodeConstructor?-1:(y(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){var t=typeof e.value_,n=typeof this.value_,r=Rl.VALUE_TYPE_ORDER.indexOf(t),i=Rl.VALUE_TYPE_ORDER.indexOf(n);return y(0<=r,"Unknown leaf type: "+t),y(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}Rl.VALUE_TYPE_ORDER=["object","boolean","number","string"];let xl,Dl;const E=new class extends vl{compare(e,t){const n=e.node.getPriority();var r=t.node.getPriority();return 0===(r=n.compareTo(r))?Cc(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return T.MIN}maxPost(){return new T(Sc,new Rl("[PRIORITY-POST]",Dl))}makePost(e,t){e=xl(e);return new T(t,new Rl("[PRIORITY-POST]",e))}toString(){return".priority"}},Pl=Math.log(2);class Ol{constructor(e){this.count=parseInt(Math.log(e+1)/Pl,10),this.current_=this.count-1;t=this.count;var t=parseInt(Array(t+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}function Ml(c,e,l,t){c.sort(e);const u=function(e,t){let n,r;if(0==(s=t-e))return null;if(1==s)return n=c[e],r=l?l(n):n,new Il(r,n.node,Il.BLACK,null,null);var i=parseInt(s/2,10)+e,e=u(e,i),s=u(i+1,t);return n=c[i],r=l?l(n):n,new Il(r,n.node,Il.BLACK,e,s)};var n=function(t){let i=null,s=null,a=c.length;function n(e,t){var n=a-e,r=a,e=(a-=e,u(1+n,r)),r=c[n],n=l?l(r):r;n=new Il(n,r.node,t,null,e),i=(i?i.left=n:s=n,n)}for(let e=0;e<t.count;++e){var r=t.nextBitIsOne(),o=Math.pow(2,t.count-(e+1));r?n(o,Il.BLACK):(n(o,Il.BLACK),n(o,Il.RED))}return s}(new Ol(c.length));return new Tl(t||e,n)}let Ll;const Fl={};class Ul{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return y((Fl,E),"ChildrenNode.ts has not been loaded"),Ll=Ll||new Ul({".priority":Fl},{".priority":E})}get(e){var t=pe(this.indexes_,e);if(t)return t instanceof Tl?t:null;throw new Error("No index defined for "+e)}hasIndex(e){return de(this.indexSet_,e.toString())}addIndex(e,t){y(e!==wl,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(T.Wrap);let s=i.getNext();for(;s;)r=r||e.isDefinedOn(s.node),n.push(s),s=i.getNext();var t=r?Ml(n,e.getCompare()):Fl,a=e.toString();const o=Object.assign({},this.indexSet_),c=(o[a]=e,Object.assign({},this.indexes_));return c[a]=t,new Ul(c,o)}addToIndexes(a,o){var e=ge(this.indexes_,(t,n)=>{const r=pe(this.indexSet_,n);if(y(r,"Missing index implementation for "+n),t===Fl){if(r.isDefinedOn(a.node)){const i=[],s=o.getIterator(T.Wrap);let e=s.getNext();for(;e;)e.name!==a.name&&i.push(e),e=s.getNext();return i.push(a),Ml(i,r.getCompare())}return Fl}{n=o.get(a.name);let e=t;return(e=n?e.remove(new T(a.name,n)):e).insert(a,a.node)}});return new Ul(e,this.indexSet_)}removeFromIndexes(n,r){var e=ge(this.indexes_,e=>{if(e===Fl)return e;var t=r.get(n.name);return t?e.remove(new T(n.name,t)):e});return new Ul(e,this.indexSet_)}}let ql;class k{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Al(this.priorityNode_),this.children_.isEmpty()&&y(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return ql=ql||new k(new Tl(kl),null,Ul.Default)}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ql}updatePriority(e){return this.children_.isEmpty()?this:new k(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();e=this.children_.get(e);return null===e?ql:e}getChild(e){var t=g(e);return null===t?this:this.getImmediateChild(t).getChild(w(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(n,r){if(y(r,"We should always be passing snapshot nodes"),".priority"===n)return this.updatePriority(r);{var i=new T(n,r);let e,t;return t=r.isEmpty()?(e=this.children_.remove(n),this.indexMap_.removeFromIndexes(i,this.children_)):(e=this.children_.insert(n,r),this.indexMap_.addToIndexes(i,this.children_)),i=e.isEmpty()?ql:this.priorityNode_,new k(e,i,t)}}updateChild(e,t){var n=g(e);if(null===n)return t;y(".priority"!==g(e)||1===il(e),".priority must be the last token in a path");e=this.getImmediateChild(n).updateChild(w(e),t);return this.updateImmediateChild(n,e)}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;const r={};let i=0,s=0,a=!0;if(this.forEachChild(E,(e,t)=>{r[e]=t.val(n),i++,a&&k.INTEGER_REGEXP_.test(e)?s=Math.max(s,Number(e)):a=!1}),!n&&a&&s<2*i){const e=[];for(const t in r)e[t]=r[t];return e}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(null===this.lazyHash_){let n="";this.getPriority().isEmpty()||(n+="priority:"+Cl(this.getPriority().val())+":"),this.forEachChild(E,(e,t)=>{t=t.hash();""!==t&&(n+=":"+e+":"+t)}),this.lazyHash_=""===n?"":sc(n)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);return r?(n=r.getPredecessorKey(new T(e,t)))?n.name:null:this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);return t?(e=t.minKey())&&e.name:this.children_.minKey()}getFirstChild(e){e=this.getFirstChildName(e);return e?new T(e,this.children_.get(e)):null}getLastChildName(e){const t=this.resolveIndex_(e);return t?(e=t.maxKey())&&e.name:this.children_.maxKey()}getLastChild(e){e=this.getLastChildName(e);return e?new T(e,this.children_.get(e)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getIteratorFrom(t,e=>e);{const r=this.children_.getIteratorFrom(t.name,T.Wrap);let e=r.peek();for(;null!=e&&n.compare(e,t)<0;)r.getNext(),e=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getReverseIteratorFrom(t,e=>e);{const r=this.children_.getReverseIteratorFrom(t.name,T.Wrap);let e=r.peek();for(;null!=e&&0<n.compare(e,t);)r.getNext(),e=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Bl?-1:0}withIndex(e){if(e===wl||this.indexMap_.hasIndex(e))return this;e=this.indexMap_.addIndex(e,this.children_);return new k(this.children_,this.priorityNode_,e)}isIndexed(e){return e===wl||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority())){if(this.children_.count()!==n.children_.count())return!1;{const r=this.getIterator(E),i=n.getIterator(E);let e=r.getNext(),t=i.getNext();for(;e&&t;){if(e.name!==t.name||!e.node.equals(t.node))return!1;e=r.getNext(),t=i.getNext()}return null===e&&null===t}}return!1}}resolveIndex_(e){return e===wl?null:this.indexMap_.get(e.toString())}}k.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Vl extends k{constructor(){super(new Tl(kl),k.EMPTY_NODE,Ul.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return k.EMPTY_NODE}isEmpty(){return!1}}const Bl=new Vl,jl=(Object.defineProperties(T,{MIN:{value:new T(kc,k.EMPTY_NODE)},MAX:{value:new T(Sc,Bl)}}),_l.__EMPTY_NODE=k.EMPTY_NODE,Rl.__childrenNodeConstructor=k,Wp=Bl,Sl=Wp,Wp=Bl,Dl=Wp,!0);function Kl(i,e=null){if(null===i)return k.EMPTY_NODE;var t;if("object"==typeof i&&".priority"in i&&(e=i[".priority"]),y(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"!=typeof(i="object"==typeof i&&".value"in i&&null!==i[".value"]?i[".value"]:i)||".sv"in i)return t=i,new Rl(t,Kl(e));if(i instanceof Array||!jl){let r=k.EMPTY_NODE;return Ac(i,(e,t)=>{if(de(i,e)&&"."!==e.substring(0,1)){const n=Kl(t);!n.isLeafNode()&&n.isEmpty()||(r=r.updateImmediateChild(e,n))}}),r.updatePriority(Kl(e))}{const s=[];let r=!1;if(Ac(i,(e,t)=>{if("."!==e.substring(0,1)){const n=Kl(t);n.isEmpty()||(r=r||!n.getPriority().isEmpty(),s.push(new T(e,n)))}}),0===s.length)return k.EMPTY_NODE;var n=Ml(s,El,e=>e.name,kl);return r?(t=Ml(s,E.getCompare()),new k(n,Kl(e),new Ul({".priority":t},{".priority":E}))):new k(n,Kl(e),Ul.Default)}}xl=Kl;class Wl extends vl{constructor(e){super(),this.indexPath_=e,y(!I(e)&&".priority"!==g(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node);var r=this.extractChild(t.node);return 0===(r=n.compareTo(r))?Cc(e.name,t.name):r}makePost(e,t){e=Kl(e),e=k.EMPTY_NODE.updateChild(this.indexPath_,e);return new T(t,e)}maxPost(){var e=k.EMPTY_NODE.updateChild(this.indexPath_,Bl);return new T(Sc,e)}toString(){return al(this.indexPath_,0).join("/")}}const zl=new class extends vl{compare(e,t){var n=e.node.compareTo(t.node);return 0===n?Cc(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return T.MIN}maxPost(){return T.MAX}makePost(e,t){e=Kl(e);return new T(t,e)}toString(){return".value"}};function Gl(e){return{type:"value",snapshotNode:e}}function Hl(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function $l(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Ql(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class Yl{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){y(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange($l(t,a)):y(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange(Hl(t,n)):s.trackChildChange(Ql(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(E,(e,t)=>{n.hasChild(e)||i.trackChildChange($l(e,t))}),n.isLeafNode()||n.forEachChild(E,(e,t)=>{if(r.hasChild(e)){const n=r.getImmediateChild(e);n.equals(t)||i.trackChildChange(Ql(e,t,n))}else i.trackChildChange(Hl(e,t))})),n.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?k.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Jl{constructor(e){this.indexedFilter_=new Yl(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Jl.getStartPost_(e),this.endPost_=Jl.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){var t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,e=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&e}updateChild(e,t,n,r,i,s){return this.matches(new T(t,n))||(n=k.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){let r=(t=t.isLeafNode()?k.EMPTY_NODE:t).withIndex(this.index_);r=r.updatePriority(k.EMPTY_NODE);const i=this;return t.forEachChild(E,(e,t)=>{i.matches(new T(e,t))||(r=r.updateImmediateChild(e,k.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){var t;return e.hasStart()?(t=e.getIndexStartName(),e.getIndex().makePost(e.getIndexStartValue(),t)):e.getIndex().minPost()}static getEndPost_(e){var t;return e.hasEnd()?(t=e.getIndexEndName(),e.getIndex().makePost(e.getIndexEndValue(),t)):e.getIndex().maxPost()}}class Xl{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{e=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?e<=0:e<0},this.withinEndPost=e=>{e=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?e<=0:e<0},this.rangedFilter_=new Jl(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new T(t,n))||(n=k.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,n,t){let r;if(n.isLeafNode()||n.isEmpty())r=k.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<n.numChildren()&&n.isIndexed(this.index_)){r=k.EMPTY_NODE.withIndex(this.index_);let e,t=(e=this.reverse_?n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_),0);for(;e.hasNext()&&t<this.limit_;){var i=e.getNext();if(this.withinDirectionalStart(i)){if(!this.withinDirectionalEnd(i))break;r=r.updateImmediateChild(i.name,i.node),t++}}}else{r=(r=n.withIndex(this.index_)).updatePriority(k.EMPTY_NODE);let e,t=(e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_),0);for(;e.hasNext();){var s=e.getNext();t<this.limit_&&this.withinDirectionalStart(s)&&this.withinDirectionalEnd(s)?t++:r=r.updateImmediateChild(s.name,k.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,t)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){const d=this.index_.getCompare();s=(e,t)=>d(t,e)}else s=this.index_.getCompare();const a=e;y(a.numChildren()===this.limit_,"");var o=new T(t,n),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(a.hasChild(t)){var u=a.getImmediateChild(t);let e=r.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=e&&(e.name===t||a.hasChild(e.name));)e=r.getChildAfterChild(this.index_,e,this.reverse_);var h=null==e?1:s(e,o);if(l&&!n.isEmpty()&&0<=h)return null!=i&&i.trackChildChange(Ql(t,n,u)),a.updateImmediateChild(t,n);{null!=i&&i.trackChildChange($l(t,u));const p=a.updateImmediateChild(t,k.EMPTY_NODE);return null!=e&&this.rangedFilter_.matches(e)?(null!=i&&i.trackChildChange(Hl(e.name,e.node)),p.updateImmediateChild(e.name,e.node)):p}}return!n.isEmpty()&&l&&0<=s(c,o)?(null!=i&&(i.trackChildChange($l(c.name,c.node)),i.trackChildChange(Hl(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(c.name,k.EMPTY_NODE)):e}}class Zl{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=E}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return y(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return y(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:kc}hasEnd(){return this.endSet_}getIndexEndValue(){return y(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return y(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Sc}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return y(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===E}copy(){const e=new Zl;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function eu(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function tu(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function nu(e,t){const n=e.copy();return n.index_=t,n}function ru(e){const t={};return e.isDefault()||(n=e.index_===E?"$priority":e.index_===zl?"$value":e.index_===wl?"$key":(y(e.index_ instanceof Wl,"Unrecognized index type!"),e.index_.toString()),t.orderBy=ue(n),e.startSet_&&(r=e.startAfterSet_?"startAfter":"startAt",t[r]=ue(e.indexStartValue_),e.startNameSet_&&(t[r]+=","+ue(e.indexStartName_))),e.endSet_&&(r=e.endBeforeSet_?"endBefore":"endAt",t[r]=ue(e.indexEndValue_),e.endNameSet_&&(t[r]+=","+ue(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_)),t;var n,r}function iu(t){const n={};if(t.startSet_&&(n.sp=t.indexStartValue_,t.startNameSet_&&(n.sn=t.indexStartName_),n.sin=!t.startAfterSet_),t.endSet_&&(n.ep=t.indexEndValue_,t.endNameSet_&&(n.en=t.indexEndName_),n.ein=!t.endBeforeSet_),t.limitSet_){n.l=t.limit_;let e=t.viewFrom_;""===e&&(e=t.isViewFromLeft()?"l":"r"),n.vf=e}return t.index_!==E&&(n.i=t.index_.toString()),n}class su extends tl{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=pc("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(y(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){const s=e._path.toString(),a=(this.log_("Listen called for "+s+" "+e._queryIdentifier),su.getListenId_(e,r)),o={};this.listens_[a]=o;e=ru(e._queryParams);this.restRequest_(s+".json",e,(e,t)=>{let n=t;null===(e=404===e?n=null:e)&&this.onDataUpdate_(s,n,!1,r),pe(this.listens_,a)===o&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){e=su.getListenId_(e,t);delete this.listens_[e]}get(e){var t=ru(e._queryParams);const r=e._path.toString(),i=new ie;return this.restRequest_(r+".json",t,(e,t)=>{let n=t;null===(e=404===e?n=null:e)?(this.onDataUpdate_(r,n,!1,null),i.resolve(n)):i.reject(new Error(n))}),i.promise}refreshAuthToken(e){}restRequest_(i,s={},a){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([e,t])=>{e&&e.accessToken&&(s.auth=e.accessToken),t&&t.token&&(s.ac=t.token);const n=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+ye(s),r=(this.log_("Sending REST request for "+n),new XMLHttpRequest);r.onreadystatechange=()=>{if(a&&4===r.readyState){this.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);let e=null;if(200<=r.status&&r.status<300){try{e=le(r.responseText)}catch(e){Ic("Failed to parse JSON response for "+n+": "+r.responseText)}a(null,e)}else 401!==r.status&&404!==r.status&&Ic("Got unsuccessful REST response for "+n+" Status: "+r.status),a(r.status);a=null}},r.open("GET",n,!0),r.send()})}}class au{constructor(){this.rootNode_=k.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function ou(){return{value:null,children:new Map}}function cu(e,t,n){var r;I(t)?(e.value=n,e.children.clear()):null!==e.value?e.value=e.value.updateChild(t,n):(r=g(t),e.children.has(r)||e.children.set(r,ou()),cu(e.children.get(r),t=w(t),n))}function lu(e,n,r){var i;null!==e.value?r(n,e.value):(i=(e,t)=>{lu(t,new m(n.toString()+"/"+e),r)},e.children.forEach((e,t)=>{i(t,e)}))}class uu{constructor(e){this.collection_=e,this.last_=null}get(){var e=this.collection_.get();const n=Object.assign({},e);return this.last_&&Ac(this.last_,(e,t)=>{n[e]=n[e]-t}),this.last_=e,n}}class hu{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new uu(e);t=1e4+2e4*Math.random();xc(this.reportStats_.bind(this),Math.floor(t))}reportStats_(){var e=this.statsListener_.get();const n={};let r=!1;Ac(e,(e,t)=>{0<t&&de(this.statsToReport_,e)&&(n[e]=t,r=!0)}),r&&this.server_.reportStats(n),xc(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function du(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function pu(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function fu(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}$n=rc={OVERWRITE:0,0:"OVERWRITE",MERGE:1,1:"MERGE",ACK_USER_WRITE:2,2:"ACK_USER_WRITE",LISTEN_COMPLETE:3,3:"LISTEN_COMPLETE"};class gu{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=rc.ACK_USER_WRITE,this.source=du()}operationForChild(e){if(I(this.path)){if(null!=this.affectedTree.value)return y(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new m(e));return new gu(f(),t,this.revert)}return y(g(this.path)===e,"operationForChild called for unrelated child."),new gu(w(this.path),this.affectedTree,this.revert)}}class mu{constructor(e,t){this.source=e,this.path=t,this.type=rc.LISTEN_COMPLETE}operationForChild(e){return I(this.path)?new mu(this.source,f()):new mu(this.source,w(this.path))}}class vu{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=rc.OVERWRITE}operationForChild(e){return I(this.path)?new vu(this.source,f(),this.snap.getImmediateChild(e)):new vu(this.source,w(this.path),this.snap)}}class yu{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=rc.MERGE}operationForChild(e){if(I(this.path)){const t=this.children.subtree(new m(e));return t.isEmpty()?null:t.value?new vu(this.source,f(),t.value):new yu(this.source,f(),t)}return y(g(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new yu(this.source,w(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class _u{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(I(e))return this.isFullyInitialized()&&!this.filtered_;e=g(e);return this.isCompleteForChild(e)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class wu{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function bu(r,i,t,e,s,a){const n=e.filter(e=>e.type===t);n.sort((e,t)=>{var n=r;if(null==e.childName||null==t.childName)throw d("Should only compare child_ events.");return e=new T(e.childName,e.snapshotNode),t=new T(t.childName,t.snapshotNode),n.index_.compare(e,t)}),n.forEach(t=>{"value"!==(e=t).type&&"child_removed"!==e.type&&(e.prevName=a.getPredecessorChildName(e.childName,e.snapshotNode,r.index_));const n=e;var e;s.forEach(e=>{e.respondsTo(t.type)&&i.push(e.createEvent(n,r.query_))})})}function Iu(e,t){return{eventCache:e,serverCache:t}}function Tu(e,t,n,r){return Iu(new _u(t,n,r),e.serverCache)}function Eu(e,t,n,r){return Iu(e.eventCache,new _u(t,n,r))}function ku(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Su(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Cu;class S{constructor(e,t=(Cu=Cu||new Tl(gc),Cu)){this.value=e,this.children=t}static fromObject(e){let n=new S(null);return Ac(e,(e,t)=>{n=n.set(new m(e),t)}),n}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:f(),value:this.value};if(I(e))return null;{var n=g(e);const r=this.children.get(n);if(null===r)return null;e=r.findRootMostMatchingPathAndValue(w(e),t);return null==e?null:{path:b(new m(n),e.path),value:e.value}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(I(e))return this;{var t=g(e);const n=this.children.get(t);return null!==n?n.subtree(w(e)):new S(null)}}set(e,t){if(I(e))return new S(t,this.children);{var n=g(e);const r=this.children.get(n)||new S(null);e=r.set(w(e),t),e=this.children.insert(n,e);return new S(this.value,e)}}remove(t){if(I(t))return this.children.isEmpty()?new S(null):new S(null,this.children);{var n=g(t);const r=this.children.get(n);if(r){const i=r.remove(w(t));let e;return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&e.isEmpty()?new S(null):new S(this.value,e)}return this}}get(e){if(I(e))return this.value;{var t=g(e);const n=this.children.get(t);return n?n.get(w(e)):null}}setTree(e,t){if(I(e))return t;{var n=g(e);const r=this.children.get(n)||new S(null),i=r.setTree(w(e),t);return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new S(this.value,e)}}fold(e){return this.fold_(f(),e)}fold_(n,r){const i={};return this.children.inorderTraversal((e,t)=>{i[e]=t.fold_(b(n,e),r)}),r(n,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,f(),t)}findOnPath_(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(I(e))return null;{r=g(e);const i=this.children.get(r);return i?i.findOnPath_(w(e),b(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,f(),t)}foreachOnPath_(e,t,n){if(I(e))return this;{this.value&&n(t,this.value);var r=g(e);const i=this.children.get(r);return i?i.foreachOnPath_(w(e),b(t,r),n):new S(null)}}foreach(e){this.foreach_(f(),e)}foreach_(n,r){this.children.inorderTraversal((e,t)=>{t.foreach_(b(n,e),r)}),this.value&&r(n,this.value)}foreachChild(n){this.children.inorderTraversal((e,t)=>{t.value&&n(e,t.value)})}}class Au{constructor(e){this.writeTree_=e}static empty(){return new Au(new S(null))}}function Nu(t,n,r){if(I(n))return new Au(new S(r));var i=t.writeTree_.findRootMostValueAndPath(n);if(null==i)return s=new S(r),s=t.writeTree_.setTree(n,s),new Au(s);{var s=i.path;let e=i.value;return i=cl(s,n),e=e.updateChild(i,r),new Au(t.writeTree_.set(s,e))}}function Ru(e,n,t){let r=e;return Ac(t,(e,t)=>{r=Nu(r,b(n,e),t)}),r}function xu(e,t){if(I(t))return Au.empty();e=e.writeTree_.setTree(t,new S(null));return new Au(e)}function Du(e,t){return null!=Pu(e,t)}function Pu(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(cl(n.path,t)):null}function Ou(e){const n=[],t=e.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(E,(e,t)=>{n.push(new T(e,t))}):e.writeTree_.children.inorderTraversal((e,t)=>{null!=t.value&&n.push(new T(e,t.value))}),n}function Mu(e,t){if(I(t))return e;var n=Pu(e,t);return null!=n?new Au(new S(n)):new Au(e.writeTree_.subtree(t))}function Lu(e){return e.writeTree_.isEmpty()}function Fu(e,t){return function r(i,e,s){if(null!=e.value)return s.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((e,t)=>{".priority"===e?(y(null!==t.value,"Priority writes must always be leaf nodes"),n=t.value):s=r(b(i,e),t,s)}),s=s.getChild(i).isEmpty()||null===n?s:s.updateChild(b(i,".priority"),n)}}(f(),e.writeTree_,t)}function Uu(e,t){return $u(t,e)}function qu(e){return e.visible}function Vu(t,n,r){let i=Au.empty();for(let e=0;e<t.length;++e){const a=t[e];if(n(a)){var s=a.path;let e;if(a.snap)hl(r,s)?(e=cl(r,s),i=Nu(i,e,a.snap)):hl(s,r)&&(e=cl(s,r),i=Nu(i,f(),a.snap.getChild(e)));else{if(!a.children)throw d("WriteRecord should have .snap or .children");if(hl(r,s))e=cl(r,s),i=Ru(i,e,a.children);else if(hl(s,r))if(I(e=cl(s,r)))i=Ru(i,f(),a.children);else{const o=pe(a.children,g(e));o&&(s=o.getChild(w(e)),i=Nu(i,f(),s))}}}}return i}function Bu(e,t,n,r,i){var s;return r||i?(s=Mu(e.visibleWrites,t),!i&&Lu(s)?n:i||null!=n||Du(s,f())?Fu(Vu(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(hl(e.path,t)||hl(t,e.path))},t),n||k.EMPTY_NODE):null):null!=(s=Pu(e.visibleWrites,t))?s:Lu(s=Mu(e.visibleWrites,t))?n:null!=n||Du(s,f())?Fu(s,n||k.EMPTY_NODE):null}function ju(e,t,n,r){return Bu(e.writeTree,e.treePath,t,n,r)}function Ku(e,t){{var r=e.writeTree;e=e.treePath;let n=k.EMPTY_NODE;const i=Pu(r.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(E,(e,t)=>{n=n.updateImmediateChild(e,t)}),n;if(t){const s=Mu(r.visibleWrites,e);return t.forEachChild(E,(e,t)=>{t=Fu(Mu(s,new m(e)),t);n=n.updateImmediateChild(e,t)}),Ou(s).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n}return Ou(Mu(r.visibleWrites,e)).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n}}function Wu(e,t,n,r){var i=e.writeTree,e=e.treePath;return y(n||r,"Either existingEventSnap or existingServerSnap must exist"),n=b(e,t),Du(i.visibleWrites,n)?null:Lu(n=Mu(i.visibleWrites,n))?r.getChild(t):Fu(n,r.getChild(t))}function zu(e,t){return n=e.writeTree,t=b(e.treePath,t),Pu(n.visibleWrites,t);var n}function Gu(e,t,n){return r=e.writeTree,e=b(e=e.treePath,t),null!=(i=Pu(r.visibleWrites,e))?i:n.isCompleteForChild(t)?Fu(Mu(r.visibleWrites,e),n.getNode().getImmediateChild(t)):null;var r,i}function Hu(e,t){return $u(b(e.treePath,t),e.writeTree)}function $u(e,t){return{treePath:e,writeTree:t}}class Qu{constructor(){this.changeMap=new Map}trackChildChange(e){var t=e.type,n=e.childName,r=(y("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),y(".priority"!==n,"Only non-priority child changes can be tracked."),this.changeMap.get(n));if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,Ql(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,$l(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,Hl(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw d("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Ql(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const Yu=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Ju{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new _u(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Gu(this.writes_,e,n)}getChildAfterChild(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Su(this.viewCache_);return 0===(r=function(e,n,r,i,s,a){{var o=e.writeTree,c=(e=e.treePath,r),l=i;r=s,i=a;let t;if(o=Mu(o.visibleWrites,e),null!=(e=Pu(o,f())))t=e;else{if(null==n)return[];t=Fu(o,n)}if((t=t.withIndex(i)).isEmpty()||t.isLeafNode())return[];{const u=[],h=i.getCompare(),d=r?t.getReverseIteratorFrom(c,i):t.getIteratorFrom(c,i);let e=d.getNext();for(;e&&u.length<l;)0!==h(e,c)&&u.push(e),e=d.getNext();return u}}}(this.writes_,r,t,1,n,e)).length?null:r[0]}}function Xu(n,r,i,s,a,o){const c=r.eventCache;if(null!=zu(s,i))return r;{let e,t;var l,u,h,d;return e=I(i)?(y(r.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),r.serverCache.isFiltered()?(d=Ku(s,(d=Su(r))instanceof k?d:k.EMPTY_NODE),n.filter.updateFullNode(r.eventCache.getNode(),d,o)):(l=ju(s,Su(r)),n.filter.updateFullNode(r.eventCache.getNode(),l,o))):".priority"===(l=g(i))?(y(1===il(i),"Can't have a priority with additional path components"),null!=(u=Wu(s,i,h=c.getNode(),t=r.serverCache.getNode()))?n.filter.updatePriority(h,u):c.getNode()):(h=w(i),null!=(d=c.isCompleteForChild(l)?(t=r.serverCache.getNode(),null!=(u=Wu(s,i,c.getNode(),t))?c.getNode().getImmediateChild(l).updateChild(h,u):c.getNode().getImmediateChild(l)):Gu(s,l,r.serverCache))?n.filter.updateChild(c.getNode(),l,d,h,a,o):c.getNode()),Tu(r,e,c.isFullyInitialized()||I(i),n.filter.filtersNodes())}}function Zu(e,t,n,r,i,s,a,o){const c=t.serverCache;let l;const u=a?e.filter:e.filter.getIndexedFilter();if(I(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),h,null)}else{a=g(n);if(!c.isCompleteForPath(n)&&1<il(n))return t;var d=w(n);const p=c.getNode().getImmediateChild(a);h=p.updateChild(d,r),l=".priority"===a?u.updatePriority(c.getNode(),h):u.updateChild(c.getNode(),a,h,d,Yu,null)}return Xu(e,d=Eu(t,l,c.isFullyInitialized()||I(n),u.filtersNodes()),n,i,new Ju(i,d,s),o)}function eh(t,n,r,i,s,a,o){const c=n.eventCache;let l,e;const u=new Ju(s,n,a);if(I(r))e=t.filter.updateFullNode(n.eventCache.getNode(),i,o),l=Tu(n,e,!0,t.filter.filtersNodes());else{s=g(r);if(".priority"===s)e=t.filter.updatePriority(n.eventCache.getNode(),i),l=Tu(n,e,c.isFullyInitialized(),c.isFiltered());else{a=w(r);const h=c.getNode().getImmediateChild(s);let e;if(I(a))e=i;else{const d=u.getCompleteChild(s);e=null!=d?".priority"===sl(a)&&d.getChild(ol(a)).isEmpty()?d:d.updateChild(a,i):k.EMPTY_NODE}l=h.equals(e)?n:Tu(n,t.filter.updateChild(c.getNode(),s,e,a,u,o),c.isFullyInitialized(),t.filter.filtersNodes())}}return l}function th(e,t){return e.eventCache.isCompleteForChild(t)}function nh(e,n,t){return t.foreach((e,t)=>{n=n.updateChild(e,t)}),n}function rh(r,i,e,t,s,a,o,c){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let l=i,n;n=I(e)?t:new S(null).setTree(e,t);const u=i.serverCache.getNode();return n.children.inorderTraversal((e,t)=>{u.hasChild(e)&&(t=nh(0,i.serverCache.getNode().getImmediateChild(e),t),l=Zu(r,l,new m(e),t,s,a,o,c))}),n.children.inorderTraversal((e,t)=>{var n=!i.serverCache.isCompleteForChild(e)&&null===t.value;u.hasChild(e)||n||(n=nh(0,i.serverCache.getNode().getImmediateChild(e),t),l=Zu(r,l,new m(e),n,s,a,o,c))}),l}class ih{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new Yl(n.getIndex()),i=(e=n).loadsAllData()?new Yl(e.getIndex()):new(e.hasLimit()?Xl:Jl)(e),s=(this.processor_={filter:i},t.serverCache),a=t.eventCache;e=r.updateFullNode(k.EMPTY_NODE,s.getNode(),null),t=i.updateFullNode(k.EMPTY_NODE,a.getNode(),null),e=new _u(e,s.isFullyInitialized(),r.filtersNodes()),t=new _u(t,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Iu(t,e),this.eventGenerator_=new wu(this.query_)}get query(){return this.query_}}function sh(e){return 0===e.eventRegistrations_.length}function ah(n,r,t){const i=[];if(t){y(null==r,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(e=>{e=e.createCancelEvent(t,s);e&&i.push(e)})}if(r){let t=[];for(let e=0;e<n.eventRegistrations_.length;++e){const a=n.eventRegistrations_[e];if(a.matches(r)){if(r.hasAnyCallback()){t=t.concat(n.eventRegistrations_.slice(e+1));break}}else t.push(a)}n.eventRegistrations_=t}else n.eventRegistrations_=[];return i}function oh(e,t,n,r){t.type===rc.MERGE&&null!==t.source.queryId&&(y(Su(e.viewCache_),"We should always have a full cache before handling merges"),y(ku(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=function(e,t,n,r,i){const s=new Qu;let a,o;if(n.type===rc.OVERWRITE){var c=n;a=c.source.fromUser?eh(e,t,c.path,c.snap,r,i,s):(y(c.source.fromServer,"Unknown source."),o=c.source.tagged||t.serverCache.isFiltered()&&!I(c.path),Zu(e,t,c.path,c.snap,r,i,o,s))}else if(n.type===rc.MERGE)c=n,a=c.source.fromUser?function(n,r,i,e,s,a,o){let c=r;return e.foreach((e,t)=>{e=b(i,e);th(r,g(e))&&(c=eh(n,c,e,t,s,a,o))}),e.foreach((e,t)=>{e=b(i,e);th(r,g(e))||(c=eh(n,c,e,t,s,a,o))}),c}(e,t,c.path,c.children,r,i,s):(y(c.source.fromServer,"Unknown source."),o=c.source.tagged||t.serverCache.isFiltered(),rh(e,t,c.path,c.children,r,i,o,s));else if(n.type===rc.ACK_USER_WRITE){var l=n;a=l.revert?function(n,r,i,s,a,o){let c;if(null!=zu(s,i))return r;{a=new Ju(s,r,a);const u=r.eventCache.getNode();let t;if(I(i)||".priority"===g(i)){var e=r.serverCache.isFullyInitialized()?ju(s,Su(r)):(l=r.serverCache.getNode(),y(l instanceof k,"serverChildren would be complete if leaf node"),Ku(s,l));t=n.filter.updateFullNode(u,e,o)}else{var l=g(i);let e=Gu(s,l,r.serverCache);null==e&&r.serverCache.isCompleteForChild(l)&&(e=u.getImmediateChild(l)),(t=null!=e?n.filter.updateChild(u,l,e,w(i),a,o):r.eventCache.getNode().hasChild(l)?n.filter.updateChild(u,l,k.EMPTY_NODE,w(i),a,o):u).isEmpty()&&r.serverCache.isFullyInitialized()&&((c=ju(s,Su(r))).isLeafNode()&&(t=n.filter.updateFullNode(t,c,o)))}return c=r.serverCache.isFullyInitialized()||null!=zu(s,f()),Tu(r,t,c,n.filter.filtersNodes())}}(e,t,l.path,r,i,s):function(e,t,i,n,s,a,o){if(null!=zu(s,i))return t;const c=t.serverCache.isFiltered(),l=t.serverCache;if(null!=n.value){if(I(i)&&l.isFullyInitialized()||l.isCompleteForPath(i))return Zu(e,t,i,l.getNode().getChild(i),s,a,c,o);if(I(i)){let n=new S(null);return l.getNode().forEachChild(wl,(e,t)=>{n=n.set(new m(e),t)}),rh(e,t,i,n,s,a,c,o)}return t}{let r=new S(null);return n.foreach((e,t)=>{var n=b(i,e);l.isCompleteForPath(n)&&(r=r.set(e,l.getNode().getChild(n)))}),rh(e,t,i,r,s,a,c,o)}}(e,t,l.path,l.affectedTree,r,i,s)}else{if(n.type!==rc.LISTEN_COMPLETE)throw d("Unknown operation type: "+n.type);a=function(e,t,n,r,i){const s=t.serverCache,a=Eu(t,s.getNode(),s.isFullyInitialized()||I(n),s.isFiltered());return Xu(e,a,n,r,Yu,i)}(e,t,n.path,r,s)}l=s.getChanges();{c=t,i=a,e=l;const u=i.eventCache;if(u.isFullyInitialized()){n=u.getNode().isLeafNode()||u.getNode().isEmpty();const h=ku(c);(0<e.length||!c.eventCache.isFullyInitialized()||n&&!u.getNode().equals(h)||!u.getNode().getPriority().equals(h.getPriority()))&&e.push(Gl(ku(i)))}}return{viewCache:a,changes:l}}(e.processor_,i,t,n,r);return n=e.processor_,r=s.viewCache,y(r.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),y(r.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed"),y(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,ch(e,s.changes,s.viewCache.eventCache.getNode(),null)}function ch(e,t,n,r){r=r?[r]:e.eventRegistrations_;{var i=e.eventGenerator_;e=t,t=n,n=r,r=[];const s=[];return e.forEach(e=>{var t;"child_changed"===e.type&&i.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),bu(i,r,"child_removed",e,n,t),bu(i,r,"child_added",e,n,t),bu(i,r,"child_moved",s,n,t),bu(i,r,"child_changed",e,n,t),bu(i,r,"value",e,n,t),r}}let lh;class uh{constructor(){this.views=new Map}}function hh(t,n,r,i){var e=n.source.queryId;if(null!==e)return e=t.views.get(e),y(null!=e,"SyncTree gave us an op for an invalid query."),oh(e,n,r,i);{let e=[];for(const s of t.views.values())e=e.concat(oh(s,n,r,i));return e}}function dh(e,n,r,i,s){var a=n._queryIdentifier;if(a=e.views.get(a))return a;{let e=ju(r,s?i:null),t;return t=!!e||(e=i instanceof k?Ku(r,i):k.EMPTY_NODE,!1),a=Iu(new _u(e,t,!1),new _u(i,s,!1)),new ih(n,a)}}function ph(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function fh(e,t){let n=null;for(const r of e.views.values())n=n||function(e,t){const n=Su(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!I(t)&&!n.getImmediateChild(g(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function gh(e,t){const n=t._queryParams;if(n.loadsAllData())return yh(e);t=t._queryIdentifier;return e.views.get(t)}function mh(e,t){return null!=gh(e,t)}function vh(e){return null!=yh(e)}function yh(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let _h,wh=1;class bh{constructor(e){this.listenProvider_=e,this.syncPointTree_=new S(null),this.pendingWriteTree_={visibleWrites:Au.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Ih(e,t,n,r,i){var s=e.pendingWriteTree_,a=t,o=n,c=r;return r=i,y(c>s.lastWriteId,"Stacking an older write on top of newer ones"),s.allWrites.push({path:a,snap:o,writeId:c,visible:r=void 0===r||r}),r&&(s.visibleWrites=Nu(s.visibleWrites,a,o)),s.lastWriteId=c,i?Nh(e,new vu(du(),t,n)):[]}function Th(e,t,n=!1){var r=function(t,n){for(let e=0;e<t.allWrites.length;e++){var r=t.allWrites[e];if(r.writeId===n)return r}return null}(e.pendingWriteTree_,t);if(function(t,n){var e,r=t.allWrites.findIndex(e=>e.writeId===n);y(0<=r,"removeWrite called with nonexistent writeId.");const i=t.allWrites[r];t.allWrites.splice(r,1);let s=i.visible,a=!1,o=t.allWrites.length-1;for(;s&&0<=o;){var c=t.allWrites[o];c.visible&&(o>=r&&function(e,t){if(e.snap)return hl(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&hl(b(e.path,n),t))return 1}(c,i.path)?s=!1:hl(i.path,c.path)&&(a=!0)),o--}return s&&(a?((e=t).visibleWrites=Vu(e.allWrites,qu,f()),0<e.allWrites.length?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):i.snap?t.visibleWrites=xu(t.visibleWrites,i.path):Ac(i.children,e=>{t.visibleWrites=xu(t.visibleWrites,b(i.path,e))}),1)}(e.pendingWriteTree_,t)){let t=new S(null);return null!=r.snap?t=t.set(f(),!0):Ac(r.children,e=>{t=t.set(new m(e),!0)}),Nh(e,new gu(r.path,t,n))}return[]}function Eh(e,t,n){return Nh(e,new vu(pu(),t,n))}function kh(n,e,t,r,i=!1){var s=e._path,a=n.syncPointTree_.get(s);let o=[];if(a&&("default"===e._queryIdentifier||mh(a,e))){var c,l,t=function(e,t,n,r){var i=t._queryIdentifier;const s=[];let a=[];var o=vh(e);if("default"===i)for(var[c,l]of e.views.entries())a=a.concat(ah(l,n,r)),sh(l)&&(e.views.delete(c),l.query._queryParams.loadsAllData()||s.push(l.query));else{const u=e.views.get(i);u&&(a=a.concat(ah(u,n,r)),sh(u)&&(e.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return o&&!vh(e)&&s.push((y(lh,"Reference.ts has not been loaded"),new lh(t._repo,t._path))),{removed:s,events:a}}(a,e,t,r);0===a.views.size&&(n.syncPointTree_=n.syncPointTree_.remove(s));const g=t.removed;if(o=t.events,!i){if(a=-1!==g.findIndex(e=>e._queryParams.loadsAllData()),t=n.syncPointTree_.findOnPath(s,(e,t)=>vh(t)),a&&!t){const m=n.syncPointTree_.subtree(s);if(!m.isEmpty()){var u=m.fold((e,t,r)=>{if(t&&vh(t))return[yh(t)];{let n=[];return t&&(n=ph(t)),Ac(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<u.length;++e){var h=(d=u[e]).query,d=Rh(n,d);n.listenProvider_.startListening(Lh(h),xh(n,h),d.hashFn,d.onComplete)}}}!t&&0<g.length&&!r&&(a?n.listenProvider_.stopListening(Lh(e),null):g.forEach(e=>{var t=n.queryToTagMap.get(Dh(e));n.listenProvider_.stopListening(Lh(e),t)}))}var p=n,f=g;for(let e=0;e<f.length;++e){const v=f[e];v._queryParams.loadsAllData()||(c=Dh(v),l=p.queryToTagMap.get(c),p.queryToTagMap.delete(c),p.tagToQueryMap.delete(l))}}return o}function Sh(e,t,n,r){if(null==(r=Ph(e,r)))return[];var i=(s=Oh(r)).path,r=s.queryId,s=cl(i,t);return Mh(e,i,new vu(fu(r),s,n))}function Ch(e,t,n,r=!1){const i=t._path;let s=null,a=!1,o=(e.syncPointTree_.foreachOnPath(i,(e,t)=>{e=cl(e,i);s=s||fh(t,e),a=a||vh(t)}),e.syncPointTree_.get(i));o?(a=a||vh(o),s=s||fh(o,f())):(o=new uh,e.syncPointTree_=e.syncPointTree_.set(i,o));let c;if(null!=s)c=!0;else{c=!1,s=k.EMPTY_NODE;const p=e.syncPointTree_.subtree(i);p.foreachChild((e,t)=>{t=fh(t,f());t&&(s=s.updateImmediateChild(e,t))})}var l,u=mh(o,t),h=(u||t._queryParams.loadsAllData()||(h=Dh(t),y(!e.queryToTagMap.has(h),"View does not exist, but we have a tag"),l=wh++,e.queryToTagMap.set(h,l),e.tagToQueryMap.set(l,h)),Uu(e.pendingWriteTree_,i));let d=function(e,t,n,r,i,s){r=dh(e,t,r,i,s),e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,r),r.eventRegistrations_.push(n);{s=n;const a=(i=r).viewCache_.eventCache,o=[];if(!a.getNode().isLeafNode()){const c=a.getNode();c.forEachChild(E,(e,t)=>{o.push(Hl(e,t))})}return a.isFullyInitialized()&&o.push(Gl(a.getNode())),ch(i,o,a.getNode(),s)}}(o,t,n,h,s,c);return u||a||r||(u=gh(o,t),d=d.concat(function(t,e,n){const r=e._path,i=xh(t,e),s=Rh(t,n),a=t.listenProvider_.startListening(Lh(e),i,s.hashFn,s.onComplete),o=t.syncPointTree_.subtree(r);if(i)y(!vh(o.value),"If we're adding a query, it shouldn't be shadowed");else{var c=o.fold((e,t,r)=>{if(!I(e)&&t&&vh(t))return[yh(t).query];{let n=[];return t&&(n=n.concat(ph(t).map(e=>e.query))),Ac(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<c.length;++e){var l=c[e];t.listenProvider_.stopListening(Lh(l),xh(t,l))}}return a}(e,t,u))),d}function Ah(e,n,t){var r=e.pendingWriteTree_,e=e.syncPointTree_.findOnPath(n,(e,t)=>{t=fh(t,cl(e,n));if(t)return t});return Bu(r,n,e,t,!0)}function Nh(e,t){return function t(n,r,i,s){if(I(n.path))return function i(s,e,a,o){var t=e.get(f());null==a&&null!=t&&(a=fh(t,f()));let c=[];return e.children.inorderTraversal((e,t)=>{var n=a?a.getImmediateChild(e):null,r=Hu(o,e),e=s.operationForChild(e);e&&(c=c.concat(i(e,t,n,r)))}),t&&(c=c.concat(hh(t,s,o,a))),c}(n,r,i,s);{var a=r.get(f());null==i&&null!=a&&(i=fh(a,f()));let e=[];var o,c=g(n.path),l=n.operationForChild(c),r=r.children.get(c);return r&&l&&(o=i?i.getImmediateChild(c):null,c=Hu(s,c),e=e.concat(t(l,r,o,c))),e=a?e.concat(hh(a,n,s,i)):e}}(t,e.syncPointTree_,null,Uu(e.pendingWriteTree_,f()))}function Rh(a,t){const o=t.query,c=xh(a,o);return{hashFn:()=>{const e=t.viewCache_.serverCache.getNode()||k.EMPTY_NODE;return e.hash()},onComplete:e=>{if("ok"===e)return c?(i=a,r=o._path,(t=Ph(i,c))?(s=(n=Oh(t)).path,t=n.queryId,n=cl(s,r),Mh(i,s,new mu(fu(t),n))):[]):(r=a,i=o._path,Nh(r,new mu(pu(),i)));var t,n,r,i,s=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,o);return kh(a,o,null,s)}}}function xh(e,t){t=Dh(t);return e.queryToTagMap.get(t)}function Dh(e){return e._path.toString()+"$"+e._queryIdentifier}function Ph(e,t){return e.tagToQueryMap.get(t)}function Oh(e){var t=e.indexOf("$");return y(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new m(e.substr(0,t))}}function Mh(e,t,n){var r=e.syncPointTree_.get(t);return y(r,"Missing sync point for query tag that we're tracking"),hh(r,n,Uu(e.pendingWriteTree_,t),null)}function Lh(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?(y(_h,"Reference.ts has not been loaded"),new _h(e._repo,e._path)):e}class Fh{constructor(e){this.node_=e}getImmediateChild(e){e=this.node_.getImmediateChild(e);return new Fh(e)}node(){return this.node_}}class Uh{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){e=b(this.path_,e);return new Uh(this.syncTree_,e)}node(){return Ah(this.syncTree_,this.path_)}}function qh(e,t,n){{if(!e||"object"!=typeof e)return e;if(y(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]){var r=e[".sv"];if("timestamp"===r)return n.timestamp;y(!1,"Unexpected server value: "+r)}else{if("object"==typeof e[".sv"]){n=e[".sv"],r=t,n.hasOwnProperty("increment")||y(!1,"Unexpected server value: "+JSON.stringify(n,null,2)),"number"!=typeof(t=n.increment)&&y(!1,"Unexpected increment value: "+t);const i=r.node();if(y(null!==i&&void 0!==i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return t;const s=i;return"number"!=typeof(n=s.getValue())?t:n+t}y(!1,"Unexpected server value: "+JSON.stringify(e,null,2))}}}const Vh=function(e,t,n,r){return jh(t,new Uh(n,e),r)},Bh=function(e,t,n){return jh(e,new Fh(t),n)};function jh(e,r,i){var t,n=qh(e.getPriority().val(),r.getImmediateChild(".priority"),i);let s;if(e.isLeafNode()){const a=e;return(t=qh(a.getValue(),r,i))!==a.getValue()||n!==a.getPriority().val()?new Rl(t,Kl(n)):e}{const o=e;return n!==(s=o).getPriority().val()&&(s=s.updatePriority(new Rl(n))),o.forEachChild(E,(e,t)=>{var n=jh(t,r.getImmediateChild(e),i);n!==t&&(s=s.updateImmediateChild(e,n))}),s}}class Kh{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Wh(e,t){let n=t instanceof m?t:new m(t),r=e,i=g(n);for(;null!==i;){var s=pe(r.node.children,i)||{children:{},childCount:0};r=new Kh(i,r,s),n=w(n),i=g(n)}return r}function zh(e){return e.node.value}function Gh(e,t){e.node.value=t,function e(t){var n,r,i,s;null!==t.parent&&(n=t.parent,r=t.name,i=function(e){return void 0===zh(e)&&!Hh(e)}(t),s=de(n.node.children,r),i&&s?(delete n.node.children[r],n.node.childCount--,e(n)):i||s||(n.node.children[r]=t.node,n.node.childCount++,e(n)))}(e)}function Hh(e){return 0<e.node.childCount}function $h(n,r){Ac(n.node.children,(e,t)=>{r(new Kh(e,n,t))})}function Qh(e){return new m(null===e.parent?e.name:Qh(e.parent)+"/"+e.name)}function Yh(e,t,n,r){r&&void 0===t||ud(ke(e,"value"),t,n)}function Jh(e,t,r,n){if(!n||void 0!==t){const o=ke(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(o+" must be an object containing the children to replace.");const c=[];Ac(t,(e,t)=>{const n=new m(e);if(ud(o,t,b(r,n)),".priority"===sl(n)&&!nd(t))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");c.push(n)});{var i=o;var s=c;let e,t;for(e=0;e<s.length;e++){var a=al(t=s[e]);for(let e=0;e<a.length;e++)if((".priority"!==a[e]||e!==a.length-1)&&!od(a[e]))throw new Error(i+"contains an invalid key ("+a[e]+") in path "+t.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}s.sort(ll);let n=null;for(e=0;e<s.length;e++){if(t=s[e],null!==n&&hl(n,t))throw new Error(i+"contains a path "+n.toString()+" that is ancestor of another path "+t.toString());n=t}}}}function Xh(e,t,n){if(!n||void 0!==t){if(Ec(t))throw new Error(ke(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!nd(t))throw new Error(ke(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function Zh(e,t,n,r){if(!(r&&void 0===n||od(n)))throw new Error(ke(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function ed(e,t,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),hd(e,t,n,r)}function td(e,t){if(".info"===g(t))throw new Error(e+" failed = Can't modify data under /.info/")}function nd(e){return null===e||"string"==typeof e||"number"==typeof e&&!Ec(e)||e&&"object"==typeof e&&de(e,".sv")}function rd(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!od(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!ld(n))throw new Error(ke(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')}const id=/[\[\].#$\/\u0000-\u001F\u007F]/,sd=/[\[\].#$\u0000-\u001F\u007F]/,ad=10485760,od=function(e){return"string"==typeof e&&0!==e.length&&!id.test(e)},cd=function(e){return"string"==typeof e&&0!==e.length&&!sd.test(e)},ld=function(e){return e=e&&e.replace(/^\/*\.info(\/|$)/,"/"),cd(e)},ud=function(s,e,t){const a=t instanceof m?new dl(t,s):t;if(void 0===e)throw new Error(s+"contains undefined "+fl(a));if("function"==typeof e)throw new Error(s+"contains a function "+fl(a)+" with contents = "+e.toString());if(Ec(e))throw new Error(s+"contains "+e.toString()+" "+fl(a));if("string"==typeof e&&e.length>ad/3&&Ae(e)>ad)throw new Error(s+"contains a string greater than "+ad+" utf8 bytes "+fl(a)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let r=!1,i=!1;if(Ac(e,(e,t)=>{if(".value"===e)r=!0;else if(".priority"!==e&&".sv"!==e&&(i=!0,!od(e)))throw new Error(s+" contains an invalid key ("+e+") "+fl(a)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var n=a;0<n.parts_.length&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ae(e),pl(n),ud(s,t,a),e=(t=a).parts_.pop(),t.byteLength_-=Ae(e),0<t.parts_.length&&--t.byteLength_}),r&&i)throw new Error(s+' contains ".value" child '+fl(a)+" in addition to actual children.")}},hd=function(e,t,n,r){if(!(r&&void 0===n||cd(n)))throw new Error(ke(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')};class dd{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function pd(t,n){let r=null;for(let e=0;e<n.length;e++){const s=n[e];var i=s.getPath();null===r||ul(i,r.path)||(t.eventLists_.push(r),r=null),(r=null===r?{events:[],path:i}:r).events.push(s)}r&&t.eventLists_.push(r)}function fd(e,t,n){pd(e,n),md(e,e=>ul(e,t))}function gd(e,t,n){pd(e,n),md(e,e=>hl(e,t)||hl(t,e))}function md(t,n){t.recursionDepth_++;let r=!0;for(let e=0;e<t.eventLists_.length;e++){var i,s=t.eventLists_[e];if(s)if(n(s.path)){{i=void 0;var a=t.eventLists_[e];for(let e=0;e<a.events.length;e++){const o=a.events[e];null!==o&&(a.events[e]=null,i=o.getEventRunner(),hc&&wc("event: "+o.toString()),Mc(i))}}t.eventLists_[e]=null}else r=!1}r&&(t.eventLists_=[]),t.recursionDepth_--}const vd="repo_interrupt",yd=25;class _d{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new dd,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ou(),this.transactionQueueTree_=new Kh,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function wd(e){const t=e.infoData_.getNode(new m(".info/serverTimeOffset"));e=t.val()||0;return(new Date).getTime()+e}function bd(e){return(e=(e={timestamp:wd(e)})||{}).timestamp=e.timestamp||(new Date).getTime(),e}function Id(e,t,n,r,i){e.dataUpdateCount++;var s,a,o,c,l,u,h,d,p,f=new m(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let g=f;0<(p=i?r?(s=ge(n,e=>Kl(e)),o=e.serverSyncTree_,p=f,c=s,(h=Ph(o,i))?(l=(d=Oh(h)).path,u=d.queryId,h=cl(l,p),d=S.fromObject(c),Mh(o,l,new yu(fu(u),h,d))):[]):(s=Kl(n),Sh(e.serverSyncTree_,f,s,i)):r?(a=ge(n,e=>Kl(e)),t=e.serverSyncTree_,i=f,r=a,a=S.fromObject(r),Nh(t,new yu(pu(),i,a))):(a=Kl(n),Eh(e.serverSyncTree_,f,a))).length&&(g=Od(e,f)),gd(e.eventQueue_,g,p)}function Td(e,t){if(Ed(e,"connected",t),!1===t){var r=e;Rd(r,"onDisconnectEvents");const i=bd(r),s=ou();lu(r.onDisconnect_,f(),(e,t)=>{t=Vh(e,t,r.serverSyncTree_,i);cu(s,e,t)});let n=[];lu(s,f(),(e,t)=>{n=n.concat(Eh(r.serverSyncTree_,e,t));t=Ud(r,e);Od(r,t)}),r.onDisconnect_=ou(),gd(r.eventQueue_,f(),n)}}function Ed(e,t,n){t=new m("/.info/"+t),n=Kl(n);e.infoData_.updateSnapshot(t,n),n=Eh(e.infoSyncTree_,t,n),gd(e.eventQueue_,t,n)}function kd(e){return e.nextWriteId_++}function Sd(r,i,e,t,s){Rd(r,"set",{path:i.toString(),value:e,priority:t});var n=bd(r);const a=Kl(e,t);e=Ah(r.serverSyncTree_,i),n=Bh(a,e,n);const o=kd(r);n=Ih(r.serverSyncTree_,i,n,o,!0),pd(r.eventQueue_,n),r.server_.put(i.toString(),a.val(!0),(e,t)=>{var n="ok"===e;n||Ic("set at "+i+" failed: "+e),n=Th(r.serverSyncTree_,o,!n),gd(r.eventQueue_,i,n),xd(0,s,e,t)}),n=Ud(r,i),Od(r,n),gd(r.eventQueue_,n,[])}function Cd(n,r,e,i){const s=Kl(e);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&cu(n.onDisconnect_,r,s),xd(0,i,e,t)})}function Ad(e,t,n){n=".info"===g(t._path)?kh(e.infoSyncTree_,t,n):kh(e.serverSyncTree_,t,n);fd(e.eventQueue_,t._path,n)}function Nd(e){e.persistentConnection_&&e.persistentConnection_.interrupt(vd)}function Rd(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),wc(n,...t)}function xd(e,r,i,s){r&&Mc(()=>{if("ok"===i)r(null);else{var t=(i||"error").toUpperCase();let e=t;s&&(e+=": "+s);const n=new Error(e);n.code=t,r(n)}})}function Dd(e,t,n){return Ah(e.serverSyncTree_,t,n)||k.EMPTY_NODE}function Pd(n,e=n.transactionQueueTree_){if(e||Fd(n,e),zh(e)){const c=Ld(n,e);if(y(0<c.length,"Sending zero length transaction queue"),c.every(e=>0===e.status)){var i=n,s=Qh(e),a=c;const l=a.map(e=>e.currentWriteId),u=Dd(i,s,l);let t=u;var r=u.hash();for(let e=0;e<a.length;e++){const p=a[e];y(0===p.status,"tryToSendTransactionQueue_: items in queue should all be run."),p.status=1,p.retryCount++;var o=cl(s,p.path);t=t.updateChild(o,p.currentOutputSnapshotRaw)}const h=t.val(!0),d=s;i.server_.put(d.toString(),h,t=>{Rd(i,"transaction put response",{path:d.toString(),status:t});let n=[];if("ok"===t){const r=[];for(let e=0;e<a.length;e++)a[e].status=2,n=n.concat(Th(i.serverSyncTree_,a[e].currentWriteId)),a[e].onComplete&&r.push(()=>a[e].onComplete(null,!0,a[e].currentOutputSnapshotResolved)),a[e].unwatcher();Fd(i,Wh(i.transactionQueueTree_,s)),Pd(i,i.transactionQueueTree_),gd(i.eventQueue_,s,n);for(let e=0;e<r.length;e++)Mc(r[e])}else{if("datastale"===t)for(let e=0;e<a.length;e++)3===a[e].status?a[e].status=4:a[e].status=0;else{Ic("transaction at "+d.toString()+" failed: "+t);for(let e=0;e<a.length;e++)a[e].status=4,a[e].abortReason=t}Od(i,s)}},r)}}else Hh(e)&&$h(e,e=>{Pd(n,e)})}function Od(e,t){var t=Md(e,t),n=Qh(t),i=e,s=Ld(e,t),a=n;if(0!==s.length){const l=[];let r=[];const u=s.filter(e=>0===e.status),h=u.map(e=>e.currentWriteId);for(let n=0;n<s.length;n++){const d=s[n];var o=cl(a,d.path);let e=!1,t;if(y(null!==o,"rerunTransactionsUnderNode_: relativePath should not be null."),4===d.status)e=!0,t=d.abortReason,r=r.concat(Th(i.serverSyncTree_,d.currentWriteId,!0));else if(0===d.status)if(d.retryCount>=yd)e=!0,t="maxretry",r=r.concat(Th(i.serverSyncTree_,d.currentWriteId,!0));else{const p=Dd(i,d.path,h);d.currentInputSnapshot=p;var c=s[n].update(p.val());if(void 0!==c){ud("transaction failed: Data returned ",c,d.path);let e=Kl(c);"object"==typeof c&&null!=c&&de(c,".priority")||(e=e.updatePriority(p.getPriority())),o=d.currentWriteId,c=bd(i),c=Bh(e,p,c),d.currentOutputSnapshotRaw=e,d.currentOutputSnapshotResolved=c,d.currentWriteId=kd(i),h.splice(h.indexOf(o),1),r=(r=r.concat(Ih(i.serverSyncTree_,d.path,c,d.currentWriteId,d.applyLocally))).concat(Th(i.serverSyncTree_,o,!0))}else e=!0,t="nodata",r=r.concat(Th(i.serverSyncTree_,d.currentWriteId,!0))}gd(i.eventQueue_,a,r),r=[],e&&(s[n].status=2,c=s[n].unwatcher,setTimeout(c,Math.floor(0)),s[n].onComplete&&("nodata"===t?l.push(()=>s[n].onComplete(null,!1,s[n].currentInputSnapshot)):l.push(()=>s[n].onComplete(new Error(t),!1,null))))}Fd(i,i.transactionQueueTree_);for(let e=0;e<l.length;e++)Mc(l[e]);Pd(i,i.transactionQueueTree_)}return n}function Md(e,t){let n,r=e.transactionQueueTree_;for(n=g(t);null!==n&&void 0===zh(r);)r=Wh(r,n),t=w(t),n=g(t);return r}function Ld(e,t){const n=[];return function t(n,e,r){var i=zh(e);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);$h(e,e=>{t(n,e,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function Fd(t,e){const n=zh(e);if(n){let t=0;for(let e=0;e<n.length;e++)2!==n[e].status&&(n[t]=n[e],t++);n.length=t,Gh(e,0<n.length?n:void 0)}$h(e,e=>{Fd(t,e)})}function Ud(t,n){var r,e=Qh(Md(t,n)),n=Wh(t.transactionQueueTree_,n);{var i=n;let e=i.parent;for(;null!==e;)r=e,qd(t,r),e=e.parent}return qd(t,n),function t(e,n,r,i){r&&!i&&n(e),$h(e,e=>{t(e,n,!0,i)}),r&&i&&n(e)}(n,e=>{qd(t,e)}),e}function qd(r,e){const i=zh(e);if(i){const s=[];let t=[],n=-1;for(let e=0;e<i.length;e++)3!==i[e].status&&(1===i[e].status?(y(n===e-1,"All SENT items should be at beginning of queue."),n=e,i[e].status=3,i[e].abortReason="set"):(y(0===i[e].status,"Unexpected transaction status in abort"),i[e].unwatcher(),t=t.concat(Th(r.serverSyncTree_,i[e].currentWriteId,!0)),i[e].onComplete&&s.push(i[e].onComplete.bind(null,new Error("set"),!1,null))));-1===n?Gh(e,void 0):i.length=n+1,gd(r.eventQueue_,Qh(e),t);for(let e=0;e<s.length;e++)Mc(s[e])}}function Vd(e,t){var n=(e=Bd(e)).namespace,r=("firebase.com"===e.domain&&bc(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===e.domain||bc("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||Tc(),"ws"===e.scheme||"wss"===e.scheme);return{repoInfo:new jc(e.host,e.secure,n,r,t,"",n!==e.subdomain),path:new m(e.pathString)}}const Bd=function(s){let n="",r="",a="",o="",c="",l=!0,u="https",h=443;if("string"==typeof s){let e=s.indexOf("//"),t=(0<=e&&(u=s.substring(0,e-1),s=s.substring(e+2)),s.indexOf("/")),i=(-1===t&&(t=s.length),s.indexOf("?"));-1===i&&(i=s.length),n=s.substring(0,Math.min(t,i)),t<i&&(o=function(){let n="";var r=s.substring(t,i).split("/");for(let t=0;t<r.length;t++)if(0<r[t].length){let e=r[t];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}n+="/"+e}return n}());var d,p=function(e){const t={};for(const r of(e="?"===e.charAt(0)?e.substring(1):e).split("&")){var n;0!==r.length&&(2===(n=r.split("=")).length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):Ic(`Invalid query segment '${r}' in query '${e}'`))}return t}(s.substring(Math.min(s.length,i)));0<=(e=n.indexOf(":"))?(l="https"===u||"wss"===u,h=parseInt(n.substring(e+1),10)):e=n.length;const f=n.slice(0,e);"localhost"===f.toLowerCase()?r="localhost":f.split(".").length<=2?r=f:(d=n.indexOf("."),a=n.substring(0,d).toLowerCase(),r=n.substring(d+1),c=a),"ns"in p&&(c=p.ns)}return{host:n,port:h,domain:r,subdomain:a,secure:l,scheme:u,pathString:o,namespace:c}},jd="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Kd=function(){let s=0;const a=[];return function(e){var t=e===s;s=e;let n;const r=new Array(8);for(n=7;0<=n;n--)r[n]=jd.charAt(e%64),e=Math.floor(e/64);y(0===e,"Cannot push at time == 0");let i=r.join("");if(t){for(n=11;0<=n&&63===a[n];n--)a[n]=0;a[n]++}else for(n=0;n<12;n++)a[n]=Math.floor(64*Math.random());for(n=0;n<12;n++)i+=jd.charAt(a[n]);return y(20===i.length,"nextPushId: Length should be 20."),i}}();class Wd{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){var e=this.snapshot.ref;return("value"===this.eventType?e:e.parent)._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ue(this.snapshot.exportVal())}}class zd{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Gd{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return y(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Hd{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new ie;return n=this._repo,r=this._path,i=e.wrapCallback(()=>{}),n.server_.onDisconnectCancel(r.toString(),(e,t)=>{"ok"===e&&!function e(n,t){if(I(t))return n.value=null,n.children.clear(),!0;if(null===n.value)return!(0<n.children.size)||(r=g(t),t=w(t),n.children.has(r)&&e(n.children.get(r),t)&&n.children.delete(r),0===n.children.size);var r;if(n.value.isLeafNode())return!1;{const i=n.value;return n.value=null,i.forEachChild(E,(e,t)=>{cu(n,new m(e),t)}),e(n,t)}}(n.onDisconnect_,r),xd(0,i,e,t)}),e.promise;var n,r,i}remove(){td("OnDisconnect.remove",this._path);const e=new ie;return Cd(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){td("OnDisconnect.set",this._path),Yh("OnDisconnect.set",e,this._path,!1);const t=new ie;return Cd(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){td("OnDisconnect.setWithPriority",this._path),Yh("OnDisconnect.setWithPriority",e,this._path,!1),Xh("OnDisconnect.setWithPriority",t,!1);const n=new ie;{var r=this._repo,i=this._path,s=n.wrapCallback(()=>{});const a=Kl(e,t);r.server_.onDisconnectPut(i.toString(),a.val(!0),(e,t)=>{"ok"===e&&cu(r.onDisconnect_,i,a),xd(0,s,e,t)})}return n.promise}update(e){td("OnDisconnect.update",this._path),Jh("OnDisconnect.update",e,this._path,!1);const t=new ie;return n=this._repo,r=this._path,i=e,s=t.wrapCallback(()=>{}),fe(i)?(wc("onDisconnect().update() called with empty data.  Don't do anything."),xd(0,s,"ok",void 0)):n.server_.onDisconnectMerge(r.toString(),i,(e,t)=>{"ok"===e&&Ac(i,(e,t)=>{t=Kl(t);cu(n.onDisconnect_,b(r,e),t)}),xd(0,s,e,t)}),t.promise;var n,r,i,s}}class $d{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return I(this._path)?null:sl(this._path)}get ref(){return new Xd(this._repo,this._path)}get _queryIdentifier(){var e;return"{}"===(e=vc(iu(this._queryParams)))?"default":e}get _queryObject(){return iu(this._queryParams)}isEqual(e){if(!((e=_(e))instanceof $d))return!1;var t=this._repo===e._repo,n=ul(this._path,e._path),e=this._queryIdentifier===e._queryIdentifier;return t&&n&&e}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(t){let n="";for(let e=t.pieceNum_;e<t.pieces_.length;e++)""!==t.pieces_[e]&&(n+="/"+encodeURIComponent(String(t.pieces_[e])));return n||"/"}(this._path)}}function Qd(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function Yd(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===wl){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==kc)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==Sc)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===E){if(null!=t&&!nd(t)||null!=n&&!nd(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(y(e.getIndex()instanceof Wl||e.getIndex()===zl,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Jd(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Xd extends $d{constructor(e,t){super(e,t,new Zl,!1)}get parent(){var e=ol(this._path);return null===e?null:new Xd(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Zd{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){var t=new m(e),e=np(this.ref,e);return new Zd(this._node.getChild(t),e,E)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(n){if(this._node.isLeafNode())return!1;const e=this._node;return!!e.forEachChild(this._index,(e,t)=>n(new Zd(t,np(this.ref,e),E)))}hasChild(e){e=new m(e);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ep(e,t){return(e=_(e))._checkNotDeleted("ref"),void 0!==t?np(e._root,t):e._root}function tp(e,t){(e=_(e))._checkNotDeleted("refFromURL");const n=Vd(t,e._repo.repoInfo_.nodeAdmin);rd("refFromURL",n);t=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||t.host===e._repo.repoInfo_.host||bc("refFromURL: Host name does not match the current database: (found "+t.host+" but expected "+e._repo.repoInfo_.host+")"),ep(e,n.path.toString())}function np(e,t){return(null===g((e=_(e))._path)?ed:hd)("child","path",t,!1),new Xd(e._repo,b(e._path,t))}function rp(e,t){td("set",(e=_(e))._path),Yh("set",t,e._path,!1);const n=new ie;return Sd(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function ip(e,t){Jh("update",t,e._path,!1);const r=new ie;{var i=e._repo,s=e._path,a=(e=t,r.wrapCallback(()=>{})),o,c,l,u,h,d;Rd(i,"update",{path:s.toString(),value:e});let n=!0;const p=bd(i),f={};if(Ac(e,(e,t)=>{n=!1,f[e]=Vh(b(s,e),Kl(t),i.serverSyncTree_,p)}),n)wc("update() called with empty data.  Don't do anything."),xd(0,a,"ok",void 0);else{const g=kd(i);t=i.serverSyncTree_,o=s,c=f,l=g,u=t.pendingWriteTree_,h=o,d=c,y(l>u.lastWriteId,"Stacking an older merge on top of newer ones"),u.allWrites.push({path:h,children:d,writeId:l,visible:!0}),u.visibleWrites=Ru(u.visibleWrites,h,d),u.lastWriteId=l,h=S.fromObject(c);d=Nh(t,new yu(du(),o,h));pd(i.eventQueue_,d),i.server_.merge(s.toString(),e,(e,t)=>{(r="ok"===e)||Ic("update at "+s+" failed: "+e);var n=Th(i.serverSyncTree_,g,!r),r=0<n.length?Od(i,s):s;gd(i.eventQueue_,r,n),xd(0,a,e,t)}),Ac(e,e=>{e=Ud(i,b(s,e));Od(i,e)}),gd(i.eventQueue_,s,[])}}return r.promise}function sp(t){t=_(t);var e=new Gd(()=>{}),e=new ap(e),n=t._repo,r=t,i=e;return(null!=(e=function(e,t){const n=t._path;let r=null,i=(e.syncPointTree_.foreachOnPath(n,(e,t)=>{e=cl(e,n);r=r||fh(t,e)}),e.syncPointTree_.get(n));i?r=r||fh(i,f()):(i=new uh,e.syncPointTree_=e.syncPointTree_.set(n,i));var s=null!=r;const a=s?new _u(r,!0,!1):null;return e=Uu(e.pendingWriteTree_,t._path),ku(dh(i,t,e,s?a.getNode():k.EMPTY_NODE,s).viewCache_)}(n.serverSyncTree_,r))?Promise.resolve(e):n.server_.get(r).then(e=>{var t,e=Kl(e).withIndex(r._queryParams.getIndex());return Ch(n.serverSyncTree_,r,i,!0),t=r._queryParams.loadsAllData()?Eh(n.serverSyncTree_,r._path,e):(t=xh(n.serverSyncTree_,r),Sh(n.serverSyncTree_,r._path,e,t)),gd(n.eventQueue_,r._path,t),kh(n.serverSyncTree_,r,i,null,!0),e},e=>(Rd(n,"get for query "+ue(r)+" failed: "+e),Promise.reject(new Error(e))))).then(e=>new Zd(e,new Xd(t._repo,t._path),t._queryParams.getIndex()))}class ap{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){var n=t._queryParams.getIndex();return new Wd("value",this,new Zd(e.snapshotNode,new Xd(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new zd(this,e,t):null}matches(e){return e instanceof ap&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class op{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new zd(this,e,t):null}createEvent(e,t){y(null!=e.childName,"Child events should have a childName.");var n=np(new Xd(t._repo,t._path),e.childName),t=t._queryParams.getIndex();return new Wd(e.type,this,new Zd(e.snapshotNode,n,t),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof op&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function cp(n,e,t,r,i){let s;if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){const c=t;var a=(e,t)=>{Ad(n._repo,n,o),c(e,t)};a.userCallback=t.userCallback,a.context=t.context,t=a}a=new Gd(t,s||void 0);const o="value"===e?new ap(a):new op(e,a);r=n._repo,i=n,t=o;return t=".info"===g(i._path)?Ch(r.infoSyncTree_,i,t):Ch(r.serverSyncTree_,i,t),fd(r.eventQueue_,i._path,t),()=>Ad(n._repo,n,o)}function lp(e,t,n,r){return cp(e,"value",t,n,r)}function up(e,t,n,r){cp(e,"child_added",t,n,r)}function hp(e,t,n,r){cp(e,"child_changed",t,n,r)}function dp(e,t,n,r){cp(e,"child_moved",t,n,r)}function pp(e,t,n,r){cp(e,"child_removed",t,n,r)}function fp(e,t,n){let r=null;n=n?new Gd(n):null;"value"===t?r=new ap(n):t&&(r=new op(t,n)),Ad(e._repo,e,r)}class gp{}class mp extends gp{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Yh("endAt",this._value,e._path,!0);var t=tu(e._queryParams,this._value,this._key);if(Jd(t),Yd(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new $d(e._repo,e._path,t,e._orderByCalled)}}class vp extends gp{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Yh("endBefore",this._value,e._path,!1);var t=function(e,t,n){let r;return(r=e.index_===wl||n?tu(e,t,n):tu(e,t,kc)).endBeforeSet_=!0,r}(e._queryParams,this._value,this._key);if(Jd(t),Yd(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new $d(e._repo,e._path,t,e._orderByCalled)}}class yp extends gp{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Yh("startAt",this._value,e._path,!0);var t=eu(e._queryParams,this._value,this._key);if(Jd(t),Yd(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new $d(e._repo,e._path,t,e._orderByCalled)}}class _p extends gp{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Yh("startAfter",this._value,e._path,!1);var t=function(e,t,n){let r;return(r=e.index_===wl||n?eu(e,t,n):eu(e,t,Sc)).startAfterSet_=!0,r}(e._queryParams,this._value,this._key);if(Jd(t),Yd(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new $d(e._repo,e._path,t,e._orderByCalled)}}class wp extends gp{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new $d(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}class bp extends gp{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new $d(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}class Ip extends gp{constructor(e){super(),this._path=e}_apply(e){Qd(e,"orderByChild");var t=new m(this._path);if(I(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");return t=new Wl(t),Yd(t=nu(e._queryParams,t)),new $d(e._repo,e._path,t,!0)}}class Tp extends gp{_apply(e){Qd(e,"orderByKey");var t=nu(e._queryParams,wl);return Yd(t),new $d(e._repo,e._path,t,!0)}}class Ep extends gp{_apply(e){Qd(e,"orderByPriority");var t=nu(e._queryParams,E);return Yd(t),new $d(e._repo,e._path,t,!0)}}class kp extends gp{_apply(e){Qd(e,"orderByValue");var t=nu(e._queryParams,zl);return Yd(t),new $d(e._repo,e._path,t,!0)}}class Sp extends gp{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(Yh("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new mp(this._value,this._key)._apply(new yp(this._value,this._key)._apply(e))}}function Cp(e,...t){let n=_(e);for(const r of t)n=r._apply(n);return n}Wp=Xd,y(!lh,"__referenceConstructor has already been defined"),lh=Wp,Wp=Xd,y(!_h,"__referenceConstructor has already been defined"),_h=Wp;const Ap={};function Np(e,t,n,r,i){let s=r||e.options.databaseURL,a=(void 0===s&&(e.options.projectId||bc("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),wc("Using default host for project ",e.options.projectId),s=e.options.projectId+"-default-rtdb.firebaseio.com"),Vd(s,i)),o=a.repoInfo,c,l=void 0;(l="undefined"!=typeof process&&process.env?process.env.FIREBASE_DATABASE_EMULATOR_HOST:l)?(c=!0,s=`http://${l}?ns=`+o.namespace,a=Vd(s,i),o=a.repoInfo):c=!a.repoInfo.secure;r=i&&c?new Uc(Uc.OWNER):new Fc(e.name,e.options,t);return rd("Invalid Firebase Database URL",a),I(a.path)||bc("Database URL must point to the root of a Firebase Database (not including a child path)."),r=function(e,t,n,r){let i=Ap[t.name];return i||(i={},Ap[t.name]=i),i[e.toURLString()]&&bc("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),t=new _d(e,!1,n,r),i[e.toURLString()]=t}(o,e,r,new Lc(e.name,n)),new Rp(r,e)}class Rp{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){if(!this._instanceStarted){var a=this._repoInternal,e=this.app.options.appId,t=this.app.options.databaseAuthVariableOverride,n;if(a.stats_=Hc(a.repoInfo_),a.forceRestClient_||function(){const e="object"==typeof window&&window.navigator&&window.navigator.userAgent||"";return 0<=e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)}())a.server_=new su(a.repoInfo_,(e,t,n,r)=>{Id(a,e,t,n,r)},a.authTokenProvider_,a.appCheckProvider_),setTimeout(()=>Td(a,!0),0);else{if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ue(t)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}a.persistentConnection_=new ml(a.repoInfo_,e,(e,t,n,r)=>{Id(a,e,t,n,r)},e=>{Td(a,e)},e=>{var n=a;Ac(e,(e,t)=>{Ed(n,e,t)})},a.authTokenProvider_,a.appCheckProvider_,t),a.server_=a.persistentConnection_}a.authTokenProvider_.addTokenChangeListener(e=>{a.server_.refreshAuthToken(e)}),a.appCheckProvider_.addTokenChangeListener(e=>{a.server_.refreshAppCheckToken(e.token)}),a.statsReporter_=(t=()=>new hu(a.stats_,a.server_),n=(e=a.repoInfo_).toString(),Gc[n]||(Gc[n]=t()),Gc[n]),a.infoData_=new au,a.infoSyncTree_=new bh({startListening:(e,t,n,r)=>{let i=[];const s=a.infoData_.getNode(e._path);return s.isEmpty()||(i=Eh(a.infoSyncTree_,e._path,s),setTimeout(()=>{r("ok")},0)),i},stopListening:()=>{}}),Ed(a,"connected",!1),a.serverSyncTree_=new bh({startListening:(n,e,t,r)=>(a.server_.listen(n,t,e,(e,t)=>{e=r(e,t);gd(a.eventQueue_,n._path,e)}),[]),stopListening:(e,t)=>{a.server_.unlisten(e,t)}}),this._instanceStarted=!0}return this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Xd(this._repo,f())),this._rootInternal}_delete(){if(null!==this._rootInternal){{var e=this._repo,t=this.app.name;const n=Ap[t];n&&n[e.key]===e||bc(`Database ${t}(${e.repoInfo_}) has already been deleted.`),Nd(e),delete n[e.key]}this._repoInternal=null,this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&bc("Cannot call "+e+" on a deleted database.")}}function xp(){Zc.IS_TRANSPORT_INITIALIZED&&Ic("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Dp(){xp(),Qc.forceDisallow()}function Pp(){xp(),Xc.forceDisallow(),Qc.forceAllow()}class Op{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function Mp(i,t,e){if(td("Reference.transaction",(i=_(i))._path),".length"===i.key||".keys"===i.key)throw"Reference.transaction failed: "+i.key+" is a read-only object.";var n=null==(e=null==e?void 0:e.applyLocally)||e;const s=new ie;e=lp(i,()=>{});{var r=i._repo,a=i._path;Rd(r,"transaction on "+a);const o={path:a,update:t,onComplete:(e,t,n)=>{var r;e?s.reject(e):(r=new Zd(n,new Xd(i._repo,i._path),E),s.resolve(new Op(t,r)))},status:null,order:lc(),applyLocally:n,retryCount:0,unwatcher:e,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},c=Dd(r,a,void 0);if(o.currentInputSnapshot=c,void 0===(t=o.update(c.val())))o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{ud("transaction failed: Data returned ",t,o.path),o.status=0;n=Wh(r.transactionQueueTree_,a);const l=zh(n)||[];l.push(o),Gh(n,l);let e;if("object"==typeof t&&null!==t&&de(t,".priority"))e=pe(t,".priority"),y(nd(e),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{const u=Ah(r.serverSyncTree_,a)||k.EMPTY_NODE;e=u.getPriority().val()}n=bd(r),t=Kl(t,e),n=Bh(t,c,n),o.currentOutputSnapshotRaw=t,o.currentOutputSnapshotResolved=n,o.currentWriteId=kd(r),n=Ih(r.serverSyncTree_,a,n,o.currentWriteId,o.applyLocally),gd(r.eventQueue_,a,n),Pd(r,r.transactionQueueTree_)}}return s.promise}function Lp(e){e="FIREBASE WARNING: "+e;Fp.warn(e)}ml.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},ml.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},ec(bt),vt(new o("database",(e,{instanceIdentifier:t})=>Np(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),r(Hn,_o,void 0),r(Hn,_o,"esm2017");const Fp=new je("@firebase/database-compat");class Up{constructor(e){this._delegate=e}cancel(t){c("OnDisconnect.cancel",0,1,arguments.length),Se("OnDisconnect.cancel","onComplete",t,!0);const e=this._delegate.cancel();return t&&e.then(()=>t(null),e=>t(e)),e}remove(t){c("OnDisconnect.remove",0,1,arguments.length),Se("OnDisconnect.remove","onComplete",t,!0);const e=this._delegate.remove();return t&&e.then(()=>t(null),e=>t(e)),e}set(e,t){c("OnDisconnect.set",1,2,arguments.length),Se("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then(()=>t(null),e=>t(e)),n}setWithPriority(e,t,n){c("OnDisconnect.setWithPriority",2,3,arguments.length),Se("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then(()=>n(null),e=>n(e)),r}update(t,n){if(c("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,Lp("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Se("OnDisconnect.update","onComplete",n,!0);const e=this._delegate.update(t);return n&&e.then(()=>n(null),e=>n(e)),e}}class qp{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return c("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class Vp{constructor(e,t){this._database=e,this._delegate=t}val(){return c("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return c("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return c("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return c("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return c("DataSnapshot.child",0,1,arguments.length),e=String(e),hd("DataSnapshot.child","path",e,!1),new Vp(this._database,this._delegate.child(e))}hasChild(e){return c("DataSnapshot.hasChild",1,1,arguments.length),hd("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return c("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return c("DataSnapshot.forEach",1,1,arguments.length),Se("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new Vp(this._database,e)))}hasChildren(){return c("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return c("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return c("DataSnapshot.ref",0,0,arguments.length),new jp(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class Bp{constructor(e,t){this.database=e,this._delegate=t}on(e,n,t,r){c("Query.on",2,4,arguments.length),Se("Query.on","callback",n,!1);const i=Bp.getCancelAndContextArgs_("Query.on",t,r);var s=(e,t)=>{n.call(i.context,new Vp(this.database,e),t)},a=(s.userCallback=n,s.context=i.context,null==(t=i.cancel)?void 0:t.bind(i.context));switch(e){case"value":return lp(this._delegate,s,a),n;case"child_added":return up(this._delegate,s,a),n;case"child_removed":return pp(this._delegate,s,a),n;case"child_changed":return hp(this._delegate,s,a),n;case"child_moved":return dp(this._delegate,s,a),n;default:throw new Error(ke("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){var r;if(c("Query.off",0,3,arguments.length),void 0!==e)switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(ke("Query.off","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}Se("Query.off","callback",t,!0),Ce("Query.off","context",n,!0),t?((r=()=>{}).userCallback=t,r.context=n,fp(this._delegate,e,r)):fp(this._delegate,e)}get(){return sp(this._delegate).then(e=>new Vp(this.database,e))}once(e,n,t,r){c("Query.once",1,4,arguments.length),Se("Query.once","callback",n,!0);const i=Bp.getCancelAndContextArgs_("Query.once",t,r),s=new ie;var a=(e,t)=>{e=new Vp(this.database,e);n&&n.call(i.context,e,t),s.resolve(e)},o=(a.userCallback=n,a.context=i.context,e=>{i.cancel&&i.cancel.call(i.context,e),s.reject(e)});switch(e){case"value":lp(this._delegate,a,o,{onlyOnce:!0});break;case"child_added":up(this._delegate,a,o,{onlyOnce:!0});break;case"child_removed":pp(this._delegate,a,o,{onlyOnce:!0});break;case"child_changed":hp(this._delegate,a,o,{onlyOnce:!0});break;case"child_moved":dp(this._delegate,a,o,{onlyOnce:!0});break;default:throw new Error(ke("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return c("Query.limitToFirst",1,1,arguments.length),new Bp(this.database,Cp(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new wp(e)}(e)))}limitToLast(e){return c("Query.limitToLast",1,1,arguments.length),new Bp(this.database,Cp(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new bp(e)}(e)))}orderByChild(e){return c("Query.orderByChild",1,1,arguments.length),new Bp(this.database,Cp(this._delegate,function(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return hd("orderByChild","path",e,!1),new Ip(e)}(e)))}orderByKey(){return c("Query.orderByKey",0,0,arguments.length),new Bp(this.database,Cp(this._delegate,new Tp))}orderByPriority(){return c("Query.orderByPriority",0,0,arguments.length),new Bp(this.database,Cp(this._delegate,new Ep))}orderByValue(){return c("Query.orderByValue",0,0,arguments.length),new Bp(this.database,Cp(this._delegate,new kp))}startAt(e=null,t){return c("Query.startAt",0,2,arguments.length),new Bp(this.database,Cp(this._delegate,([e=null,t]=[e,t],Zh("startAt","key",t,!0),new yp(e,t))))}startAfter(e=null,t){return c("Query.startAfter",0,2,arguments.length),new Bp(this.database,Cp(this._delegate,(Zh("startAfter","key",t,!0),new _p(e,t))))}endAt(e=null,t){return c("Query.endAt",0,2,arguments.length),new Bp(this.database,Cp(this._delegate,(Zh("endAt","key",t,!0),new mp(e,t))))}endBefore(e=null,t){return c("Query.endBefore",0,2,arguments.length),new Bp(this.database,Cp(this._delegate,(Zh("endBefore","key",t,!0),new vp(e,t))))}equalTo(e,t){return c("Query.equalTo",1,2,arguments.length),new Bp(this.database,Cp(this._delegate,(Zh("equalTo","key",t,!0),new Sp(e,t))))}toString(){return c("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return c("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(c("Query.isEqual",1,1,arguments.length),e instanceof Bp)return this._delegate.isEqual(e._delegate);throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,Se(e,"cancel",r.cancel,!0),r.context=n,Ce(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(ke(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new jp(this.database,new Xd(this._delegate._repo,this._delegate._path))}}class jp extends Bp{constructor(e,t){super(e,new $d(t._repo,t._path,new Zl,!1)),this.database=e,this._delegate=t}getKey(){return c("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return c("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new jp(this.database,np(this._delegate,e))}getParent(){c("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new jp(this.database,e):null}getRoot(){return c("Reference.root",0,0,arguments.length),new jp(this.database,this._delegate.root)}set(e,t){c("Reference.set",1,2,arguments.length),Se("Reference.set","onComplete",t,!0);const n=rp(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}update(t,n){if(c("Reference.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,Lp("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}td("Reference.update",this._delegate._path),Se("Reference.update","onComplete",n,!0);const e=ip(this._delegate,t);return n&&e.then(()=>n(null),e=>n(e)),e}setWithPriority(e,t,n){c("Reference.setWithPriority",2,3,arguments.length),Se("Reference.setWithPriority","onComplete",n,!0);const r=function(e,t,n){if(td("setWithPriority",e._path),Yh("setWithPriority",t,e._path,!1),Xh("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new ie;return Sd(e._repo,e._path,t,n,r.wrapCallback(()=>{})),r.promise}(this._delegate,e,t);return n&&r.then(()=>n(null),e=>n(e)),r}remove(t){c("Reference.remove",0,1,arguments.length),Se("Reference.remove","onComplete",t,!0);td("remove",(n=this._delegate)._path);const e=rp(n,null);var n;return t&&e.then(()=>t(null),e=>t(e)),e}transaction(e,t,n){if(c("Reference.transaction",1,3,arguments.length),Se("Reference.transaction","transactionUpdate",e,!1),Se("Reference.transaction","onComplete",t,!0),void 0!==n&&"boolean"!=typeof n)throw new Error(ke("Reference.transaction","applyLocally")+"must be a boolean.");const r=Mp(this._delegate,e,{applyLocally:n}).then(e=>new qp(e.committed,new Vp(this.database,e.snapshot)));return t&&r.then(e=>t(null,e.committed,e.snapshot),e=>t(e,!1,null)),r}setPriority(e,t){c("Reference.setPriority",1,2,arguments.length),Se("Reference.setPriority","onComplete",t,!0);const n=function(e,t){td("setPriority",(e=_(e))._path),Xh("setPriority",t,!1);const n=new ie;return Sd(e._repo,b(e._path,".priority"),t,null,n.wrapCallback(()=>{})),n.promise}(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}push(e,t){c("Reference.push",0,2,arguments.length),Se("Reference.push","onComplete",t,!0);const n=function(e,t){td("push",(e=_(e))._path),Yh("push",t,e._path,!0);var n=wd(e._repo);const r=np(e,n=Kd(n)),i=np(e,n);let s;return s=null!=t?rp(i,t).then(()=>i):Promise.resolve(i),r.then=s.then.bind(s),r.catch=s.then.bind(s,void 0),r}(this._delegate,e),r=n.then(e=>new jp(this.database,e)),i=(t&&r.then(()=>t(null),e=>t(e)),new jp(this.database,n));return i.then=r.then.bind(r),i.catch=r.catch.bind(r,void 0),i}onDisconnect(){return td("Reference.onDisconnect",this._delegate._path),new Up(new Hd(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class Kp{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Dp,forceLongPolling:Pp}}useEmulator(t,n,r={}){{var[t,n,r,i={}]=[this._delegate,t,n,r];(t=_(t))._checkNotDeleted("useEmulator"),t._instanceStarted&&bc("Cannot call useEmulator() after instance has already been initialized.");var s,a=t._repoInternal;let e=void 0;return a.repoInfo_.nodeAdmin?(i.mockUserToken&&bc('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),e=new Uc(Uc.OWNER)):i.mockUserToken&&(s="string"==typeof i.mockUserToken?i.mockUserToken:se(i.mockUserToken,t.app.options.projectId),e=new Uc(s)),i=a,t=n,n=r,r=e,i.repoInfo_=new jc(t+":"+n,!1,i.repoInfo_.namespace,i.repoInfo_.webSocketOnly,i.repoInfo_.nodeAdmin,i.repoInfo_.persistenceKey,i.repoInfo_.includeNamespaceInQueryParams),void(r&&(i.authTokenProvider_=r))}}ref(e){var t;return c("database.ref",0,1,arguments.length),t=e instanceof jp?tp(this._delegate,e.toString()):ep(this._delegate,e),new jp(this,t)}refFromURL(e){c("database.refFromURL",1,1,arguments.length);e=tp(this._delegate,e);return new jp(this,e)}goOffline(){var e;c("database.goOffline",0,0,arguments.length),(e=_(e=this._delegate))._checkNotDeleted("goOffline"),Nd(e._repo)}goOnline(){return c("database.goOnline",0,0,arguments.length),(e=_(e=this._delegate))._checkNotDeleted("goOnline"),void((e=e._repo).persistentConnection_&&e.persistentConnection_.resume(vd));var e}}Kp.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:e=>({".sv":{increment:e}})};var Wp=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:r,namespace:i,nodeAdmin:s=!1}){ec(n);const a=new Me("auth-internal",new Le("database-standalone"));return a.setComponent(new o("auth-internal",()=>r,"PRIVATE")),{instance:new Kp(Np(e,a,void 0,t,s),e),namespace:i}}}),Hn=Kp.ServerValue,e=((_o=Vt).INTERNAL.registerComponent(new o("database-compat",(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),e=e.getProvider("database").getImmediate({identifier:t});return new Kp(e,n)},"PUBLIC").setServiceProps({Reference:jp,Query:Bp,Database:Kp,DataSnapshot:Vp,enableLogging:function(e,t){_c(e,t)},INTERNAL:Wp,ServerValue:Hn}).setMultipleInstances(!0)),_o.registerVersion("@firebase/database-compat","0.3.0-20221206221533"),"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{}),C=e||self;function zp(){}function Gp(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Hp(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}Math.random();function $p(e,t,n){return e.call.apply(e.bind,arguments)}function Qp(t,n,e){if(t)return 2<arguments.length?(r=Array.prototype.slice.call(arguments,2),function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}):function(){return t.apply(n,arguments)};var r;throw Error()}function Yp(e,t,n){return(Yp=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?$p:Qp).apply(null,arguments)}function Jp(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Xp(e,s){function t(){}t.prototype=s.prototype,e.X=s.prototype,e.prototype=new t,(e.prototype.constructor=e).Wb=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return s.prototype[t].apply(e,r)}}function Zp(){this.s=this.s,this.o=this.o}Zp.prototype.s=!1,Zp.prototype.na=function(){this.s||(this.s=!0,this.M())},Zp.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ef=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(t,n){if("string"==typeof t)return"string"!=typeof n||1!=n.length?-1:t.indexOf(n,0);for(let e=0;e<t.length;e++)if(e in t&&t[e]===n)return e;return-1};function tf(t){var n=t.length;if(0<n){const r=Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r}return[]}function nf(t){for(let e=1;e<arguments.length;e++){var n=arguments[e];if(Gp(n)){var r=t.length||0,i=n.length||0;t.length=r+i;for(let e=0;e<i;e++)t[r+e]=n[e]}else t.push(n)}}function rf(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}rf.prototype.h=function(){this.defaultPrevented=!0};var sf=function(){if(!C.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{C.addEventListener("test",zp,t),C.removeEventListener("test",zp,t)}catch(e){}return e}();function af(e){return/^[\s\xa0]*$/.test(e)}var of=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function cf(e,t){return e<t?-1:t<e?1:0}function lf(){var e=C.navigator;return(e=e&&e.userAgent)?e:""}function uf(e){return-1!=lf().indexOf(e)}function hf(e){return hf[" "](e),e}hf[" "]=zp;var df,Wp=uf("Opera"),pf=uf("Trident")||uf("MSIE"),Hn=uf("Edge"),ff=Hn||pf,gf=uf("Gecko")&&!(-1!=lf().toLowerCase().indexOf("webkit")&&!uf("Edge"))&&!(uf("Trident")||uf("MSIE"))&&!uf("Edge"),_o=-1!=lf().toLowerCase().indexOf("webkit")&&!uf("Edge");function mf(){var e=C.document;return e?e.documentMode:void 0}var vf="",yf=(yf=lf(),gf?/rv:([^\);]+)(\)|;)/.exec(yf):Hn?/Edge\/([\d\.]+)/.exec(yf):pf?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(yf):_o?/WebKit\/(\S+)/.exec(yf):Wp?/(?:Version)[ \/]?(\S+)/.exec(yf):void 0),_f=((yf&&(vf=yf?yf[1]:""),pf&&null!=(yf=mf())&&yf>parseFloat(vf))?df=String(yf):df=vf,{});var wf=C.document&&pf&&(mf()||parseInt(df,10))||void 0;function bf(e,t){if(rf.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(gf){e:{try{hf(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:If[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&bf.X.h.call(this)}}Xp(bf,rf);var If={2:"touch",3:"pen",4:"mouse"},Tf=(bf.prototype.h=function(){bf.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1},"closure_listenable_"+(1e6*Math.random()|0)),Ef=0;function kf(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++Ef,this.ba=this.ea=!1}function Sf(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function Cf(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function Af(e){const t={};for(const n in e)t[n]=e[n];return t}const Nf="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Rf(t){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e])t[n]=r[n];for(let e=0;e<Nf.length;e++)n=Nf[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function xf(e){this.src=e,this.g={},this.h=0}function Df(e,t){var n,r,i,s=t.type;s in e.g&&(n=e.g[s],(i=0<=(r=ef(n,t)))&&Array.prototype.splice.call(n,r,1),i&&(Sf(t),0==e.g[s].length&&(delete e.g[s],e.h--)))}function Pf(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ba&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}xf.prototype.add=function(e,t,n,r,i){var s=e.toString(),a=((e=this.g[s])||(e=this.g[s]=[],this.h++),Pf(e,t,r,i));return-1<a?(t=e[a],n||(t.ea=!1)):((t=new kf(t,this.src,s,!!r,i)).ea=n,e.push(t)),t};var Of="closure_lm_"+(1e6*Math.random()|0),Mf={};function Lf(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=Hp(i)?!!i.capture:!!i,o=Vf(e);if(o||(e[Of]=o=new xf(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function(){const n=qf;return function e(t){return n.call(e.src,e.listener,t)}}(),(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(i=sf?i:a)&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Uf(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Ff(e){var t,n,r;"number"!=typeof e&&e&&!e.ba&&((t=e.src)&&t[Tf]?Df(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Uf(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Vf(t))?(Df(n,e),0==n.h&&(n.src=null,t[Of]=null)):Sf(e)))}function Uf(e){return e in Mf?Mf[e]:Mf[e]="on"+e}function qf(e,t){var n,r;return!!e.ba||(t=new bf(t,this),n=e.listener,r=e.ha||e.src,e.ea&&Ff(e),n.call(r,t))}function Vf(e){return(e=e[Of])instanceof xf?e:null}var Bf="__closure_events_fn_"+(1e9*Math.random()>>>0);function jf(t){return"function"==typeof t?t:(t[Bf]||(t[Bf]=function(e){return t.handleEvent(e)}),t[Bf])}function Kf(){Zp.call(this),this.i=new xf(this),(this.P=this).I=null}function Wf(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t?t=new rf(t,e):t instanceof rf?t.target=t.target||e:(a=t,Rf(t=new rf(r,e),a)),a=!0,n)for(var i=n.length-1;0<=i;i--)var s=t.g=n[i],a=zf(s,r,!0,t)&&a;if(a=zf(s=t.g=e,r,!0,t)&&a,a=zf(s,r,!1,t)&&a,n)for(i=0;i<n.length;i++)a=zf(s=t.g=n[i],r,!1,t)&&a}function zf(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a,o,c=t[s];c&&!c.ba&&c.capture==n&&(a=c.listener,o=c.ha||c.src,c.ea&&Df(e.i,c),i=!1!==a.call(o,r)&&i)}return i&&!r.defaultPrevented}Xp(Kf,Zp),Kf.prototype[Tf]=!0,Kf.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else i=Hp(i)?!!i.capture:!!i,r=jf(r),t&&t[Tf]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=Pf(a=t.g[n],r,i,s))&&(Sf(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):(t=t&&Vf(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?Pf(n,r,i,s):t)?n[t]:null)&&Ff(r))}(this,e,t,n,r)},Kf.prototype.M=function(){if(Kf.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Sf(n[r]);delete t.g[e],t.h--}}this.I=null},Kf.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Kf.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Gf,Hf=C.JSON.stringify,$f=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Qf,e=>e.reset());class Qf{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Yf(e,t){var n;Gf||(n=C.Promise.resolve(void 0),Gf=function(){n.then(Zf)}),Jf||(Gf(),Jf=!0),Xf.add(e,t)}var Jf=!1,Xf=new class{constructor(){this.h=this.g=null}add(e,t){const n=$f.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Zf(){for(var e;e=function(){var e=Xf;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){C.setTimeout(()=>{throw e},0)}(e)}var t=$f;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}Jf=!1}function eg(e,t){Kf.call(this),this.h=e||1,this.g=t||C,this.j=Yp(this.lb,this),this.l=Date.now()}function tg(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function ng(e,t,n){if("function"==typeof e)n&&(e=Yp(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Yp(e.handleEvent,e)}return 2147483647<Number(t)?-1:C.setTimeout(e,t||0)}Xp(eg,Kf),(t=eg.prototype).ca=!1,t.R=null,t.lb=function(){var e;this.ca&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Wf(this,"tick"),this.ca&&(tg(this),this.start())))},t.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},t.M=function(){eg.X.M.call(this),tg(this),delete this.g};class rg extends Zp{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=ng(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}M(){super.M(),this.g&&(C.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ig(e){Zp.call(this),this.h=e,this.g={}}Xp(ig,Zp);var sg=[];function ag(e,t,n,r){Array.isArray(n)||(n&&(sg[0]=n.toString()),n=sg);for(var i=0;i<n.length;i++){var s=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=jf(r),t&&t[Tf]?t.O(n,r,Hp(i)?!!i.capture:!!i,s):Lf(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=jf(r),t&&t[Tf]?t.N(n,r,Hp(i)?!!i.capture:!!i,s):Lf(t,n,r,!1,i,s)}(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function og(e){Cf(e.g,function(e,t){this.g.hasOwnProperty(t)&&Ff(e)},e),e.g={}}function cg(){this.g=!0}function lg(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return Hf(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}ig.prototype.M=function(){ig.X.M.call(this),og(this)},ig.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},cg.prototype.Aa=function(){this.g=!1},cg.prototype.info=function(){};var ug={},hg=null;function dg(){return hg=hg||new Kf}function pg(e){rf.call(this,ug.Pa,e)}function fg(){var e=dg();Wf(e,new pg(e))}function gg(e,t){rf.call(this,ug.STAT_EVENT,e),this.stat=t}function mg(e){var t=dg();Wf(t,new gg(t,e))}function vg(e,t){rf.call(this,ug.Qa,e),this.size=t}function yg(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return C.setTimeout(function(){e()},t)}function _g(){}function wg(e){return e.h||(e.h=e.i())}function bg(){}function Ig(){rf.call(this,"d")}function Tg(){rf.call(this,"c")}function Eg(){}function kg(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new ig(this),this.O=Ag,this.T=new eg(e=ff?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Sg}function Sg(){this.i=null,this.g="",this.h=!1}ug.Pa="serverreachability",Xp(pg,rf),ug.STAT_EVENT="statevent",Xp(gg,rf),ug.Qa="timingevent",Xp(vg,rf),Bt={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},ic={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"},_g.prototype.h=null,e={OPEN:"a",qb:"b",Na:"c",Cb:"d"},Xp(Ig,rf),Xp(Tg,rf),Xp(Eg,_g),Eg.prototype.g=function(){return new XMLHttpRequest},Eg.prototype.i=function(){return{}};var Cg=new Eg,Ag=45e3,Ng={},Rg={};function xg(e,t,n){e.K=1,e.v=$g(Wg(t)),e.s=n,e.P=!0,Dg(e,null)}function Dg(e,t){e.F=Date.now(),Mg(e),e.A=Wg(e.v);var a,o,c,l,u,h,n=e.A,r=e.U;Array.isArray(r)||(r=[String(r)]),om(n.i,"t",r),e.C=0,n=e.l.H,e.h=new Sg,e.g=av(e.l,n?t:null,!e.s),0<e.N&&(e.L=new rg(Yp(e.La,e,e.g),e.N)),ag(e.S,e.g,"readystatechange",e.ib),t=e.H?Af(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),fg(),a=e.j,o=e.u,c=e.A,l=e.m,u=e.U,h=e.s,a.info(function(){if(a.g)if(h)for(var e="",t=h.split("&"),n=0;n<t.length;n++){var r,i,s=t[n].split("=");1<s.length&&(r=s[0],s=s[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+s+"&":e+(r+"=redacted&"))}else e=null;else e=h;return"XMLHTTP REQ ("+l+") [attempt "+u+"]: "+o+"\n"+c+"\n"+e})}function Pg(e){return e.g&&"GET"==e.u&&2!=e.K&&e.l.Da}function Og(e,t,n){let r=!0,i;for(;!e.I&&e.C<n.length;){if((i=(c=void 0,o=(s=e).C,-1==(c=(a=n).indexOf("\n",o))?Rg:(o=Number(a.substring(o,c)),isNaN(o)?Ng:(c+=1)+o>a.length?Rg:(a=a.substr(c,o),s.C=c+o,a))))==Rg){4==t&&(e.o=4,mg(14),r=!1),lg(e.j,e.m,null,"[Incomplete Response]");break}if(i==Ng){e.o=4,mg(15),lg(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}lg(e.j,e.m,i,null),Vg(e,i)}var s,a,o,c;Pg(e)&&i!=Rg&&i!=Ng&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,mg(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Xm(t),t.K=!0,mg(11))):(lg(e.j,e.m,n,"[Invalid Chunked Response]"),qg(e),Ug(e))}function Mg(e){e.V=Date.now()+e.O,Lg(e,e.O)}function Lg(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=yg(Yp(e.gb,e),t)}function Fg(e){e.B&&(C.clearTimeout(e.B),e.B=null)}function Ug(e){0==e.l.G||e.I||tv(e.l,e)}function qg(e){Fg(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,tg(e.T),og(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Vg(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||fm(n.h,e)))if(!e.J&&fm(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;ev(n),Wm(n)}Jm(n),mg(18)}}else n.Ba=i[1],0<n.Ba-n.T&&i[2]<37500&&n.L&&0==n.A&&!n.v&&(n.v=yg(Yp(n.cb,n),6e3));if(pm(n.h)<=1&&n.ja){try{n.ja()}catch(e){}n.ja=void 0}}else rv(n,11)}else if(!e.J&&n.g!=e||ev(n),!af(t))for(i=n.Fa.g.parse(t),t=0;t<i.length;t++){var s=i[t];if(n.T=s[0],s=s[1],2==n.G)if("c"==s[0]){n.I=s[1],n.ka=s[2];var a=s[3],o=(null!=a&&(n.ma=a,n.j.info("VER="+n.ma)),s[4]);null!=o&&(n.Ca=o,n.j.info("SVER="+n.Ca));var c,l,u=s[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const f=e.g;if(f){const g=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;!g||(c=r.h).g||-1==g.indexOf("spdy")&&-1==g.indexOf("quic")&&-1==g.indexOf("h2")||(c.j=c.l,c.g=new Set,c.h&&(gm(c,c.h),c.h=null)),r.D&&(l=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.za=l,A(r.F,r.D,l))}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms"));var h,d,p=e;(r=n).sa=sv(r,r.H?r.ka:null,r.V),p.J?(mm(r.h,p),h=p,(d=r.J)&&h.setTimeout(d),h.B&&(Fg(h),Mg(h)),r.g=p):Ym(r),0<n.i.length&&Gm(n)}else"stop"!=s[0]&&"close"!=s[0]||rv(n,7);else 3==n.G&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?rv(n,7):Km(n):"noop"!=s[0]&&n.l&&n.l.wa(s),n.A=0)}fg()}catch(e){}}function Bg(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Gp(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(Gp(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(Gp(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(t=kg.prototype).setTimeout=function(e){this.O=e},t.ib=function(e){e=e.target;const t=this.L;t&&3==Fm(e)?t.l():this.La(e)},t.La=function(e){try{if(e==this.g)e:{var t=Fm(this.g),n=this.g.Ea();if(this.g.aa(),!(t<3)&&(3!=t||ff||this.g&&(this.h.h||this.g.fa()||Um(this.g)))){this.I||4!=t||7==n||fg(),Fg(this);var r=this.g.aa();this.Y=r;t:if(Pg(this)){var i=Um(this.g),s=(e="",i.length),a=4==Fm(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){qg(this),Ug(this);var o="";break t}this.h.i=new C.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:a&&n==s-1});i.splice(0,s),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==r,h=this.j,d=this.u,p=this.A,f=this.m,g=this.U,m=t,v=r,h.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+g+"]: "+d+"\n"+p+"\n"+m+" "+v}),this.i){if(this.Z&&!this.J){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!af(c)){var u=c;break t}}u=null}if(!(r=u)){this.i=!1,this.o=3,mg(12),qg(this),Ug(this);break e}lg(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Vg(this,r)}this.P?(Og(this,t,o),ff&&this.i&&3==t&&(ag(this.S,this.T,"tick",this.hb),this.T.start())):(lg(this.j,this.m,o,null),Vg(this,o)),4==t&&qg(this),this.i&&!this.I&&(4==t?tv(this.l,this):(this.i=!1,Mg(this)))}else 400==r&&0<o.indexOf("Unknown SID")?(this.o=3,mg(12)):(this.o=0,mg(13)),qg(this),Ug(this)}}}catch(e){}var h,d,p,f,g,m,v},t.hb=function(){var e,t;this.g&&(e=Fm(this.g),t=this.g.fa(),this.C<t.length&&(Fg(this),Og(this,e,t),this.i&&4!=e&&Mg(this)))},t.cancel=function(){this.I=!0,qg(this)},t.gb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.V?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&(fg(),mg(17)),qg(this),this.o=2,Ug(this)):Lg(this,this.V-n)};var jg=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Kg(e,t){var n;this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Kg?(this.h=void 0!==t?t:e.h,zg(this,e.j),this.s=e.s,this.g=e.g,Gg(this,e.m),this.l=e.l,t=e.i,(n=new rm).i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Hg(this,n),this.o=e.o):e&&(n=String(e).match(jg))?(this.h=!!t,zg(this,n[1]||"",!0),this.s=Qg(n[2]||""),this.g=Qg(n[3]||"",!0),Gg(this,n[4]),this.l=Qg(n[5]||"",!0),Hg(this,n[6]||"",!0),this.o=Qg(n[7]||"")):(this.h=!!t,this.i=new rm(null,this.h))}function Wg(e){return new Kg(e)}function zg(e,t,n){e.j=n?Qg(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Gg(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Hg(e,t,n){var r,i;t instanceof rm?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(im(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(sm(this,t),om(this,n,e))},r)),r.j=i):(n||(t=Yg(t,tm)),e.i=new rm(t,e.h))}function A(e,t,n){e.i.set(t,n)}function $g(e){return A(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Qg(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Yg(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Jg),n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function Jg(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Kg.prototype.toString=function(){var e=[],t=this.j,n=(t&&e.push(Yg(t,Xg,!0),":"),this.g);return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(Yg(t,Xg,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Yg(n,"/"==n.charAt(0)?em:Zg,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Yg(n,nm)),e.join("")};var Xg=/[#\/\?@]/g,Zg=/[#\?:]/g,em=/[#\?]/g,tm=/[#\?@]/g,nm=/#/g;function rm(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function im(e){if(!e.g&&(e.g=new Map,e.h=0,e.i)){var t=e.i;if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),s=null;0<=i?(r=t[n].substring(0,i),s=t[n].substring(i+1)):r=t[n],i=r,s=s?decodeURIComponent(s.replace(/\+/g," ")):"",e.add(decodeURIComponent(i.replace(/\+/g," ")),s)}}}}function sm(e,t){im(e),t=cm(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function am(e,t){return im(e),t=cm(e,t),e.g.has(t)}function om(e,t,n){sm(e,t),0<n.length&&(e.i=null,e.g.set(cm(e,t),tf(n)),e.h+=n.length)}function cm(e,t){return t=String(t),e.j?t.toLowerCase():t}(t=rm.prototype).add=function(e,t){im(this),this.i=null,e=cm(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},t.forEach=function(n,r){im(this),this.g.forEach(function(e,t){e.forEach(function(e){n.call(r,e,t,this)},this)},this)},t.oa=function(){im(this);const e=Array.from(this.g.values()),n=Array.from(this.g.keys()),r=[];for(let t=0;t<n.length;t++){var i=e[t];for(let e=0;e<i.length;e++)r.push(n[t])}return r},t.W=function(t){im(this);let n=[];if("string"==typeof t)am(this,t)&&(n=n.concat(this.g.get(cm(this,t))));else{t=Array.from(this.g.values());for(let e=0;e<t.length;e++)n=n.concat(t[e])}return n},t.set=function(e,t){return im(this),this.i=null,am(this,e=cm(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++)for(var r=t[n],i=encodeURIComponent(String(r)),s=this.W(r),r=0;r<s.length;r++){var a=i;""!==s[r]&&(a+="="+encodeURIComponent(String(s[r]))),e.push(a)}return this.i=e.join("&")};var lm,um=class{constructor(e,t){this.h=e,this.g=t}};function hm(e){this.l=e||10,e=C.PerformanceNavigationTiming?0<(e=C.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(C.g&&C.g.Ga&&C.g.Ga()&&C.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function dm(e){return e.h||e.g&&e.g.size>=e.j}function pm(e){return e.h?1:e.g?e.g.size:0}function fm(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function gm(e,t){e.g?e.g.add(t):e.h=t}function mm(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function vm(t){if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return tf(t.i);{let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}}function ym(){}function _m(){this.g=new ym}function wm(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function bm(e){this.l=e.ac||null,this.j=e.jb||!1}function Im(e,t){Kf.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=Tm,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}hm.prototype.cancel=function(){if(this.i=vm(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},ym.prototype.stringify=function(e){return C.JSON.stringify(e,void 0)},ym.prototype.parse=function(e){return C.JSON.parse(e,void 0)},Xp(bm,_g),bm.prototype.g=function(){return new Im(this.l,this.j)},bm.prototype.i=(lm={},function(){return lm}),Xp(Im,Kf);var Tm=0;function Em(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function km(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Sm(e)}function Sm(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(t=Im.prototype).open=function(e,t){if(this.readyState!=Tm)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Sm(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||C).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,km(this)),this.readyState=Tm},t.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Sm(this)),this.g&&(this.readyState=3,Sm(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==C.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Em(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))},t.Ta=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?km:Sm)(this),3==this.readyState&&Em(this))},t.Va=function(e){this.g&&(this.response=this.responseText=e,km(this))},t.Ua=function(e){this.g&&(this.response=e,km(this))},t.ga=function(){this.g&&km(this)},t.setRequestHeader=function(e,t){this.v.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Im.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Cm=C.JSON.parse;function Am(e){Kf.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Nm,this.K=this.L=!1}Xp(Am,Kf);var Nm="",Rm=/^https?$/i,xm=["POST","PUT"];function Dm(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Pm(e),Mm(e)}function Pm(e){e.D||(e.D=!0,Wf(e,"complete"),Wf(e,"error"))}function Om(e){if(e.h&&(!e.C[1]||4!=Fm(e)||2!=e.aa()))if(e.v&&4==Fm(e))ng(e.Ha,0,e);else if(Wf(e,"readystatechange"),4==Fm(e)){e.h=!1;try{var t,n,r,i,s=e.aa();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break;default:a=!1}if((t=a)||((n=0===s)&&(!(i=String(e.H).match(jg)[1]||null)&&C.self&&C.self.location&&(i=(r=C.self.location.protocol).substr(0,r.length-1)),n=!Rm.test(i?i.toLowerCase():"")),t=n),t)Wf(e,"complete"),Wf(e,"success");else{e.m=6;try{var o=2<Fm(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.aa()+"]",Pm(e)}}finally{Mm(e)}}}function Mm(e,t){if(e.g){Lm(e);const n=e.g,r=e.C[0]?zp:null;e.g=null,e.C=null,t||Wf(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Lm(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(C.clearTimeout(e.A),e.A=null)}function Fm(e){return e.g?e.g.readyState:0}function Um(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Nm:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function qm(e){let n="";return Cf(e,function(e,t){n=(n=n+t+":")+e+"\r\n"}),n}function Vm(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=qm(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):A(e,t,n))}function Bm(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function jm(e){this.Ca=0,this.i=[],this.j=new cg,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Bm("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Bm("baseRetryDelayMs",5e3,e),this.bb=Bm("retryDelaySeedMs",1e4,e),this.$a=Bm("forwardChannelMaxRetries",2,e),this.ta=Bm("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new hm(e&&e.concurrentRequestLimit),this.Fa=new _m,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Km(e){var t,n;zm(e),3==e.G&&(t=e.U++,A(n=Wg(e.F),"SID",e.I),A(n,"RID",t),A(n,"TYPE","terminate"),$m(e,n),(t=new kg(e,e.j,t,void 0)).K=2,t.v=$g(Wg(n)),n=!1,!(n=C.navigator&&C.navigator.sendBeacon?C.navigator.sendBeacon(t.v.toString(),""):n)&&C.Image&&((new Image).src=t.v,n=!0),n||(t.g=av(t.l,null),t.g.da(t.v)),t.F=Date.now(),Mg(t)),iv(e)}function Wm(e){e.g&&(Xm(e),e.g.cancel(),e.g=null)}function zm(e){Wm(e),e.u&&(C.clearTimeout(e.u),e.u=null),ev(e),e.h.cancel(),e.m&&("number"==typeof e.m&&C.clearTimeout(e.m),e.m=null)}function Gm(e){dm(e.h)||e.m||(e.m=!0,Yf(e.Ja,e),e.C=0)}function Hm(e,t){var n=t?t.m:e.U++,r=Wg(e.F);A(r,"SID",e.I),A(r,"RID",n),A(r,"AID",e.T),$m(e,r),e.o&&e.s&&Vm(r,e.o,e.s),n=new kg(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=Qm(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),gm(e.h,n),xg(n,r,t)}function $m(e,n){e.ia&&Cf(e.ia,function(e,t){A(n,t,e)}),e.l&&Bg({},function(e,t){A(n,t,e)})}function Qm(r,e,i){i=Math.min(r.i.length,i);var s=r.l?Yp(r.l.Ra,r.l,r):null;e:{var a=r.i;let n=-1;for(;;){const l=["count="+i];-1==n?0<i?(n=a[0].h,l.push("ofs="+n)):n=0:l.push("ofs="+n);let t=!0;for(let e=0;e<i;e++){var o=a[e].h,c=a[e].g;if((o-=n)<0)n=Math.max(0,a[e].h-100),t=!1;else try{!function(e,r){const i="req"+o+"_"||"";try{Bg(e,function(e,t){let n=e;Hp(e)&&(n=Hf(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}(c,l)}catch(r){s&&s(c)}}if(t){s=l.join("&");break e}}}return r=r.i.splice(0,i),e.D=r,s}function Ym(e){e.g||e.u||(e.Z=1,Yf(e.Ia,e),e.A=0)}function Jm(e){return!(e.g||e.u||3<=e.A)&&(e.Z++,e.u=yg(Yp(e.Ia,e),nv(e,e.A)),e.A++,1)}function Xm(e){null!=e.B&&(C.clearTimeout(e.B),e.B=null)}function Zm(e){e.g=new kg(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=Wg(e.sa),n=(A(t,"RID","rpc"),A(t,"SID",e.I),A(t,"CI",e.L?"0":"1"),A(t,"AID",e.T),A(t,"TYPE","xmlhttp"),$m(e,t),e.o&&e.s&&Vm(t,e.o,e.s),e.J&&e.g.setTimeout(e.J),e.g);e=e.ka,n.K=1,n.v=$g(Wg(t)),n.s=null,n.P=!0,Dg(n,e)}function ev(e){null!=e.v&&(C.clearTimeout(e.v),e.v=null)}function tv(e,t){var n,r,i,s=null;if(e.g==t){ev(e),Xm(e),e.g=null;var a=2}else{if(!fm(e.h,t))return;s=t.D,mm(e.h,t),a=1}if(0!=e.G)if(e.pa=t.Y,t.i)1==a?(s=t.s?t.s.length:0,t=Date.now()-t.F,n=e.C,Wf(a=dg(),new vg(a,s)),Gm(e)):Ym(e);else if(3==(n=t.o)||0==n&&0<e.pa||(1!=a||(i=t,pm((r=e).h)>=r.h.j-(r.m?1:0)||(r.m?(r.i=i.D.concat(r.i),0):1==r.G||2==r.G||r.C>=(r.Za?0:r.$a)||(r.m=yg(Yp(r.Ja,r,i),nv(r,r.C)),r.C++,0))))&&(2!=a||!Jm(e)))switch(s&&0<s.length&&(t=e.h,t.i=t.i.concat(s)),n){case 1:rv(e,5);break;case 4:rv(e,10);break;case 3:rv(e,6);break;default:rv(e,2)}}function nv(e,t){let n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function rv(e,t){if(e.j.info("Error code "+t),2==t){n=null,e.l&&(n=null),r=Yp(e.kb,e),n||(n=new Kg("//www.google.com/images/cleardot.gif"),C.location&&"http"==C.location.protocol||zg(n,"https"),$g(n));var n=n.toString(),r,i=new cg;if(C.Image){const s=new Image;s.onload=Jp(wm,i,s,"TestLoadImage: loaded",!0,r),s.onerror=Jp(wm,i,s,"TestLoadImage: error",!1,r),s.onabort=Jp(wm,i,s,"TestLoadImage: abort",!1,r),s.ontimeout=Jp(wm,i,s,"TestLoadImage: timeout",!1,r),C.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=n}else r(!1)}else mg(2);e.G=0,e.l&&e.l.va(t),iv(e),zm(e)}function iv(e){var t;e.G=0,e.la=[],e.l&&(0==(t=vm(e.h)).length&&0==e.i.length||(nf(e.la,t),nf(e.la,e.i),e.h.i.length=0,tf(e.i),e.i.length=0),e.l.ua())}function sv(e,t,n){var r,i,s=n instanceof Kg?Wg(n):new Kg(n,void 0);return""!=s.g?(t&&(s.g=t+"."+s.g),Gg(s,s.m)):(s=(r=C.location).protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port,i=new Kg(null,void 0),s&&zg(i,s),t&&(i.g=t),r&&Gg(i,r),n&&(i.l=n),s=i),n=e.D,t=e.za,n&&t&&A(s,n,t),A(s,"VER",e.ma),$m(e,s),s}function av(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Da&&!e.ra?new Am(new bm({jb:!0})):new Am(e.ra)).Ka(e.H),t}function ov(){}function cv(){if(pf&&!(10<=Number(wf)))throw Error("Environmental error: no available transport.")}function lv(e,t){Kf.call(this),this.g=new jm(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!af(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!af(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new dv(this)}function uv(e){Ig.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function hv(){Tg.call(this),this.status=1}function dv(e){this.g=e}(t=Am.prototype).Ka=function(e){this.L=e},t.da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||Cg).g(),this.C=this.u?wg(this.u):wg(Cg),this.g.onreadystatechange=Yp(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void Dm(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const u of r.keys())n.set(u,r.get(u))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=C.FormData&&e instanceof C.FormData,0<=ef(xm,t)&&!r&&!i&&n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(var[s,a]of n)this.g.setRequestHeader(s,a);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Lm(this),0<this.B&&((this.K=(l=this.g,pf&&(o=function(){let t=0;var n=of(String(df)).split("."),r=of("9").split("."),i=Math.max(n.length,r.length);for(let e=0;0==t&&e<i;e++)for(var s=n[e]||"",a=r[e]||"";s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],(0!=s[0].length||0!=a[0].length)&&(t=cf(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||cf(0==s[2].length,0==a[2].length)||cf(s[2],a[2]),s=s[3],a=a[3],0==t););return 0<=t},c=_f,Object.prototype.hasOwnProperty.call(c,9)?c[9]:c[9]=o())&&"number"==typeof l.timeout&&void 0!==l.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=Yp(this.qa,this)):this.A=ng(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Dm(this,e)}var o,c,l},t.qa=function(){this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Wf(this,"timeout"),this.abort(8))},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Wf(this,"complete"),Wf(this,"abort"),Mm(this))},t.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Mm(this,!0)),Am.X.M.call(this)},t.Ha=function(){this.s||(this.F||this.v||this.l?Om(this):this.fb())},t.fb=function(){Om(this)},t.aa=function(){try{return 2<Fm(this)?this.g.status:-1}catch(e){return-1}},t.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.Sa=function(e){var t;if(this.g)return t=this.g.responseText,e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Cm(t)},t.Ea=function(){return this.m},t.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(t=jm.prototype).ma=8,t.G=1,t.Ja=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const s=new kg(this,this.j,t,void 0);let e=this.s;if(this.S&&(e?Rf(e=Af(e),this.S):e=this.S),null!==this.o||this.N||(s.H=e,e=null),this.O)e:{for(var n=0,r=0;r<this.i.length;r++){var i=this.i[r];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(n+=i)){n=r;break e}if(4096===n||r===this.i.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=Qm(this,s,n),A(r=Wg(this.F),"RID",t),A(r,"CVER",22),this.D&&A(r,"X-HTTP-Session-Id",this.D),$m(this,r),e&&(this.N?n="headers="+encodeURIComponent(String(qm(e)))+"&"+n:this.o&&Vm(r,this.o,e)),gm(this.h,s),this.Ya&&A(r,"TYPE","init"),this.O?(A(r,"$req",n),A(r,"SID","null"),s.Z=!0,xg(s,r,null)):xg(s,r,n),this.G=2}}else 3==this.G&&(t?Hm(this,t):0==this.i.length||dm(this.h)||Hm(this))},t.Ia=function(){var e;this.u=null,Zm(this),this.$&&!(this.K||null==this.g||this.P<=0)&&(e=2*this.P,this.j.info("BP detection timer enabled: "+e),this.B=yg(Yp(this.eb,this),e))},t.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,mg(10),Wm(this),Zm(this))},t.cb=function(){null!=this.v&&(this.v=null,Wm(this),Jm(this),mg(19))},t.kb=function(e){e?(this.j.info("Successfully pinged google.com"),mg(2)):(this.j.info("Failed to ping google.com"),mg(1))},(t=ov.prototype).xa=function(){},t.wa=function(){},t.va=function(){},t.ua=function(){},t.Ra=function(){},cv.prototype.g=function(e,t){return new lv(e,t)},Xp(lv,Kf),lv.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;mg(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=sv(e,null,e.V),Gm(e)},lv.prototype.close=function(){Km(this.g)},lv.prototype.u=function(e){var t,n=this.g;"string"==typeof e?((t={}).__data__=e,e=t):this.v&&((t={}).__data__=Hf(e),e=t),n.i.push(new um(n.ab++,e)),3==n.G&&Gm(n)},lv.prototype.M=function(){this.g.l=null,delete this.j,Km(this.g),delete this.g,lv.X.M.call(this)},Xp(uv,Ig),Xp(hv,Tg),Xp(dv,ov),dv.prototype.xa=function(){Wf(this.g,"a")},dv.prototype.wa=function(e){Wf(this.g,new uv(e))},dv.prototype.va=function(e){Wf(this.g,new hv)},dv.prototype.ua=function(){Wf(this.g,"b")},cv.prototype.createWebChannel=cv.prototype.g,lv.prototype.send=lv.prototype.u,lv.prototype.open=lv.prototype.m,Bt.NO_ERROR=0,Bt.TIMEOUT=8,Bt.HTTP_ERROR=6,ic.COMPLETE="complete",(bg.EventType=e).OPEN="a",e.CLOSE="b",e.ERROR="c",e.MESSAGE="d",Kf.prototype.listen=Kf.prototype.N,Am.prototype.listenOnce=Am.prototype.O,Am.prototype.getLastError=Am.prototype.Oa,Am.prototype.getLastErrorCode=Am.prototype.Ea,Am.prototype.getStatus=Am.prototype.aa,Am.prototype.getResponseJson=Am.prototype.Sa,Am.prototype.getResponseText=Am.prototype.fa,Am.prototype.send=Am.prototype.da,Am.prototype.setWithCredentials=Am.prototype.Ka;var pv,fv,gv=dg,mv=Bt,vv=ic,yv=ug,_v=bm,wv=bg,bv=Am,Hn="@firebase/firestore";class Iv{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Iv.UNAUTHENTICATED=new Iv(null),Iv.GOOGLE_CREDENTIALS=new Iv("google-credentials-uid"),Iv.FIRST_PARTY=new Iv("first-party-uid"),Iv.MOCK_USER=new Iv("mock-user");let Tv="9.15.0-20221206221533";const Ev=new je("@firebase/firestore");function kv(){return Ev.logLevel}function p(e,...t){Ev.logLevel<=h.DEBUG&&(t=t.map(Av),Ev.debug(`Firestore (${Tv}): `+e,...t))}function Sv(e,...t){Ev.logLevel<=h.ERROR&&(t=t.map(Av),Ev.error(`Firestore (${Tv}): `+e,...t))}function Cv(e,...t){Ev.logLevel<=h.WARN&&(t=t.map(Av),Ev.warn(`Firestore (${Tv}): `+e,...t))}function Av(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function N(e="Unexpected state"){e=`FIRESTORE (${Tv}) INTERNAL ASSERTION FAILED: `+e;throw Sv(e),new Error(e)}function R(e){e||N()}const x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class D extends ae{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: `+this.message}}class Nv{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Rv{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer "+e)}}class xv{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Iv.UNAUTHENTICATED))}shutdown(){}}class Dv{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Pv{constructor(e){this.t=e,this.currentUser=Iv.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const i=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let s=new Nv;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Nv,t.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const e=s;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})},o=e=>{p("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(e=>o(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?o(e):(p("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Nv))},0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(p("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(R("string"==typeof e.accessToken),new Rv(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return R(null===e||"string"==typeof e),new Iv(e)}}class Ov{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r,this.type="FirstParty",this.user=Iv.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(R(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);var e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Mv{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r}getToken(){return Promise.resolve(new Ov(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(Iv.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Lv{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class Fv{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(t,n){const r=e=>{null!=e.error&&p("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: "+e.error.message);var t=e.token!==this.A;return this.A=e.token,p("FirebaseAppCheckTokenProvider",`Received ${t?"new":"existing"} token.`),t?n(e.token):Promise.resolve()},i=(this.o=e=>{t.enqueueRetryable(()=>r(e))},e=>{p("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)});this.T.onInit(e=>i(e)),setTimeout(()=>{var e;this.appCheck||((e=this.T.getImmediate({optional:!0}))?i(e):p("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(R("string"==typeof e.token),this.A=e.token,new Lv(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class Uv{static R(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var i=function(){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(40);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let e=0;e<40;e++)t[e]=Math.floor(256*Math.random());return t}();for(let e=0;e<i.length;++e)r.length<20&&i[e]<n&&(r+=t.charAt(i[e]%t.length))}return r}}function P(e,t){return e<t?-1:t<e?1:0}function qv(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function Vv(e){return e+"\0"}class Bv{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new D(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new D(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new D(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new D(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Bv.fromMillis(Date.now())}static fromDate(e){return Bv.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),e=Math.floor(1e6*(e-1e3*t));return new Bv(t,e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?P(this.nanoseconds,e.nanoseconds):P(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class O{constructor(e){this.timestamp=e}static fromTimestamp(e){return new O(e)}static min(){return new O(new Bv(0,0))}static max(){return new O(new Bv(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class jv{constructor(e,t,n){void 0===t?t=0:t>e.length&&N(),void 0===n?n=e.length-t:n>e.length-t&&N(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===jv.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof jv?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(n){for(let e=this.offset,t=this.limit();e<t;e++)n(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,n){const r=Math.min(t.length,n.length);for(let e=0;e<r;e++){const r=t.get(e),i=n.get(e);if(r<i)return-1;if(r>i)return 1}return t.length<n.length?-1:t.length>n.length?1:0}}class M extends jv{construct(e,t,n){return new M(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new D(x.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new M(t)}static emptyPath(){return new M([])}}const Kv=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Wv extends jv{construct(e,t,n){return new Wv(e,t,n)}static isValidIdentifier(e){return Kv.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=Wv.isValidIdentifier(e)?e:"`"+e+"`")).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Wv(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var i=()=>{if(0===n.length)throw new D(x.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new D(x.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new D(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new D(x.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Wv(t)}static emptyPath(){return new Wv([])}}class L{constructor(e){this.path=e}static fromPath(e){return new L(M.fromString(e))}static fromName(e){return new L(M.fromString(e).popFirst(5))}static empty(){return new L(M.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===M.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return M.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new L(new M(e.slice()))}}class zv{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function Gv(e){return e.fields.find(e=>2===e.kind)}function Hv(e){return e.fields.filter(e=>2!==e.kind)}zv.UNKNOWN_ID=-1;class $v{constructor(e,t){this.fieldPath=e,this.kind=t}}class Qv{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Qv(0,Xv.min())}}function Yv(e,t){var n=e.toTimestamp().seconds,e=e.toTimestamp().nanoseconds+1,e=O.fromTimestamp(1e9===e?new Bv(n+1,0):new Bv(n,e));return new Xv(e,L.empty(),t)}function Jv(e){return new Xv(e.readTime,e.key,-1)}class Xv{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Xv(O.min(),L.empty(),-1)}static max(){return new Xv(O.max(),L.empty(),-1)}}function Zv(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=L.comparator(e.documentKey,t.documentKey))?n:P(e.largestBatchId,t.largestBatchId)}const ey="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ty{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function ny(e){if(e.code!==x.FAILED_PRECONDITION||e.message!==ey)throw e;p("LocalStore","Unexpectedly lost primary lease")}class F{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,i){return this.callbackAttached&&N(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new F((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(i,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof F?t:F.resolve(t)}catch(e){return F.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):F.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):F.reject(t)}static resolve(n){return new F((e,t)=>{e(n)})}static reject(n){return new F((e,t)=>{t(n)})}static waitFor(e){return new F((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=F.resolve(!1);for(const n of e)t=t.next(e=>e?F.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}static mapArray(o,c){return new F((t,n)=>{const r=o.length,i=new Array(r);let s=0;for(let e=0;e<r;e++){const a=e;c(o[a]).next(e=>{i[a]=e,++s===r&&t(i)},e=>n(e))}})}static doWhile(r,i){return new F((e,t)=>{const n=()=>{!0===r()?i().next(()=>{n()},t):e()};n()})}}class ry{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.P=new Nv,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{e.error?this.P.reject(new ay(t,e.error)):this.P.resolve()},this.transaction.onerror=e=>{e=hy(e.target.error);this.P.reject(new ay(t,e))}}static open(e,t,n,r){try{return new ry(t,e.transaction(r,n))}catch(e){throw new ay(t,e)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(p("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){e=this.transaction.objectStore(e);return new cy(e)}}class iy{constructor(e,t,n){this.name=e,this.version=t,this.S=n,12.2===iy.D(W())&&Sv("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return p("SimpleDb","Removing database:",e),ly(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!J())return!1;if(iy.N())return!0;const e=W(),t=iy.D(e),n=0<t&&t<10,r=iy.k(e),i=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||i)}static N(){var e;return"undefined"!=typeof process&&"YES"===(null==(e=process.env)?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static k(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async F(i){return this.db||(p("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{e=e.target.result;t(e)},r.onblocked=()=>{n(new ay(i,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{e=e.target.error;"VersionError"===e.name?n(new D(x.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===e.name?n(new D(x.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+e)):n(new ay(i,e))},r.onupgradeneeded=e=>{p("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.S.$(t,r.transaction,e.oldVersion,this.version).next(()=>{p("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.F(e);const t=ry.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.V(),e)).catch(e=>(t.abort(e),F.reject(e))).toPromise();return s.catch(()=>{}),await t.v,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(p("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class sy{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return ly(this.q.delete())}}class ay extends D{constructor(e,t){super(x.UNAVAILABLE,`IndexedDB transaction '${e}' failed: `+t),this.name="IndexedDbTransactionError"}}function oy(e){return"IndexedDbTransactionError"===e.name}class cy{constructor(e){this.store=e}put(e,t){return ly(void 0!==t?(p("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(p("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)))}add(e){return p("SimpleDb","ADD",this.store.name,e,e),ly(this.store.add(e))}get(t){return ly(this.store.get(t)).next(e=>(p("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return p("SimpleDb","DELETE",this.store.name,e),ly(this.store.delete(e))}count(){return p("SimpleDb","COUNT",this.store.name),ly(this.store.count())}W(e,n){var t=this.options(e,n);if(t.index||"function"!=typeof this.store.getAll){const e=this.cursor(t),n=[];return this.H(e,(e,t)=>{n.push(t)}).next(()=>n)}{const e=this.store.getAll(t.range);return new F((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}J(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new F((t,n)=>{r.onerror=e=>{n(e.target.error)},r.onsuccess=e=>{t(e.target.result)}})}Y(e,t){p("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.X=!1;e=this.cursor(n);return this.H(e,(e,t,n)=>n.delete())}Z(e,t){let n;t?n=e:(n={},t=e);e=this.cursor(n);return this.H(e,t)}tt(r){const e=this.cursor({});return new F((n,t)=>{e.onerror=e=>{e=hy(e.target.error);t(e)},e.onsuccess=e=>{const t=e.target.result;t?r(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}H(e,s){const a=[];return new F((i,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new sy(t),r=s(t.primaryKey,t.value,n);if(r instanceof F){const e=r.catch(e=>(n.done(),F.reject(e)));a.push(e)}n.isDone?i():null===n.G?t.continue():t.continue(n.G)}else i()}}).next(()=>F.waitFor(a))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ly(e){return new F((t,n)=>{e.onsuccess=e=>{e=e.target.result;t(e)},e.onerror=e=>{e=hy(e.target.error);n(e)}})}let uy=!1;function hy(e){const t=iy.D(W());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return uy||(uy=!0,setTimeout(()=>{throw e},0)),e}}return e}class dy{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){p("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{p("IndexBackiller","Documents written: "+await this.et.st())}catch(e){oy(e)?p("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await ny(e)}await this.nt(6e4)})}}class py{constructor(e,t){this.localStore=e,this.persistence=t}async st(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.it(e,t))}it(e,t){const n=new Set;let r=t,i=!0;return F.doWhile(()=>!0===i&&0<r,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>null===t||n.has(t)?void(i=!1):(p("IndexBackiller","Processing collection: "+t),this.rt(e,t,r).next(e=>{r-=e,n.add(t)})))).next(()=>t-r)}rt(r,i,e){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(r,i).next(n=>this.localStore.localDocuments.getNextDocuments(r,i,n,e).next(e=>{const t=e.changes;return this.localStore.indexManager.updateIndexEntries(r,t).next(()=>this.ot(n,e)).next(e=>(p("IndexBackiller","Updating offset: "+e),this.localStore.indexManager.updateCollectionGroup(r,i,e))).next(()=>t.size)}))}ot(e,t){let n=e;return t.changes.forEach((e,t)=>{t=Jv(t);0<Zv(t,n)&&(n=t)}),new Xv(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class fy{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ut(e),this.ct=e=>t.writeSequenceNumber(e))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.ct&&this.ct(e),e}}fy.at=-1;class gy{constructor(e,t,n,r,i,s,a,o){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.useFetchStreams=o}}class my{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new my("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof my&&e.projectId===this.projectId&&e.database===this.database}}function vy(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function yy(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function _y(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function wy(e){return null==e}function by(e){return 0===e&&1/e==-1/0}function Iy(e){return"number"==typeof e&&Number.isInteger(e)&&!by(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class Ty{constructor(e){this.binaryString=e}static fromBase64String(e){e=atob(e);return new Ty(e)}static fromUint8Array(e){e=function(t){let n="";for(let e=0;e<t.length;++e)n+=String.fromCharCode(t[e]);return n}(e);return new Ty(e)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){{var t=this.binaryString;const n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return P(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ty.EMPTY_BYTE_STRING=new Ty("");const Ey=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ky(t){if(R(!!t),"string"!=typeof t)return{seconds:Sy(t.seconds),nanos:Sy(t.nanos)};{let e=0;var n=Ey.exec(t);R(!!n),n[1]&&(n=(n[1]+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function Sy(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Cy(e){return"string"==typeof e?Ty.fromBase64String(e):Ty.fromUint8Array(e)}function Ay(e){return"server_timestamp"===(null==(e=((null==(e=null==e?void 0:e.mapValue)?void 0:e.fields)||{}).__type__)?void 0:e.stringValue)}function Ny(e){e=ky(e.mapValue.fields.__local_write_time__.timestampValue);return new Bv(e.seconds,e.nanos)}const Ry={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},xy={nullValue:"NULL_VALUE"};function Dy(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Ay(e)?4:zy(e)?9007199254740991:10:N()}function Py(e,t){if(e===t)return!0;var n,r=Dy(e);if(r!==Dy(t))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ny(e).isEqual(Ny(t));case 3:var i=t;if("string"==typeof e.timestampValue&&"string"==typeof i.timestampValue&&e.timestampValue.length===i.timestampValue.length)return e.timestampValue===i.timestampValue;var s=ky(e.timestampValue),i=ky(i.timestampValue);return s.seconds===i.seconds&&s.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return n=t,Cy(e.bytesValue).isEqual(Cy(n.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return s=t,Sy((n=e).geoPointValue.latitude)===Sy(s.geoPointValue.latitude)&&Sy(n.geoPointValue.longitude)===Sy(s.geoPointValue.longitude);case 2:return i=t,"integerValue"in(n=e)&&"integerValue"in i?Sy(n.integerValue)===Sy(i.integerValue):"doubleValue"in n&&"doubleValue"in i&&((n=Sy(n.doubleValue))===(i=Sy(i.doubleValue))?by(n)===by(i):isNaN(n)&&isNaN(i));case 9:return qv(e.arrayValue.values||[],t.arrayValue.values||[],Py);case 10:{var a=e;const o=a.mapValue.fields||{},c=t.mapValue.fields||{};if(vy(o)!==vy(c))return!1;for(const a in o)if(o.hasOwnProperty(a)&&(void 0===c[a]||!Py(o[a],c[a])))return!1;return!0;return}default:return N()}}function Oy(e,t){return void 0!==(e.values||[]).find(e=>Py(e,t))}function My(e,t){if(e===t)return 0;var n=Dy(e),r=Dy(t);if(n!==r)return P(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return P(e.booleanValue,t.booleanValue);case 2:return p=t,(i=Sy(e.integerValue||e.doubleValue))<(l=Sy(p.integerValue||p.doubleValue))?-1:l<i?1:i===l?0:isNaN(i)?isNaN(l)?0:-1:1;case 3:return Ly(e.timestampValue,t.timestampValue);case 4:return Ly(Ny(e),Ny(t));case 5:return P(e.stringValue,t.stringValue);case 6:{var i=e.bytesValue;var s=t.bytesValue;const m=Cy(i),v=Cy(s);return m.compareTo(v);return}case 7:var s=e.referenceValue,a=t.referenceValue,o=s.split("/"),c=a.split("/");for(let e=0;e<o.length&&e<c.length;e++){const a=P(o[e],c[e]);if(0!==a)return a}return P(o.length,c.length);case 8:return a=e.geoPointValue,p=t.geoPointValue,0!==(l=P(Sy(a.latitude),Sy(p.latitude)))?l:P(Sy(a.longitude),Sy(p.longitude));case 9:var l=e.arrayValue,u=t.arrayValue,h=l.values||[],d=u.values||[];for(let e=0;e<h.length&&e<d.length;++e){const u=My(h[e],d[e]);if(u)return u}return P(h.length,d.length);case 10:{var p=e.mapValue;var f=t.mapValue;if(p===Ry.mapValue&&f===Ry.mapValue)return 0;if(p===Ry.mapValue)return 1;if(f===Ry.mapValue)return-1;const y=p.fields||{},_=Object.keys(y),w=f.fields||{},b=Object.keys(w);_.sort(),b.sort();for(let e=0;e<_.length&&e<b.length;++e){const f=P(_[e],b[e]);if(0!==f)return f;var g=My(y[_[e]],w[b[e]]);if(0!==g)return g}return P(_.length,b.length);return}default:throw N()}}function Ly(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return P(e,t);var e=ky(e),t=ky(t),n=P(e.seconds,t.seconds);return 0!==n?n:P(e.nanos,t.nanos)}function Fy(e){return function n(r){{if("nullValue"in r)return"null";if("booleanValue"in r)return""+r.booleanValue;if("integerValue"in r)return""+r.integerValue;if("doubleValue"in r)return""+r.doubleValue;if("timestampValue"in r)return`time(${(e=ky(r.timestampValue)).seconds},${e.nanos})`;if("stringValue"in r)return r.stringValue;if("bytesValue"in r)return Cy(r.bytesValue).toBase64();if("referenceValue"in r)return t=r.referenceValue,L.fromName(t).toString();if("geoPointValue"in r)return`geo(${(t=r.geoPointValue).latitude},${t.longitude})`;if("arrayValue"in r){let e="[",t=!0;for(const s of r.arrayValue.values||[])t?t=!1:e+=",",e+=n(s);return e+"]"}if("mapValue"in r){var i=r.mapValue;let e="{",t=!0;for(const a of Object.keys(i.fields||{}).sort())t?t=!1:e+=",",e+=a+":"+n(i.fields[a]);return e+"}"}return N()}var e,t}(e)}function Uy(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/`+t.path.canonicalString()}}function qy(e){return e&&"integerValue"in e}function Vy(e){return!!e&&"arrayValue"in e}function By(e){return e&&"nullValue"in e}function jy(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Ky(e){return e&&"mapValue"in e}function Wy(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return yy(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=Wy(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=Wy(t.arrayValue.values[e]);return r}return Object.assign({},t)}function zy(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Gy(e,t){var n=My(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Hy(e,t){var n=My(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class $y{constructor(e,t){this.position=e,this.inclusive=t}}function Qy(t,n,r){let i=0;for(let e=0;e<t.position.length;e++){const s=n[e],a=t.position[e];if(i=s.field.isKeyField()?L.comparator(L.fromName(a.referenceValue),r.key):My(a,r.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function Yy(t,n){if(null===t)return null===n;if(null===n)return!1;if(t.inclusive!==n.inclusive||t.position.length!==n.position.length)return!1;for(let e=0;e<t.position.length;e++)if(!Py(t.position[e],n.position[e]))return!1;return!0}class Jy{}class U extends Jy{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new i_(e,t,n):"array-contains"===t?new c_(e,n):"in"===t?new l_(e,n):"not-in"===t?new u_(e,n):"array-contains-any"===t?new h_(e,n):new U(e,t,n)}static createKeyFieldInFilter(e,t,n){return new("in"===t?s_:a_)(e,n)}matches(e){e=e.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(My(e,this.value)):null!==e&&Dy(this.value)===Dy(e)&&this.matchesComparison(My(e,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return N()}}isInequality(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class q extends Jy{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new q(e,t)}matches(t){return Xy(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null===this.ht&&(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){var e=this.lt(e=>e.isInequality());return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Xy(e){return"and"===e.op}function Zy(e){return"or"===e.op}function e_(e){return t_(e)&&Xy(e)}function t_(e){for(const t of e.filters)if(t instanceof q)return!1;return!0}function n_(e,t){t=e.filters.concat(t);return q.create(t,e.op)}function r_(e){return e instanceof U?`${(t=e).field.canonicalString()} ${t.op} `+Fy(t.value):e instanceof q?e.op.toString()+" {"+e.getFilters().map(r_).join(" ,")+"}":"Filter";var t}class i_ extends U{constructor(e,t,n){super(e,t,n),this.key=L.fromName(n.referenceValue)}matches(e){e=L.comparator(e.key,this.key);return this.matchesComparison(e)}}class s_ extends U{constructor(e,t){super(e,"in",t),this.keys=o_(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class a_ extends U{constructor(e,t){super(e,"not-in",t),this.keys=o_(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function o_(e,t){return((null==(t=t.arrayValue)?void 0:t.values)||[]).map(e=>L.fromName(e.referenceValue))}class c_ extends U{constructor(e,t){super(e,"array-contains",t)}matches(e){e=e.data.field(this.field);return Vy(e)&&Oy(e.arrayValue,this.value)}}class l_ extends U{constructor(e,t){super(e,"in",t)}matches(e){e=e.data.field(this.field);return null!==e&&Oy(this.value.arrayValue,e)}}class u_ extends U{constructor(e,t){super(e,"not-in",t)}matches(e){if(Oy(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;e=e.data.field(this.field);return null!==e&&!Oy(this.value.arrayValue,e)}}class h_ extends U{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Vy(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Oy(this.value.arrayValue,e))}}class d_{constructor(e,t="asc"){this.field=e,this.dir=t}}class p_{constructor(e,t){this.comparator=e,this.root=t||g_.EMPTY}insert(e,t){return new p_(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,g_.BLACK,null,null))}remove(e){return new p_(this.comparator,this.root.remove(e,this.comparator).copy(null,null,g_.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(e+":"+t),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new f_(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new f_(this.root,e,this.comparator,!1)}getReverseIterator(){return new f_(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new f_(this.root,e,this.comparator,!0)}}class f_{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class g_{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:g_.RED,this.left=null!=r?r:g_.EMPTY,this.right=null!=i?i:g_.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new g_(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return g_.EMPTY;let e=this;return(e=(e=e.left.isRed()||e.left.left.isRed()?e:e.moveRedLeft()).copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r=(r=r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()?r:r.moveRedLeft()).copy(null,null,null,r.left.remove(e,t),null);else{if(0===t(e,(r=(r=r.left.isRed()?r.rotateRight():r).right.isEmpty()||r.right.isRed()||r.right.left.isRed()?r:r.moveRedRight()).key)){if(r.right.isEmpty())return g_.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e=(e=(e=e.right.isRed()&&!e.left.isRed()?e.rotateLeft():e).left.isRed()&&e.left.left.isRed()?e.rotateRight():e).left.isRed()&&e.right.isRed()?e.colorFlip():e}moveRedLeft(){let e=this.colorFlip();return e=e.right.left.isRed()?(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip():e}moveRedRight(){let e=this.colorFlip();return e=e.left.left.isRed()?(e=e.rotateRight()).colorFlip():e}rotateLeft(){var e=this.copy(null,null,g_.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,g_.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw N();if(this.right.isRed())throw N();var e=this.left.check();if(e!==this.right.check())throw N();return e+(this.isRed()?0:1)}}g_.EMPTY=null,g_.RED=!0,g_.BLACK=!1,g_.EMPTY=new class{constructor(){this.size=0}get key(){throw N()}get value(){throw N()}get color(){throw N()}get left(){throw N()}get right(){throw N()}copy(e,t,n,r,i){return this}insert(e,t,n){return new g_(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class V{constructor(e){this.comparator=e,this.data=new p_(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new m_(this.data.getIterator())}getIteratorFrom(e){return new m_(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof V))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new V(this.comparator);return t.data=e,t}}class m_{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function v_(e){return e.hasNext()?e.getNext():void 0}class y_{constructor(e){(this.fields=e).sort(Wv.comparator)}static empty(){return new y_([])}unionWith(e){let t=new V(Wv.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new y_(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return qv(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class __{constructor(e){this.value=e}static empty(){return new __({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let t=this.value;for(let e=0;e<n.length-1;++e)if(!Ky(t=(t.mapValue.fields||{})[n.get(e)]))return null;return(t=(t.mapValue.fields||{})[n.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Wy(t)}setAll(e){let n=Wv.emptyPath(),r={},i=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,i),r={},i=[],n=t.popLast()}e?r[t.lastSegment()]=Wy(e):i.push(t.lastSegment())});e=this.getFieldsMap(n);this.applyChanges(e,r,i)}delete(e){const t=this.field(e.popLast());Ky(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Py(this.value,e.value)}getFieldsMap(n){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let t=0;t<n.length;++t){let e=r.mapValue.fields[n.get(t)];Ky(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},r.mapValue.fields[n.get(t)]=e),r=e}return r.mapValue.fields}applyChanges(n,e,t){yy(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new __(Wy(this.value))}}class w_{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new w_(e,0,O.min(),O.min(),O.min(),__.empty(),0)}static newFoundDocument(e,t,n,r){return new w_(e,1,t,O.min(),n,r,0)}static newNoDocument(e,t){return new w_(e,2,t,O.min(),O.min(),__.empty(),0)}static newUnknownDocument(e,t){return new w_(e,3,t,O.min(),O.min(),__.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(O.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=__.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=__.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=O.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof w_&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new w_(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class b_{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.ft=null}}function I_(e,t=null,n=[],r=[],i=null,s=null,a=null){return new b_(e,t,n,r,i,s,a)}function T_(e){const t=e;if(null===t.ft){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e=(e=(e+="|f:")+t.filters.map(e=>function t(e){if(e instanceof U)return e.field.canonicalString()+e.op.toString()+Fy(e.value);var n=e.filters.map(e=>t(e)).join(",");return e.op+`(${n})`}(e)).join(",")+"|ob:")+t.orderBy.map(e=>{return e.field.canonicalString()+e.dir}).join(","),wy(t.limit)||(e=(e+="|l:")+t.limit),t.startAt&&(e=(e=(e+="|lb:")+(t.startAt.inclusive?"b:":"a:"))+t.startAt.position.map(e=>Fy(e)).join(",")),t.endAt&&(e=(e=(e+="|ub:")+(t.endAt.inclusive?"a:":"b:"))+t.endAt.position.map(e=>Fy(e)).join(",")),t.ft=e}return t.ft}function E_(t,n){if(t.limit!==n.limit)return!1;if(t.orderBy.length!==n.orderBy.length)return!1;for(let e=0;e<t.orderBy.length;e++)if(r=t.orderBy[e],i=n.orderBy[e],r.dir!==i.dir||!r.field.isEqual(i.field))return!1;var r,i;if(t.filters.length!==n.filters.length)return!1;for(let e=0;e<t.filters.length;e++)if(!function r(e,t){return e instanceof U?(n=e,(s=t)instanceof U&&n.op===s.op&&n.field.isEqual(s.field)&&Py(n.value,s.value)):e instanceof q?(i=t)instanceof q&&e.op===i.op&&e.filters.length===i.filters.length&&e.filters.reduce((e,t,n)=>e&&r(t,i.filters[n]),!0):void N();var i,n,s}(t.filters[e],n.filters[e]))return!1;return t.collectionGroup===n.collectionGroup&&!!t.path.isEqual(n.path)&&!!Yy(t.startAt,n.startAt)&&Yy(t.endAt,n.endAt)}function k_(e){return L.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function S_(e,t){return e.filters.filter(e=>e instanceof U&&e.field.isEqual(t))}function C_(t,n,r){let i=xy,s=!0;for(const r of S_(t,n)){let e=xy,t=!0;switch(r.op){case"<":case"<=":e="nullValue"in(a=r.value)?xy:"booleanValue"in a?{booleanValue:!1}:"integerValue"in a||"doubleValue"in a?{doubleValue:NaN}:"timestampValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in a?{stringValue:""}:"bytesValue"in a?{bytesValue:""}:"referenceValue"in a?Uy(my.empty(),L.empty()):"geoPointValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in a?{arrayValue:{}}:"mapValue"in a?{mapValue:{}}:N();break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=xy}Gy({value:i,inclusive:s},{value:e,inclusive:t})<0&&(i=e,s=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];Gy({value:i,inclusive:s},{value:t,inclusive:r.inclusive})<0&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}function A_(t,n,r){let i=Ry,s=!0;for(const r of S_(t,n)){let e=Ry,t=!0;switch(r.op){case">=":case">":e="nullValue"in(a=r.value)?{booleanValue:!1}:"booleanValue"in a?{doubleValue:NaN}:"integerValue"in a||"doubleValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in a?{stringValue:""}:"stringValue"in a?{bytesValue:""}:"bytesValue"in a?Uy(my.empty(),L.empty()):"referenceValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in a?{arrayValue:{}}:"arrayValue"in a?{mapValue:{}}:"mapValue"in a?Ry:N(),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=Ry}0<Hy({value:i,inclusive:s},{value:e,inclusive:t})&&(i=e,s=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];0<Hy({value:i,inclusive:s},{value:t,inclusive:r.inclusive})&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}class N_{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.dt=null,this._t=null,this.startAt,this.endAt}}function R_(e,t,n,r,i,s,a,o){return new N_(e,t,n,r,i,s,a,o)}function x_(e){return new N_(e)}function D_(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function P_(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function O_(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function M_(e){return null!==e.collectionGroup}function L_(t){const n=t;if(null===n.dt){n.dt=[];const t=O_(n),e=P_(n);if(null!==t&&null===e)t.isKeyField()||n.dt.push(new d_(t)),n.dt.push(new d_(Wv.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n.dt.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.dt.push(new d_(Wv.keyField(),t))}}}return n.dt}function F_(e){const t=e;if(!t._t)if("F"===t.limitType)t._t=I_(t.path,t.collectionGroup,L_(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of L_(t)){const t="desc"===i.dir?"asc":"desc";e.push(new d_(i.field,t))}var n=t.endAt?new $y(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new $y(t.startAt.position,t.startAt.inclusive):null;t._t=I_(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t._t}function U_(e,t){t.getFirstInequalityField(),O_(e);t=e.filters.concat([t]);return new N_(e.path,e.collectionGroup,e.explicitOrderBy.slice(),t,e.limit,e.limitType,e.startAt,e.endAt)}function q_(e,t,n){return new N_(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function V_(e,t){return E_(F_(e),F_(t))&&e.limitType===t.limitType}function B_(e){return T_(F_(e))+"|lt:"+e.limitType}function j_(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>r_(e)).join(", ")}]`),wy(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${e.field.canonicalString()} (${e.dir})`}).join(", ")}]`),e.startAt&&(t=(t=(t+=", startAt: ")+(e.startAt.inclusive?"b:":"a:"))+e.startAt.position.map(e=>Fy(e)).join(",")),`Target(${t=e.endAt?(t=(t+=", endAt: ")+(e.endAt.inclusive?"a:":"b:"))+e.endAt.position.map(e=>Fy(e)).join(","):t})`}(F_(e))}; limitType=${e.limitType})`}function K_(n,e){return e.isFoundDocument()&&(a=(s=e).key.path,null!==(i=n).collectionGroup?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(a):L.isDocumentKey(i.path)?i.path.isEqual(a):i.path.isImmediateParentOf(a))&&function(e){for(const t of L_(n))if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(i=e,(!(e=n).startAt||(r=Qy(t=e.startAt,L_(e),i),t.inclusive?r<=0:r<0))&&(!e.endAt||(r=Qy(t=e.endAt,L_(e),i),t.inclusive?0<=r:0<r)));var t,r,i,s,a}function W_(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function z_(i){return(e,t)=>{let n=!1;for(const r of L_(i)){const i=function(e,t,n){var r,i=e.field.isKeyField()?L.comparator(t.key,n.key):(r=e.field,n=n,t=t.data.field(r),n=n.data.field(r),null!==t&&null!==n?My(t,n):N());switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return N()}}(r,e,t);if(0!==i)return i;n=n||r.field.isKeyField()}return 0}}function G_(e,t){if(e.wt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:by(t)?"-0":t}}function H_(e){return{integerValue:""+e}}function $_(e,t){return Iy(t)?H_(t):G_(e,t)}class Q_{constructor(){this._=void 0}}function Y_(e,t){return e instanceof nw?qy(e=t)||e&&"doubleValue"in e?t:{integerValue:0}:null}class J_ extends Q_{}class X_ extends Q_{constructor(e){super(),this.elements=e}}function Z_(e,t){const n=iw(t);for(const t of e.elements)n.some(e=>Py(e,t))||n.push(t);return{arrayValue:{values:n}}}class ew extends Q_{constructor(e){super(),this.elements=e}}function tw(e,t){let n=iw(t);for(const t of e.elements)n=n.filter(e=>!Py(e,t));return{arrayValue:{values:n}}}class nw extends Q_{constructor(e,t){super(),this.yt=e,this.gt=t}}function rw(e){return Sy(e.integerValue||e.doubleValue)}function iw(e){return Vy(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class sw{constructor(e,t){this.field=e,this.transform=t}}class aw{constructor(e,t){this.version=e,this.transformResults=t}}class ow{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ow}static exists(e){return new ow(void 0,e)}static updateTime(e){return new ow(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function cw(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class lw{}function uw(e,n){if(!e.hasLocalMutations||n&&0===n.fields.length)return null;if(null===n)return e.isNoDocument()?new yw(e.key,ow.none()):new pw(e.key,e.data,ow.none());{const i=e.data,s=__.empty();let t=new V(Wv.comparator);for(var r of n.fields)if(!t.has(r)){let e=i.field(r);null===e&&1<r.length&&(r=r.popLast(),e=i.field(r)),null===e?s.delete(r):s.set(r,e),t=t.add(r)}return new fw(e.key,s,new y_(t.toArray()),ow.none())}}function hw(e,t,n,r){if(e instanceof pw){var i=e,s=t,a=n,o=r;if(!cw(i.precondition,s))return a;const c=i.value.clone(),l=vw(i.fieldTransforms,o,s);return c.setAll(l),s.convertToFoundDocument(s.version,c).setHasLocalMutations(),null}if(e instanceof fw){a=e,i=t,o=n,s=r;if(!cw(a.precondition,i))return o;const u=vw(a.fieldTransforms,s,i),h=i.data;return h.setAll(gw(a)),h.setAll(u),i.convertToFoundDocument(i.version,h).setHasLocalMutations(),null===o?null:o.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(e=>e.field))}return cw(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function dw(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&qv(n,r,(e,t)=>{return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof X_&&t instanceof X_||e instanceof ew&&t instanceof ew?qv(e.elements,t.elements,Py):e instanceof nw&&t instanceof nw?Py(e.gt,t.gt):e instanceof J_&&t instanceof J_)}))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}class pw extends lw{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class fw extends lw{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function gw(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function mw(t,n,r){const i=new Map;R(t.length===r.length);for(let e=0;e<r.length;e++){var s=t[e],a=s.transform,o=n.data.field(s.field);i.set(s.field,(s=a,a=o,o=r[e],s instanceof X_?Z_(s,a):s instanceof ew?tw(s,a):o))}return i}function vw(e,t,n){const r=new Map;for(const l of e){const e=l.transform,u=n.data.field(l.field);r.set(l.field,(i=e,s=u,a=t,0,i instanceof J_?function(){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return s&&(e.fields.__previous_value__=s),{mapValue:e}}():i instanceof X_?Z_(i,s):i instanceof ew?tw(i,s):(c=rw(o=Y_(i,s))+rw(i.gt),qy(o)&&qy(i.gt)?H_(c):G_(i.yt,c))))}var i,s,a,o,c;return r}class yw extends lw{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class _w extends lw{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ww{constructor(e){this.count=e}}function bw(e){switch(e){default:return N(),0;case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return 1}}function Iw(e){if(void 0===e)return Sv("GRPC error has no .code"),x.UNKNOWN;switch(e){case pv.OK:return x.OK;case pv.CANCELLED:return x.CANCELLED;case pv.UNKNOWN:return x.UNKNOWN;case pv.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case pv.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case pv.INTERNAL:return x.INTERNAL;case pv.UNAVAILABLE:return x.UNAVAILABLE;case pv.UNAUTHENTICATED:return x.UNAUTHENTICATED;case pv.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case pv.NOT_FOUND:return x.NOT_FOUND;case pv.ALREADY_EXISTS:return x.ALREADY_EXISTS;case pv.PERMISSION_DENIED:return x.PERMISSION_DENIED;case pv.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case pv.ABORTED:return x.ABORTED;case pv.OUT_OF_RANGE:return x.OUT_OF_RANGE;case pv.UNIMPLEMENTED:return x.UNIMPLEMENTED;case pv.DATA_LOSS:return x.DATA_LOSS;default:return N()}}Bt=pv={OK:0,0:"OK",CANCELLED:1,1:"CANCELLED",UNKNOWN:2,2:"UNKNOWN",INVALID_ARGUMENT:3,3:"INVALID_ARGUMENT",DEADLINE_EXCEEDED:4,4:"DEADLINE_EXCEEDED",NOT_FOUND:5,5:"NOT_FOUND",ALREADY_EXISTS:6,6:"ALREADY_EXISTS",PERMISSION_DENIED:7,7:"PERMISSION_DENIED",UNAUTHENTICATED:16,16:"UNAUTHENTICATED",RESOURCE_EXHAUSTED:8,8:"RESOURCE_EXHAUSTED",FAILED_PRECONDITION:9,9:"FAILED_PRECONDITION",ABORTED:10,10:"ABORTED",OUT_OF_RANGE:11,11:"OUT_OF_RANGE",UNIMPLEMENTED:12,12:"UNIMPLEMENTED",INTERNAL:13,13:"INTERNAL",UNAVAILABLE:14,14:"UNAVAILABLE",DATA_LOSS:15,15:"DATA_LOSS"};class Tw{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(t,n){const e=this.mapKeyFn(t),r=this.inner[e];if(void 0===r)return this.inner[e]=[[t,n]],void this.innerSize++;for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return void(r[e]=[t,n]);r.push([t,n]),this.innerSize++}delete(t){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return!1;for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return 1===r.length?delete this.inner[n]:r.splice(e,1),this.innerSize--,!0;return!1}forEach(r){yy(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return _y(this.inner)}size(){return this.innerSize}}const Ew=new p_(L.comparator),kw=new p_(L.comparator);function Sw(...e){let t=kw;for(const n of e)t=t.insert(n.key,n);return t}function Cw(e){let n=kw;return e.forEach((e,t)=>n=n.insert(e,t.overlayedDocument)),n}function Aw(){return new Tw(e=>e.toString(),(e,t)=>e.isEqual(t))}const Nw=new p_(L.comparator),Rw=new V(L.comparator);function B(...e){let t=Rw;for(const n of e)t=t.add(n);return t}const xw=new V(P);class Dw{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Pw.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Dw(O.min(),r,xw,Ew,B())}}class Pw{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Pw(n,t,B(),B(),B())}}class Ow{constructor(e,t,n,r){this.It=e,this.removedTargetIds=t,this.key=n,this.Tt=r}}class Mw{constructor(e,t){this.targetId=e,this.Et=t}}class Lw{constructor(e,t,n=Ty.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Fw{constructor(){this.At=0,this.Rt=Vw(),this.bt=Ty.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return 0!==this.At}get St(){return this.vt}Dt(e){0<e.approximateByteSize()&&(this.vt=!0,this.bt=e)}Ct(){let n=B(),r=B(),i=B();return this.Rt.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:i=i.add(e);break;default:N()}}),new Pw(this.bt,this.Pt,n,r,i)}xt(){this.vt=!1,this.Rt=Vw()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){--this.At}Ft(){this.vt=!0,this.Pt=!0}}class Uw{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=Ew,this.qt=qw(),this.Ut=new V(P)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const n of e.removedTargetIds)this.Qt(n,e.key,e.Tt)}jt(n){this.forEachTarget(n,e=>{const t=this.Wt(e);switch(n.state){case 0:this.zt(e)&&t.Dt(n.resumeToken);break;case 1:t.Mt(),t.Vt||t.xt(),t.Dt(n.resumeToken);break;case 2:t.Mt(),t.Vt||this.removeTarget(e);break;case 3:this.zt(e)&&(t.Ft(),t.Dt(n.resumeToken));break;case 4:this.zt(e)&&(this.Ht(e),t.Dt(n.resumeToken));break;default:N()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.Bt.forEach((e,t)=>{this.zt(t)&&n(t)})}Jt(e){const t=e.targetId,n=e.Et.count,r=this.Yt(t);if(r){const e=r.target;if(k_(e))if(0===n){const n=new L(e.path);this.Qt(t,n,w_.newNoDocument(n,O.min()))}else R(1===n);else this.Xt(t)!==n&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(r){const i=new Map;this.Bt.forEach((e,t)=>{var n=this.Yt(t);if(n){if(e.current&&k_(n.target)){const i=new L(n.target.path);null!==this.Lt.get(i)||this.te(t,i)||this.Qt(t,i,w_.newNoDocument(i,r))}e.St&&(i.set(t,e.Ct()),e.xt())}});let s=B();this.qt.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{e=this.Yt(e);return!e||2===e.purpose||(n=!1)}),n&&(s=s.add(e))}),this.Lt.forEach((e,t)=>t.setReadTime(r));var e=new Dw(r,i,this.Ut,this.Lt,s);return this.Lt=Ew,this.qt=qw(),this.Ut=new V(P),e}Gt(e,t){var n;this.zt(e)&&(n=this.te(e,t.key)?2:0,this.Wt(e).Nt(t.key,n),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e)))}Qt(e,t,n){if(this.zt(e)){const r=this.Wt(e);this.te(e,t)?r.Nt(t,1):r.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),n&&(this.Lt=this.Lt.insert(t,n))}}removeTarget(e){this.Bt.delete(e)}Xt(e){var t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new Fw,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new V(P),this.qt=this.qt.insert(e,t)),t}zt(e){var t=null!==this.Yt(e);return t||p("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){var t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(t){this.Bt.set(t,new Fw),this.$t.getRemoteKeysForTarget(t).forEach(e=>{this.Qt(t,e,null)})}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function qw(){return new p_(L.comparator)}function Vw(){return new p_(L.comparator)}const Bw={asc:"ASCENDING",desc:"DESCENDING"},jw={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Kw={and:"AND",or:"OR"};class Ww{constructor(e,t){this.databaseId=e,this.wt=t}}function zw(e,t){return e.wt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Gw(e,t){return e.wt?t.toBase64():t.toUint8Array()}function Hw(e){return R(!!e),O.fromTimestamp((e=ky(e),new Bv(e.seconds,e.nanos)))}function $w(e,t){return new M(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function Qw(e){e=M.fromString(e);return R(hb(e)),e}function Yw(e,t){return $w(e.databaseId,t.path)}function Jw(e,t){const n=Qw(t);if(n.get(1)!==e.databaseId.projectId)throw new D(x.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new D(x.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new L(tb(n))}function Xw(e,t){return $w(e.databaseId,t)}function Zw(e){e=Qw(e);return 4===e.length?M.emptyPath():tb(e)}function eb(e){return new M(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function tb(e){return R(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function nb(e,t,n){return{name:Yw(e,t),fields:n.value.mapValue.fields}}function rb(e,t,n){const r=Jw(e,t.name),i=Hw(t.updateTime),s=t.createTime?Hw(t.createTime):O.min(),a=new __({mapValue:{fields:t.fields}}),o=w_.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function ib(e,t){let n;if(t instanceof pw)n={update:nb(e,t.key,t.value)};else if(t instanceof yw)n={delete:Yw(e,t.key)};else if(t instanceof fw)n={update:nb(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof _w))return N();n={verify:Yw(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>{var t=e.transform;if(t instanceof J_)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof X_)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof ew)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof nw)return{fieldPath:e.field.canonicalString(),increment:t.gt};throw N()})),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:zw(e,(t=r.updateTime).toTimestamp())}:void 0!==r.exists?{exists:r.exists}:N()),n;var r}function sb(r,t){const e=t.currentDocument?void 0!==(i=t.currentDocument).updateTime?ow.updateTime(Hw(i.updateTime)):void 0!==i.exists?ow.exists(i.exists):ow.none():ow.none(),n=t.updateTransforms?t.updateTransforms.map(t=>{{var n=r;let e=null;if("setToServerValue"in t)R("REQUEST_TIME"===t.setToServerValue),e=new J_;else if("appendMissingElements"in t){const n=t.appendMissingElements.values||[];e=new X_(n)}else if("removeAllFromArray"in t){const n=t.removeAllFromArray.values||[];e=new ew(n)}else"increment"in t?e=new nw(n,t.increment):N();return n=Wv.fromServerFormat(t.fieldPath),new sw(n,e)}}):[];if(t.update){t.update.name;var i=Jw(r,t.update.name),s=new __({mapValue:{fields:t.update.fields}});if(t.updateMask){const r=function(){const e=t.updateMask.fieldPaths||[];return new y_(e.map(e=>Wv.fromServerFormat(e)))}();return new fw(i,s,r,e,n)}return new pw(i,s,e,n)}if(t.delete){const n=Jw(r,t.delete);return new yw(n,e)}if(t.verify){const n=Jw(r,t.verify);return new _w(n,e)}return N()}function ab(e,t){return{documents:[Xw(e,t.path)]}}function ob(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Xw(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Xw(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i,s=function(e){if(0!==e.length)return function t(e){if(e instanceof U){var n=e;if("=="===n.op){if(jy(n.value))return{unaryFilter:{field:lb(n.field),op:"IS_NAN"}};if(By(n.value))return{unaryFilter:{field:lb(n.field),op:"IS_NULL"}}}else if("!="===n.op){if(jy(n.value))return{unaryFilter:{field:lb(n.field),op:"IS_NOT_NAN"}};if(By(n.value))return{unaryFilter:{field:lb(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:lb(n.field),op:(r=n.op,jw[r]),value:n.value}}}return e instanceof q?1===(n=(r=e).getFilters().map(e=>t(e))).length?n[0]:{compositeFilter:{op:(r=r.op,Kw[r]),filters:n}}:N();var r}(q.create(e,"and"))}(t.filters);return s&&(n.structuredQuery.where=s),(s=function(e){if(0!==e.length)return e.map(e=>{return{field:lb(e.field),direction:(e=e.dir,Bw[e])}})}(t.orderBy))&&(n.structuredQuery.orderBy=s),i=t.limit,null!==(s=e.wt||wy(i)?i:{value:i})&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt={before:(s=t.startAt).inclusive,values:s.position}),t.endAt&&(n.structuredQuery.endAt={before:!(t=t.endAt).inclusive,values:t.position}),n}function cb(e){let t=Zw(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;var s,a,o,c;0<r&&(R(1===r),(s=n.from[0]).allDescendants?i=s.collectionId:t=t.child(s.collectionId));let l=[],u=(n.where&&(l=function(){const e=function t(e){if(void 0!==e.unaryFilter){var n=e;switch(n.unaryFilter.op){case"IS_NAN":var r=ub(n.unaryFilter.field);return U.create(r,"==",{doubleValue:NaN});case"IS_NULL":r=ub(n.unaryFilter.field);return U.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":r=ub(n.unaryFilter.field);return U.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":r=ub(n.unaryFilter.field);return U.create(r,"!=",{nullValue:"NULL_VALUE"});default:return N()}}else{return void 0!==e.fieldFilter?(s=e,U.create(ub(s.fieldFilter.field),function(){switch(s.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return N()}}(),s.fieldFilter.value)):void 0!==e.compositeFilter?(i=e,q.create(i.compositeFilter.filters.map(e=>t(e)),function(){switch(i.compositeFilter.op){case"AND":return"and";case"OR":return"or";default:return N()}}())):N();var i,s}}(n.where);return e instanceof q&&e_(e)?e.getFilters():[e]}()),[]),h=(n.orderBy&&(u=n.orderBy.map(e=>{var t=e;return new d_(ub(t.field),function(){switch(t.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())})),null),d=(n.limit&&(h=wy(s="object"==typeof(e=n.limit)?e.value:e)?null:s),null),p=(n.startAt&&(d=(c=!!(a=n.startAt).before,o=a.values||[],new $y(o,c))),null);return n.endAt&&(p=(o=!(a=n.endAt).before,c=a.values||[],new $y(c,o))),R_(t,i,u,l,h,"F",d,p)}function lb(e){return{fieldPath:e.canonicalString()}}function ub(e){return Wv.fromServerFormat(e.fieldPath)}function hb(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function db(t){let i="";for(let e=0;e<t.length;e++)0<i.length&&(i=pb(i)),i=function(t){let n=i;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(t.get(e));return pb(i)}function pb(e){return e+""}function fb(n){const r=n.length;if(R(2<=r),2===r)return R(""===n.charAt(0)&&""===n.charAt(1)),M.emptyPath();r;const i=[];let s="";for(let t=0;t<r;){const r=n.indexOf("",t);switch((r<0||r>a)&&N(),n.charAt(r+1)){case"":const a=n.substring(t,r);let e;0===s.length?e=a:(s+=a,e=s,s=""),i.push(e);break;case"":s=s+n.substring(t,r)+"\0";break;case"":s+=n.substring(t,r+1);break;default:N()}t=r+2}return new M(i)}const gb=["userId","batchId"];function mb(e,t){return[e,db(t)]}function vb(e,t,n){return[e,db(t),n]}const yb={},_b=["prefixPath","collectionGroup","readTime","documentId"],wb=["prefixPath","collectionGroup","documentId"],bb=["collectionGroup","readTime","prefixPath","documentId"],Ib=["canonicalId","targetId"],Tb=["targetId","path"],Eb=["path","targetId"],kb=["collectionId","parent"],Sb=["indexId","uid"],Cb=["uid","sequenceNumber"],Ab=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Nb=["indexId","uid","orderedDocumentKey"],Rb=["userId","collectionPath","documentId"],xb=["userId","collectionPath","largestBatchId"],Db=["userId","collectionGroup","largestBatchId"],Pb=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Ob=[...Pb,"documentOverlays"],Mb=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Lb=Mb,Fb=[...Lb,"indexConfiguration","indexState","indexEntries"];class Ub extends ty{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function qb(e,t){return iy.M(e.se,t)}class Vb{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){var n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const l=this.mutations[e];if(l.key.isEqual(t.key)){r=void 0;i=void 0;s=void 0;a=void 0;o=void 0;c=void 0;a=void 0;o=void 0;c=void 0;var r=l;var i=t;var s=n[e];if(r instanceof pw){var a=r,o=i,c=s;const u=a.value.clone(),h=mw(a.fieldTransforms,o,c.transformResults);u.setAll(h),o.convertToFoundDocument(c.version,u).setHasCommittedMutations()}else if(r instanceof fw){a=r,o=i,c=s;if(cw(a.precondition,o)){const d=mw(a.fieldTransforms,o,c.transformResults),p=o.data;p.setAll(gw(a)),p.setAll(d),o.convertToFoundDocument(c.version,p).setHasCommittedMutations()}else o.convertToUnknownDocument(c.version)}else i.convertToNoDocument(s.version).setHasCommittedMutations()}}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=hw(n,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=hw(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(s,a){const o=Aw();return this.mutations.forEach(e=>{const t=s.get(e.key),n=t.overlayedDocument;let r=this.applyToLocalView(n,t.mutatedFields);r=a.has(e.key)?null:r;var i=uw(n,r);null!==i&&o.set(e.key,i),n.isValidDocument()||n.convertToNoDocument(O.min())}),o}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),B())}isEqual(e){return this.batchId===e.batchId&&qv(this.mutations,e.mutations,(e,t)=>dw(e,t))&&qv(this.baseMutations,e.baseMutations,(e,t)=>dw(e,t))}}class Bb{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){R(e.mutations.length===n.length);let r=Nw;var i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Bb(e,t,n,r)}}class jb{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Kb{constructor(e,t,n,r,i=O.min(),s=O.min(),a=Ty.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a}withSequenceNumber(e){return new Kb(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Kb(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Kb(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Wb{constructor(e){this.ie=e}}function zb(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Gb(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document={name:Yw(i=e.ie,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:zw(i,e.version.toTimestamp()),createTime:zw(i,e.createTime.toTimestamp())};else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Hb(t.version)};else{if(!t.isUnknownDocument())return N();r.unknownDocument={path:n.path.toArray(),version:Hb(t.version)}}var i;return r}function Gb(e){e=e.toTimestamp();return[e.seconds,e.nanoseconds]}function Hb(e){e=e.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function $b(e){e=new Bv(e.seconds,e.nanoseconds);return O.fromTimestamp(e)}function Qb(t,n){const r=(n.baseMutations||[]).map(e=>sb(t.ie,e));for(let e=0;e<n.mutations.length-1;++e){const r=n.mutations[e];if(e+1<n.mutations.length&&void 0!==n.mutations[e+1].transform){const i=n.mutations[e+1];r.updateTransforms=i.transform.fieldTransforms,n.mutations.splice(e+1,1),++e}}const i=n.mutations.map(e=>sb(t.ie,e)),e=Bv.fromMillis(n.localWriteTimeMs);return new Vb(n.batchId,e,r,i)}function Yb(e){var t=$b(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?$b(e.lastLimboFreeSnapshotVersion):O.min(),r=void 0!==e.query.documents?(R(1===(r=e.query).documents.length),F_(x_(Zw(r.documents[0])))):F_(cb(e.query));return new Kb(r,e.targetId,0,e.lastListenSequenceNumber,t,n,Ty.fromBase64String(e.resumeToken))}function Jb(e,t){var n=Hb(t.snapshotVersion),r=Hb(t.lastLimboFreeSnapshotVersion),e=(k_(t.target)?ab:ob)(e.ie,t.target),i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:T_(t.target),readTime:n,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:e}}function Xb(e){var t=cb({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?q_(t,t.limit,"L"):t}function Zb(e,t){return new jb(t.largestBatchId,sb(e.ie,t.overlayMutation))}function eI(e,t){var n=t.path.lastSegment();return[e,db(t.path.popLast()),n]}function tI(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Hb(r.readTime),documentKey:db(r.documentKey.path),largestBatchId:r.largestBatchId}}class nI{getBundleMetadata(e,t){return rI(e).get(t).next(e=>{if(e)return{id:(e=e).bundleId,createTime:$b(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return rI(e).put({bundleId:(e=t).id,createTime:Hb(Hw(e.createTime)),version:e.version})}getNamedQuery(e,t){return iI(e).get(t).next(e=>{if(e)return{name:(e=e).name,query:Xb(e.bundledQuery),readTime:$b(e.readTime)}})}saveNamedQuery(e,t){return iI(e).put({name:t.name,readTime:Hb(Hw(t.readTime)),bundledQuery:t.bundledQuery})}}function rI(e){return qb(e,"bundles")}function iI(e){return qb(e,"namedQueries")}class sI{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){t=t.uid||"";return new sI(e,t)}getOverlay(e,t){return aI(e).get(eI(this.userId,t)).next(e=>e?Zb(this.yt,e):null)}getOverlays(e,t){const n=Aw();return F.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(n,r,e){const i=[];return e.forEach((e,t)=>{t=new jb(r,t);i.push(this.oe(n,t))}),F.waitFor(i)}removeOverlaysForBatchId(t,e,n){const r=new Set,i=(e.forEach(e=>r.add(db(e.getCollectionPath()))),[]);return r.forEach(e=>{e=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);i.push(aI(t).Y("collectionPathOverlayIndex",e))}),F.waitFor(i)}getOverlaysForCollection(e,t,n){const r=Aw(),i=db(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return aI(e).W("collectionPathOverlayIndex",s).next(e=>{for(const t of e){const e=Zb(this.yt,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,i){const s=Aw();let a;n=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return aI(e).Z({index:"collectionGroupOverlayIndex",range:n},(e,t,n)=>{const r=Zb(this.yt,t);s.size()<i||r.largestBatchId===a?(s.set(r.getKey(),r),a=r.largestBatchId):n.done()}).next(()=>s)}oe(e,t){return aI(e).put(function(e,t,n){var[,r,i]=eI(t,n.mutation.key);return{userId:t,collectionPath:r,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:ib(e.ie,n.mutation)}}(this.yt,this.userId,t))}}function aI(e){return qb(e,"documentOverlays")}class oI{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){var n,r;"nullValue"in e?this.he(t,5):"booleanValue"in e?(this.he(t,10),t.le(e.booleanValue?1:0)):"integerValue"in e?(this.he(t,15),t.le(Sy(e.integerValue))):"doubleValue"in e?(n=Sy(e.doubleValue),isNaN(n)?this.he(t,13):(this.he(t,15),by(n)?t.le(0):t.le(n))):"timestampValue"in e?(r=e.timestampValue,this.he(t,20),"string"==typeof r?t.fe(r):(t.fe(""+(r.seconds||"")),t.le(r.nanos||0))):"stringValue"in e?(this.de(e.stringValue,t),this._e(t)):"bytesValue"in e?(this.he(t,30),t.we(Cy(e.bytesValue)),this._e(t)):"referenceValue"in e?this.me(e.referenceValue,t):"geoPointValue"in e?(r=e.geoPointValue,this.he(t,45),t.le(r.latitude||0),t.le(r.longitude||0)):"mapValue"in e?zy(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):N()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){var n=e.fields||{};this.he(t,55);for(const e of Object.keys(n))this.de(e,t),this.ce(n[e],t)}ye(e,t){var n=e.values||[];this.he(t,50);for(const e of n)this.ce(e,t)}me(e,t){this.he(t,37),L.fromName(e).path.forEach(e=>{this.he(t,60),this.pe(e,t)})}he(e,t){e.le(t)}_e(e){e.le(2)}}function cI(e){e=64-function(t){let n=0;for(let e=0;e<8;++e){var r=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&t[e]);if(n+=r,8!==r)break}return n}(e);return Math.ceil(e/8)}oI.Ie=new oI;class lI{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ee(n.value),n=t.next();this.Ae()}Re(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.be(n.value),n=t.next();this.Pe()}ve(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ee(e);else if(e<2048)this.Ee(960|e>>>6),this.Ee(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ee(480|e>>>12),this.Ee(128|63&e>>>6),this.Ee(128|63&e);else{const e=t.codePointAt(0);this.Ee(240|e>>>18),this.Ee(128|63&e>>>12),this.Ee(128|63&e>>>6),this.Ee(128|63&e)}}this.Ae()}Ve(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.be(e);else if(e<2048)this.be(960|e>>>6),this.be(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.be(480|e>>>12),this.be(128|63&e>>>6),this.be(128|63&e);else{const e=t.codePointAt(0);this.be(240|e>>>18),this.be(128|63&e>>>12),this.be(128|63&e>>>6),this.be(128|63&e)}}this.Pe()}Se(t){var n=this.De(t),t=cI(n);this.Ce(1+t),this.buffer[this.position++]=255&t;for(let e=n.length-t;e<n.length;++e)this.buffer[this.position++]=255&n[e]}xe(t){var n=this.De(t),t=cI(n);this.Ce(1+t),this.buffer[this.position++]=~(255&t);for(let e=n.length-t;e<n.length;++e)this.buffer[this.position++]=~(255&n[e])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}Ee(e){e&=255;0==e?(this.ke(0),this.ke(255)):255==e?(this.ke(255),this.ke(0)):this.ke(e)}be(e){var t=255&e;0==t?(this.Me(0),this.Me(255)):255==t?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(t){t+=this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t);const n=new Uint8Array(e);n.set(this.buffer),this.buffer=n}}}class uI{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class hI{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class dI{constructor(){this.$e=new lI,this.Be=new uI(this.$e),this.Le=new hI(this.$e)}seed(e){this.$e.seed(e)}qe(e){return 0===e?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}class pI{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Ue(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new pI(this.indexId,this.documentKey,this.arrayValue,n)}}function fI(e,t){let n=e.indexId-t.indexId;return 0!==n?n:0!==(n=gI(e.arrayValue,t.arrayValue))?n:0!==(n=gI(e.directionalValue,t.directionalValue))?n:L.comparator(e.documentKey,t.documentKey)}function gI(t,n){for(let e=0;e<t.length&&e<n.length;++e){var r=t[e]-n[e];if(0!=r)return r}return t.length-n.length}class mI{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[];for(const t of e.filters){const e=t;e.isInequality()?this.Qe=e:this.Ge.push(e)}}je(e){R(e.collectionGroup===this.collectionId);var t=Gv(e);if(void 0!==t&&!this.We(t))return!1;var n=Hv(e);let r=0,i=0;for(;r<n.length&&this.We(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Qe){const e=n[r];if(!this.ze(this.Qe,e)||!this.He(this.Ke[i++],e))return!1;++r}for(;r<n.length;++r){const e=n[r];if(i>=this.Ke.length||!this.He(this.Ke[i++],e))return!1}return!0}We(e){for(const t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;e="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind==e}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function vI(e){return e instanceof U}function yI(e){return e instanceof q&&e_(e)}function _I(e){return vI(e)||yI(e)||function(e){if(e instanceof q&&Zy(e)){for(const t of e.getFilters())if(!vI(t)&&!yI(t))return!1;return!0}return!1}(e)}function wI(e,t){var n,r;return R(e instanceof U||e instanceof q),R(t instanceof U||t instanceof q),II(e instanceof U?t instanceof U?(n=e,r=t,q.create([n,r],"and")):bI(e,t):t instanceof U?bI(t,e):function(e,t){if(R(0<e.filters.length&&0<t.filters.length),Xy(e)&&Xy(t))return n_(e,t.getFilters());const n=Zy(e)?e:t,r=Zy(e)?t:e,i=n.filters.map(e=>wI(e,r));return q.create(i,"or")}(e,t))}function bI(t,e){if(Xy(e))return n_(e,t.getFilters());e=e.filters.map(e=>wI(t,e));return q.create(e,"or")}function II(t){if(R(t instanceof U||t instanceof q),t instanceof U)return t;const e=t.getFilters();if(1===e.length)return II(e[0]);if(t_(t))return t;const n=e.map(e=>II(e)),r=[];return n.forEach(e=>{e instanceof U?r.push(e):e instanceof q&&(e.op===t.op?r.push(...e.filters):r.push(e))}),1===r.length?r[0]:q.create(r,t.op)}class TI{constructor(){this.Je=new EI}addToCollectionParentIndex(e,t){return this.Je.add(t),F.resolve()}getCollectionParents(e,t){return F.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return F.resolve()}deleteFieldIndex(e,t){return F.resolve()}getDocumentsMatchingTarget(e,t){return F.resolve(null)}getIndexType(e,t){return F.resolve(0)}getFieldIndexes(e,t){return F.resolve([])}getNextCollectionGroupToUpdate(e){return F.resolve(null)}getMinOffset(e,t){return F.resolve(Xv.min())}getMinOffsetFromCollectionGroup(e,t){return F.resolve(Xv.min())}updateCollectionGroup(e,t,n){return F.resolve()}updateIndexEntries(e,t){return F.resolve()}}class EI{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new V(M.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new V(M.comparator)).toArray()}}const kI=new Uint8Array(0);class SI{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new EI,this.Xe=new Tw(e=>T_(e),(e,t)=>E_(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(this.Ye.has(t))return F.resolve();var n=t.lastSegment(),r=t.popLast();return e.addOnCommittedListener(()=>{this.Ye.add(t)}),r={collectionId:n,parent:db(r)},CI(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[Vv(n),""],!1,!0);return CI(e).W(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(fb(t.parent))}return r})}addFieldIndex(e,t){const n=NI(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])},i=(delete r.indexId,n.add(r));if(t.indexState){const n=RI(e);return i.next(e=>{n.put(tI(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const n=NI(e),r=RI(e),i=AI(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,l){const u=AI(e);let h=!0;const n=new Map;return F.forEach(this.Ze(l),t=>this.tn(e,t).next(e=>{h=h&&!!e,n.set(t,e)})).next(()=>{if(h){let c=B();const h=[];return F.forEach(n,(e,t)=>{p("IndexedDbIndexManager",`Using index ${o=e,`id=${o.indexId}|cg=${o.collectionGroup}|f=`+o.fields.map(e=>e.fieldPath+":"+e.kind).join(",")} to execute `+T_(l));var n=function(e,t){var n=Gv(t);if(void 0===n)return null;for(const t of S_(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(t,e),r=function(e,t){const n=new Map;for(const r of Hv(t))for(const t of S_(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(t,e),i=function(e,t){const n=[];let r=!0;for(const i of Hv(t)){const t=(0===i.kind?C_:A_)(e,i.fieldPath,e.startAt);n.push(t.value),r=r&&t.inclusive}return new $y(n,r)}(t,e),s=function(e,t){const n=[];let r=!0;for(const i of Hv(t)){const t=(0===i.kind?A_:C_)(e,i.fieldPath,e.endAt);n.push(t.value),r=r&&t.inclusive}return new $y(n,r)}(t,e),a=this.en(e,t,i),o=this.en(e,t,s),r=this.nn(e,t,r),r=this.sn(e.indexId,n,a,i.inclusive,o,s.inclusive,r);return F.forEach(r,e=>u.J(e,l.limit).next(e=>{e.forEach(e=>{e=L.fromSegments(e.documentKey);c.has(e)||(c=c.add(e),h.push(e))})}))}).next(()=>h)}return F.resolve(null)})}Ze(t){var e;return this.Xe.get(t)||(e=0===t.filters.length?[t]:function(e){if(0===e.getFilters().length)return[];const t=function t(e){if(R(e instanceof U||e instanceof q),e instanceof U)return e;if(1===e.filters.length)return t(e.filters[0]);var n=e.filters.map(e=>t(e));let r=q.create(n,e.op);return _I(r=II(r))?r:(R(r instanceof q),R(Xy(r)),R(1<r.filters.length),r.filters.reduce((e,t)=>wI(e,t)))}(function t(n){var e;if(R(n instanceof U||n instanceof q),n instanceof U){if(n instanceof l_){const r=(null==(e=null==(e=n.value.arrayValue)?void 0:e.values)?void 0:e.map(e=>U.create(n.field,"==",e)))||[];return q.create(r,"or")}return n}const r=n.filters.map(e=>t(e));return q.create(r,n.op)}(e));return R(_I(t)),vI(t)||yI(t)?[t]:t.getFilters()}(q.create(t.filters,"and")).map(e=>I_(t.path,t.collectionGroup,t.orderBy,e.getFilters(),t.limit,t.startAt,t.endAt)),this.Xe.set(t,e),e)}sn(t,n,r,i,s,a,o){const c=(null!=n?n.length:1)*Math.max(r.length,s.length),l=c/(null!=n?n.length:1),u=[];for(let e=0;e<c;++e){const c=n?this.rn(n[e/l]):kI,h=this.on(t,c,r[e%l],i),d=this.un(t,c,s[e%l],a),p=o.map(e=>this.on(t,c,e,!0));u.push(...this.createRange(h,d,p))}return u}on(e,t,n,r){const i=new pI(e,L.empty(),t,n);return r?i:i.Ue()}un(e,t,n,r){const i=new pI(e,L.empty(),t,n);return r?i.Ue():i}tn(e,t){const r=new mI(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(const n of e)r.je(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let n=2;const r=this.Ze(t);return F.forEach(r,t=>this.tn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new V(Wv.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&1<r.length&&2===n?1:n)}cn(e,t){const n=new dI;for(const i of Hv(e)){const e=t.data.field(i.fieldPath);if(null==e)return null;var r=n.qe(i.kind);oI.Ie.ue(e,r)}return n.Fe()}rn(e){const t=new dI;return oI.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){const n=new dI;return oI.Ie.ue(Uy(this.databaseId,t),n.qe(0===(t=Hv(e)).length?0:t[t.length-1].kind)),n.Fe()}nn(e,t,n){if(null===n)return[];let r=[],i=(r.push(new dI),0);for(const s of Hv(e)){const e=n[i++];for(const n of r)if(this.hn(t,s.fieldPath)&&Vy(e))r=this.ln(r,s,e);else{const t=n.qe(s.kind);oI.Ie.ue(e,t)}}return this.fn(r)}en(e,t,n){return this.nn(e,t,n.position)}fn(t){const n=[];for(let e=0;e<t.length;++e)n[e]=t[e].Fe();return n}ln(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new dI;r.seed(n.Fe()),oI.Ie.ue(e,r.qe(t.kind)),i.push(r)}return i}hn(e,t){return!!e.filters.find(e=>e instanceof U&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const n=NI(e),s=RI(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next(e=>{const i=[];return F.forEach(e,r=>s.get([r.indexId,this.uid]).next(e=>{var t,n;i.push((t=r,e=e?new Qv(e.sequenceNumber,new Xv($b(e.readTime),new L(fb(e.documentKey)),e.largestBatchId)):Qv.empty(),n=t.fields.map(([e,t])=>new $v(Wv.fromServerFormat(e),t)),new zv(t.indexId,t.collectionGroup,n,e)))})).next(()=>i)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!=n?n:P(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,n,r){const i=NI(e),s=RI(e);return this.dn(e).next(t=>i.W("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(e=>F.forEach(e,e=>s.put(tI(e.indexId,this.user,t,r)))))}updateIndexEntries(i,e){const n=new Map;return F.forEach(e,(t,r)=>{var e=n.get(t.collectionGroup);return(e?F.resolve(e):this.getFieldIndexes(i,t.collectionGroup)).next(e=>(n.set(t.collectionGroup,e),F.forEach(e,n=>this._n(i,t,n).next(e=>{var t=this.wn(r,n);return e.isEqual(t)?F.resolve():this.mn(i,r,n,e,t)}))))})}gn(e,t,n,r){return AI(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.an(n,t.key),documentKey:t.key.path.toArray()})}yn(e,t,n,r){return AI(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.an(n,t.key),t.key.path.toArray()])}_n(e,n,r){const t=AI(e);let i=new V(fI);return t.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.an(r,n)])},(e,t)=>{i=i.add(new pI(r.indexId,n,t.arrayValue,t.directionalValue))}).next(()=>i)}wn(e,t){let n=new V(fI);var r=this.cn(t,e);if(null==r)return n;const i=Gv(t);if(null!=i){var s=e.data.field(i.fieldPath);if(Vy(s))for(const i of s.arrayValue.values||[])n=n.add(new pI(t.indexId,e.key,this.rn(i),r))}else n=n.add(new pI(t.indexId,e.key,kI,r));return n}mn(t,i,s,e,a){p("IndexedDbIndexManager","Updating index entries for document '%s'",i.key);const o=[];{var c=fI,l=e=>{o.push(this.gn(t,i,s,e))},u=e=>{o.push(this.yn(t,i,s,e))},h=e.getIterator(),d=a.getIterator();let n=v_(h),r=v_(d);for(;n||r;){let e=!1,t=!1;if(n&&r){const l=c(n,r);l<0?t=!0:0<l&&(e=!0)}else null!=n?t=!0:e=!0;e?(l(r),r=v_(d)):t?(u(n),n=v_(h)):(n=v_(h),r=v_(d))}}return F.waitFor(o)}dn(e){let r=1;return RI(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,t,n)=>{n.done(),r=t.sequenceNumber+1}).next(()=>r)}createRange(e,t,n){n=n.sort((e,t)=>fI(e,t)).filter((e,t,n)=>!t||0!==fI(e,n[t-1]));const r=[];r.push(e);for(const i of n){const n=fI(i,e),s=fI(i,t);if(0===n)r[0]=e.Ue();else if(0<n&&s<0)r.push(i),r.push(i.Ue());else if(0<s)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2){if(this.pn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,kI,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,kI,[]];i.push(IDBKeyRange.bound(t,n))}return i}pn(e,t){return 0<fI(e,t)}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(xI)}getMinOffset(t,e){return F.mapArray(this.Ze(e),e=>this.tn(t,e).next(e=>e||N())).next(xI)}}function CI(e){return qb(e,"collectionParents")}function AI(e){return qb(e,"indexEntries")}function NI(e){return qb(e,"indexConfiguration")}function RI(e){return qb(e,"indexState")}function xI(t){R(0!==t.length);let n=t[0].indexState.offset,r=n.largestBatchId;for(let e=1;e<t.length;e++){var i=t[e].indexState.offset;Zv(i,n)<0&&(n=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new Xv(n.readTime,n.documentKey,r)}const DI={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class PI{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new PI(e,PI.DEFAULT_COLLECTION_PERCENTILE,PI.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function OI(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId);let o=0;const c=r.Z({range:a},(e,t,n)=>(o++,n.delete())),l=(s.push(c.next(()=>{R(1===o)})),[]);for(const e of n.mutations){const r=vb(t,e.key.path,n.batchId);s.push(i.delete(r)),l.push(e.key)}return F.waitFor(s).next(()=>l)}function MI(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw N();t=e.noDocument}return JSON.stringify(t).length}PI.DEFAULT_COLLECTION_PERCENTILE=10,PI.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,PI.DEFAULT=new PI(41943040,PI.DEFAULT_COLLECTION_PERCENTILE,PI.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),PI.DISABLED=new PI(-1,0,0);class LI{constructor(e,t,n,r){this.userId=e,this.yt=t,this.indexManager=n,this.referenceDelegate=r,this.In={}}static re(e,t,n,r){R(""!==e.uid);e=e.isAuthenticated()?e.uid:"";return new LI(e,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return UI(e).Z({index:"userMutationsIndex",range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(u,h,d,p){const f=qI(u),g=UI(u);return g.add({}).next(e=>{R("number"==typeof e);const t=new Vb(e,h,d,p),n=(i=this.yt,s=this.userId,o=(a=t).baseMutations.map(e=>ib(i.ie,e)),c=a.mutations.map(e=>ib(i.ie,e)),{userId:s,batchId:a.batchId,localWriteTimeMs:a.localWriteTime.toMillis(),baseMutations:o,mutations:c}),r=[];var i,s,a,o,c;let l=new V((e,t)=>P(e.canonicalString(),t.canonicalString()));for(const u of p){const h=vb(this.userId,u.key.path,e);l=l.add(u.key.path.popLast()),r.push(g.put(n)),r.push(f.put(h,yb))}return l.forEach(e=>{r.push(this.indexManager.addToCollectionParentIndex(u,e))}),u.addOnCommittedListener(()=>{this.In[e]=t.keys()}),F.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return UI(e).get(t).next(e=>e?(R(e.userId===this.userId),Qb(this.yt,e)):null)}Tn(e,t){return this.In[t]?F.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(e=>{return e?(e=e.keys(),this.In[t]=e):null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return UI(e).Z({index:"userMutationsIndex",range:n},(e,t,n)=>{t.userId===this.userId&&(R(t.batchId>=r),i=Qb(this.yt,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return UI(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return UI(e).W("userMutationsIndex",t).next(e=>e.map(e=>Qb(this.yt,e)))}getAllMutationBatchesAffectingDocumentKey(s,a){const e=mb(this.userId,a.path),t=IDBKeyRange.lowerBound(e),o=[];return qI(s).Z({range:t},(e,t,n)=>{var[e,r,i]=e,r=fb(r);if(e===this.userId&&a.path.isEqual(r))return UI(s).get(i).next(e=>{if(!e)throw N();R(e.userId===this.userId),o.push(Qb(this.yt,e))});n.done()}).next(()=>o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let a=new V(P);const n=[];return e.forEach(s=>{var e=mb(this.userId,s.path),e=IDBKeyRange.lowerBound(e),e=qI(t).Z({range:e},(e,t,n)=>{var[e,r,i]=e,r=fb(r);e===this.userId&&s.path.isEqual(r)?a=a.add(i):n.done()});n.push(e)}),F.waitFor(n).next(()=>this.En(t,a))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,a=s.length+1,n=mb(this.userId,s),r=IDBKeyRange.lowerBound(n);let o=new V(P);return qI(e).Z({range:r},(e,t,n)=>{var[e,r,i]=e,r=fb(r);e===this.userId&&s.isPrefixOf(r)?r.length===a&&(o=o.add(i)):n.done()}).next(()=>this.En(e,o))}En(t,e){const n=[],r=[];return e.forEach(e=>{r.push(UI(t).get(e).next(e=>{if(null===e)throw N();R(e.userId===this.userId),n.push(Qb(this.yt,e))}))}),F.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return OI(t.se,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.An(n.batchId)}),F.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}An(e){delete this.In[e]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return F.resolve();e=IDBKeyRange.lowerBound([this.userId]);const r=[];return qI(t).Z({range:e},(e,t,n)=>{if(e[0]===this.userId){const t=fb(e[1]);r.push(t)}else n.done()}).next(()=>{R(0===r.length)})})}containsKey(e,t){return FI(e,this.userId,t)}Rn(e){return VI(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function FI(e,i,t){const n=mb(i,t.path),s=n[1],r=IDBKeyRange.lowerBound(n);let a=!1;return qI(e).Z({range:r,X:!0},(e,t,n)=>{var[e,r]=e;e===i&&r===s&&(a=!0),n.done()}).next(()=>a)}function UI(e){return qb(e,"mutations")}function qI(e){return qb(e,"documentMutations")}function VI(e){return qb(e,"mutationQueues")}class BI{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new BI(0)}static vn(){return new BI(-1)}}class jI{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(n){return this.Vn(n).next(e=>{const t=new BI(e.highestTargetId);return e.highestTargetId=t.next(),this.Sn(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(e=>O.fromTimestamp(new Bv(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.Vn(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.Sn(t,e)))}addTargetData(t,n){return this.Dn(t,n).next(()=>this.Vn(t).next(e=>(e.targetCount+=1,this.Cn(n,e),this.Sn(t,e))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>KI(t).delete(e.targetId)).next(()=>this.Vn(t)).next(e=>(R(0<e.targetCount),--e.targetCount,this.Sn(t,e)))}removeTargets(n,r,i){let s=0;const a=[];return KI(n).Z((e,t)=>{t=Yb(t);t.sequenceNumber<=r&&null===i.get(t.targetId)&&(s++,a.push(this.removeTargetData(n,t)))}).next(()=>F.waitFor(a)).next(()=>s)}forEachTarget(e,n){return KI(e).Z((e,t)=>{t=Yb(t);n(t)})}Vn(e){return WI(e).get("targetGlobalKey").next(e=>(R(null!==e),e))}Sn(e,t){return WI(e).put("targetGlobalKey",t)}Dn(e,t){return KI(e).put(Jb(this.yt,t))}Cn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Vn(e).next(e=>e.targetCount)}getTargetData(e,r){var t=T_(r),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let i=null;return KI(e).Z({range:t,index:"queryTargetsIndex"},(e,t,n)=>{t=Yb(t);E_(r,t.target)&&(i=t,n.done())}).next(()=>i)}addMatchingKeys(n,e,r){const i=[],s=zI(n);return e.forEach(e=>{var t=db(e.path);i.push(s.put({targetId:r,path:t})),i.push(this.referenceDelegate.addReference(n,r,e))}),F.waitFor(i)}removeMatchingKeys(n,e,r){const i=zI(n);return F.forEach(e,e=>{var t=db(e.path);return F.waitFor([i.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=zI(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=zI(e);let i=B();return r.Z({range:n,X:!0},(e,t,n)=>{e=fb(e[1]),e=new L(e);i=i.add(e)}).next(()=>i)}containsKey(e,t){t=db(t.path),t=IDBKeyRange.bound([t],[Vv(t)],!1,!0);let r=0;return zI(e).Z({index:"documentTargetsIndex",X:!0,range:t},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}ne(e,t){return KI(e).get(t).next(e=>e?Yb(e):null)}}function KI(e){return qb(e,"targets")}function WI(e){return qb(e,"targetGlobal")}function zI(e){return qb(e,"targetDocuments")}function GI([e,t],[n,r]){e=P(e,n);return 0===e?P(t,r):e}class HI{constructor(e){this.xn=e,this.buffer=new V(GI),this.Nn=0}kn(){return++this.Nn}On(e){var t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();GI(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class $I{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){p("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Mn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){oy(e)?p("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await ny(e)}await this.Fn(3e5)})}}class QI{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return F.resolve(fy.at);const n=new HI(t);return this.$n.forEachTarget(e,e=>n.On(e.sequenceNumber)).next(()=>this.$n.Ln(e,e=>n.On(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.$n.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(p("LruGarbageCollector","Garbage collection skipped; disabled"),F.resolve(DI)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(p("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold `+this.params.cacheSizeCollectionThreshold),DI):this.qn(t,n))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(t,n){let r,i,s,a,o,c,l;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(i=e>this.params.maximumSequenceNumbersToCollect?(p("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from `+e),this.params.maximumSequenceNumbersToCollect):e,a=Date.now(),this.nthSequenceNumber(t,i))).next(e=>(r=e,o=Date.now(),this.removeTargets(t,r,n))).next(e=>(s=e,c=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(l=Date.now(),kv()<=h.DEBUG&&p("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-u}ms
	Determined least recently used ${i} in `+(o-a)+"ms\n"+`	Removed ${s} targets in `+(c-o)+"ms\n"+`	Removed ${e} documents in `+(l-c)+"ms\n"+`Total Duration: ${l-u}ms`),F.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}class YI{constructor(e,t){this.db=e,this.garbageCollector=(e=this,new QI(e,t))}Bn(e){const n=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}Un(e){let t=0;return this.Ln(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,n){return this.Kn(e,(e,t)=>n(t))}addReference(e,t,n){return JI(e,n)}removeReference(e,t,n){return JI(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return JI(e,t)}Gn(t,n){let r=!1;return VI(t).tt(e=>FI(t,e,n).next(e=>(e&&(r=!0),F.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let a=0;return this.Kn(n,(t,e)=>{if(e<=r){const r=this.Gn(n,t).next(e=>{if(!e)return a++,i.getEntry(n,t).next(()=>(i.removeEntry(t,O.min()),zI(n).delete([0,db(t.path)])))});s.push(r)}}).next(()=>F.waitFor(s)).next(()=>i.apply(n)).next(()=>a)}removeTarget(e,t){t=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,t)}updateLimboDocument(e,t){return JI(e,t)}Kn(e,r){const t=zI(e);let i,s=fy.at;return t.Z({index:"documentTargetsIndex"},([e],{path:t,sequenceNumber:n})=>{0===e?(s!==fy.at&&r(new L(fb(i)),s),s=n,i=t):s=fy.at}).next(()=>{s!==fy.at&&r(new L(fb(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function JI(e,t){return zI(e).put((e=e.currentSequenceNumber,{targetId:0,path:db(t.path),sequenceNumber:e}))}class XI{constructor(){this.changes=new Tw(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,w_.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?F.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ZI{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return rT(e).put(n)}removeEntry(e,n,t){return rT(e).delete(function(e){const t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],Gb(e),t[t.length-1]]}(t))}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.Qn(t,e)))}getEntry(e,n){let r=w_.newInvalidDocument(n);return rT(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(iT(n))},(e,t)=>{r=this.jn(n,t)}).next(()=>r)}Wn(e,n){let r={size:0,document:w_.newInvalidDocument(n)};return rT(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(iT(n))},(e,t)=>{r={document:this.jn(n,t),size:MI(t)}}).next(()=>r)}getEntries(e,t){let n=Ew;return this.zn(e,t,(e,t)=>{t=this.jn(e,t);n=n.insert(e,t)}).next(()=>n)}Hn(e,t){let r=Ew,i=new p_(L.comparator);return this.zn(e,t,(e,t)=>{var n=this.jn(e,t);r=r.insert(e,n),i=i.insert(e,MI(t))}).next(()=>({documents:r,Jn:i}))}zn(e,t,i){if(t.isEmpty())return F.resolve();let n=new V(aT);t.forEach(e=>n=n.add(e));const r=IDBKeyRange.bound(iT(n.first()),iT(n.last())),s=n.getIterator();let a=s.getNext();return rT(e).Z({index:"documentKeyIndex",range:r},(e,t,n)=>{for(var r=L.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);a&&aT(a,r)<0;)i(a,null),a=s.getNext();a&&a.isEqual(r)&&(i(a,t),a=s.hasNext()?s.getNext():null),a?n.j(iT(a)):n.done()}).next(()=>{for(;a;)i(a,null),a=s.hasNext()?s.getNext():null})}getAllFromCollection(e,t,n){n=[t.popLast().toArray(),t.lastSegment(),Gb(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],t=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return rT(e).W(IDBKeyRange.bound(n,t,!0)).next(e=>{let t=Ew;for(const n of e){const e=this.jn(L.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);t=t.insert(e.key,e)}return t})}getAllFromCollectionGroup(e,t,n,r){let i=Ew;n=sT(t,n),t=sT(t,Xv.max());return rT(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(n,t,!0)},(e,t,n)=>{t=this.jn(L.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(t.key,t)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new tT(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return nT(e).get("remoteDocumentGlobalKey").next(e=>(R(!!e),e))}Qn(e,t){return nT(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const e=function(e,t){let n;if(t.document)n=rb(e.ie,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=L.fromSegments(t.noDocument.path),r=$b(t.noDocument.readTime);n=w_.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return N();{const e=L.fromSegments(t.unknownDocument.path),i=$b(t.unknownDocument.version);n=w_.newUnknownDocument(e,i)}}return t.readTime&&n.setReadTime((t=t.readTime,e=new Bv(t[0],t[1]),O.fromTimestamp(e))),n}(this.yt,t);if(!e.isNoDocument()||!e.version.isEqual(O.min()))return e}return w_.newInvalidDocument(e)}}function eT(e){return new ZI(e)}class tT extends XI{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new Tw(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(s){const a=[];let o=0,c=new V((e,t)=>P(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.Xn.get(e);if(a.push(this.Yn.removeEntry(s,e,n.readTime)),t.isValidDocument()){var r=zb(this.Yn.yt,t),i=(c=c.add(e.path.popLast()),MI(r));o+=i-n.size,a.push(this.Yn.addEntry(s,e,r))}else if(o-=n.size,this.trackRemovals){const o=zb(this.Yn.yt,t.convertToNoDocument(O.min()));a.push(this.Yn.addEntry(s,e,o))}}),c.forEach(e=>{a.push(this.Yn.indexManager.addToCollectionParentIndex(s,e))}),a.push(this.Yn.updateMetadata(s,o)),F.waitFor(a)}getFromCache(e,t){return this.Yn.Wn(e,t).next(e=>(this.Xn.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:n,Jn:e})=>(e.forEach((e,t)=>{this.Xn.set(e,{size:t,readTime:n.get(e).readTime})}),n))}}function nT(e){return qb(e,"remoteDocumentGlobal")}function rT(e){return qb(e,"remoteDocumentsV14")}function iT(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function sT(e,t){const n=t.documentKey.path.toArray();return[e,Gb(t.readTime),n.slice(0,n.length-2),0<n.length?n[n.length-1]:""]}function aT(e,t){var n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=P(n[e],r[e]))return i;return(i=P(n.length,r.length))||((i=P(n[n.length-2],r[r.length-2]))||P(n[n.length-1],r[r.length-1]))}class oT{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class cT{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,n){let r=null;return this.documentOverlayCache.getOverlay(t,n).next(e=>(r=e,this.remoteDocumentCache.getEntry(t,n))).next(e=>(null!==r&&hw(r.mutation,e,y_.empty(),Bv.now()),e))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,B()).next(()=>e))}getLocalViewOfDocuments(e,t,n=B()){const r=Aw();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let n=Sw();return e.forEach((e,t)=>{n=n.insert(e,t.overlayedDocument)}),n}))}getOverlayedDocuments(e,t){const n=Aw();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,B()))}populateOverlays(e,n,t){const r=[];return t.forEach(e=>{n.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,t)=>{n.set(e,t)})})}computeViews(e,t,r,i){let s=Ew;const a=Aw(),n=Aw();return t.forEach((e,t)=>{const n=r.get(t.key);i.has(t.key)&&(void 0===n||n.mutation instanceof fw)?s=s.insert(t.key,t):void 0!==n&&(a.set(t.key,n.mutation.getFieldMask()),hw(n.mutation,t,n.mutation.getFieldMask(),Bv.now()))}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>a.set(e,t)),t.forEach((e,t)=>{return n.set(e,new oT(t,null!=(t=a.get(e))?t:null))}),n))}recalculateAndSaveOverlays(s,a){const o=Aw();let c=new p_((e,t)=>e-t),l=B();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(s,a).next(e=>{for(const r of e)r.keys().forEach(e=>{var t,n=a.get(e);null!==n&&(t=o.get(e)||y_.empty(),t=r.applyToLocalView(n,t),o.set(e,t),t=(c.get(r.batchId)||B()).add(e),c=c.insert(r.batchId,t))})}).next(()=>{const e=[],t=c.getReverseIterator();for(;t.hasNext();){const c=t.getNext(),n=c.key,r=c.value,i=Aw();r.forEach(e=>{var t;l.has(e)||(null!==(t=uw(a.get(e),o.get(e)))&&i.set(e,t),l=l.add(e))}),e.push(this.documentOverlayCache.saveOverlays(s,n,i))}return F.waitFor(e)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(e,t,n){return r=t,L.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):M_(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n);var r}getNextDocuments(s,t,a,o){return this.remoteDocumentCache.getAllFromCollectionGroup(s,t,a,o).next(n=>{const e=0<o-n.size?this.documentOverlayCache.getOverlaysForCollectionGroup(s,t,a.largestBatchId,o-n.size):F.resolve(Aw());let r=-1,i=n;return e.next(e=>F.forEach(e,(t,e)=>(r<e.largestBatchId&&(r=e.largestBatchId),n.get(t)?F.resolve():this.remoteDocumentCache.getEntry(s,t).next(e=>{i=i.insert(t,e)}))).next(()=>this.populateOverlays(s,e,n)).next(()=>this.computeViews(s,i,e,B())).next(e=>({batchId:r,changes:Cw(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(e=>{let t=Sw();return t=e.isFoundDocument()?t.insert(e.key,e):t})}getDocumentsMatchingCollectionGroupQuery(n,r,i){const s=r.collectionGroup;let a=Sw();return this.indexManager.getCollectionParents(n,s).next(e=>F.forEach(e,e=>{t=r,e=e.child(s);var t,e=new N_(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(n,e,i).next(e=>{e.forEach((e,t)=>{a=a.insert(e,t)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,s,n){let a;return this.remoteDocumentCache.getAllFromCollection(t,s.path,n).next(e=>(a=e,this.documentOverlayCache.getOverlaysForCollection(t,s.path,n.largestBatchId))).next(r=>{r.forEach((e,t)=>{t=t.getKey();null===a.get(t)&&(a=a.insert(t,w_.newInvalidDocument(t)))});let i=Sw();return a.forEach((e,t)=>{var n=r.get(e);void 0!==n&&hw(n.mutation,t,y_.empty(),Bv.now()),K_(s,t)&&(i=i.insert(e,t))}),i})}}class lT{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return F.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){return this.Zn.set(t.id,{id:t.id,version:t.version,createTime:Hw(t.createTime)}),F.resolve()}getNamedQuery(e,t){return F.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:t.name,query:Xb(t.bundledQuery),readTime:Hw(t.readTime)}),F.resolve()}}class uT{constructor(){this.overlays=new p_(L.comparator),this.es=new Map}getOverlay(e,t){return F.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Aw();return F.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(n,r,e){return e.forEach((e,t)=>{this.oe(n,r,t)}),F.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.es.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.es.delete(n)),F.resolve()}getOverlaysForCollection(e,t,n){const r=Aw(),i=t.length+1,s=new L(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){const e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return F.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new p_((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=Aw(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const a=Aw(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return F.resolve(a)}oe(e,t,n){var r=this.overlays.get(n.key);if(null!==r){const e=this.es.get(r.largestBatchId).delete(n.key);this.es.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new jb(t,n));let i=this.es.get(t);void 0===i&&(i=B(),this.es.set(t,i)),this.es.set(t,i.add(n.key))}}class hT{constructor(){this.ns=new V(dT.ss),this.rs=new V(dT.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){e=new dT(e,t);this.ns=this.ns.add(e),this.rs=this.rs.add(e)}us(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.cs(new dT(e,t))}hs(e,t){e.forEach(e=>this.removeReference(e,t))}ls(e){const t=new L(new M([])),n=new dT(t,e),r=new dT(t,e+1),i=[];return this.rs.forEachInRange([n,r],e=>{this.cs(e),i.push(e.key)}),i}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){var t=new L(new M([])),n=new dT(t,e),t=new dT(t,e+1);let r=B();return this.rs.forEachInRange([n,t],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new dT(e,0);return null!==(t=this.ns.firstAfterOrEqual(t))&&e.isEqual(t.key)}}class dT{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return L.comparator(e.key,t.key)||P(e._s,t._s)}static os(e,t){return P(e._s,t._s)||L.comparator(e.key,t.key)}}class pT{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new V(dT.ss)}checkEmpty(e){return F.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){var i=this.ws,t=(this.ws++,0<this.mutationQueue.length&&this.mutationQueue[this.mutationQueue.length-1],new Vb(i,t,n,r));this.mutationQueue.push(t);for(const t of r)this.gs=this.gs.add(new dT(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return F.resolve(t)}lookupMutationBatch(e,t){return F.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){t=(t=this.ps(t+1))<0?0:t;return F.resolve(this.mutationQueue.length>t?this.mutationQueue[t]:null)}getHighestUnacknowledgedBatchId(){return F.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return F.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new dT(t,0),r=new dT(t,Number.POSITIVE_INFINITY),i=[];return this.gs.forEachInRange([n,r],e=>{e=this.ys(e._s);i.push(e)}),F.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new V(P);return t.forEach(e=>{var t=new dT(e,0),e=new dT(e,Number.POSITIVE_INFINITY);this.gs.forEachInRange([t,e],e=>{n=n.add(e._s)})}),F.resolve(this.Is(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;L.isDocumentKey(i)||(i=i.child(""));t=new dT(new L(i),0);let s=new V(P);return this.gs.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(s=s.add(e._s)),!0)},t),F.resolve(this.Is(s))}Is(e){const t=[];return e.forEach(e=>{e=this.ys(e);null!==e&&t.push(e)}),t}removeMutationBatch(n,r){R(0===this.Ts(r.batchId,"removed")),this.mutationQueue.shift();let i=this.gs;return F.forEach(r.mutations,e=>{var t=new dT(e.key,r.batchId);return i=i.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.gs=i})}An(e){}containsKey(e,t){var n=new dT(t,0),n=this.gs.firstAfterOrEqual(n);return F.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,F.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){e=this.ps(e);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class fT{constructor(e){this.Es=e,this.docs=new p_(L.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Es(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return F.resolve(n?n.document.mutableCopy():w_.newInvalidDocument(t))}getEntries(e,t){let n=Ew;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():w_.newInvalidDocument(e))}),F.resolve(n)}getAllFromCollection(e,t,n){let r=Ew;const i=new L(t.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i}}=s.getNext();if(!t.isPrefixOf(e.path))break;e.path.length>t.length+1||Zv(Jv(i),n)<=0||(r=r.insert(i.key,i.mutableCopy()))}return F.resolve(r)}getAllFromCollectionGroup(e,t,n,r){N()}As(e,t){return F.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new gT(this)}getSize(e){return F.resolve(this.size)}}class gT extends XI{constructor(e){super(),this.Yn=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?r.push(this.Yn.addEntry(n,t)):this.Yn.removeEntry(e)}),F.waitFor(r)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class mT{constructor(e){this.persistence=e,this.Rs=new Tw(e=>T_(e),E_),this.lastRemoteSnapshotVersion=O.min(),this.highestTargetId=0,this.bs=0,this.Ps=new hT,this.targetCount=0,this.vs=BI.Pn()}forEachTarget(e,n){return this.Rs.forEach((e,t)=>n(t)),F.resolve()}getLastRemoteSnapshotVersion(e){return F.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return F.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),F.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.bs&&(this.bs=t),F.resolve()}Dn(e){this.Rs.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.vs=new BI(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,F.resolve()}updateTargetData(e,t){return this.Dn(t),F.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),--this.targetCount,F.resolve()}removeTargets(n,r,i){let s=0;const a=[];return this.Rs.forEach((e,t)=>{t.sequenceNumber<=r&&null===i.get(t.targetId)&&(this.Rs.delete(e),a.push(this.removeMatchingKeysForTargetId(n,t.targetId)),s++)}),F.waitFor(a).next(()=>s)}getTargetCount(e){return F.resolve(this.targetCount)}getTargetData(e,t){t=this.Rs.get(t)||null;return F.resolve(t)}addMatchingKeys(e,t,n){return this.Ps.us(t,n),F.resolve()}removeMatchingKeys(t,e,n){this.Ps.hs(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(e=>{i.push(r.markPotentiallyOrphaned(t,e))}),F.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),F.resolve()}getMatchingKeysForTargetId(e,t){t=this.Ps.ds(t);return F.resolve(t)}containsKey(e,t){return F.resolve(this.Ps.containsKey(t))}}class vT{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new fy(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new mT(this),this.indexManager=new TI,this.remoteDocumentCache=(e=e=>this.referenceDelegate.xs(e),new fT(e)),this.yt=new Wb(t),this.Ns=new lT(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new uT,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Vs[e.toKey()];return n||(n=new pT(t,this.referenceDelegate),this.Vs[e.toKey()]=n),n}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,n){p("MemoryPersistence","Starting transaction:",e);const r=new yT(this.Ss.next());return this.referenceDelegate.ks(),n(r).next(e=>this.referenceDelegate.Os(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ms(t,n){return F.or(Object.values(this.Vs).map(e=>()=>e.containsKey(t,n)))}}class yT extends ty{constructor(e){super(),this.currentSequenceNumber=e}}class _T{constructor(e){this.persistence=e,this.Fs=new hT,this.$s=null}static Bs(e){return new _T(e)}get Ls(){if(this.$s)return this.$s;throw N()}addReference(e,t,n){return this.Fs.addReference(n,t),this.Ls.delete(n.toString()),F.resolve()}removeReference(e,t,n){return this.Fs.removeReference(n,t),this.Ls.add(n.toString()),F.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),F.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(e=>this.Ls.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Ls.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}ks(){this.$s=new Set}Os(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return F.forEach(this.Ls,e=>{const t=L.fromPath(e);return this.qs(n,t).next(e=>{e||r.removeEntry(t,O.min())})}).next(()=>(this.$s=null,r.apply(n)))}updateLimboDocument(e,t){return this.qs(e,t).next(e=>{e?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}qs(e,t){return F.or([()=>F.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class wT{constructor(e){this.yt=e}$(t,e,n,r){const s=new ry("createOrUpgrade",e);var i;n<1&&1<=r&&(t.createObjectStore("owner"),(i=t).createObjectStore("mutationQueues",{keyPath:"userId"}),i.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",gb,{unique:!0}),i.createObjectStore("documentMutations"),bT(t),t.createObjectStore("remoteDocuments"));let a=F.resolve();return n<3&&3<=r&&(0!==n&&((i=t).deleteObjectStore("targetDocuments"),i.deleteObjectStore("targets"),i.deleteObjectStore("targetGlobal"),bT(t)),a=a.next(()=>{{const e=s.store("targetGlobal"),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:O.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",t)}})),n<4&&4<=r&&(a=(a=0!==n?a.next(()=>{var r=t,i=s;return i.store("mutations").W().next(e=>{r.deleteObjectStore("mutations"),r.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",gb,{unique:!0});const t=i.store("mutations"),n=e.map(e=>t.put(e));return F.waitFor(n)})}):a).next(()=>{t.createObjectStore("clientMetadata",{keyPath:"clientId"})})),n<5&&5<=r&&(a=a.next(()=>this.Us(s))),n<6&&6<=r&&(a=a.next(()=>(t.createObjectStore("remoteDocumentGlobal"),this.Ks(s)))),n<7&&7<=r&&(a=a.next(()=>this.Gs(s))),n<8&&8<=r&&(a=a.next(()=>this.Qs(t,s))),n<9&&9<=r&&(a=a.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&10<=r&&(a=a.next(()=>this.js(s))),n<11&&11<=r&&(a=a.next(()=>{t.createObjectStore("bundles",{keyPath:"bundleId"}),t.createObjectStore("namedQueries",{keyPath:"name"})})),n<12&&12<=r&&(a=a.next(()=>{{const e=t.createObjectStore("documentOverlays",{keyPath:Rb});return e.createIndex("collectionPathOverlayIndex",xb,{unique:!1}),void e.createIndex("collectionGroupOverlayIndex",Db,{unique:!1})}})),n<13&&13<=r&&(a=a.next(()=>{{const e=t.createObjectStore("remoteDocumentsV14",{keyPath:_b});return e.createIndex("documentKeyIndex",wb),void e.createIndex("collectionGroupIndex",bb)}}).next(()=>this.Ws(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&14<=r&&(a=a.next(()=>this.zs(t,s))),a=n<15&&15<=r?a.next(()=>{var e=t;e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Sb}).createIndex("sequenceNumberIndex",Cb,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Ab}).createIndex("documentKeyIndex",Nb,{unique:!1})}):a}Ks(t){let n=0;return t.store("remoteDocuments").Z((e,t)=>{n+=MI(t)}).next(()=>{var e={byteSize:n};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",e)})}Us(n){const e=n.store("mutationQueues"),r=n.store("mutations");return e.W().next(e=>F.forEach(e,t=>{var e=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",e).next(e=>F.forEach(e,e=>{R(e.userId===t.userId);e=Qb(this.yt,e);return OI(n,t.userId,e).next(()=>{})}))}))}Gs(e){const a=e.store("targetDocuments"),t=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return t.Z((e,t)=>{const n=new M(e),r=[0,db(n)];s.push(a.get(r).next(e=>e?F.resolve():(e=>a.put({targetId:0,path:db(e),sequenceNumber:i.highestListenSequenceNumber}))(n)))}).next(()=>F.waitFor(s))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:kb});const n=t.store("collectionParents"),r=new EI,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:db(r)})}};return t.store("remoteDocuments").Z({X:!0},(e,t)=>{const n=new M(e);return i(n.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([,e],t)=>{const n=fb(e);return i(n.popLast())}))}js(e){const n=e.store("targets");return n.Z((e,t)=>{t=Yb(t),t=Jb(this.yt,t);return n.put(t)})}Ws(e,s){const t=s.store("remoteDocuments"),a=[];return t.Z((e,t)=>{const n=s.store("remoteDocumentsV14"),r=((i=t).document?new L(M.fromString(i.document.name).popFirst(5)):i.noDocument?L.fromSegments(i.noDocument.path):i.unknownDocument?L.fromSegments(i.unknownDocument.path):N()).path.toArray();var i={prefixPath:r.slice(0,r.length-2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:t.readTime||[0,0],unknownDocument:t.unknownDocument,noDocument:t.noDocument,document:t.document,hasCommittedMutations:!!t.hasCommittedMutations};a.push(n.put(i))}).next(()=>F.waitFor(a))}zs(e,i){const t=i.store("mutations"),s=eT(this.yt),a=new vT(_T.Bs,this.yt.ie);return t.W().next(e=>{const r=new Map;return e.forEach(e=>{var t;let n=null!=(t=r.get(e.userId))?t:B();Qb(this.yt,e).keys().forEach(e=>n=n.add(e)),r.set(e.userId,n)}),F.forEach(r,(e,t)=>{var t=new Iv(t),n=sI.re(this.yt,t),r=a.getIndexManager(t),t=LI.re(t,this.yt,r,a.referenceDelegate);return new cT(s,t,n,r).recalculateAndSaveOverlaysForDocumentKeys(new Ub(i,fy.at),e).next()})})}}function bT(e){e.createObjectStore("targetDocuments",{keyPath:Tb}).createIndex("documentTargetsIndex",Eb,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Ib,{unique:!0}),e.createObjectStore("targetGlobal")}const IT="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class TT{constructor(e,t,n,r,i,s,a,o,c,l,u=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Hs=i,this.window=s,this.document=a,this.Js=c,this.Ys=l,this.Xs=u,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=e=>Promise.resolve(),!TT.C())throw new D(x.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new YI(this,r),this.ii=t+"main",this.yt=new Wb(o),this.ri=new iy(this.ii,this.Xs,new wT(this.yt)),this.Cs=new jI(this.referenceDelegate,this.yt),this.remoteDocumentCache=eT(this.yt),this.Ns=new nI,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===l&&Sv("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(this.isPrimary||this.allowTabSynchronization)return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e));throw new D(x.FAILED_PRECONDITION,IT)}).then(e=>{this.Ss=new fy(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(t){return this.si=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ri.L(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget(async()=>{this.started&&await this.ui()}))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>kT(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(t).next(e=>{e||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(t)).next(e=>this.isPrimary&&!e?this._i(t).next(()=>!1):!!e&&this.wi(t).next(()=>!0))).catch(e=>{if(oy(e))return p("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(this.allowTabSynchronization)return p("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1;throw e}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return ET(e).get("owner").next(e=>F.resolve(this.mi(e)))}gi(e){return kT(e).delete(this.clientId)}async yi(){if(this.isPrimary&&!this.pi(this.ni,18e5)){this.ni=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=qb(e,"clientMetadata");return r.W().next(e=>{const t=this.Ii(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return F.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.oi)for(const t of e)this.oi.removeItem(this.Ti(t.clientId))}}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(t){return this.Ys?F.resolve(!0):ET(t).get("owner").next(e=>{if(null!==e&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)){if(this.mi(e)&&this.networkEnabled)return!0;if(!this.mi(e)){if(e.allowTabSynchronization)return!1;throw new D(x.FAILED_PRECONDITION,IT)}}return!(!this.networkEnabled||!this.inForeground)||kT(t).W().next(e=>void 0===this.Ii(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,e=this.networkEnabled===e.networkEnabled;if(t||n&&e)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&p("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),await this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Ub(e,fy.at);return this._i(t).next(()=>this.gi(t))}),this.ri.close(),this.Pi()}Ii(e,t){return e.filter(e=>this.pi(e.updateTimeMs,t)&&!this.Ei(e.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>kT(e).W().next(e=>this.Ii(e,18e5).map(e=>e.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return LI.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new SI(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return sI.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(t,n,r){p("IndexedDbPersistence","Starting transaction:",t);var e="readonly"===n?"readonly":"readwrite",i=15===(i=this.Xs)?Fb:14===i?Lb:13===i?Mb:12===i?Ob:11===i?Pb:void N();let s;return this.ri.runTransaction(t,e,i,e=>(s=new Ub(e,this.Ss?this.Ss.next():fy.at),"readwrite-primary"===n?this.fi(s).next(e=>!!e||this.di(s)).next(e=>{if(e)return r(s);throw Sv(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new D(x.FAILED_PRECONDITION,ey)}).next(e=>this.wi(s).next(()=>e)):this.Vi(s).next(()=>r(s)))).then(e=>(s.raiseOnCommittedEvent(),e))}Vi(e){return ET(e).get("owner").next(e=>{if(null!==e&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)&&!this.mi(e)&&!(this.Ys||this.allowTabSynchronization&&e.allowTabSynchronization))throw new D(x.FAILED_PRECONDITION,IT)})}wi(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ET(e).put("owner",t)}static C(){return iy.C()}_i(e){const t=ET(e);return t.get("owner").next(e=>this.mi(e)?(p("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):F.resolve())}pi(e,t){var n=Date.now();return!(e<n-t||n<e&&(Sv(`Detected an update time that is in the future: ${e} > `+n),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null==(e=this.window)?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),!G()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{var n=null!==(null==(t=this.oi)?void 0:t.getItem(this.Ti(e)));return p("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return Sv("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){Sv("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_`+e}}function ET(e){return qb(e,"owner")}function kT(e){return qb(e,"clientMetadata")}function ST(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class CT{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Si=n,this.Di=r}static Ci(e,t){let n=B(),r=B();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new CT(e,t.fromCache,n,r)}}class AT{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(t,n,r,i){return this.ki(t,n).next(e=>e||this.Oi(t,n,i,r)).next(e=>e||this.Mi(t,n))}ki(i,s){if(D_(s))return F.resolve(null);let t=F_(s);return this.indexManager.getIndexType(i,t).next(e=>0===e?null:(null!==s.limit&&1===e&&(s=q_(s,null,"F"),t=F_(s)),this.indexManager.getDocumentsMatchingTarget(i,t).next(e=>{const r=B(...e);return this.Ni.getDocuments(i,r).next(n=>this.indexManager.getMinOffset(i,t).next(e=>{var t=this.Fi(s,n);return this.$i(s,t,r,e.readTime)?this.ki(i,q_(s,null,"F")):this.Bi(i,t,s,e)}))})))}Oi(t,n,r,i){return D_(n)||i.isEqual(O.min())?this.Mi(t,n):this.Ni.getDocuments(t,r).next(e=>{e=this.Fi(n,e);return this.$i(n,e,r,i)?this.Mi(t,n):(kv()<=h.DEBUG&&p("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),j_(n)),this.Bi(t,e,n,Yv(i,-1)))})}Fi(n,e){let r=new V(z_(n));return e.forEach((e,t)=>{K_(n,t)&&(r=r.add(t))}),r}$i(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))}Mi(e,t){return kv()<=h.DEBUG&&p("QueryEngine","Using full collection scan to execute query:",j_(t)),this.Ni.getDocumentsMatchingQuery(e,t,Xv.min())}Bi(e,n,t,r){return this.Ni.getDocumentsMatchingQuery(e,t,r).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t))}}class NT{constructor(e,t,n,r){this.persistence=e,this.Li=t,this.yt=r,this.qi=new p_(P),this.Ui=new Tw(e=>T_(e),E_),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(n)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new cT(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.qi))}}function RT(e,t,n,r){return new NT(e,t,n,r)}async function xT(e,t){const a=e;return a.persistence.runTransaction("Handle user change","readonly",i=>{let s;return a.mutationQueue.getAllMutationBatches(i).next(e=>(s=e,a.Qi(t),a.mutationQueue.getAllMutationBatches(i))).next(e=>{const t=[],n=[];let r=B();for(const i of s){t.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}for(const i of e){n.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}return a.localDocuments.getDocuments(i,r).next(e=>({ji:e,removedBatchIds:t,addedBatchIds:n}))})})}function DT(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Cs.getLastRemoteSnapshotVersion(e))}function PT(e,s,t){let n=B(),a=B();return t.forEach(e=>n=n.add(e)),s.getEntries(e,n).next(r=>{let i=Ew;return t.forEach((e,t)=>{const n=r.get(e);t.isFoundDocument()!==n.isFoundDocument()&&(a=a.add(e)),t.isNoDocument()&&t.version.isEqual(O.min())?(s.removeEntry(e,t.readTime),i=i.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(t),i=i.insert(e,t)):p("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),{Wi:i,zi:a}})}function OT(e,r){const i=e;return i.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return i.Cs.getTargetData(t,r).next(e=>e?(n=e,F.resolve(n)):i.Cs.allocateTargetId(t).next(e=>(n=new Kb(r,e,0,t.currentSequenceNumber),i.Cs.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=i.qi.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.qi=i.qi.insert(e.targetId,e),i.Ui.set(r,e.targetId)),e})}async function MT(e,t,n){const r=e,i=r.qi.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!oy(e))throw e;p("LocalStore",`Failed to update sequence numbers for target ${t}: `+e)}r.qi=r.qi.remove(t),r.Ui.delete(i.target)}function LT(e,n,r){const i=e;let s=O.min(),a=B();return i.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,i=r.Ui.get(n);return void 0!==i?F.resolve(r.qi.get(i)):r.Cs.getTargetData(t,n)}(i,t,F_(n)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.Cs.getMatchingKeysForTargetId(t,e.targetId).next(e=>{a=e})}).next(()=>i.Li.getDocumentsMatchingQuery(t,n,r?s:O.min(),r?a:B())).next(e=>(qT(i,W_(n),e),{documents:e,Hi:a})))}function FT(e,t){const n=e,r=n.Cs,i=n.qi.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.ne(e,t).next(e=>e?e.target:null))}function UT(e,t){const n=e,r=n.Ki.get(t)||O.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.Gi.getAllFromCollectionGroup(e,t,Yv(r,-1),Number.MAX_SAFE_INTEGER)).then(e=>(qT(n,t,e),e))}function qT(e,t,n){let r=e.Ki.get(t)||O.min();n.forEach((e,t)=>{0<t.readTime.compareTo(r)&&(r=t.readTime)}),e.Ki.set(t,r)}function VT(e,t){return`firestore_clients_${e}_`+t}function BT(e,t,n){let r=`firestore_mutations_${e}_`+n;return t.isAuthenticated()&&(r+="_"+t.uid),r}function jT(e,t){return`firestore_targets_${e}_`+t}class KT{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Zi(e,t,n){var r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&((s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new D(r.error.code,r.error.message))),s?new KT(e,t,r.state,i):(Sv("SharedClientState",`Failed to parse mutation state for ID '${t}': `+n),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class WT{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Zi(e,t){var n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&((i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new D(n.error.code,n.error.message))),i?new WT(e,n.state,r):(Sv("SharedClientState",`Failed to parse target state for ID '${e}': `+t),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class zT{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=xw;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=Iy(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new zT(e,i):(Sv("SharedClientState",`Failed to parse client data for instance '${e}': `+t),null)}}class GT{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new GT(t.clientId,t.onlineState):(Sv("SharedClientState","Failed to parse online state: "+e),null)}}class HT{constructor(){this.activeTargetIds=xw}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class $T{constructor(e,t,n,r,i){this.window=e,this.Hs=t,this.persistenceKey=n,this.sr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new p_(P),this.started=!1,this.cr=[];e=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ar=VT(this.persistenceKey,this.sr),this.hr="firestore_sequence_number_"+this.persistenceKey,this.ur=this.ur.insert(this.sr,new HT),this.lr=new RegExp(`^firestore_clients_${e}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${e}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${e}_(\\d+)$`),this.wr="firestore_online_state_"+this.persistenceKey,this.mr="firestore_bundle_loaded_v2_"+this.persistenceKey,this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.vi();for(const n of e)if(n!==this.sr){const e=this.getItem(VT(this.persistenceKey,n));var t;e&&(t=zT.Zi(n,e))&&(this.ur=this.ur.insert(t.clientId,t))}this.gr();const n=this.storage.getItem(this.wr);if(n){const e=this.yr(n);e&&this.pr(e)}for(const e of this.cr)this.rr(e);this.cr=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(n){let r=!1;return this.ur.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,n){this.Tr(e,t,n),this.Er(e)}addLocalQueryTarget(e){let t="not-current";var n;return!this.isActiveQueryTarget(e)||(n=this.storage.getItem(jT(this.persistenceKey,e)))&&(n=WT.Zi(e,n))&&(t=n.state),this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(jT(this.persistenceKey,e))}updateQueryState(e,t,n){this.Rr(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Er(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return p("SharedClientState","READ",e,t),t}setItem(e,t){p("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){p("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){const i=e;i.storageArea===this.storage&&(p("SharedClientState","EVENT",i.key,i.newValue),i.key!==this.ar?this.Hs.enqueueRetryable(async()=>{var e;if(this.started){if(null!==i.key){if(this.lr.test(i.key))return null==i.newValue?(e=this.vr(i.key),this.Vr(e,null)):(e=this.Sr(i.key,i.newValue))?this.Vr(e.clientId,e):void 0;if(this.dr.test(i.key)){if(null!==i.newValue){var t=this.Dr(i.key,i.newValue);if(t)return this.Cr(t)}}else if(this._r.test(i.key)){if(null!==i.newValue&&(t=this.Nr(i.key,i.newValue)))return this.kr(t)}else if(i.key===this.wr){if(null!==i.newValue){var n=this.yr(i.newValue);if(n)return this.pr(n)}}else if(i.key===this.hr)(n=function(e){let t=fy.at;if(null!=e)try{var n=JSON.parse(e);R("number"==typeof n),t=n}catch(e){Sv("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(i.newValue))!==fy.at&&this.sequenceNumberHandler(n);else if(i.key===this.mr){const r=this.Or(i.newValue);await Promise.all(r.map(e=>this.syncEngine.Mr(e)))}}}else this.cr.push(i)}):Sv("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,n){const r=new KT(this.currentUser,e,t,n),i=BT(this.persistenceKey,this.currentUser,e);this.setItem(i,r.tr())}Er(e){e=BT(this.persistenceKey,this.currentUser,e);this.removeItem(e)}br(e){e={clientId:this.sr,onlineState:e};this.storage.setItem(this.wr,JSON.stringify(e))}Rr(e,t,n){const r=jT(this.persistenceKey,e),i=new WT(e,t,n);this.setItem(r,i.tr())}Pr(e){e=JSON.stringify(Array.from(e));this.setItem(this.mr,e)}vr(e){e=this.lr.exec(e);return e?e[1]:null}Sr(e,t){e=this.vr(e);return zT.Zi(e,t)}Dr(e,t){var e=this.dr.exec(e),n=Number(e[1]),e=void 0!==e[2]?e[2]:null;return KT.Zi(new Iv(e),n,t)}Nr(e,t){e=this._r.exec(e),e=Number(e[1]);return WT.Zi(e,t)}yr(e){return GT.Zi(e)}Or(e){return JSON.parse(e)}async Cr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Fr(e.batchId,e.state,e.error);p("SharedClientState","Ignoring mutation for non-active user "+e.user.uid)}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const n=t?this.ur.insert(e,t):this.ur.remove(e),r=this.Ir(this.ur),i=this.Ir(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Br(s,a).then(()=>{this.ur=n})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let n=xw;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class QT{constructor(){this.Lr=new HT,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,n){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new HT,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class YT{Ur(e){}shutdown(){}}class JT{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){p("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){p("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const XT={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ZT{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class e0 extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.oo=t+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(t,e,n,r,i){const s=this.ho(t,e);p("RestConnection","Sending: ",s,n);e={};return this.lo(e,r,i),this.fo(t,s,e,n).then(e=>(p("RestConnection","Received: ",e),e),e=>{throw Cv("RestConnection",t+" failed with error: ",e,"url: ",s,"request:",n),e})}_o(e,t,n,r,i,s){return this.ao(e,t,n,r,i)}lo(n,e,t){n["X-Goog-Api-Client"]="gl-js/ fire/"+Tv,n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>n[t]=e),t&&t.headers.forEach((e,t)=>n[t]=e)}ho(e,t){e=XT[e];return this.oo+`/v1/${t}:`+e}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(o,t,n,r){return new Promise((i,s)=>{const a=new bv;a.setWithCredentials(!0),a.listenOnce(vv.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case mv.NO_ERROR:var e=a.getResponseJson();p("Connection","XHR received:",JSON.stringify(e)),i(e);break;case mv.TIMEOUT:p("Connection",'RPC "'+o+'" timed out'),s(new D(x.DEADLINE_EXCEEDED,"Request time out"));break;case mv.HTTP_ERROR:var t=a.getStatus();if(p("Connection",'RPC "'+o+'" failed with status:',t,"response text:",a.getResponseText()),0<t){let e=a.getResponseJson();var n=null==(e=Array.isArray(e)?e[0]:e)?void 0:e.error;if(n&&n.status&&n.message){r=n.status.toLowerCase().replace(/_/g,"-");const o=0<=Object.values(x).indexOf(r)?r:x.UNKNOWN;s(new D(o,n.message))}else s(new D(x.UNKNOWN,"Server responded with status "+a.getStatus()))}else s(new D(x.UNAVAILABLE,"Connection failed."));break;default:N()}}finally{p("Connection",'RPC "'+o+'" completed.')}var r});var e=JSON.stringify(r);a.send(t,"POST",e,n,15)})}wo(e,t,n){const r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=new cv,s=gv(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/`+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new _v({})),this.lo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;e=r.join("");p("Connection","Creating WebChannel: "+e,a);const o=i.createWebChannel(e,a);let c=!1,l=!1;const u=new ZT({Hr:e=>{l?p("Connection","Not sending because WebChannel is closed:",e):(c||(p("Connection","Opening WebChannel transport."),o.open(),c=!0),p("Connection","WebChannel sending:",e),o.send(e))},Jr:()=>o.close()}),h=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return h(o,wv.EventType.OPEN,()=>{l||p("Connection","WebChannel transport opened.")}),h(o,wv.EventType.CLOSE,()=>{l||(l=!0,p("Connection","WebChannel transport closed"),u.io())}),h(o,wv.EventType.ERROR,e=>{l||(l=!0,Cv("Connection","WebChannel transport errored:",e),u.io(new D(x.UNAVAILABLE,"The operation could not be completed")))}),h(o,wv.EventType.MESSAGE,n=>{if(!l){var n=n.data[0],r=(R(!!n),n.error||(null==(r=n[0])?void 0:r.error));if(r){p("Connection","WebChannel received error:",r);const n=r.status;let e=function(e){e=pv[e];if(void 0!==e)return Iw(e)}(n),t=r.message;void 0===e&&(e=x.INTERNAL,t="Unknown error status: "+n+" with message "+r.message),l=!0,u.io(new D(e,t)),o.close()}else p("Connection","WebChannel received:",n),u.ro(n)}}),h(s,yv.STAT_EVENT,e=>{10===e.stat?p("Connection","Detected buffering proxy"):11===e.stat&&p("Connection","Detected no buffering proxy")}),setTimeout(()=>{u.so()},0),u}}function t0(){return"undefined"!=typeof window?window:null}function n0(){return"undefined"!=typeof document?document:null}function r0(e){return new Ww(e,!0)}class i0{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Hs=e,this.timerId=t,this.mo=n,this.yo=r,this.po=i,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();var t=Math.floor(this.Io+this.bo()),n=Math.max(0,Date.now()-this.Eo),r=Math.max(0,t-n);0<r&&p("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class s0{constructor(e,t,n,r,i,s,a,o){this.Hs=e,this.vo=n,this.Vo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new i0(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(e,t){this.Lo(),this.qo(),this.xo.cancel(),this.So++,4!==e?this.xo.reset():t&&t.code===x.RESOURCE_EXHAUSTED?(Sv(t.toString()),Sv("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):t&&t.code===x.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Uo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(t)}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),n=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.So===n&&this.Go(e,t)},t=>{e(()=>{var e=new D(x.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Qo(e)})})}Go(e,t){const n=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{n(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(e=>{n(()=>this.Qo(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Oo(){this.state=5,this.xo.Ro(async()=>{this.state=0,this.start()})}Qo(e){return p("PersistentStream","close with error: "+e),this.stream=null,this.close(4,e)}Ko(t){return e=>{this.Hs.enqueueAndForget(()=>this.So===t?e():(p("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class a0 extends s0{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.yt=i}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(p=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===p?1:"REMOVE"===p?2:"CURRENT"===p?3:"RESET"===p?4:N(),i=t.targetChange.targetIds||[],s=(p=t.targetChange.resumeToken,e.wt?(R(void 0===p||"string"==typeof p),Ty.fromBase64String(p||"")):(R(void 0===p||p instanceof Uint8Array),Ty.fromUint8Array(p||new Uint8Array))),a=t.targetChange.cause,o=a&&(o=void 0===(p=a).code?x.UNKNOWN:Iw(p.code),new D(o,p.message||""));n=new Lw(r,i,s,o||null)}else if("documentChange"in t){t.documentChange;(u=t.documentChange).document,u.document.name,u.document.updateTime;var s=Jw(e,u.document.name),o=Hw(u.document.updateTime),c=u.document.createTime?Hw(u.document.createTime):O.min(),l=new __({mapValue:{fields:u.document.fields}}),c=w_.newFoundDocument(s,o,c,l),l=u.targetIds||[],u=u.removedTargetIds||[];n=new Ow(l,u,c.key,c)}else if("documentDelete"in t)t.documentDelete,(l=t.documentDelete).document,u=Jw(e,l.document),c=l.readTime?Hw(l.readTime):O.min(),c=w_.newNoDocument(u,c),l=l.removedTargetIds||[],n=new Ow([],l,c.key,c);else if("documentRemove"in t){t.documentRemove;(d=t.documentRemove).document;var h=Jw(e,d.document),d=d.removedTargetIds||[];n=new Ow([],d,h,null)}else{if(!("filter"in t))return N();{t.filter;const e=t.filter;e.targetId,d=e.count||0,h=new ww(d),d=e.targetId,n=new Mw(d,h)}}var p;return n}(this.yt,e),e=function(e){if(!("targetChange"in e))return O.min();e=e.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?O.min():Hw(e.readTime)}(e);return this.listener.Wo(t,e)}zo(e){const t={};t.database=eb(this.yt),t.addTarget=function(e,t){let n;var r=t.target;return(n=k_(r)?{documents:ab(e,r)}:{query:ob(e,r)}).targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=Gw(e,t.resumeToken):0<t.snapshotVersion.compareTo(O.min())&&(n.readTime=zw(e,t.snapshotVersion.toTimestamp())),n}(this.yt,e);this.yt,n=e;var n,e=null==(e=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return N()}}())?null:{"goog-listen-tags":e};e&&(t.labels=e),this.Bo(t)}Ho(e){const t={};t.database=eb(this.yt),t.removeTarget=e,this.Bo(t)}}class o0 extends s0{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.yt=i,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){var t,n,r;return R(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo?(this.xo.reset(),n=e.writeResults,r=e.commitTime,n=n&&0<n.length?(R(void 0!==r),n.map(t=>{{var n=r;let e=t.updateTime?Hw(t.updateTime):Hw(n);return e.isEqual(O.min())&&(e=Hw(n)),new aw(e,t.transformResults||[])}})):[],t=Hw(e.commitTime),this.listener.Zo(t,n)):(R(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu())}eu(){const e={};e.database=eb(this.yt),this.Bo(e)}Xo(e){e={streamToken:this.lastStreamToken,writes:e.map(e=>ib(this.yt,e))};this.Bo(e)}}class c0 extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.yt=r,this.nu=!1}su(){if(this.nu)throw new D(x.FAILED_PRECONDITION,"The client has already been terminated.")}ao(n,r,i){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.ao(n,r,i,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new D(x.UNKNOWN,e.toString())})}_o(n,r,i,s){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection._o(n,r,i,e,t,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new D(x.UNKNOWN,e.toString())})}terminate(){this.nu=!0}}class l0{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,1<=this.iu&&(this.lu(),this.au("Connection failed 1 times. Most recent error: "+e.toString()),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){e=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(Sv(e),this.ou=!1):p("OnlineStateTracker",e)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class u0{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=i,this.mu.Ur(e=>{n.enqueueAndForget(async()=>{if(_0(this)){p("RemoteStore","Restarting streams for network reachability change.");{var e;const t=this;t._u.add(4),await d0(t),t.gu.set("Unknown"),t._u.delete(4),await h0(t)}}})}),this.gu=new l0(n,r)}}async function h0(e){if(_0(e))for(const t of e.wu)await t(!0)}async function d0(e){for(const t of e.wu)await t(!1)}function p0(e,t){const n=e;n.du.has(t.targetId)||(n.du.set(t.targetId,t),y0(n)?v0(n):A0(n).ko()&&g0(n,t))}function f0(e,t){const n=e,r=A0(n);n.du.delete(t),r.ko()&&m0(n,t),0===n.du.size&&(r.ko()?r.Fo():_0(n)&&n.gu.set("Unknown"))}function g0(e,t){e.yu.Ot(t.targetId),A0(e).zo(t)}function m0(e,t){e.yu.Ot(t),A0(e).Ho(t)}function v0(t){t.yu=new Uw({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ne:e=>t.du.get(e)||null}),A0(t).start(),t.gu.uu()}function y0(e){return _0(e)&&!A0(e).No()&&0<e.du.size}function _0(e){return 0===e._u.size}function w0(e){e.yu=void 0}async function b0(e,t,n){if(!oy(t))throw t;e._u.add(1),await d0(e),e.gu.set("Offline"),n=n||(()=>DT(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{p("RemoteStore","Retrying IndexedDB access"),await n(),e._u.delete(1),await h0(e)})}function I0(t,n){return n().catch(e=>b0(t,e,n))}async function T0(e){const t=e,n=N0(t);let r=0<t.fu.length?t.fu[t.fu.length-1].batchId:-1;for(;_0(a=t)&&a.fu.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.fu.length&&n.Fo();break}r=e.batchId;{var i=t;var s=e;i.fu.push(s);const o=N0(i);o.ko()&&o.Yo&&o.Xo(s.mutations)}}catch(e){await b0(t,e)}var a;E0(t)&&k0(t)}function E0(e){return _0(e)&&!N0(e).No()&&0<e.fu.length}function k0(e){N0(e).start()}async function S0(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),p("RemoteStore","RemoteStore received new credentials");e=_0(n);n._u.add(3),await d0(n),e&&n.gu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n._u.delete(3),await h0(n)}async function C0(e,t){const n=e;t?(n._u.delete(2),await h0(n)):(n._u.add(2),await d0(n),n.gu.set("Unknown"))}function A0(t){return t.pu||(t.pu=function(e,t,n){const r=e;return r.su(),new a0(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,n)}(t.datastore,t.asyncQueue,{Yr:async function(n){n.du.forEach((e,t)=>{g0(n,e)})}.bind(null,t),Zr:async function(e,t){w0(e),y0(e)?(e.gu.hu(t),v0(e)):e.gu.set("Unknown")}.bind(null,t),Wo:async function(e,t,n){if(e.gu.set("Online"),t instanceof Lw&&2===t.state&&t.cause)try{var r=e,i=t.cause;for(const o of t.targetIds)r.du.has(o)&&(await r.remoteSyncer.rejectListen(o,i),r.du.delete(o),r.yu.removeTarget(o))}catch(n){p("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await b0(e,n)}else if(t instanceof Ow?e.yu.Kt(t):t instanceof Mw?e.yu.Jt(t):e.yu.jt(t),!n.isEqual(O.min()))try{const t=await DT(e.localStore);if(0<=n.compareTo(t)){var s=e,a=n;const c=s.yu.Zt(a);void await(c.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=s.du.get(t);n&&s.du.set(t,n.withResumeToken(e.resumeToken,a))}}),c.targetMismatches.forEach(e=>{const t=s.du.get(e);t&&(s.du.set(e,t.withResumeToken(Ty.EMPTY_BYTE_STRING,t.snapshotVersion)),m0(s,e),e=new Kb(t.target,e,1,t.sequenceNumber),g0(s,e))}),s.remoteSyncer.applyRemoteEvent(c))}}catch(t){p("RemoteStore","Failed to raise snapshot:",t),await b0(e,t)}}.bind(null,t)}),t.wu.push(async e=>{e?(t.pu.Mo(),y0(t)?v0(t):t.gu.set("Unknown")):(await t.pu.stop(),w0(t))})),t.pu}function N0(t){return t.Iu||(t.Iu=function(e,t,n){const r=e;return r.su(),new o0(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,n)}(t.datastore,t.asyncQueue,{Yr:async function(e){N0(e).eu()}.bind(null,t),Zr:async function(e,t){if(t&&N0(e).Yo){var n=e,r=t,i;if(bw(i=r.code)&&i!==x.ABORTED){const i=n.fu.shift();N0(n).Mo(),await I0(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,r)),await T0(n)}await 0}E0(e)&&k0(e)}.bind(null,t),tu:async function(e){const t=N0(e);for(const n of e.fu)t.Xo(n.mutations)}.bind(null,t),Zo:async function(e,t,n){const r=e.fu.shift(),i=Bb.from(r,t,n);await I0(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await T0(e)}.bind(null,t)}),t.wu.push(async e=>{e?(t.Iu.Mo(),await T0(t)):(await t.Iu.stop(),0<t.fu.length&&(p("RemoteStore",`Stopping write stream with ${t.fu.length} pending writes`),t.fu=[]))})),t.Iu}class R0{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Nv,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,a=new R0(e,t,s,r,i);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new D(x.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function x0(e,t){if(Sv("AsyncQueue",t+": "+e),oy(e))return new D(x.UNAVAILABLE,t+": "+e);throw e}class D0{constructor(n){this.comparator=n?(e,t)=>n(e,t)||L.comparator(e.key,t.key):(e,t)=>L.comparator(e.key,t.key),this.keyedMap=Sw(),this.sortedSet=new p_(this.comparator)}static emptySet(e){return new D0(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){e=this.keyedMap.get(e);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof D0))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new D0;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class P0{constructor(){this.Tu=new p_(L.comparator)}track(e){var t=e.doc.key,n=this.Tu.get(t);!n||0!==e.type&&3===n.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==n.type?this.Tu=this.Tu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Tu=this.Tu.remove(t):1===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):N()}Eu(){const n=[];return this.Tu.inorderTraversal((e,t)=>{n.push(t)}),n}}class O0{constructor(e,t,n,r,i,s,a,o,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new O0(e,t,D0.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&V_(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class M0{constructor(){this.Au=void 0,this.listeners=[]}}class L0{constructor(){this.queries=new Tw(e=>B_(e),V_),this.onlineState="Unknown",this.Ru=new Set}}async function F0(e,t){const n=e,r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new M0),i)try{s.Au=await n.onListen(r)}catch(e){const n=x0(e,`Initialization of query '${j_(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.bu(n.onlineState),s.Au&&t.Pu(s.Au)&&q0(n)}async function U0(e,t){const n=e,r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);0<=e&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function q0(e){e.Ru.forEach(e=>{e.next()})}class V0{constructor(e,t,n){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=n||{}}Pu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new O0(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){return!e.fromCache||(!this.options.Nu||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){if(0<e.docChanges.length)return!0;var t=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}xu(e){e=O0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class B0{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}class j0{constructor(e){this.yt=e}Ji(e){return Jw(this.yt,e)}Yi(e){return e.metadata.exists?rb(this.yt,e.document,!1):w_.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return Hw(e)}}class K0{constructor(e,t,n){this.Mu=e,this.localStore=t,this.yt=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=W0(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;const n=M.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,n=new j0(this.yt);for(const i of e)if(i.metadata.queries){const e=n.Ji(i.metadata.name);for(const n of i.metadata.queries){var r=(t.get(n)||B()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=e;let s=B(),a=Ew;for(const e of n){const n=t.Ji(e.metadata.name),l=(e.document&&(s=s.add(n)),t.Yi(e));l.setReadTime(t.Xi(e.metadata.readTime)),a=a.insert(n,l)}const o=i.Gi.newChangeBuffer({trackRemovals:!0}),c=await OT(i,F_(x_(M.fromString("__bundle__/docs/"+r))));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>PT(t,o,a).next(e=>(o.apply(t),e)).next(e=>i.Cs.removeMatchingKeysForTargetId(t,c.targetId).next(()=>i.Cs.addMatchingKeys(t,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(t,e.Wi,e.zi)).next(()=>e.Wi)))}(this.localStore,new j0(this.yt),this.documents,this.Mu.id),t=this.$u(this.documents);for(const e of this.queries)await async function(e,n,r=B()){const i=await OT(e,F_(Xb(n.bundledQuery))),s=e;return s.persistence.runTransaction("Save named query","readwrite",e=>{var t=Hw(n.readTime);return 0<=i.snapshotVersion.compareTo(t)?s.Ns.saveNamedQuery(e,n):(t=i.withResumeToken(Ty.EMPTY_BYTE_STRING,t),s.qi=s.qi.insert(t.targetId,t),s.Cs.updateTargetData(e,t).next(()=>s.Cs.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>s.Cs.addMatchingKeys(e,r,i.targetId)).next(()=>s.Ns.saveNamedQuery(e,n)))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Bu:this.collectionGroups,Lu:e}}}function W0(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class z0{constructor(e){this.key=e}}class G0{constructor(e){this.key=e}}class H0{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=B(),this.mutatedKeys=B(),this.Gu=z_(e),this.Qu=new D0(this.Gu)}get ju(){return this.qu}Wu(e,t){const o=t?t.zu:new P0,c=(t||this).Qu;let l=(t||this).mutatedKeys,u=c,h=!1;const d="F"===this.query.limitType&&c.size===this.query.limit?c.last():null,p="L"===this.query.limitType&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((e,t)=>{const n=c.get(e),r=K_(this.query,t)?t:null,i=!!n&&this.mutatedKeys.has(n.key),s=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let a=!1;n&&r?n.data.isEqual(r.data)?i!==s&&(o.track({type:3,doc:r}),a=!0):this.Hu(n,r)||(o.track({type:2,doc:r}),a=!0,(d&&0<this.Gu(r,d)||p&&this.Gu(r,p)<0)&&(h=!0)):!n&&r?(o.track({type:0,doc:r}),a=!0):n&&!r&&(o.track({type:1,doc:n}),a=!0,(d||p)&&(h=!0)),a&&(l=r?(u=u.add(r),s?l.add(e):l.delete(e)):(u=u.delete(e),l.delete(e)))}),null!==this.query.limit)for(;u.size>this.query.limit;){const e="F"===this.query.limitType?u.last():u.first();u=u.delete(e.key),l=l.delete(e.key),o.track({type:1,doc:e})}return{Qu:u,zu:o,$i:h,mutatedKeys:l}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const i=e.zu.Eu();i.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return N()}};return n(e)-n(t)}(e.type,t.type)||this.Gu(e.doc,t.doc)),this.Ju(n);var t=t?this.Yu():[],s=0===this.Ku.size&&this.current?1:0,a=s!==this.Uu;return this.Uu=s,0!==i.length||a?{snapshot:new O0(this.query,e.Qu,r,i,e.mutatedKeys,0==s,a,!1,!!n&&0<n.resumeToken.approximateByteSize()),Xu:t}:{Xu:t}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new P0,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(e=>this.qu=this.qu.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.qu=this.qu.delete(e)),this.current=e.current)}Yu(){if(!this.current)return[];const t=this.Ku,n=(this.Ku=B(),this.Qu.forEach(e=>{this.Zu(e.key)&&(this.Ku=this.Ku.add(e.key))}),[]);return t.forEach(e=>{this.Ku.has(e)||n.push(new G0(e))}),this.Ku.forEach(e=>{t.has(e)||n.push(new z0(e))}),n}tc(e){this.qu=e.Hi,this.Ku=B();e=this.Wu(e.documents);return this.applyChanges(e,!0)}ec(){return O0.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}class $0{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Q0{constructor(e){this.key=e,this.nc=!1}}class Y0{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.sc={},this.ic=new Tw(e=>B_(e),V_),this.rc=new Map,this.oc=new Set,this.uc=new p_(L.comparator),this.cc=new Map,this.ac=new hT,this.hc={},this.lc=new Map,this.fc=BI.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}async function J0(n,e,t,r,i){n._c=(e,i,t)=>async function(e,t,n){let r=t.view.Wu(i);r.$i&&(r=await LT(e.localStore,t.query,!1).then(({documents:e})=>t.view.Wu(e,r)));n=n&&n.targetChanges.get(t.targetId),n=t.view.applyChanges(r,e.isPrimaryClient,n);return iE(e,t.targetId,n.Xu),n.snapshot}(n,e,t);const s=await LT(n.localStore,e,!0),a=new H0(e,s.Hi),o=a.Wu(s.documents),c=Pw.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),l=a.applyChanges(o,n.isPrimaryClient,c);iE(n,t,l.Xu);r=new $0(e,t,a);return n.ic.set(e,r),n.rc.has(t)?n.rc.get(t).push(e):n.rc.set(t,[e]),l.snapshot}async function X0(e,t){const r=e;try{const e=await function(e,l){const u=e,h=l.snapshotVersion;let d=u.qi;return u.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const e=u.Gi.newChangeBuffer({trackRemovals:!0}),c=(d=u.qi,[]);l.targetChanges.forEach((t,n)=>{const r=d.get(n);if(r){c.push(u.Cs.removeMatchingKeys(o,t.removedDocuments,n).next(()=>u.Cs.addMatchingKeys(o,t.addedDocuments,n)));let e=r.withSequenceNumber(o.currentSequenceNumber);var i,s,a;l.targetMismatches.has(n)?e=e.withResumeToken(Ty.EMPTY_BYTE_STRING,O.min()).withLastLimboFreeSnapshotVersion(O.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,h)),d=d.insert(n,e),i=r,s=e,a=t,0!==i.resumeToken.approximateByteSize()&&!(3e8<=s.snapshotVersion.toMicroseconds()-i.snapshotVersion.toMicroseconds()||0<a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size)||c.push(u.Cs.updateTargetData(o,e))}});let t=Ew,n=B();if(l.documentUpdates.forEach(e=>{l.resolvedLimboDocuments.has(e)&&c.push(u.persistence.referenceDelegate.updateLimboDocument(o,e))}),c.push(PT(o,e,l.documentUpdates).next(e=>{t=e.Wi,n=e.zi})),!h.isEqual(O.min())){const l=u.Cs.getLastRemoteSnapshotVersion(o).next(e=>u.Cs.setTargetsMetadata(o,o.currentSequenceNumber,h));c.push(l)}return F.waitFor(c).next(()=>e.apply(o)).next(()=>u.localDocuments.getLocalViewOfDocuments(o,t,n)).next(()=>t)}).then(e=>(u.qi=d,e))}(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.cc.get(t);n&&(R(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.nc=!0:0<e.modifiedDocuments.size?R(n.nc):0<e.removedDocuments.size&&(R(n.nc),n.nc=!1))}),await aE(r,e,t)}catch(e){await ny(e)}}function Z0(n,r,e){const t=n;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const n=[];t.ic.forEach((e,t)=>{t=t.view.bu(r);t.snapshot&&n.push(t.snapshot)});{e=t.eventManager;var i=r;const s=e;s.onlineState=i;let n=!1;s.queries.forEach((e,t)=>{for(const e of t.listeners)e.bu(i)&&(n=!0)}),n&&q0(s)}n.length&&t.sc.Wo(n),t.onlineState=r,t.isPrimaryClient&&t.sharedClientState.setOnlineState(r)}}function eE(e,t){(e.lc.get(t)||[]).forEach(e=>{e.resolve()}),e.lc.delete(t)}function tE(e,t,n){const r=e;let i=r.hc[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.hc[r.currentUser.toKey()]=i}}function nE(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.rc.get(e))t.ic.delete(r),n&&t.sc.wc(r,n);t.rc.delete(e),t.isPrimaryClient&&t.ac.ls(e).forEach(e=>{t.ac.containsKey(e)||rE(t,e)})}function rE(e,t){e.oc.delete(t.path.canonicalString());var n=e.uc.get(t);null!==n&&(f0(e.remoteStore,n),e.uc=e.uc.remove(t),e.cc.delete(n),sE(e))}function iE(e,t,n){for(const i of n)if(i instanceof z0){e.ac.addReference(i.key,t);{var r=e;const s=i.key,a=s.path.canonicalString();r.uc.get(s)||r.oc.has(a)||(p("SyncEngine","New document in limbo: "+s),r.oc.add(a),sE(r))}}else i instanceof G0?(p("SyncEngine","Document no longer in limbo: "+i.key),e.ac.removeReference(i.key,t),e.ac.containsKey(i.key)||rE(e,i.key)):N()}function sE(e){for(;0<e.oc.size&&e.uc.size<e.maxConcurrentLimboResolutions;){var t=e.oc.values().next().value,n=(e.oc.delete(t),new L(M.fromString(t))),t=e.fc.next();e.cc.set(t,new Q0(n)),e.uc=e.uc.insert(n,t),p0(e.remoteStore,new Kb(F_(x_(n.path)),t,2,fy.at))}}async function aE(e,n,r){const i=e,s=[],a=[],o=[];if(!i.ic.isEmpty()){i.ic.forEach((e,t)=>{o.push(i._c(t,n,r).then(e=>{(e||r)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,null!=e&&e.fromCache?"not-current":"current"),e&&(s.push(e),e=CT.Ci(t.targetId,e),a.push(e))}))}),await Promise.all(o),i.sc.Wo(s);{var t=i.localStore,c=a;const l=t;try{await l.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>F.forEach(c,t=>F.forEach(t.Si,e=>l.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>F.forEach(t.Di,e=>l.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(t){if(!oy(t))throw t;p("LocalStore","Failed to update sequence numbers: "+t)}for(const t of c){const c=t.targetId;if(!t.fromCache){const t=l.qi.get(c),u=t.snapshotVersion,h=t.withLastLimboFreeSnapshotVersion(u);l.qi=l.qi.insert(c,h)}}}}}async function oE(t,n){const r=t,i=[],s=[];for(const t of n){let e;var a=r.rc.get(t);if(a&&0!==a.length){e=await OT(r.localStore,F_(a[0]));for(const t of a){const n=r.ic.get(t),u=(o=n,0,l=await LT((c=r).localStore,o.query,!0),l=o.view.tc(l),c.isPrimaryClient&&iE(c,o.targetId,l.Xu),await l);u.snapshot&&s.push(u.snapshot)}}else{a=await FT(r.localStore,t);e=await OT(r.localStore,a),await J0(r,cE(a),t,!1,e.resumeToken)}i.push(e)}var o,c,l;return r.sc.Wo(s),i}function cE(e){return R_(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function lE(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=X0.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(e,t){const n=e,r=n.cc.get(t);if(r&&r.nc)return B().add(r.key);{let e=B();const r=n.rc.get(t);if(!r)return e;for(const t of r){const r=n.ic.get(t);e=e.unionWith(r.view.ju)}return e}}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=async function(e,t,n){const r=e,i=(r.sharedClientState.updateQueryState(t,"rejected",n),r.cc.get(t)),s=i&&i.key;if(s){let e=new p_(L.comparator);e=e.insert(s,w_.newNoDocument(s,O.min()));const n=B().add(s),i=new Dw(O.min(),new Map,new V(P),e,n);await X0(r,i),r.uc=r.uc.remove(s),r.cc.delete(t),sE(r)}else await MT(r.localStore,t,!1).then(()=>nE(r,t,n)).catch(ny)}.bind(null,t),t.sc.Wo=function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.Pu(e)&&(r=!0);i.Au=e}}r&&q0(n)}.bind(null,t.eventManager),t.sc.wc=function(e,t,n){const r=e,i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}.bind(null,t.eventManager),t}function uE(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=async function(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=i.Gi.newChangeBuffer({trackRemovals:!0});return function(e,t,r,i){const s=r.batch,n=s.keys();let a=F.resolve();return n.forEach(n=>{a=a.next(()=>i.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);R(null!==t),e.version.compareTo(t)<0&&(s.applyToRemoteDocument(e,r),e.isValidDocument()&&(e.setReadTime(r.commitVersion),i.addEntry(e)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,s))}(i,e,r,n).next(()=>n.apply(e)).next(()=>i.mutationQueue.performConsistencyCheck(e)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(e,t,r.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(t){let n=B();for(let e=0;e<t.mutationResults.length;++e)0<t.mutationResults[e].transformResults.length&&(n=n.add(t.batch.mutations[e].key));return n}(r))).next(()=>i.localDocuments.getDocuments(e,t))})}(n.localStore,t);tE(n,r,null),eE(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await aE(n,e)}catch(e){await ny(e)}}.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=async function(e,t,n){const r=e;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return i.mutationQueue.lookupMutationBatch(t,r).next(e=>(R(null!==e),n=e.keys(),i.mutationQueue.removeMutationBatch(t,e))).next(()=>i.mutationQueue.performConsistencyCheck(t)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(t,n,r)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,n)).next(()=>i.localDocuments.getDocuments(t,n))})}(r.localStore,t);tE(r,t,n),eE(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await aE(r,e)}catch(n){await ny(n)}}.bind(null,t),t}class hE{constructor(){this.synchronizeTabs=!1}async initialize(e){this.yt=r0(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return RT(this.persistence,new AT,e.initialUser,this.yt)}yc(e){return new vT(_T.Bs,this.yt)}gc(e){return new QT}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class dE extends hE{constructor(e,t,n){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ac.initialize(this,e),await uE(this.Ac.syncEngine),await T0(this.Ac.remoteStore),await this.persistence.li(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Ic(e){return RT(this.persistence,new AT,e.initialUser,this.yt)}Tc(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new $I(n,e.asyncQueue,t)}Ec(e,t){t=new py(t,this.persistence);return new dy(e.asyncQueue,t)}yc(e){var t=ST(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?PI.withCacheSize(this.cacheSizeBytes):PI.DEFAULT;return new TT(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,t0(),n0(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new QT}}class pE extends dE{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);e=this.Ac.syncEngine;this.sharedClientState instanceof $T&&(this.sharedClientState.syncEngine={Fr:async function(e,t,n,r){var i=await function(e,n){const r=e,i=r.mutationQueue;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>i.Tn(t,n).next(e=>e?r.localDocuments.getDocuments(t,e):F.resolve(null)))}(e.localStore,t);null!==i?("pending"===n?await T0(e.remoteStore):"acknowledged"===n||"rejected"===n?(tE(e,t,r||null),eE(e,t),e.localStore.mutationQueue.An(t)):N(),await aE(e,i)):p("SyncEngine","Cannot apply mutation batch with id: "+t)}.bind(null,e),$r:async function(e,t,n,r){const i=e;if(i.dc)p("SyncEngine","Ignoring unexpected query state notification.");else{var s=i.rc.get(t);if(s&&0<s.length)switch(n){case"current":case"not-current":{const e=await UT(i.localStore,W_(s[0])),r=Dw.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,Ty.EMPTY_BYTE_STRING);await aE(i,e,r);break}case"rejected":await MT(i.localStore,t,!0),nE(i,t,r);break;default:N()}}}.bind(null,e),Br:async function(e,t,n){const r=lE(e);if(r.dc){for(const e of t)if(r.rc.has(e))p("SyncEngine","Adding an already active target "+e);else{const t=await FT(r.localStore,e),n=await OT(r.localStore,t);await J0(r,cE(t),n.targetId,!1,n.resumeToken),p0(r.remoteStore,n)}for(const e of n)r.rc.has(e)&&await MT(r.localStore,e,!1).then(()=>{f0(r.remoteStore,e),nE(r,e)}).catch(ny)}}.bind(null,e),vi:function(e){return e.localStore.persistence.vi()}.bind(null,e),Mr:async function(e,t){const n=e;return UT(n.localStore,t).then(e=>aE(n,e))}.bind(null,e)},await this.sharedClientState.start()),await this.persistence.li(async e=>{{var r=this.Ac.syncEngine,t=e;const i=r;if(lE(i),uE(i),!0===t&&!0!==i.dc){const r=i.sharedClientState.getAllActiveQueryTargets(),t=await oE(i,r.toArray());i.dc=!0,await C0(i.remoteStore,!0);for(const r of t)p0(i.remoteStore,r)}else if(!1===t&&!1!==i.dc){const r=[];let n=Promise.resolve();i.rc.forEach((e,t)=>{i.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(nE(i,t),MT(i.localStore,t,!0))),f0(i.remoteStore,t)}),await n,await oE(i,r);{const s=i;s.cc.forEach((e,t)=>{f0(s.remoteStore,t)}),s.ac.fs(),s.cc=new Map,s.uc=new p_(L.comparator)}i.dc=!1,await C0(i.remoteStore,!1)}}await 0,this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}gc(e){var t=t0();if(!$T.C(t))throw new D(x.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=ST(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new $T(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class fE{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Z0(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=async function(e,t){const n=e;var r;n.currentUser.isEqual(t)||(p("SyncEngine","User change. New user:",t.toKey()),r=await xT(n.localStore,t),n.currentUser=t,(e=n).lc.forEach(e=>{e.forEach(e=>{e.reject(new D(x.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.lc.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await aE(n,r.ji))}.bind(null,this.syncEngine),await C0(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new L0}createDatastore(e){var t=r0(e.databaseInfo.databaseId),n=(n=e.databaseInfo,new e0(n)),r=e.authCredentials,i=e.appCheckCredentials;return e=t,new c0(r,i,n,e)}createRemoteStore(e){return t=this.localStore,n=this.datastore,e=e.asyncQueue,r=e=>Z0(this.syncEngine,e,0),i=new(JT.C()?JT:YT),new u0(t,n,e,r,i);var t,n,r,i}createSyncEngine(e,t){{var n=this.localStore,r=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser;e=e.maxConcurrentLimboResolutions;const o=new Y0(n,r,i,s,a,e);return t&&(o.dc=!0),o}}terminate(){return async function(e){const t=e;p("RemoteStore","RemoteStore shutting down."),t._u.add(5),await d0(t),t.mu.shutdown(),t.gu.set("Unknown")}(this.remoteStore)}}function gE(e,t,n){if(!n)throw new D(x.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function mE(e,t,n,r){if(!0===t&&!0===r)throw new D(x.INVALID_ARGUMENT,e+` and ${n} cannot be used together.`)}function vE(e){if(!L.isDocumentKey(e))throw new D(x.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function yE(e){if(L.isDocumentKey(e))throw new D(x.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function _E(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":N();if(e instanceof Array)return"an array";e=e.constructor?e.constructor.name:null;return e?`a custom ${e} object`:"an object"}function j(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new D(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");e=_E(e);throw new D(x.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: `+e)}function wE(e,t){if(t<=0)throw new D(x.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}const bE=new Map;class IE{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new D(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new D(x.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,mE("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class TE{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new IE({}),this._settingsFrozen=!1}get app(){if(this._app)return this._app;throw new D(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available")}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new D(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new IE(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new xv;switch(e.type){case"gapi":var t=e.client;return new Mv(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new D(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){{var e=this;const t=bE.get(e);t&&(p("ComponentProvider","Removing Datastore"),bE.delete(e),t.terminate())}return Promise.resolve()}}class EE{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new SE(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new EE(this.firestore,e,this._key)}}class kE{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new kE(this.firestore,e,this._query)}}class SE extends kE{constructor(e,t,n){super(e,t,x_(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new EE(this.firestore,null,new L(e))}withConverter(e){return new SE(this.firestore,e,this._path)}}function CE(e,t,...n){var r;if(e=_(e),gE("collection","path",t),e instanceof TE)return yE(r=M.fromString(t,...n)),new SE(e,null,r);if(e instanceof EE||e instanceof SE)return yE(r=e._path.child(M.fromString(t,...n))),new SE(e.firestore,null,r);throw new D(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore")}function AE(e,t,...n){var r;if(e=_(e),gE("doc","path",t=1===arguments.length?Uv.R():t),e instanceof TE)return vE(r=M.fromString(t,...n)),new EE(e,null,new L(r));if(e instanceof EE||e instanceof SE)return vE(r=e._path.child(M.fromString(t,...n))),new EE(e.firestore,e instanceof SE?e.converter:null,new L(r));throw new D(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore")}function NE(e,t){return e=_(e),t=_(t),(e instanceof EE||e instanceof SE)&&(t instanceof EE||t instanceof SE)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function RE(e,t){return e=_(e),t=_(t),e instanceof kE&&t instanceof kE&&e.firestore===t.firestore&&V_(e._query,t._query)&&e.converter===t.converter}function xE(t,n=10240){let r=0;return{async read(){var e;return r<t.byteLength?(e={value:t.slice(r,r+n),done:!1},r+=n,e):{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class DE{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):Sv("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class PE{constructor(e,t){this.Pc=e,this.yt=t,this.metadata=new Nv,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(e=>{e&&e.Ou()?this.metadata.resolve(e.ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             `+JSON.stringify(null==e?void 0:e.ku)))},e=>this.metadata.reject(e))}close(){return this.Pc.cancel()}async getMetadata(){return this.metadata.promise}async mc(){return await this.getMetadata(),this.Vc()}async Vc(){var e=await this.Sc();if(null===e)return null;var t=this.vc.decode(e),n=Number(t);return isNaN(n)&&this.Dc(`length string (${t}) is not valid number`),t=await this.Cc(n),new B0(JSON.parse(t),e.length+n)}xc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async Sc(){for(;this.xc()<0&&!await this.Nc(););if(0===this.buffer.length)return null;var e=this.xc(),t=(e<0&&this.Dc("Reached the end of bundle when a length string is expected."),this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}async Cc(e){for(;this.buffer.length<e;)await this.Nc()&&this.Dc("Reached the end of bundle when more is expected.");var t=this.vc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Dc(e){throw this.Pc.cancel(),new Error("Invalid bundle format: "+e)}async Nc(){var e=await this.Pc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class OE{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new D(x.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const o=e,n=eb(o.yt)+"/documents",r={documents:t.map(e=>Yw(o.yt,e))},i=await o._o("BatchGetDocuments",n,r,t.length),c=new Map,s=(i.forEach(e=>{a=o.yt;const t="found"in e?(n=a,R(!!(r=e).found),r.found.name,r.found.updateTime,n=Jw(n,r.found.name),i=Hw(r.found.updateTime),s=r.found.createTime?Hw(r.found.createTime):O.min(),r=new __({mapValue:{fields:r.found.fields}}),w_.newFoundDocument(n,i,s,r)):"missing"in e?function(e,t){R(!!t.missing),R(!!t.readTime);e=Jw(e,t.missing),t=Hw(t.readTime);return w_.newNoDocument(e,t)}(a,e):N();var n,r,i,s,a;c.set(t.key.toString(),t)}),[]);return t.forEach(e=>{e=c.get(e.toString());R(!!e),s.push(e)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new yw(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{t=L.fromPath(t);this.mutations.push(new _w(t,this.precondition(t)))});{var e=this.datastore,n=this.mutations;const r=e,i=eb(r.yt)+"/documents",s={writes:n.map(e=>ib(r.yt,e))};await r.ao("Commit",i,s)}await 0,this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw N();t=O.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new D(x.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(O.min())?ow.exists(!1):ow.updateTime(t):ow.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return ow.exists(!0);if(t.isEqual(O.min()))throw new D(x.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ow.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class ME{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.kc=n.maxAttempts,this.xo=new i0(this.asyncQueue,"transaction_retry")}run(){--this.kc,this.Oc()}Oc(){this.xo.Ro(async()=>{const t=new OE(this.datastore),e=this.Mc(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.Fc(e)}))}).catch(e=>{this.Fc(e)})})}Mc(e){try{var t=this.updateFunction(e);return!wy(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Fc(e){0<this.kc&&this.$c(e)?(--this.kc,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if("FirebaseError"!==e.name)return!1;e=e.code;return"aborted"===e||"failed-precondition"===e||"already-exists"===e||!bw(e)}}class LE{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Iv.UNAUTHENTICATED,this.clientId=Uv.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{p("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(p("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new D(x.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new Nv;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(e){var t=x0(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function FE(e,t){e.asyncQueue.verifyOperationInProgress(),p("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await xT(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function UE(e,n){e.asyncQueue.verifyOperationInProgress();var t=await qE(e),r=(p("FirestoreClient","Initializing OnlineComponentProvider"),await e.getConfiguration());await n.initialize(t,r),e.setCredentialChangeListener(e=>S0(n.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>S0(n.remoteStore,t)),e.onlineComponents=n}async function qE(e){return e.offlineComponents||(p("FirestoreClient","Using default OfflineComponentProvider"),await FE(e,new hE)),e.offlineComponents}async function VE(e){return e.onlineComponents||(p("FirestoreClient","Using default OnlineComponentProvider"),await UE(e,new fE)),e.onlineComponents}function BE(e){return qE(e).then(e=>e.persistence)}function jE(e){return qE(e).then(e=>e.localStore)}function KE(e){return VE(e).then(e=>e.remoteStore)}function WE(e){return VE(e).then(e=>e.syncEngine)}async function zE(e){const t=await VE(e),n=t.eventManager;return n.onListen=async function(e,t){const n=lE(e);let r,i;const s=n.ic.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.ec();else{const e=await OT(n.localStore,F_(t)),s=(n.isPrimaryClient&&p0(n.remoteStore,e),n.sharedClientState.addLocalQueryTarget(e.targetId));r=e.targetId,i=await J0(n,t,r,"current"===s,e.resumeToken)}return i}.bind(null,t.syncEngine),n.onUnlisten=async function(e,t){const n=e,r=n.ic.get(t),i=n.rc.get(r.targetId);if(1<i.length)return n.rc.set(r.targetId,i.filter(e=>!V_(e,t))),void n.ic.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await MT(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),f0(n.remoteStore,r.targetId),nE(n,r.targetId)}).catch(ny)):(nE(n,r.targetId),await MT(n.localStore,r.targetId,!0))}.bind(null,t.syncEngine),n}function GE(t,c,l={}){const u=new Nv;return t.asyncQueue.enqueueAndForget(async()=>{{var n=await zE(t),r=t.asyncQueue,i=c,s=l,a=u;const e=new DE({next:e=>{r.enqueueAndForget(()=>U0(n,o));var t=e.docs.has(i);!t&&e.fromCache?a.reject(new D(x.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&s&&"server"===s.source?a.reject(new D(x.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):a.resolve(e)},error:e=>a.reject(e)}),o=new V0(x_(i.path),e,{includeMetadataChanges:!0,Nu:!0});return F0(n,o)}}),u.promise}function HE(o,c,l={}){const u=new Nv;return o.asyncQueue.enqueueAndForget(async()=>{{var t=await zE(o),n=o.asyncQueue,e=c,r=l,i=u;const s=new DE({next:e=>{n.enqueueAndForget(()=>U0(t,a)),e.fromCache&&"server"===r.source?i.reject(new D(x.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(e)},error:e=>i.reject(e)}),a=new V0(e,s,{includeMetadataChanges:!0,Nu:!0});return F0(t,a)}}),u.promise}function $E(r,e,t,i){e=r0(e),t=function(e){if(e instanceof Uint8Array)return xE(e,void 0);if(e instanceof ArrayBuffer)return xE(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof t?(new TextEncoder).encode(t):t);const s=new PE(t,e);r.asyncQueue.enqueueAndForget(async()=>{{var e=await WE(r),t=s;const n=e;return void async function(t,n,r){try{var i=await n.getMetadata();if(await function(e,t){const n=e,r=Hw(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Ns.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,i))return await n.close(),r._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}),Promise.resolve(new Set);r._updateProgress(W0(i));const a=new K0(i,t.localStore,n.yt);let e=await n.mc();for(;e;){const t=await a.Fu(e);t&&r._updateProgress(t),e=await n.mc()}var s=await a.complete();return await aE(t,s.Lu,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Ns.saveBundleMetadata(e,t))}(t.localStore,i),r._completeWith(s.progress),Promise.resolve(s.Bu)}catch(t){return Cv("SyncEngine","Loading bundle failed with "+t),r._failWith(t),Promise.resolve(new Set)}}(n,t,i).then(e=>{n.sharedClientState.notifyBundleLoaded(e)})}})}class QE{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new i0(this,"async_queue_retry"),this.Wc=()=>{var e=n0();e&&p("AsyncQueue","Visibility state changed to "+e.visibilityState),this.xo.Po()};const e=n0();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=n0();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});const t=new Nv;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}async Jc(){if(0!==this.Lc.length){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(e){if(!oy(e))throw e;p("AsyncQueue","Operation failed with retryable error: "+e)}0<this.Lc.length&&this.xo.Ro(()=>this.Jc())}}Hc(e){var t=this.Bc.then(()=>(this.Gc=!0,e().catch(e=>{throw this.Kc=e,this.Gc=!1,Sv("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return t=e.stack?e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack:t}(e)),e}).then(e=>(this.Gc=!1,e))));return this.Bc=t}enqueueAfterDelay(e,t,n){this.zc(),-1<this.jc.indexOf(e)&&(t=0);e=R0.createAndSchedule(this,e,t,n,e=>this.Yc(e));return this.Uc.push(e),e}zc(){this.Kc&&N()}verifyOperationInProgress(){}async Xc(){for(var e;await(e=this.Bc),e!==this.Bc;);}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(t){return this.Xc().then(()=>{this.Uc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this.Uc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){e=this.Uc.indexOf(e);this.Uc.splice(e,1)}}function YE(e){var t=e;if("object"==typeof t&&null!==t){var n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return 1}}class JE{constructor(){this._progressObserver={},this._taskCompletionResolver=new Nv,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class XE extends TE{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new QE,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||ek(this),this._firestoreClient.terminate()}}function ZE(e){return e._firestoreClient||ek(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function ek(e){var t,n,r,i,s=e._freezeSettings(),s=(t=e._databaseId,n=(null==(n=e._app)?void 0:n.options.appId)||"",r=e._persistenceKey,i=s,new gy(t,n,r,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams));e._firestoreClient=new LE(e._authCredentials,e._appCheckCredentials,e._queue,s)}function tk(e,n,r){const i=new Nv;return e.asyncQueue.enqueue(async()=>{try{await FE(e,r),await UE(e,n),i.resolve()}catch(e){const n=e;if(!("FirebaseError"===(t=n).name?t.code===x.FAILED_PRECONDITION||t.code===x.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw n;Cv("Error enabling offline persistence. Falling back to persistence disabled: "+n),i.reject(n)}var t}).then(()=>i.promise)}function nk(e){return(r=ZE(e=j(e,XE))).asyncQueue.enqueue(async()=>{const e=await BE(r),t=await KE(r);e.setNetworkEnabled(!0);{const n=t;return n._u.delete(0),h0(n)}});var r}function rk(t,e){return r=ZE(t=j(t,XE)),i=e,r.asyncQueue.enqueue(async()=>{{var e=await jE(r),t=i;const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Ns.getNamedQuery(e,t))}}).then(e=>e?new kE(t,null,e.query):null);var r,i}function ik(e){if(e._initialized||e._terminated)throw new D(x.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class sk{constructor(e){this._byteString=e}static fromBase64String(e){try{return new sk(Ty.fromBase64String(e))}catch(e){throw new D(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new sk(Ty.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class ak{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new D(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Wv(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ok{constructor(e){this._methodName=e}}class ck{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new D(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new D(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return P(this._lat,e._lat)||P(this._long,e._long)}}const lk=/^__.*__$/;class uk{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new fw(e,this.data,this.fieldMask,t,this.fieldTransforms):new pw(e,this.data,t,this.fieldTransforms)}}class hk{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new fw(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function dk(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw N()}}class pk{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.yt=n,this.ignoreUndefinedProperties=r,void 0===i&&this.na(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new pk(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const n=null==(t=this.path)?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.ua(e),r}ca(e){var t;const n=null==(t=this.path)?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.na(),r}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return Pk(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(dk(this.sa)&&lk.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class fk{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=n||r0(e)}da(e,t,n,r=!1){return new pk({sa:e,methodName:t,fa:n,path:Wv.emptyPath(),oa:!1,la:r},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function gk(e){var t=e._freezeSettings(),n=r0(e._databaseId);return new fk(e._databaseId,!!t.ignoreUndefinedProperties,n)}function mk(e,t,n,r,i,s={}){const a=e.da(s.merge||s.mergeFields?2:0,t,n,i);Nk("Data must be an object, but it was:",a,r);e=Ck(r,a);let o,c;if(s.merge)o=new y_(a.fieldMask),c=a.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Rk(t,r,n);if(!a.contains(i))throw new D(x.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Ok(e,i)||e.push(i)}o=new y_(e),c=a.fieldTransforms.filter(e=>o.covers(e.field))}else o=null,c=a.fieldTransforms;return new uk(new __(e),o,c)}class vk extends ok{_toFieldTransform(e){if(2!==e.sa)throw 1===e.sa?e.ha(this._methodName+"() can only appear at the top level of your update data"):e.ha(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof vk}}function yk(e,t,n){return new pk({sa:3,fa:t.settings.fa,methodName:e._methodName,oa:n},t.databaseId,t.yt,t.ignoreUndefinedProperties)}class _k extends ok{_toFieldTransform(e){return new sw(e.path,new J_)}isEqual(e){return e instanceof _k}}class wk extends ok{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=yk(this,e,!0),n=this._a.map(e=>Sk(e,t)),r=new X_(n);return new sw(e.path,r)}isEqual(e){return this===e}}class bk extends ok{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=yk(this,e,!0),n=this._a.map(e=>Sk(e,t)),r=new ew(n);return new sw(e.path,r)}isEqual(e){return this===e}}class Ik extends ok{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){var t=new nw(e.yt,$_(e.yt,this.wa));return new sw(e.path,t)}isEqual(e){return this===e}}function Tk(e,i,s,t){const a=e.da(1,i,s),o=(Nk("Data must be an object, but it was:",a,t),[]),c=__.empty();yy(t,(e,t)=>{var n=Dk(i,e,s),r=(t=_(t),a.ca(n));if(t instanceof vk)o.push(n);else{const e=Sk(t,r);null!=e&&(o.push(n),c.set(n,e))}});e=new y_(o);return new hk(c,e,a.fieldTransforms)}function Ek(t,n,e,r,i,s){const a=t.da(1,n,e),o=[Rk(n,r,e)],c=[i];if(s.length%2!=0)throw new D(x.INVALID_ARGUMENT,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(Rk(n,s[e])),c.push(s[e+1]);const l=[],u=__.empty();for(let e=o.length-1;0<=e;--e)if(!Ok(l,o[e])){const n=o[e];var h=_(c[e]);const r=a.ca(n);if(h instanceof vk)l.push(n);else{const t=Sk(h,r);null!=t&&(l.push(n),u.set(n,t))}}t=new y_(l);return new hk(u,t,a.fieldTransforms)}function kk(e,t,n,r=!1){return Sk(n,e.da(r?4:3,t))}function Sk(e,n){if(Ak(e=_(e)))return Nk("Unsupported field value:",n,e),Ck(e,n);if(e instanceof ok){{var t=e;var r=n;if(!dk(r.sa))throw r.ha(t._methodName+"() can only be used with update() and set()");if(!r.path)throw r.ha(t._methodName+"() is not currently supported inside arrays");t=t._toFieldTransform(r);t&&r.fieldTransforms.push(t)}return null}if(void 0===e&&n.ignoreUndefinedProperties)return null;if(n.path&&n.fieldMask.push(n.path),e instanceof Array){if(n.settings.oa&&4!==n.sa)throw n.ha("Nested arrays are not supported");{var i=n;const a=[];let t=0;for(const o of e){let e=Sk(o,i.aa(t));null==e&&(e={nullValue:"NULL_VALUE"}),a.push(e),t++}return{arrayValue:{values:a}}}}var s,r=0,t=n;if(null===(r=_(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return $_(t.yt,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date)return s=Bv.fromDate(r),{timestampValue:zw(t.yt,s)};if(r instanceof Bv)return s=new Bv(r.seconds,1e3*Math.floor(r.nanoseconds/1e3)),{timestampValue:zw(t.yt,s)};if(r instanceof ck)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof sk)return{bytesValue:Gw(t.yt,r._byteString)};if(r instanceof EE){const c=t.databaseId,l=r.firestore._databaseId;if(l.isEqual(c))return{referenceValue:$w(r.firestore._databaseId||t.databaseId,r._key.path)};throw t.ha(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${c.projectId}/`+c.database)}throw t.ha("Unsupported field value: "+_E(r))}function Ck(e,n){const r={};return _y(e)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):yy(e,(e,t)=>{t=Sk(t,n.ra(e));null!=t&&(r[e]=t)}),{mapValue:{fields:r}}}function Ak(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Bv||e instanceof ck||e instanceof sk||e instanceof EE||e instanceof ok)}function Nk(e,t,n){var r;if(!Ak(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))throw"an object"===(r=_E(n))?t.ha(e+" a custom object"):t.ha(e+" "+r)}function Rk(e,t,n){if((t=_(t))instanceof ak)return t._internalPath;if("string"==typeof t)return Dk(e,t);throw Pk("Field path arguments must be of type string or ",e,!1,void 0,n)}const xk=new RegExp("[~\\*/\\[\\]]");function Dk(t,n,r){if(0<=n.search(xk))throw Pk(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new ak(...n.split("."))._internalPath}catch(e){throw Pk(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function Pk(e,t,n,r,i){var s=r&&!r.isEmpty(),a=void 0!==i;let o=`Function ${t}() called with invalid data`,c=(n&&(o+=" (via `toFirestore()`)"),o+=". ","");return(s||a)&&(c+=" (found",s&&(c+=" in field "+r),a&&(c+=" in document "+i),c+=")"),new D(x.INVALID_ARGUMENT,o+e+c)}function Ok(e,t){return e.some(e=>e.isEqual(t))}class Mk{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new EE(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){var e;if(this._document)return this._converter?(e=new Lk(this._firestore,this._userDataWriter,this._key,this._document,null),this._converter.fromFirestore(e)):this._userDataWriter.convertValue(this._document.data.value)}get(e){if(this._document){e=this._document.data.field(Fk("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Lk extends Mk{data(){return super.data()}}function Fk(e,t){return"string"==typeof t?Dk(e,t):(t instanceof ak?t:t._delegate)._internalPath}function Uk(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new D(x.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class qk{}class Vk extends qk{}function Bk(e,t,...n){let r=[];t instanceof qk&&r.push(t),r=r.concat(n);n=(t=r).filter(e=>e instanceof Kk).length,t=t.filter(e=>e instanceof jk).length;if(1<n||0<n&&0<t)throw new D(x.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.");for(const t of r)e=t._apply(e);return e}class jk extends Vk{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new jk(e,t,n)}_apply(e){var t=this._parse(e);return Jk(e._query,t),new kE(e.firestore,e.converter,U_(e._query,t))}_parse(t){var n=gk(t.firestore);{var r=t._query,i="where",s=n,a=t.firestore._databaseId,o=(n=this._field,t=this._op,this._value);let e;if(n.isKeyField()){if("array-contains"===t||"array-contains-any"===t)throw new D(x.INVALID_ARGUMENT,`Invalid Query. You can't perform '${t}' queries on documentId().`);if("in"===t||"not-in"===t){Yk(o,t);const i=[];for(const s of o)i.push(Qk(a,r,s));e={arrayValue:{values:i}}}else e=Qk(a,r,o)}else"in"!==t&&"not-in"!==t&&"array-contains-any"!==t||Yk(o,t),e=kk(s,i,o,"in"===t||"not-in"===t);return U.create(n,t,e)}}}class Kk extends qk{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Kk(e,t)}_parse(t){var e=this._queryConstraints.map(e=>e._parse(t)).filter(e=>0<e.getFilters().length);return 1===e.length?e[0]:q.create(e,this._getOperator())}_apply(t){const n=this._parse(t);{if(0===n.getFilters().length)return t;{var r=t._query;let e=r;for(const r of n.getFlattenedFilters())Jk(e,r),e=U_(e,r)}return new kE(t.firestore,t.converter,U_(t._query,n))}}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Wk extends Vk{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Wk(e,t)}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new D(x.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new D(x.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");t=new d_(t,n);return n=t,null===P_(e)&&null!==(e=O_(e))&&Xk(0,e,n.field),t}(e._query,this._field,this._direction);return new kE(e.firestore,e.converter,(t=(e=e._query).explicitOrderBy.concat([t]),new N_(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class zk extends Vk{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new zk(e,t,n)}_apply(e){return new kE(e.firestore,e.converter,q_(e._query,this._limit,this._limitType))}}class Gk extends Vk{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Gk(e,t,n)}_apply(e){var t,n=$k(e,this.type,this._docOrFields,this._inclusive);return new kE(e.firestore,e.converter,(t=e._query,e=n,new N_(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}class Hk extends Vk{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Hk(e,t,n)}_apply(e){var t,n=$k(e,this.type,this._docOrFields,this._inclusive);return new kE(e.firestore,e.converter,(t=e._query,e=n,new N_(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function $k(e,t,n,r){if(n[0]=_(n[0]),n[0]instanceof Mk){var i=e._query,s=e.firestore._databaseId,a=t,o=n[0]._document,c=r;if(!o)throw new D(x.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const f=[];for(const a of L_(i))if(a.field.isKeyField())f.push(Uy(s,o.key));else{const i=o.data.field(a.field);if(Ay(i))throw new D(x.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===i){const i=a.field.canonicalString();throw new D(x.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${i}' (used as the orderBy) does not exist.`)}f.push(i)}return new $y(f,c)}a=gk(e.firestore);{var l=e._query,u=e.firestore._databaseId,h=a,d=t,p=n,i=r;const g=l.explicitOrderBy;if(p.length>g.length)throw new D(x.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const m=[];for(let e=0;e<p.length;e++){const v=p[e];if(g[e].field.isKeyField()){if("string"!=typeof v)throw new D(x.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a `+typeof v);if(!M_(l)&&-1!==v.indexOf("/"))throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${v}' contains a slash.`);const h=l.path.child(M.fromString(v));if(!L.isDocumentKey(h))throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${h}' is not because it contains an odd number of segments.`);const p=new L(h);m.push(Uy(u,p))}else{const l=kk(h,d,v);m.push(l)}}return new $y(m,i)}}function Qk(e,t,n){if("string"==typeof(n=_(n))){if(""===n)throw new D(x.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!M_(t)&&-1!==n.indexOf("/"))throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);t=t.path.child(M.fromString(n));if(L.isDocumentKey(t))return Uy(e,new L(t));throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${t}' is not because it has an odd number of segments (${t.length}).`)}if(n instanceof EE)return Uy(e,n._key);throw new D(x.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${_E(n)}.`)}function Yk(e,t){if(!Array.isArray(e)||0===e.length)throw new D(x.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(10<e.length)throw new D(x.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function Jk(e,t){if(t.isInequality()){const r=O_(e),i=t.field;if(null!==r&&!r.isEqual(i))throw new D(x.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${i.toString()}'`);var n=P_(e);null!==n&&Xk(0,i,n)}const r=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(0<=t.indexOf(e.op))return e.op;return null}(e.filters,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new D(x.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new D(x.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function Xk(e,t,n){if(!n.isEqual(t))throw new D(x.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Zk{convertValue(e,t="none"){switch(Dy(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Sy(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Cy(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw N()}}convertObject(e,n){const r={};return yy(e.fields,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new ck(Sy(e.latitude),Sy(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=function e(t){t=t.mapValue.fields.__previous_value__;return Ay(t)?e(t):t}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ny(e));default:return null}}convertTimestamp(e){e=ky(e);return new Bv(e.seconds,e.nanos)}convertDocumentKey(e,t){const n=M.fromString(e),r=(R(hb(n)),new my(n.get(1),n.get(3))),i=new L(n.popFirst(5));return r.isEqual(t)||Sv(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function eS(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class tS extends Zk{constructor(e){super(),this.firestore=e}convertBytes(e){return new sk(e)}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new EE(this.firestore,null,e)}}class nS{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class rS extends Mk{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){var t;if(this._document)return this._converter?(t=new iS(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null),this._converter.fromFirestore(t,e)):this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}get(e,t={}){if(this._document){e=this._document.data.field(Fk("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e,t.serverTimestamps)}}}class iS extends rS{data(e={}){return super.data(e)}}class sS{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new nS(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new iS(this._firestore,this._userDataWriter,e.key,e,new nS(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){e=!!e.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new D(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,t){if(s._snapshot.oldDocs.isEmpty()){let n=0;return s._snapshot.docChanges.map(e=>{var t=new iS(s._firestore,s._userDataWriter,e.doc.key,e.doc,new nS(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);return e.doc,{type:"added",doc:t,oldIndex:-1,newIndex:n++}})}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new iS(s._firestore,s._userDataWriter,e.doc.key,e.doc,new nS(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),r=i.indexOf(e.doc.key)),{type:function(){switch(e.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return N()}}(),doc:t,oldIndex:n,newIndex:r}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function aS(e,t){return e instanceof rS&&t instanceof rS?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof sS&&t instanceof sS&&e._firestore===t._firestore&&RE(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class oS extends Zk{constructor(e){super(),this.firestore=e}convertBytes(e){return new sk(e)}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new EE(this.firestore,null,e)}}function cS(e,t,n){e=j(e,EE);var r=j(e.firestore,XE),t=eS(e.converter,t,n);return dS(r,[mk(gk(r),"setDoc",e._key,t,null!==e.converter,n).toMutation(e._key,ow.none())])}function lS(e,t,n,...r){e=j(e,EE);var i=j(e.firestore,XE),s=gk(i);let a;return dS(i,[(a="string"==typeof(t=_(t))||t instanceof ak?Ek(s,"updateDoc",e._key,t,n,r):Tk(s,"updateDoc",e._key,t)).toMutation(e._key,ow.exists(!0))])}function uS(t,...n){t=_(t);let e={includeMetadataChanges:!1},r=0;"object"!=typeof n[r]||YE(n[r])||(e=n[r],r++);var i={includeMetadataChanges:e.includeMetadataChanges};if(YE(n[r])){const t=n[r];n[r]=null==(l=t.next)?void 0:l.bind(t),n[r+1]=null==(l=t.error)?void 0:l.bind(t),n[r+2]=null==(l=t.complete)?void 0:l.bind(t)}let s,a,o;if(t instanceof EE)a=j(t.firestore,XE),o=x_(t._key.path),s={next:e=>{n[r]&&n[r](pS(a,t,e))},error:n[r+1],complete:n[r+2]};else{const h=j(t,kE),d=(a=j(h.firestore,XE),o=h._query,new oS(a));s={next:e=>{n[r]&&n[r](new sS(a,d,h,e))},error:n[r+1],complete:n[r+2]},Uk(t._query)}{var c=ZE(a),l=o,u=s;const p=new DE(u),f=new V0(l,p,i);return c.asyncQueue.enqueueAndForget(async()=>F0(await zE(c),f)),()=>{p.bc(),c.asyncQueue.enqueueAndForget(async()=>U0(await zE(c),f))}}}function hS(e,t){{var n=ZE(e=j(e,XE));e=YE(t)?t:{next:t};const r=new DE(e);return n.asyncQueue.enqueueAndForget(async()=>{var e=await zE(n),t=r;e.Ru.add(t),t.next()}),()=>{r.bc(),n.asyncQueue.enqueueAndForget(async()=>{var e=await zE(n),t=r;e.Ru.delete(t)})}}}function dS(e,t){{var n=ZE(e),r=t;const i=new Nv;return n.asyncQueue.enqueueAndForget(async()=>async function(t,e,n){const r=uE(t);try{const t=await function(e,i){const s=e,a=Bv.now(),o=i.reduce((e,t)=>e.add(t.key),B());let c,l;return s.persistence.runTransaction("Locally write mutations","readwrite",n=>{let t=Ew,r=B();return s.Gi.getEntries(n,o).next(e=>{(t=e).forEach((e,t)=>{t.isValidDocument()||(r=r.add(e))})}).next(()=>s.localDocuments.getOverlayedDocuments(n,t)).next(e=>{c=e;const t=[];for(const n of i){const i=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Y_(r.transform,e||null);null!=i&&(n=null===n?__.empty():n).set(r.field,i)}return n||null}(n,c.get(n.key).overlayedDocument);null!=i&&t.push(new fw(n.key,i,function r(e){const i=[];return yy(e.fields,(e,t)=>{const n=new Wv([e]);if(Ky(t)){const e=r(t.mapValue).fields;if(0===e.length)i.push(n);else for(const t of e)i.push(n.child(t))}else i.push(n)}),new y_(i)}(i.value.mapValue),ow.exists(!0)))}return s.mutationQueue.addMutationBatch(n,a,t,i)}).next(e=>{var t=(l=e).applyToLocalDocumentSet(c,r);return s.documentOverlayCache.saveOverlays(n,e.batchId,t)})}).then(()=>({batchId:l.batchId,changes:Cw(c)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId);{var i=r;var s=t.batchId;var a=n;let e=i.hc[i.currentUser.toKey()];e=(e=e||new p_(P)).insert(s,a),i.hc[i.currentUser.toKey()]=e}await aE(r,t.changes),await T0(r.remoteStore)}catch(t){const e=x0(t,"Failed to persist write");n.reject(e)}}(await WE(n),r,i)),i.promise}}function pS(e,t,n){var r=n.docs.get(t._key),i=new oS(e);return new rS(e,i,t._key,r,new nS(n.hasPendingWrites,n.fromCache),t.converter)}const fS={maxAttempts:5};class gS{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=gk(e)}set(e,t,n){this._verifyNotCommitted();const r=mS(e,this._firestore),i=eS(r.converter,t,n),s=mk(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,ow.none())),this}update(e,t,n,...r){this._verifyNotCommitted();e=mS(e,this._firestore);let i;return i="string"==typeof(t=_(t))||t instanceof ak?Ek(this._dataReader,"WriteBatch.update",e._key,t,n,r):Tk(this._dataReader,"WriteBatch.update",e._key,t),this._mutations.push(i.toMutation(e._key,ow.exists(!0))),this}delete(e){this._verifyNotCommitted();e=mS(e,this._firestore);return this._mutations=this._mutations.concat(new yw(e._key,ow.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(x.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function mS(e,t){if((e=_(e)).firestore!==t)throw new D(x.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class vS extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=gk(e)}get(e){const n=mS(e,this._firestore),r=new tS(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return N();const t=e[0];if(t.isFoundDocument())return new Mk(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new Mk(this._firestore,r,n._key,null,n.converter);throw N()})}set(e,t,n){e=mS(e,this._firestore),t=eS(e.converter,t,n),t=mk(this._dataReader,"Transaction.set",e._key,t,null!==e.converter,n);return this._transaction.set(e._key,t),this}update(e,t,n,...r){e=mS(e,this._firestore),n="string"==typeof(t=_(t))||t instanceof ak?Ek(this._dataReader,"Transaction.update",e._key,t,n,r):Tk(this._dataReader,"Transaction.update",e._key,t);return this._transaction.update(e._key,n),this}delete(e){e=mS(e,this._firestore);return this._transaction.delete(e._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=mS(e,this._firestore),n=new oS(this._firestore);return super.get(e).then(e=>new rS(this._firestore,n,t._key,e._document,new nS(!1,!1),t.converter))}}function yS(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new D("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function _S(){if("undefined"==typeof Uint8Array)throw new D("unimplemented","Uint8Arrays are not available in this environment.")}function wS(){if("undefined"==typeof atob)throw new D("unimplemented","Blobs are unavailable in Firestore in this environment.")}$n=bt,Tv=$n,vt(new o("firestore",(e,{instanceIdentifier:t,options:n})=>{const r=e.getProvider("app").getImmediate(),i=new XE(new Pv(e.getProvider("auth-internal")),new Fv(e.getProvider("app-check-internal")),function(e,t){if(Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))return new my(e.options.projectId,t);throw new D(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.')}(r,t),r);return n=Object.assign({useFetchStreams:!0},n),i._setSettings(n),i},"PUBLIC").setMultipleInstances(!0)),r(Hn,"3.8.0-20221206221533",void 0),r(Hn,"3.8.0-20221206221533","esm2017");class bS{constructor(e){this._delegate=e}static fromBase64String(e){return wS(),new bS(sk.fromBase64String(e))}static fromUint8Array(e){return _S(),new bS(sk.fromUint8Array(e))}toBase64(){return wS(),this._delegate.toBase64()}toUint8Array(){return _S(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function IS(e){if("object"==typeof e&&null!==e){var t=e;for(const n of["next","error","complete"])if(n in t&&"function"==typeof t[n])return 1}}class TS{enableIndexedDbPersistence(e,t){return e=e._delegate,t={forceOwnership:t},ik(e=j(e,XE)),n=ZE(e),e=e._freezeSettings(),r=new fE,tk(n,r,new dE(r,e.cacheSizeBytes,null==t?void 0:t.forceOwnership));var n,r}enableMultiTabIndexedDbPersistence(e){return ik(e=j(e=e._delegate,XE)),t=ZE(e),e=e._freezeSettings(),n=new fE,tk(t,n,new pE(n,e.cacheSizeBytes));var t,n}clearIndexedDbPersistence(e){{var t=e._delegate;if(t._initialized&&!t._terminated)throw new D(x.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const n=new Nv;return t._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!iy.C())return Promise.resolve();e+="main";await iy.delete(e)}(ST(t._databaseId,t._persistenceKey)),n.resolve()}catch(e){n.reject(e)}}),n.promise}}}class ES{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof my||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||Cv("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(n,r,e={}){{var[n,r,e,i={}]=[this._delegate,n,r,e];const s=(n=j(n,TE))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==r&&Cv("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:r+":"+e,ssl:!1})),i.mockUserToken){let e,t;if("string"==typeof i.mockUserToken)e=i.mockUserToken,t=Iv.MOCK_USER;else{e=se(i.mockUserToken,null==(r=n._app)?void 0:r.options.projectId);const s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new D(x.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new Iv(s)}n._authCredentials=new Dv(new Rv(e,t))}return}}enableNetwork(){return nk(this._delegate)}disableNetwork(){return e=this._delegate,(n=ZE(e=j(e,XE))).asyncQueue.enqueue(async()=>{const e=await BE(n),t=await KE(n);return e.setNetworkEnabled(!1),async function(){const e=t;e._u.add(0),await d0(e),e.gu.set("Offline")}()});var e,n}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,mE("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){var e=this._delegate;{var t=ZE(e=j(e,XE));const n=new Nv;return t.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;_0(n.remoteStore)||p("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.lc.get(e)||[];r.push(t),n.lc.set(e,r)}catch(e){const n=x0(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await WE(t),n)),n.promise}}onSnapshotsInSync(e){return hS(this._delegate,e)}get app(){if(this._appCompat)return this._appCompat;throw new D("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available")}collection(e){try{return new US(this,CE(this._delegate,e))}catch(e){throw RS(e,"collection()","Firestore.collection()")}}doc(e){try{return new NS(this,AE(this._delegate,e))}catch(e){throw RS(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new MS(this,function(e,t){if(e=j(e,TE),gE("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new D(x.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new kE(e,null,new N_(M.emptyPath(),t))}(this._delegate,e))}catch(e){throw RS(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){var n=this._delegate,r=e=>t(new SS(this,e)),e=void 0;if(n=j(n,XE),(e=Object.assign(Object.assign({},fS),e)).maxAttempts<1)throw new D(x.INVALID_ARGUMENT,"Max attempts must be at least 1");{var i=ZE(n),s=e=>r(new vS(n,e)),a=e;const o=new Nv;return i.asyncQueue.enqueueAndForget(async()=>{var e=await VE(i).then(e=>e.datastore);new ME(i.asyncQueue,e,a,s,o).run()}),o.promise}}batch(){return ZE(this._delegate),new CS(new gS(this._delegate,e=>dS(this._delegate,e)))}loadBundle(e){return n=ZE(t=j(this._delegate,XE)),r=new JE,$E(n,t._databaseId,e,r),r;var t,n,r}namedQuery(e){return rk(this._delegate,e).then(e=>e?new MS(this,e):null)}}class kS extends Zk{constructor(e){super(),this.firestore=e}convertBytes(e){return new bS(new sk(e))}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return NS.forKey(e,this.firestore,null)}}class SS{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new kS(e)}get(e){const t=qS(e);return this._delegate.get(t).then(e=>new PS(this._firestore,new rS(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){e=qS(e);return n?(yS("Transaction.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){e=qS(e);return 2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){e=qS(e);return this._delegate.delete(e),this}}class CS{constructor(e){this._delegate=e}set(e,t,n){e=qS(e);return n?(yS("WriteBatch.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){e=qS(e);return 2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){e=qS(e);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class AS{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){e=new iS(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new OS(this._firestore,e),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=AS.INSTANCES;let r=n.get(e),i=(r||(r=new WeakMap,n.set(e,r)),r.get(t));return i||(i=new AS(e,new kS(e),t),r.set(t,i)),i}}AS.INSTANCES=new WeakMap;class NS{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new kS(e)}static forPath(e,t,n){if(e.length%2!=0)throw new D("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new NS(t,new EE(t._delegate,n,new L(e)))}static forKey(e,t,n){return new NS(t,new EE(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new US(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new US(this.firestore,CE(this._delegate,e))}catch(e){throw RS(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=_(e))instanceof EE&&NE(this._delegate,e)}set(e,t){t=yS("DocumentReference.set",t);try{return t?cS(this._delegate,e,t):cS(this._delegate,e)}catch(e){throw RS(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?lS(this._delegate,e):lS(this._delegate,e,t,...n)}catch(e){throw RS(e,"updateDoc()","DocumentReference.update()")}}delete(){return dS(j((e=this._delegate).firestore,XE),[new yw(e._key,ow.none())]);var e}onSnapshot(...e){var t=xS(e),e=DS(e,e=>new PS(this.firestore,new rS(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return uS(this._delegate,t,e)}get(e){let t;return(t=("cache"===(null==e?void 0:e.source)?function(t){t=j(t,EE);const n=j(t.firestore,XE),e=ZE(n),r=new oS(n);return function(e,t){const n=new Nv;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}(t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new D(x.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){t=x0(e,`Failed to get document '${t} from cache`);n.reject(t)}}(await jE(e),t,n)),n.promise}(e,t._key).then(e=>new rS(n,r,t._key,e,new nS(null!==e&&e.hasLocalMutations,!0),t.converter))}:"server"===(null==e?void 0:e.source)?function(t){t=j(t,EE);const n=j(t.firestore,XE);return GE(ZE(n),t._key,{source:"server"}).then(e=>pS(n,t,e))}:function(t){t=j(t,EE);const n=j(t.firestore,XE);return GE(ZE(n),t._key).then(e=>pS(n,t,e))})(this._delegate)).then(e=>new PS(this.firestore,new rS(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new NS(this.firestore,e?this._delegate.withConverter(AS.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function RS(e,t,n){return e.message=e.message.replace(t,n),e}function xS(e){for(const t of e)if("object"==typeof t&&!IS(t))return t;return{}}function DS(e,t){let n;return{next:e=>{n.next&&n.next(t(e))},error:null==(e=(n=IS(e[0])?e[0]:IS(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)?void 0:e.bind(n),complete:null==(e=n.complete)?void 0:e.bind(n)}}class PS{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new NS(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return aS(this._delegate,e._delegate)}}class OS extends PS{data(e){e=this._delegate.data(e);return void 0===e&&N(),e}}class MS{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new kS(e)}where(e,t,n){try{return new MS(this.firestore,Bk(this._delegate,(r=n,i=t,s=Fk("where",e),jk._create(s,i,r))))}catch(e){throw RS(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,s}orderBy(e,t){try{return new MS(this.firestore,Bk(this._delegate,([n,r="asc"]=[e,t],i=r,s=Fk("orderBy",n),Wk._create(s,i))))}catch(e){throw RS(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r,i,s}limit(e){try{return new MS(this.firestore,Bk(this._delegate,(wE("limit",t=e),zk._create("limit",t,"F"))))}catch(e){throw RS(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new MS(this.firestore,Bk(this._delegate,(wE("limitToLast",t=e),zk._create("limitToLast",t,"L"))))}catch(e){throw RS(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new MS(this.firestore,Bk(this._delegate,([...t]=[...e],Gk._create("startAt",t,!0))))}catch(e){throw RS(e,"startAt()","Query.startAt()")}var t}startAfter(...e){try{return new MS(this.firestore,Bk(this._delegate,([...t]=[...e],Gk._create("startAfter",t,!1))))}catch(e){throw RS(e,"startAfter()","Query.startAfter()")}var t}endBefore(...e){try{return new MS(this.firestore,Bk(this._delegate,([...t]=[...e],Hk._create("endBefore",t,!1))))}catch(e){throw RS(e,"endBefore()","Query.endBefore()")}var t}endAt(...e){try{return new MS(this.firestore,Bk(this._delegate,([...t]=[...e],Hk._create("endAt",t,!0))))}catch(e){throw RS(e,"endAt()","Query.endAt()")}var t}isEqual(e){return RE(this._delegate,e._delegate)}get(e){let t;return(t=("cache"===(null==e?void 0:e.source)?function(t){t=j(t,kE);const n=j(t.firestore,XE),e=ZE(n),r=new oS(n);return function(e,t){const n=new Nv;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await LT(e,t,!0),i=new H0(t,r.Hi),s=i.Wu(r.documents),a=i.applyChanges(s,!1);n.resolve(a.snapshot)}catch(e){t=x0(e,`Failed to execute query '${t} against cache`);n.reject(t)}}(await jE(e),t,n)),n.promise}(e,t._query).then(e=>new sS(n,r,t,e))}:"server"===(null==e?void 0:e.source)?function(t){t=j(t,kE);const n=j(t.firestore,XE),e=ZE(n),r=new oS(n);return HE(e,t._query,{source:"server"}).then(e=>new sS(n,r,t,e))}:function(t){t=j(t,kE);const n=j(t.firestore,XE),e=ZE(n),r=new oS(n);return Uk(t._query),HE(e,t._query).then(e=>new sS(n,r,t,e))})(this._delegate)).then(e=>new FS(this.firestore,new sS(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=xS(e),e=DS(e,e=>new FS(this.firestore,new sS(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return uS(this._delegate,t,e)}withConverter(e){return new MS(this.firestore,e?this._delegate.withConverter(AS.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class LS{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new OS(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class FS{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new MS(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new OS(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new LS(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new OS(this._firestore,e))})}isEqual(e){return aS(this._delegate,e._delegate)}}class US extends MS{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new NS(this.firestore,e):null}doc(e){try{return void 0===e?new NS(this.firestore,AE(this._delegate)):new NS(this.firestore,AE(this._delegate,e))}catch(e){throw RS(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=j(e.firestore,XE),r=AE(e),i=eS(e.converter,t);return dS(n,[mk(gk(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,ow.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new NS(this.firestore,e))}isEqual(e){return NE(this._delegate,e._delegate)}withConverter(e){return new US(this.firestore,e?this._delegate.withConverter(AS.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function qS(e){return j(e,EE)}var _o={Firestore:ES,GeoPoint:ck,Timestamp:Bv,Blob:bS,Transaction:SS,WriteBatch:CS,DocumentReference:NS,DocumentSnapshot:PS,Query:MS,QueryDocumentSnapshot:OS,QuerySnapshot:FS,CollectionReference:US,FieldPath:class WR{constructor(...e){this._delegate=new ak(...e)}static documentId(){return new WR(Wv.keyField().canonicalString())}isEqual(e){return(e=_(e))instanceof ak&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class zR{constructor(e){this._delegate=e}static serverTimestamp(){const e=new _k("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new zR(e)}static delete(){const e=new vk("deleteField");return e._methodName="FieldValue.delete",new zR(e)}static arrayUnion(...e){[...e]=[...e];const t=new wk("arrayUnion",e);return t._methodName="FieldValue.arrayUnion",new zR(t)}static arrayRemove(...e){[...e]=[...e];const t=new bk("arrayRemove",e);return t._methodName="FieldValue.arrayRemove",new zR(t)}static increment(e){const t=new Ik("increment",e);return t._methodName="FieldValue.increment",new zR(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){Ev.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1},Wp=Vt,VS=(e,t)=>new ES(e,t,new TS);Wp.INTERNAL.registerComponent(new o("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("firestore").getImmediate();return VS(t,e)},"PUBLIC").setServiceProps(Object.assign({},_o))),Wp.registerVersion("@firebase/firestore-compat","0.3.0-20221206221533");const BS="type.googleapis.com/google.protobuf.Int64Value",jS="type.googleapis.com/google.protobuf.UInt64Value";function KS(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function WS(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case BS:case jS:var t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>WS(e)):"function"==typeof e||"object"==typeof e?KS(e,e=>WS(e)):e}const zS="functions",GS={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class HS extends ae{constructor(e,t,n){super(zS+"/"+e,t||""),this.details=n}}class $S{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{var e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return this.messaging.getToken()}catch(e){return}}async getAppCheckToken(){var e;return!this.appCheck||(e=await this.appCheck.getToken()).error?null:e.token}async getContext(){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken()}}}const QS="us-central1";class YS{constructor(e,t,n,r,i=QS,s){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new $S(t,n,r),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{var a=new URL(i);this.customDomain=a.origin,this.region=QS}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){var t=this.app.options.projectId;return null===this.emulatorOrigin?null!==this.customDomain?this.customDomain+"/"+e:`https://${this.region}-${t}.cloudfunctions.net/`+e:`${this.emulatorOrigin}/${t}/${this.region}/`+e}}async function JS(e,t,n,r){n={data:n=function t(e){if(null==e)return null;if("number"==typeof(e=e instanceof Number?e.valueOf():e)&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>t(e));if("function"==typeof e||"object"==typeof e)return KS(e,e=>t(e));throw new Error("Data cannot be encoded in JSON: "+e)}(n)};const i={};var s=await e.contextProvider.getContext();s.authToken&&(i.Authorization="Bearer "+s.authToken),s.messagingToken&&(i["Firebase-Instance-ID-Token"]=s.messagingToken),null!==s.appCheckToken&&(i["X-Firebase-AppCheck"]=s.appCheckToken);const a=function(n){let r=null;return{promise:new Promise((e,t)=>{r=setTimeout(()=>{t(new HS("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{r&&clearTimeout(r)}}}(r.timeout||7e4);if(s=await Promise.race([async function(e,t,n,r){n["Content-Type"]="application/json";let i;try{i=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(e){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(e){}return{status:i.status,json:s}}(t,n,i,e.fetchImpl),a.promise,e.cancelAllRequests]),a.cancel(),!s)throw new HS("cancelled","Firebase Functions instance was deleted.");if(n=function(e,t){let n=function(){if(200<=e&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(),r=n,i=void 0;try{var s=t&&t.error;if(s){const e=s.status;if("string"==typeof e){if(!GS[e])return new HS("internal","internal");n=GS[e],r=e}var a=s.message;"string"==typeof a&&(r=a),void 0!==(i=s.details)&&(i=WS(i))}}catch(e){}return"ok"===n?null:new HS(n,r,i)}(s.status,s.json))throw n;if(!s.json)throw new HS("internal","Response is not valid JSON object.");let o=s.json.data;if(void 0===(o=void 0===o?s.json.result:o))throw new HS("internal","Response is missing data field.");return{data:WS(o)}}var XS,ZS,eC,yf="@firebase/functions",vf="0.9.0-20221206221533";function tC(e,t,n){_(e).emulatorOrigin=`http://${t}:`+n}fv=fetch.bind(self),vt(new o(zS,(e,{instanceIdentifier:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("messaging-internal"),e=e.getProvider("app-check-internal");return new YS(n,r,i,e,t,fv)},"PUBLIC").setMultipleInstances(!0)),r(yf,vf,void 0),r(yf,vf,"esm2017");class nC{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return i=_(this._delegate),s=e,a=t,e=>{return t=e,n=a||{},r=(e=i)._url(s),JS(e,r,t,n);var t,n,r};var i,s,a}httpsCallableFromURL(e,t){return n=this._delegate,r=_(n),i=e,s=t,e=>JS(r,i,e,s||{});var n,r,i,s}useFunctionsEmulator(e){e=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(null==e)throw new ae("functions","No origin provided to useFunctionsEmulator()");if(null==e[2])throw new ae("functions","Port missing in origin provided to useFunctionsEmulator()");return tC(this._delegate,e[1],Number(e[2]))}useEmulator(e,t){return tC(this._delegate,e,t)}}t={Functions:nC},Vt.INTERNAL.registerComponent(new o("functions-compat",(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),e=e.getProvider("functions").getImmediate({identifier:null!=t?t:"us-central1"});return new nC(n,e)},"PUBLIC").setServiceProps(t).setMultipleInstances(!0)),Vt.registerVersion("@firebase/functions-compat","0.3.0-20221206221533");const rC="/firebase-messaging-sw.js",iC="/firebase-cloud-messaging-push-scope",sC="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",aC="https://fcmregistrations.googleapis.com/v1",oC="google.c.a.c_id",cC="google.c.a.e";function lC(e){e=new Uint8Array(e);const t=btoa(String.fromCharCode(...e));return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(ic=LN=LN||{})[ic.DATA_MESSAGE=1]="DATA_MESSAGE",ic[ic.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(ic=XS=XS||{}).PUSH_RECEIVED="push-received",ic.NOTIFICATION_CLICKED="notification-clicked";const uC="fcm_token_details_db",hC="fcm_token_object_Store";const dC="firebase-messaging-database",pC=1,fC="firebase-messaging-store";let gC=null;function mC(){return gC=gC||tt(dC,pC,{upgrade:(e,t)=>{0===t&&e.createObjectStore(fC)}})}async function vC(e){var t=_C(e);const n=await mC();return(t=await n.transaction(fC).objectStore(fC).get(t))?t:(t=await async function(a){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(uC))return null}let o=null;const e=await tt(uC,5,{upgrade:async(e,t,n,r)=>{if(!(t<2)&&e.objectStoreNames.contains(hC)){const s=r.objectStore(hC);var i,e=await s.index("fcmSenderId").get(a);await s.clear(),e&&(2===t?(i=e).auth&&i.p256dh&&i.endpoint&&(o={token:i.fcmToken,createTime:null!=(r=i.createTime)?r:Date.now(),subscriptionOptions:{auth:i.auth,p256dh:i.p256dh,endpoint:i.endpoint,swScope:i.swScope,vapidKey:"string"==typeof i.vapidKey?i.vapidKey:lC(i.vapidKey)}}):3===t?(i=e,o={token:i.fcmToken,createTime:i.createTime,subscriptionOptions:{auth:lC(i.auth),p256dh:lC(i.p256dh),endpoint:i.endpoint,swScope:i.swScope,vapidKey:lC(i.vapidKey)}}):4===t&&(o={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:lC(e.auth),p256dh:lC(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:lC(e.vapidKey)}}))}}});return e.close(),await nt(uC),await nt("fcm_vapid_details_db"),await nt("undefined"),function(e){var t;if(e&&e.subscriptionOptions)return t=e.subscriptionOptions,"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(o)?o:null}(e.appConfig.senderId))?(await yC(e,t),t):void 0}async function yC(e,t){e=_C(e);const n=await mC(),r=n.transaction(fC,"readwrite");return await r.objectStore(fC).put(t,e),await r.done,t}function _C({appConfig:e}){return e.appId}const wC=new oe("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function bC(e,t){var n={method:"DELETE",headers:await TC(e)};try{const s=await fetch(IC(e.appConfig)+"/"+t,n);var r,i=await s.json();if(i.error)throw r=i.error.message,wC.create("token-unsubscribe-failed",{errorInfo:r})}catch(e){throw wC.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function IC({projectId:e}){return aC+`/projects/${e}/registrations`}async function TC({appConfig:e,installations:t}){t=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":"FIS "+t})}function EC({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==sC&&(i.web.applicationPubKey=r),i}const kC=6048e5;async function SC(e){var t=await vC(e.firebaseDependencies);if(t){await bC(e.firebaseDependencies,t.token);{t=_C(t=e.firebaseDependencies);const r=await mC(),i=r.transaction(fC,"readwrite");await i.objectStore(fC).delete(t),await i.done}await 0}const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function CC(e,t){t={token:await async function(e,t){var n=await TC(e),t=EC(t),t={method:"POST",headers:n,body:JSON.stringify(t)};let r;try{const i=await fetch(IC(e.appConfig),t);r=await i.json()}catch(e){throw wC.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(r.error)throw t=r.error.message,wC.create("token-subscribe-failed",{errorInfo:t});if(r.token)return r.token;throw wC.create("token-subscribe-no-token")}(e,t),createTime:Date.now(),subscriptionOptions:t};return await yC(e,t),t.token}function AC(e){var t,n,r,i,s={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId},a=s;return(n=e).notification&&(a.notification={},(t=n.notification.title)&&(a.notification.title=t),(t=n.notification.body)&&(a.notification.body=t),(t=n.notification.image)&&(a.notification.image=t),(t=n.notification.icon)&&(a.notification.icon=t)),n=s,(a=e).data&&(n.data=a.data),a=s,(e.fcmOptions||null!=(r=e.notification)&&r.click_action)&&(a.fcmOptions={},(i=null!=(r=null==(r=e.fcmOptions)?void 0:r.link)?r:null==(i=e.notification)?void 0:i.click_action)&&(a.fcmOptions.link=i),(i=null==(i=e.fcmOptions)?void 0:i.analytics_label)&&(a.fcmOptions.analyticsLabel=i)),s}function NC(t,n){const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),e<n.length&&r.push(n.charAt(e));r.join("")}function RC(e){return wC.create("missing-app-config-values",{valueName:e})}NC("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),NC("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class xC{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw RC("App Configuration Object");if(!e.name)throw RC("App Name");var t=e.options;for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw RC(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function DC(e){try{e.swRegistration=await navigator.serviceWorker.register(rC,{scope:iC}),e.swRegistration.update().catch(()=>{})}catch(e){throw wC.create("failed-service-worker-registration",{browserErrorMessage:null==e?void 0:e.message})}}async function PC(e,t){if(!navigator)throw wC.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw wC.create("permission-blocked");var n=e,r=(await((r=null==t?void 0:t.vapidKey)?n.vapidKey=r:n.vapidKey||(n.vapidKey=sC)),e),n=null==t?void 0:t.serviceWorkerRegistration;if(n||r.swRegistration||await DC(r),n||!r.swRegistration){if(!(n instanceof ServiceWorkerRegistration))throw wC.create("invalid-sw-registration");r.swRegistration=n}return await 0,async function(e){o=e.swRegistration,r=e.vapidKey;const t=await(await o.pushManager.getSubscription()||o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(){var e=(r+"=".repeat((4-r.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}()}));var r,n,i,s,a,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:lC(t.getKey("auth")),p256dh:lC(t.getKey("p256dh"))},c=await vC(e.firebaseDependencies);if(c){if(a=c.subscriptionOptions,n=o.vapidKey===a.vapidKey,i=o.endpoint===a.endpoint,s=o.auth===a.auth,a=o.p256dh===a.p256dh,n&&i&&s&&a)return Date.now()>=c.createTime+kC?async function(e,t){try{var n=await async function(e,t){var n=await TC(e),r=EC(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(IC(e.appConfig)+"/"+t.token,r);i=await s.json()}catch(e){throw wC.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error)throw r=i.error.message,wC.create("token-update-failed",{errorInfo:r});if(i.token)return i.token;throw wC.create("token-update-no-token")}(e.firebaseDependencies,t),r=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return await yC(e.firebaseDependencies,r),n}catch(t){throw await SC(e),t}}(e,{token:c.token,createTime:Date.now(),subscriptionOptions:o}):c.token;try{await bC(e.firebaseDependencies,c.token)}catch(e){console.warn(e)}return CC(e.firebaseDependencies,o)}return CC(e.firebaseDependencies,o)}(e)}async function OC(e,t){var n,r=t.data;if(r.isFirebaseMessaging&&(e.onMessageHandler&&r.messageType===XS.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(AC(r)):e.onMessageHandler.next(AC(r))),n=r.data,"object"==typeof(t=n)&&t&&oC in t&&"1"===n[cC])){t=e;var i=r.messageType;e=n,r=function(){switch(i){case XS.NOTIFICATION_CLICKED:return"notification_open";case XS.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}();const s=await t.firebaseDependencies.analyticsProvider.get();s.logEvent(r,{message_id:e[oC],message_name:e["google.c.a.c_l"],message_time:e["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}}e="@firebase/messaging",$n="0.12.0-20221206221533";vt(new o("messaging",e=>{const t=new xC(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>OC(t,e)),t},"PUBLIC")),vt(new o("messaging-internal",e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>PC(t,e)}},"PRIVATE")),r(e,$n),r(e,$n,"esm2017");const MC="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",LC="https://fcmregistrations.googleapis.com/v1",FC="FCM_MSG",UC="google.c.a.c_id",qC=3,VC=1;function BC(e){e=new Uint8Array(e);const t=btoa(String.fromCharCode(...e));return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(ic=ZS=ZS||{})[ic.DATA_MESSAGE=1]="DATA_MESSAGE",ic[ic.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",Bt=eC={PUSH_RECEIVED:"push-received",NOTIFICATION_CLICKED:"notification-clicked"};const jC="fcm_token_details_db",KC="fcm_token_object_Store";const WC="firebase-messaging-database",zC=1,GC="firebase-messaging-store";let HC=null;function $C(){return HC=HC||tt(WC,zC,{upgrade:(e,t)=>{0===t&&e.createObjectStore(GC)}})}async function QC(e){var t=JC(e);const n=await $C();return(t=await n.transaction(GC).objectStore(GC).get(t))?t:(t=await async function(a){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(jC))return null}let o=null;const e=await tt(jC,5,{upgrade:async(e,t,n,r)=>{if(!(t<2)&&e.objectStoreNames.contains(KC)){const s=r.objectStore(KC);var i,e=await s.index("fcmSenderId").get(a);await s.clear(),e&&(2===t?(i=e).auth&&i.p256dh&&i.endpoint&&(o={token:i.fcmToken,createTime:null!=(r=i.createTime)?r:Date.now(),subscriptionOptions:{auth:i.auth,p256dh:i.p256dh,endpoint:i.endpoint,swScope:i.swScope,vapidKey:"string"==typeof i.vapidKey?i.vapidKey:BC(i.vapidKey)}}):3===t?(i=e,o={token:i.fcmToken,createTime:i.createTime,subscriptionOptions:{auth:BC(i.auth),p256dh:BC(i.p256dh),endpoint:i.endpoint,swScope:i.swScope,vapidKey:BC(i.vapidKey)}}):4===t&&(o={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:BC(e.auth),p256dh:BC(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:BC(e.vapidKey)}}))}}});return e.close(),await nt(jC),await nt("fcm_vapid_details_db"),await nt("undefined"),function(e){var t;if(e&&e.subscriptionOptions)return t=e.subscriptionOptions,"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(o)?o:null}(e.appConfig.senderId))?(await YC(e,t),t):void 0}async function YC(e,t){e=JC(e);const n=await $C(),r=n.transaction(GC,"readwrite");return await r.objectStore(GC).put(t,e),await r.done,t}function JC({appConfig:e}){return e.appId}const XC=new oe("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function ZC(e,t){var n={method:"DELETE",headers:await tA(e)};try{const s=await fetch(eA(e.appConfig)+"/"+t,n);var r,i=await s.json();if(i.error)throw r=i.error.message,XC.create("token-unsubscribe-failed",{errorInfo:r})}catch(e){throw XC.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function eA({projectId:e}){return LC+`/projects/${e}/registrations`}async function tA({appConfig:e,installations:t}){t=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":"FIS "+t})}function nA({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==MC&&(i.web.applicationPubKey=r),i}async function rA(e){var t=await QC(e.firebaseDependencies);if(t){await ZC(e.firebaseDependencies,t.token);{t=JC(t=e.firebaseDependencies);const r=await $C(),i=r.transaction(GC,"readwrite");await i.objectStore(GC).delete(t),await i.done}await 0}const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function iA(e,t){t={token:await async function(e,t){var n=await tA(e),t=nA(t),t={method:"POST",headers:n,body:JSON.stringify(t)};let r;try{const i=await fetch(eA(e.appConfig),t);r=await i.json()}catch(e){throw XC.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(r.error)throw t=r.error.message,XC.create("token-subscribe-failed",{errorInfo:t});if(r.token)return r.token;throw XC.create("token-subscribe-no-token")}(e,t),createTime:Date.now(),subscriptionOptions:t};return await YC(e,t),t.token}function sA(t,n){const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),e<n.length&&r.push(n.charAt(e));r.join("")}async function aA(e,t){var n=function({data:e}){if(!e)return null;try{return e.json()}catch(e){return null}}(e);if(n){t.deliveryMetricsExportedToBigQueryEnabled&&await async function(e,t){t=function(e,t){const n={};return e.from&&(n.project_number=e.from),e.fcmMessageId&&(n.message_id=e.fcmMessageId),n.instance_id=t,e.notification?n.message_type=ZS.DISPLAY_NOTIFICATION.toString():n.message_type=ZS.DATA_MESSAGE.toString(),n.sdk_platform=qC.toString(),n.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),e.collapse_key&&(n.collapse_key=e.collapse_key),n.event=VC.toString(),null!=(t=e.fcmOptions)&&t.analytics_label&&(n.analytics_label=null==(t=e.fcmOptions)?void 0:t.analytics_label),n}(t,await e.firebaseDependencies.installations.getId());{const n={};return n.event_time_ms=Math.floor(Date.now()).toString(),n.source_extension_json_proto3=JSON.stringify(t),void e.logEvents.push(n)}}(t,n);var r,i,s,a,o=await oA();if(o.some(e=>"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://"))){var c=o,l=n;l.isFirebaseMessaging=!0,l.messageType=eC.PUSH_RECEIVED;for(const u of c)u.postMessage(l)}else n.notification&&(c=function(e){const t=Object.assign({},e.notification);return t.data={[FC]:e},t}(n),r=c.actions,a=Notification.maxActions,r&&a&&r.length>a&&console.warn(`This browser only supports ${a} actions. The remaining actions will not be displayed.`),await self.registration.showNotification(null!=(a=c.title)?a:"",c)),t&&t.onBackgroundMessageHandler&&(o=a={from:(r=n).from,collapseKey:r.collapse_key,messageId:r.fcmMessageId},(e=r).notification&&(o.notification={},(n=e.notification.title)&&(o.notification.title=n),(n=e.notification.body)&&(o.notification.body=n),(n=e.notification.image)&&(o.notification.image=n),(n=e.notification.icon)&&(o.notification.icon=n)),e=a,(o=r).data&&(e.data=o.data),o=a,(r.fcmOptions||null!=(i=r.notification)&&i.click_action)&&(o.fcmOptions={},(s=null!=(i=null==(i=r.fcmOptions)?void 0:i.link)?i:null==(s=r.notification)?void 0:s.click_action)&&(o.fcmOptions.link=s),(s=null==(s=r.fcmOptions)?void 0:s.analytics_label)&&(o.fcmOptions.analyticsLabel=s)),"function"==typeof t.onBackgroundMessageHandler?await t.onBackgroundMessageHandler(a):t.onBackgroundMessageHandler.next(a))}}function oA(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function cA(e){return XC.create("missing-app-config-values",{valueName:e})}sA("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),sA("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class lA{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw cA("App Configuration Object");if(!e.name)throw cA("App Name");var t=e.options;for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw cA(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}var uA;vt(new o("messaging-sw",e=>{const t=new lA(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return self.addEventListener("push",e=>{e.waitUntil(aA(e,t))}),self.addEventListener("pushsubscriptionchange",e=>{e.waitUntil(async function(e,t){(e=e.newSubscription)?(e=await QC(t.firebaseDependencies),await rA(t),t.vapidKey=null!=(e=null==(e=null==e?void 0:e.subscriptionOptions)?void 0:e.vapidKey)?e:MC,await async function(e){o=e.swRegistration,r=e.vapidKey;const t=await(await o.pushManager.getSubscription()||o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(){var e=(r+"=".repeat((4-r.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}()}));var r,n,i,s,a,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:BC(t.getKey("auth")),p256dh:BC(t.getKey("p256dh"))},c=await QC(e.firebaseDependencies);if(c){if(a=c.subscriptionOptions,n=o.vapidKey===a.vapidKey,i=o.endpoint===a.endpoint,s=o.auth===a.auth,a=o.p256dh===a.p256dh,n&&i&&s&&a)return Date.now()>=c.createTime+6048e5?async function(e,t){try{var n=await async function(e,t){var n=await tA(e),r=nA(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(eA(e.appConfig)+"/"+t.token,r);i=await s.json()}catch(e){throw XC.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error)throw r=i.error.message,XC.create("token-update-failed",{errorInfo:r});if(i.token)return i.token;throw XC.create("token-update-no-token")}(e.firebaseDependencies,t),r=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return await YC(e.firebaseDependencies,r),n}catch(t){throw await rA(e),t}}(e,{token:c.token,createTime:Date.now(),subscriptionOptions:o}):c.token;try{await ZC(e.firebaseDependencies,c.token)}catch(e){console.warn(e)}return iA(e.firebaseDependencies,o)}return iA(e.firebaseDependencies,o)}(t)):await rA(t)}(e,t))}),self.addEventListener("notificationclick",e=>{e.waitUntil(async function(e){const t=null==(r=null==(n=e.notification)?void 0:n.data)?void 0:r[FC];if(t&&!e.action){e.stopImmediatePropagation(),e.notification.close();e=t;s=(s=null!=(i=null==(i=e.fcmOptions)?void 0:i.link)?i:null==(s=e.notification)?void 0:s.click_action)||("object"==typeof(i=e.data)&&i&&UC in i?self.location.origin:null);if(s){var n=new URL(s,self.location.href),r=new URL(self.location.origin);if(n.host===r.host){let e=await async function(e){for(const n of await oA()){var t=new URL(n.url,self.location.href);if(e.host===t.host)return n}return null}(n);if(e?e=await e.focus():(e=await self.clients.openWindow(s),await new Promise(e=>{setTimeout(e,3e3)})),e)return t.messageType=eC.NOTIFICATION_CLICKED,t.isFirebaseMessaging=!0,e.postMessage(t)}}}var i,s}(e))}),t},"PUBLIC"));class hA{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(t){return async function(e){return PC(_(e),t)}(this._delegate)}async deleteToken(){return async function(e){if(navigator)return e.swRegistration||await DC(e),SC(e);throw wC.create("only-available-in-window")}(_(this._delegate))}onMessage(e){var t=this._delegate,n=t=_(t);if(navigator)return n.onMessageHandler=e,()=>{n.onMessageHandler=null};throw wC.create("only-available-in-window")}onBackgroundMessage(e){var t=this._delegate,n=t=_(t),t=e;if(void 0!==self.document)throw XC.create("only-available-in-sw");return n.onBackgroundMessageHandler=t,()=>{n.onBackgroundMessageHandler=null}}}Hn={isSupported:function(){return self&&"ServiceWorkerGlobalScope"in self?J()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"undefined"!=typeof window&&J()&&Z()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}};Vt.INTERNAL.registerComponent(new o("messaging-compat",e=>self&&"ServiceWorkerGlobalScope"in self?new hA(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging-sw").getImmediate()):new hA(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging").getImmediate()),"PUBLIC").setServiceProps(Hn)),Vt.registerVersion("@firebase/messaging-compat","0.2.0-20221206221533");const dA="firebasestorage.googleapis.com",pA="storageBucket";class fA extends ae{constructor(e,t,n=0){super(gA(e),`Firebase Storage: ${t} (${gA(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,fA.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return gA(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=this._baseMessage+`
`+this.customData.serverResponse:this.message=this._baseMessage}}function gA(e){return"storage/"+e}function mA(){return new fA("unknown","An unknown error occurred, please check the error payload for server response.")}function vA(){return new fA("retry-limit-exceeded","Max retry time for operation exceeded, please try again.")}function yA(){return new fA("canceled","User canceled the upload/download.")}function _A(){return new fA("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function wA(e){return new fA("invalid-argument",e)}function bA(){return new fA("app-deleted","The Firebase app was deleted.")}function IA(e){return new fA("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function TA(e,t){return new fA("invalid-format","String does not match format '"+e+"': "+t)}function EA(e){throw new fA("internal-error","Internal error: "+e)}class kA{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=kA.makeFromUrl(e,t)}catch(t){return new kA(e,"")}if(""===n.path)return n;throw new fA("invalid-default-bucket","Invalid default bucket '"+e+"'.")}static makeFromUrl(t,e){let n=null;var r="([A-Za-z0-9.\\-_]+)",i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}var a=e.replace(/[.]/g,"\\."),o=new RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),a=e===dA?"(?:storage.googleapis.com|storage.cloud.google.com)":e,c=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:o,indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${a}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let e=0;e<c.length;e++){const h=c[e];var l=h.regex.exec(t);if(l){var u=l[h.indices.bucket],l=l[h.indices.path]||"";n=new kA(u,l),h.postModify(n);break}}if(null==n)throw e=t,new fA("invalid-url","Invalid URL '"+e+"'.");return n}}class SA{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=0){}}function CA(e){return"string"==typeof e||e instanceof String}function AA(e){return NA()&&e instanceof Blob}function NA(){return"undefined"!=typeof Blob&&!G()}function RA(e,t,n,r){if(r<t)throw wA(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n<r)throw wA(`Invalid value for '${e}'. Expected ${n} or less.`)}function xA(e,t,n){return n+`://${null==n?"https://"+t:t}/v0`+e}function DA(e){const t=encodeURIComponent;let n="?";for(const i in e){var r;e.hasOwnProperty(i)&&(r=t(i)+"="+t(e[i]),n=n+r+"&")}return n=n.slice(0,-1)}function PA(e,t){var n=500<=e&&e<600,r=-1!==[408,429].indexOf(e),t=-1!==t.indexOf(e);return n||r||t}Bt=uA={NO_ERROR:0,0:"NO_ERROR",NETWORK_ERROR:1,1:"NETWORK_ERROR",ABORT:2,2:"ABORT"};class OA{constructor(e,t,n,r,i,s,a,o,c,l,u,h=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=u,this.retry=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){var e=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{var s=this.callback_(i,i.getResponse());void 0!==s?n(s):n()}catch(e){r(e)}else if(null!==i){const a=mA();a.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,a)):r(a)}else{s=(t.canceled?this.appDelete_?bA:yA:vA)();r(s)}};this.canceled_?e(0,new MA(!1,null,!0)):this.backoffId_=function(t,n,e){let r=1,i=null,s=null,a=!1,o=0;function c(){return 2===o}let l=!1;function u(...e){l||(l=!0,n.apply(null,e))}function h(e){i=setTimeout(()=>{i=null,t(p,c())},e)}function d(){s&&clearTimeout(s)}function p(e,...t){{if(!l)return e||c()||a?(d(),void u.call(null,e,...t)):(r<64&&(r*=2),void h(1===o?(o=2,0):1e3*(r+Math.random())));d()}}let f=!1;function g(e){f||(f=!0,d(),l||(null!==i?(e||(o=2),clearTimeout(i),h(0)):e||(o=1)))}return h(0),s=setTimeout(()=>{g(a=!0)},e),g}((r,e)=>{if(e)r(!1,new MA(!1,null,!0));else{const i=this.connectionFactory_(),s=(this.pendingConnection_=i,e=>{var t=e.loaded,e=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,e)});null!==this.progressCallback_&&i.addUploadProgressListener(s),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&i.removeUploadProgressListener(s),this.pendingConnection_=null;var e,t=i.getErrorCode()===uA.NO_ERROR,n=i.getStatus();t&&!PA(n,this.additionalRetryCodes_)||!this.retry?(e=-1!==this.successCodes_.indexOf(n),r(!0,new MA(e,i))):(e=i.getErrorCode()===uA.ABORT,r(!1,new MA(!1,null,e)))})}},e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class MA{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}const LA={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class FA{constructor(e,t){this.data=e,this.contentType=t||null}}function UA(e,t){switch(e){case LA.RAW:return new FA(qA(t));case LA.BASE64:case LA.BASE64URL:return new FA(VA(e,t));case LA.DATA_URL:return new FA((n=t,(r=new BA(n)).base64?VA(LA.BASE64,r.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw TA(LA.DATA_URL,"Malformed data URL.")}return qA(t)}(r.rest)),(n=t,new BA(n).contentType))}var n,r;throw mA()}function qA(n){const r=[];for(let t=0;t<n.length;t++){let e=n.charCodeAt(t);var i,s;e<=127?r.push(e):e<=2047?r.push(192|e>>6,128|63&e):55296==(64512&e)?t<n.length-1&&56320==(64512&n.charCodeAt(t+1))?(i=e,s=n.charCodeAt(++t),e=65536|(1023&i)<<10|1023&s,r.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e)):r.push(239,191,189):56320==(64512&e)?r.push(239,191,189):r.push(224|e>>12,128|e>>6&63,128|63&e)}return new Uint8Array(r)}function VA(e,t){switch(e){case LA.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw TA(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case LA.BASE64URL:if(r=-1!==t.indexOf("+"),n=-1!==t.indexOf("/"),r||n)throw TA(e,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}let i;try{i=function(e){if("undefined"==typeof atob)throw new fA("unsupported-environment","base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw TA(e,"Invalid character found")}const s=new Uint8Array(i.length);for(let e=0;e<i.length;e++)s[e]=i.charCodeAt(e);return s}class BA{constructor(e){this.base64=!1,this.contentType=null;var t,n=e.match(/^data:([^,]+)?,/);if(null===n)throw TA(LA.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;null!=r&&(this.base64=(n=r).length>=(t=";base64").length&&n.substring(n.length-t.length)===t,this.contentType=this.base64?r.substring(0,r.length-";base64".length):r),this.rest=e.substring(e.indexOf(",")+1)}}class jA{constructor(e,t){let n=0,r="";AA(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(AA(this.data_))return r=e,i=t,null===(s=(n=s=this.data_).webkitSlice?n.webkitSlice(r,i):n.mozSlice?n.mozSlice(r,i):n.slice?n.slice(r,i):null)?null:new jA(s);var n,r,i,s=new Uint8Array(this.data_.buffer,e,t-e);return new jA(s,!0)}static getBlob(...e){var t;if(NA())return t=e.map(e=>e instanceof jA?e.data_:e),new jA(function(...t){const e="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==e){const n=new e;for(let e=0;e<t.length;e++)n.append(t[e]);return n.getBlob()}if(NA())return new Blob(t);throw new fA("unsupported-environment","This browser doesn't seem to support creating Blobs")}.apply(null,t));{const r=e.map(e=>CA(e)?UA(LA.RAW,e).data:e.data_);let t=0;r.forEach(e=>{t+=e.byteLength});const i=new Uint8Array(t);let n=0;return r.forEach(t=>{for(let e=0;e<t.length;e++)i[n++]=t[e]}),new jA(i,!0)}}uploadData(){return this.data_}}function KA(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(e=t)||Array.isArray(e)?null:t}function WA(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function zA(e,t){return t}class GA{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||zA}}let HA=null;function $A(){if(HA)return HA;const e=[],t=(e.push(new GA("bucket")),e.push(new GA("generation")),e.push(new GA("metageneration")),e.push(new GA("name","fullPath",!0)),new GA("name")),n=(t.xform=function(e,t){return!CA(t)||t.length<2?t:WA(t)},e.push(t),new GA("size"));return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new GA("timeCreated")),e.push(new GA("updated")),e.push(new GA("md5Hash",null,!0)),e.push(new GA("cacheControl",null,!0)),e.push(new GA("contentDisposition",null,!0)),e.push(new GA("contentEncoding",null,!0)),e.push(new GA("contentLanguage",null,!0)),e.push(new GA("contentType",null,!0)),e.push(new GA("metadata","customMetadata",!0)),HA=e}function QA(e,t,n){t=KA(t);if(null===t)return null;{var r=t,i=n;const c={type:"file"};var s,a,o=i.length;for(let e=0;e<o;e++){const l=i[e];c[l.local]=l.xform(c,r[l.server])}return s=c,a=e,Object.defineProperty(s,"ref",{get:function(){var e=s.bucket,t=s.fullPath,t=new kA(e,t);return a._makeStorageReference(t)}}),c}}function YA(t,n){const r={};var i=n.length;for(let e=0;e<i;e++){var s=n[e];s.writable&&(r[s.server]=t[s.local])}return JSON.stringify(r)}const JA="prefixes";class XA{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function ZA(e){if(!e)throw mA()}function eN(n,r){return function(e,t){t=QA(n,t,r);return ZA(null!==t),t}}function tN(n,r){return function(e,t){t=function(e,t,n){if(null===(n=KA(n)))return null;{var r=e,i=t,e=n;const o={prefixes:[],items:[],nextPageToken:e.nextPageToken};if(e[JA])for(const c of e[JA]){var s=c.replace(/\/$/,""),s=r._makeStorageReference(new kA(i,s));o.prefixes.push(s)}if(e.items)for(const l of e.items){var a=r._makeStorageReference(new kA(i,l.name));o.items.push(a)}return o}}(n,r,t);return ZA(null!==t),t}}function nN(l,u){return function(e,t){var n=QA(l,t,u);ZA(null!==n);{var r=n,i=l.host,s=l._protocol;if(null===(n=KA(t)))return null;if(!CA(n.downloadTokens))return null;const a=n.downloadTokens;if(0===a.length)return null;const o=encodeURIComponent,c=a.split(",");return c.map(e=>{var t=r.bucket,n=r.fullPath;return xA("/b/"+o(t)+"/o/"+o(n),i,s)+DA({alt:"media",token:e})})[0]}}}function rN(i){return function(e,t){let n;var r;return(n=401===e.getStatus()?e.getErrorText().includes("Firebase App Check token is invalid")?new fA("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new fA("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(r=i.bucket,new fA("quota-exceeded","Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(r=i.path,new fA("unauthorized","User does not have permission to access '"+r+"'.")):t).status=e.getStatus(),n.serverResponse=t.serverResponse,n}}function iN(r){const i=rN(r);return function(e,t){let n=i(e,t);return(n=404===e.getStatus()?(e=r.path,new fA("object-not-found","Object '"+e+"' does not exist.")):n).serverResponse=t.serverResponse,n}}function sN(e,t,n){var r=xA(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new XA(r,"GET",eN(e,n),i);return s.errorHandler=iN(t),s}function aN(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=(e=t,(t=null)&&t.contentType||e&&e.type()||"application/octet-stream")),r}class oN{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function cN(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){ZA(!1)}const r=t||["active"];return ZA(!!n&&-1!==r.indexOf(n)),n}const lN={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function uN(e){switch(e){case"running":case"pausing":case"canceling":return lN.RUNNING;case"paused":return lN.PAUSED;case"success":return lN.SUCCESS;case"canceled":return lN.CANCELED;default:return lN.ERROR}}class hN{constructor(e,t,n){"function"==typeof e||null!=t||null!=n?(this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0):(this.next=(t=e).next,this.error=t.error,this.complete=t.complete)}}function dN(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class pN extends class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=uA.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=uA.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=uA.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r){if(this.sent_)throw EA("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(this.sent_)return this.errorCode_;throw EA("cannot .getErrorCode() before sending")}getStatus(){if(!this.sent_)throw EA("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(this.sent_)return this.xhr_.response;throw EA("cannot .getResponse() before sending")}getErrorText(){if(this.sent_)return this.xhr_.statusText;throw EA("cannot .getErrorText() before sending")}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}{initXhr(){this.xhr_.responseType="text"}}function fN(){return new pN}class gN{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=$A(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{if(this._request=void 0,this._chunkMultiplier=1,e._codeEquals("canceled"))this._needToFetchStatus=!0,this.completeTransitions_();else{var t=this.isExponentialBackoffExpired();if(PA(e.status,[])){if(!t)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();e=vA()}this._error=e,this._transition("error")}},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals("canceled")?this.completeTransitions_():(this._error=e,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(e){return 262144<e.size()}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(n){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([e,t])=>{switch(this._state){case"running":n(e,t);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{var n=function(e,t,n,r,i){var s=t.bucketOnlyServerUrl(),a={name:(i=aN(t,r,i)).fullPath},o=xA(s,e.host,e._protocol),r={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":""+r.size(),"X-Goog-Upload-Header-Content-Type":i.contentType,"Content-Type":"application/json; charset=utf-8"},s=YA(i,n),i=e.maxUploadRetryTime;const c=new XA(o,"POST",function(e){cN(e);let t;try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){ZA(!1)}return ZA(CA(t)),t},i);return c.urlParams=a,c.headers=r,c.body=s,c.errorHandler=rN(t),c}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,fN,e,t);(this._request=r).getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const i=this._uploadUrl;this._resolveToken((e,t)=>{var n=function(e,t,n,i){e=e.maxUploadRetryTime;const r=new XA(n,"POST",function(e){var t=cN(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){ZA(!1)}n||ZA(!1);var r=Number(n);return ZA(!isNaN(r)),new oN(r,i.size(),"final"===t)},e);return r.headers={"X-Goog-Upload-Command":"query"},r.errorHandler=rN(t),r}(this._ref.storage,this._ref._location,i,this._blob);const r=this._ref.storage._makeRequest(n,fN,e,t);(this._request=r).getPromise().then(e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const i=262144*this._chunkMultiplier,s=new oN(this._transferred,this._blob.size()),a=this._uploadUrl;this._resolveToken((e,t)=>{let n;try{n=function(e,s,t,a,n,o,r,i){const c=new oN(0,0);if(r?(c.current=r.current,c.total=r.total):(c.current=0,c.total=a.size()),a.size()!==c.total)throw new fA("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");let l=r=c.total-c.current;0<n&&(l=Math.min(l,n));var u=(n=c.current)+l,r={"X-Goog-Upload-Command":0===l?"finalize":r===l?"upload, finalize":"upload","X-Goog-Upload-Offset":""+c.current};const h=a.slice(n,u);if(null===h)throw _A();u=s.maxUploadRetryTime;const d=new XA(t,"POST",function(e,t){var n=cN(e,["active","final"]),r=c.current+l,i=a.size(),e="final"===n?eN(s,o)(e,t):null;return new oN(r,i,"final"===n,e)},u);return d.headers=r,d.body=h.uploadData(),d.progressCallback=i||null,d.errorHandler=rN(e),d}(this._ref._location,this._ref.storage,a,this._blob,i,this._mappings,s,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const r=this._ref.storage._makeRequest(n,fN,e,t,!1);(this._request=r).getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){262144*this._chunkMultiplier*2<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{var n=sN(this._ref.storage,this._ref._location,this._mappings);const r=this._ref.storage._makeRequest(n,fN,e,t);(this._request=r).getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{var n=function(e,t,n,r,i){var s=t.bucketOnlyServerUrl();const a={"X-Goog-Upload-Protocol":"multipart"};var o=function(){let t="";for(let e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}(),i=(a["Content-Type"]="multipart/related; boundary="+o,aN(t,r,i)),c="--"+o+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+YA(i,n)+"\r\n--"+o+"\r\nContent-Type: "+i.contentType+"\r\n\r\n",o="\r\n--"+o+"--";const l=jA.getBlob(c,r,o);if(null===l)throw _A();o={name:i.fullPath},i=xA(s,e.host,e._protocol),s=e.maxUploadRetryTime;const u=new XA(i,"POST",eN(e,n),s);return u.urlParams=o,u.headers=a,u.body=l.uploadData(),u.errorHandler=rN(t),u}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,fN,e,t);(this._request=r).getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){var t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":var t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=yA(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){var e=uN(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new hN(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){e=this._observers.indexOf(e);-1!==e&&this._observers.splice(e,1)}_notifyObservers(){this._finishPromise();const e=this._observers.slice();e.forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(uN(this._state)){case lN.SUCCESS:dN(this._resolve.bind(null,this.snapshot))();break;case lN.CANCELED:case lN.ERROR:const t=this._reject;dN(t.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(uN(this._state)){case lN.RUNNING:case lN.PAUSED:e.next&&dN(e.next.bind(e,this.snapshot))();break;case lN.SUCCESS:e.complete&&dN(e.complete.bind(e))();break;case lN.CANCELED:case lN.ERROR:default:e.error&&dN(e.error.bind(e,this._error))()}}resume(){var e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){var e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){var e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class mN{constructor(e,t){this._service=e,t instanceof kA?this._location=t:this._location=kA.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new mN(e,t)}get root(){var e=new kA(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return WA(this._location.path)}get storage(){return this._service}get parent(){var e=function(e){if(0===e.length)return null;var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);return null===e?null:(e=new kA(this._location.bucket,e),new mN(this._service,e))}_throwIfRoot(e){if(""===this._location.path)throw IA(e)}}function vN(e,t){null!=t&&"number"==typeof t.maxResults&&RA("options.maxResults",1,1e3,t.maxResults);t=function(e,t,n,r){const i={};t.isRoot?i.prefix="":i.prefix=t.path+"/",0<"/".length&&(i.delimiter="/"),n&&(i.pageToken=n),r&&(i.maxResults=r);n=xA(t.bucketOnlyServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime;const s=new XA(n,"GET",tN(e,t.bucket),r);return s.urlParams=i,s.errorHandler=rN(t),s}(e.storage,e._location,(t=t||{}).pageToken,t.maxResults);return e.storage.makeRequestWithTokens(t,fN)}function yN(e,t){n=e._location.path,t=t.split("/").filter(e=>0<e.length).join("/");var n,t=0===n.length?t:n+"/"+t,t=new kA(e._location.bucket,t);return new mN(e.storage,t)}function _N(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof bN)return n=e,r=t,new mN(n,r);throw wA("To use ref(service, url), the first argument must be a Storage instance.")}return function e(t,n){if(t instanceof bN){var r=t;if(null==r._bucket)throw new fA("no-default-bucket","No default bucket found. Did you set the '"+pA+"' property when initializing the app?");return r=new mN(r,r._bucket),null!=n?e(r,n):r}return void 0!==n?yN(t,n):t}(e,t);var n,r}function wN(e,t){t=null==t?void 0:t[pA];return null==t?null:kA.makeFromBucketSpec(t,e)}class bN{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=dA,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?kA.makeFromBucketSpec(r,this._host):wN(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=kA.makeFromBucketSpec(this._url,e):this._bucket=wN(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){RA("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){RA("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){var t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new mN(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new SA(bA());{[s,a,o,e,n,r,t=!0]=[e,this._appId,n,r,t,this._firebaseVersion,i],c=DA(s.urlParams),l=s.url+c,i=c=Object.assign({},s.headers),a&&(i["X-Firebase-GMPID"]=a),a=c,null!==o&&0<o.length&&(a.Authorization="Firebase "+o),c["X-Firebase-Storage-Version"]="webjs/"+(null!=r?r:"AppManager"),r=c,null!==e&&(r["X-Firebase-AppCheck"]=e);const u=new OA(l,s.method,c,s.body,s.successCodes,s.additionalRetryCodes,s.handler,s.errorHandler,s.timeout,s.progressCallback,n,t);return this._requests.add(u),u.getPromise().then(()=>this._requests.delete(u),()=>this._requests.delete(u)),u}var s,a,o,c,l}async makeRequestWithTokens(e,t){var[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}_o="@firebase/storage",Wp="0.10.0-20221206221533";function IN(e,t){return _N(e=_(e),t)}vt(new o("storage",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),e=e.getProvider("app-check-internal");return new bN(n,r,e,t,bt)},"PUBLIC").setMultipleInstances(!0)),r(_o,Wp,""),r(_o,Wp,"esm2017");class TN{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class EN{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new TN(this._delegate.snapshot,this,this._ref)}then(t,e){return this._delegate.then(e=>{if(t)return t(new TN(e,this,this._ref))},e)}on(e,t,n,r){let i=void 0;return t&&(i="function"==typeof t?e=>t(new TN(e,this,this._ref)):{next:t.next?e=>t.next(new TN(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)}}class kN{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new SN(e,this._service))}get items(){return this._delegate.items.map(e=>new SN(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class SN{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){e=yN(this._delegate,e);return new SN(e,this.storage)}get root(){return new SN(this._delegate.root,this.storage)}get parent(){var e=this._delegate.parent;return null==e?null:new SN(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new EN((n=this._delegate,e=e,t=t,(n=_(n))._throwIfRoot("uploadBytesResumable"),new gN(n,new jA(e),t)),this);var n}putString(e,t=LA.RAW,n){this._throwIfRoot("putString");t=UA(t,e);const r=Object.assign({},n);return null==r.contentType&&null!=t.contentType&&(r.contentType=t.contentType),new EN(new gN(this._delegate,new jA(t.data,!0),r),this)}listAll(){return function(e){const t={prefixes:[],items:[]};return async function e(t,n,r){r=await vN(t,{pageToken:r});n.prefixes.push(...r.prefixes),n.items.push(...r.items),null!=r.nextPageToken&&await e(t,n,r.nextPageToken)}(e,t).then(()=>t)}(_(this._delegate)).then(e=>new kN(e,this.storage))}list(e){return vN(_(this._delegate),e=e||void 0).then(e=>new kN(e,this.storage))}getMetadata(){return(e=e=_(e=this._delegate))._throwIfRoot("getMetadata"),t=sN(e.storage,e._location,$A()),e.storage.makeRequestWithTokens(t,fN);var e,t}updateMetadata(e){return t=_(this._delegate),e=e,t._throwIfRoot("updateMetadata"),e=function(e,t,n,r){var i=xA(t.fullServerUrl(),e.host,e._protocol),n=YA(n,r),s=e.maxOperationRetryTime;const a=new XA(i,"PATCH",eN(e,r),s);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=n,a.errorHandler=iN(t),a}(t.storage,t._location,e,$A()),t.storage.makeRequestWithTokens(e,fN);var t}getDownloadURL(){return(e=_(this._delegate))._throwIfRoot("getDownloadURL"),t=function(e,t,n){var r=xA(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new XA(r,"GET",nN(e,n),i);return s.errorHandler=iN(t),s}(e.storage,e._location,$A()),e.storage.makeRequestWithTokens(t,fN).then(e=>{if(null===e)throw new fA("no-download-url","The given file does not have any download URLs.");return e});var e,t}delete(){return this._throwIfRoot("delete"),(e=_(this._delegate))._throwIfRoot("deleteObject"),t=function(e,t){var n=xA(t.fullServerUrl(),e.host,e._protocol),e=e.maxOperationRetryTime;const r=new XA(n,"DELETE",function(e,t){},e);return r.successCodes=[200,204],r.errorHandler=iN(t),r}(e.storage,e._location),e.storage.makeRequestWithTokens(t,fN);var e,t}_throwIfRoot(e){if(""===this._delegate._location.path)throw IA(e)}}class CN{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(AN(e))throw wA("ref() expected a child path but got a URL, use refFromURL instead.");return new SN(IN(this._delegate,e),this)}refFromURL(e){if(!AN(e))throw wA("refFromURL() expected a full URL but got a child path, use ref() instead.");try{kA.makeFromUrl(e,this._delegate.host)}catch(e){throw wA("refFromUrl() expected a valid full URL but got an invalid one.")}return new SN(IN(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,n={}){var[e,t,n,r={}]=[this._delegate,e,t,n],[e,t,n,r={}]=[e,t,n,r];e.host=t+":"+n,e._protocol="http",(t=r.mockUserToken)&&(e._overrideAuthToken="string"==typeof t?t:se(t,e.app.options.projectId))}}function AN(e){return/^[A-Za-z]+:\/\//.test(e)}yf=Vt,vf={TaskState:lN,TaskEvent:{STATE_CHANGED:"state_changed"},StringFormat:LA,Storage:CN,Reference:SN},yf.INTERNAL.registerComponent(new o("storage-compat",function(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),e=e.getProvider("storage").getImmediate({identifier:t});return new CN(n,e)},"PUBLIC").setServiceProps(vf).setMultipleInstances(!0)),yf.registerVersion("@firebase/storage-compat","0.2.0-20221206221533");const NN="@firebase/performance",RN="0.6.0-20221206221533",xN=RN,DN="FB-PERF-TRACE-MEASURE",PN="@firebase/performance/config",ON="@firebase/performance/configexpire";var MN,LN="Performance";const FN=new oe("performance",LN,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),UN=new je(LN);UN.logLevel=h.INFO;let qN,VN;class BN{constructor(e){if(!(this.window=e))throw FN.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&Z()?!!J()||(UN.info("IndexedDB is not supported by current browswer"),!1):(UN.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,n){if(this.PerformanceObserver){const t=new this.PerformanceObserver(e=>{for(const t of e.getEntries())n(t)});t.observe({entryTypes:[e]})}}static getInstance(){return qN=void 0===qN?new BN(VN):qN}}let jN;function KN(t,n){var e=t.length-n.length;if(e<0||1<e)throw FN.create("invalid String merger input");const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),n.length>e&&r.push(n.charAt(e));return r.join("")}let WN;class zN{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=KN("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=KN("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return WN=void 0===WN?new zN:WN}}Bt=MN={UNKNOWN:0,0:"UNKNOWN",VISIBLE:1,1:"VISIBLE",HIDDEN:2,2:"HIDDEN"};const GN=["firebase_","google_","ga_"],HN=new RegExp("^[a-zA-Z]\\w*$");function $N(){switch(BN.getInstance().document.visibilityState){case"visible":return MN.VISIBLE;case"hidden":return MN.HIDDEN;default:return MN.UNKNOWN}}function QN(e){e=null==(e=e.options)?void 0:e.appId;if(e)return e;throw FN.create("no app id")}const YN="0.0.1",JN={loggingEnabled:!0},XN="FIREBASE_INSTALLATIONS_AUTH";function ZN(t,e){var r,i,n=function(){const e=BN.getInstance().localStorage;if(e){var t=e.getItem(ON);if(t&&Number(t)>Date.now()&&(t=e.getItem(PN)))try{return JSON.parse(t)}catch(e){return}}}();return n?(tR(n),Promise.resolve()):(i=e,function(){const e=(r=t).installations.getToken();return e.then(e=>{}),e}().then(e=>{var t=function(){var e=null==(e=r.app.options)?void 0:e.projectId;if(e)return e;throw FN.create("no project id")}(),n=function(){var e=null==(e=r.app.options)?void 0:e.apiKey;if(e)return e;throw FN.create("no api key")}(),n=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${t}/namespaces/fireperf:fetch?key=`+n,{method:"POST",headers:{Authorization:XN+" "+e},body:JSON.stringify({app_instance_id:i,app_instance_id_token:e,app_id:QN(r.app),app_version:xN,sdk_version:YN})});return fetch(n).then(e=>{if(e.ok)return e.json();throw FN.create("RC response not ok")})}).catch(()=>{UN.info(eR)}).then(tR).then(e=>{{const t=BN.getInstance().localStorage;return void(e&&t&&(t.setItem(PN,JSON.stringify(e)),t.setItem(ON,String(Date.now()+60*zN.getInstance().configTimeToLive*60*1e3))))}},()=>{}))}const eR="Could not fetch config, will use default configs";function tR(e){if(!e)return e;const t=zN.getInstance();var n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=JN.loggingEnabled,n.fpr_log_source?t.logSource=Number(n.fpr_log_source):JN.logSource&&(t.logSource=JN.logSource),n.fpr_log_endpoint_url?t.logEndPointUrl=n.fpr_log_endpoint_url:JN.logEndPointUrl&&(t.logEndPointUrl=JN.logEndPointUrl),n.fpr_log_transport_key?t.transportKey=n.fpr_log_transport_key:JN.transportKey&&(t.transportKey=JN.transportKey),void 0!==n.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate):void 0!==JN.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=JN.networkRequestsSamplingRate),void 0!==n.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate):void 0!==JN.tracesSamplingRate&&(t.tracesSamplingRate=JN.tracesSamplingRate),t.logTraceAfterSampling=nR(t.tracesSamplingRate),t.logNetworkAfterSampling=nR(t.networkRequestsSamplingRate),e}function nR(e){return Math.random()<=e}let rR=1,iR;function sR(e){var t;return rR=2,iR=iR||(t=e,function(){const n=BN.getInstance().document;return new Promise(e=>{if(n&&"complete"!==n.readyState){const t=()=>{"complete"===n.readyState&&(n.removeEventListener("readystatechange",t),e())};n.addEventListener("readystatechange",t)}else e()})}().then(()=>{{const e=t.installations.getId();return e.then(e=>{jN=e}),e}}).then(e=>ZN(t,e)).then(()=>aR(),()=>aR()))}function aR(){rR=3}let oR=3,cR=[],lR=!1;function uR(e){setTimeout(()=>{if(0!==oR)if(cR.length){const n=cR.splice(0,1e3),i=n.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})),s={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:zN.getInstance().logSource,log_event:i};var e,r,t;e=s,r=n,e=s,t=zN.getInstance().getFlTransportFullUrl(),fetch(t,{method:"POST",body:JSON.stringify(e)}).then(e=>(e.ok||UN.info("Call to Firebase backend failed."),e.json())).then(e=>{var t=Number(e.nextRequestWaitMillis);let n=1e4;isNaN(t)||(n=Math.max(t,n)),t=e.logResponseDetails,Array.isArray(t)&&0<t.length&&"RETRY_REQUEST_LATER"===t[0].responseAction&&(cR=[...r,...cR],UN.info("Retry transport request later.")),oR=3,uR(n)}).catch(()=>{cR=[...n,...cR],oR--,UN.info(`Tries left: ${oR}.`),uR(1e4)});return}else return uR(1e4)},e)}let hR;function dR(e,t){var n;(hR=hR||(n=gR,(...e)=>{e={message:n(...e),eventTime:Date.now()};if(!e.eventTime||!e.message)throw FN.create("invalid cc log");cR=[...cR,e]}))(e,t)}function pR(e){var t=zN.getInstance();!t.instrumentationEnabled&&e.isAuto||!t.dataCollectionEnabled&&!e.isAuto||!BN.getInstance().requiredApisAvailable()||e.isAuto&&$N()!==MN.VISIBLE||(3===rR?fR(e):sR(e.performanceController).then(()=>fR(e),()=>fR(e)))}function fR(e){var t;jN&&(t=zN.getInstance()).loggingEnabled&&t.logTraceAfterSampling&&setTimeout(()=>dR(e,1),0)}function gR(e,t){if(0===t)return t={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},t={application_info:mR(e.performanceController.app),network_request_metric:t},JSON.stringify(t);{t=e;const n={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(n.counters=t.counters);e=t.getAttributes();return 0!==Object.keys(e).length&&(n.custom_attributes=e),e={application_info:mR(t.performanceController.app),trace_metric:n},JSON.stringify(e)}}function mR(e){return{google_app_id:QN(e),app_instance_id:jN,web_app_info:{sdk_version:xN,page_url:BN.getInstance().getUrl(),service_worker_status:null!=(e=BN.getInstance().navigator)&&e.serviceWorker?e.serviceWorker.controller?2:3:1,visibility_state:$N(),effective_connection_type:function(){var e=BN.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0}}const vR=["_fp","_fcp","_fid"];class yR{constructor(e,t,n=!1,r){this.performanceController=e,this.name=t,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=BN.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-`+this.name,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-`+this.name,this.traceMeasure=r||`${DN}-${this.randomId}-`+this.name,r&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw FN.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw FN.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),pR(this)}record(e,t,n){if(e<=0)throw FN.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw FN.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object.assign({},n.attributes)),n&&n.metrics)for(const r of Object.keys(n.metrics))isNaN(Number(n.metrics[r]))||(this.counters[r]=Math.floor(Number(n.metrics[r])));pR(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(r=this.name,0===(n=e).length||100<n.length||!(r&&r.startsWith("_wt_")&&-1<vR.indexOf(n))&&n.startsWith("_"))throw FN.create("invalid custom metric name",{customMetricName:e});var n,r;this.counters[e]=(t=null!=t?t:0,(r=Math.floor(t))<t&&UN.info(`Metric value should be an Integer, setting the value as : ${r}.`),r)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){var n,r=!(0===(n=e).length||40<n.length||GN.some(e=>n.startsWith(e))||!n.match(HN)),i=0!==t.length&&t.length<=100;if(r&&i)this.customAttributes[e]=t;else{if(!r)throw FN.create("invalid attribute name",{attributeName:e});if(!i)throw FN.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){var e=this.api.getEntriesByName(this.traceMeasure);(e=e&&e[0])&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,n,r){var i=BN.getInstance().getUrl();if(i){const s=new yR(e,"_wt_"+i,!0);i=Math.floor(1e3*BN.getInstance().getTimeOrigin()),s.setStartTime(i),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),n&&((i=n.find(e=>"first-paint"===e.name))&&i.startTime&&s.putMetric("_fp",Math.floor(1e3*i.startTime)),(i=n.find(e=>"first-contentful-paint"===e.name))&&i.startTime&&s.putMetric("_fcp",Math.floor(1e3*i.startTime)),r&&s.putMetric("_fid",Math.floor(1e3*r))),pR(s)}}static createUserTimingTrace(e,t){pR(new yR(e,t,!1,t))}}function _R(e,t){const n=t;var r,i;if(n&&void 0!==n.responseStart){t=BN.getInstance().getTimeOrigin(),r=Math.floor(1e3*(n.startTime+t)),i=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,t=Math.floor(1e3*(n.responseEnd-n.startTime));{var s={performanceController:e,url:n.name&&n.name.split("?")[0],responsePayloadBytes:n.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:t};const a=zN.getInstance();a.instrumentationEnabled&&(e=s.url,r=a.logEndPointUrl.split("?")[0],i=a.flTransportEndpointUrl.split("?")[0],e!==r&&e!==i&&a.loggingEnabled&&a.logNetworkAfterSampling&&setTimeout(()=>dR(s,0),0))}}}function wR(s){jN&&(setTimeout(()=>{{var n=s;const e=BN.getInstance(),r=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");if(e.onFirstInputDelay){let t=setTimeout(()=>{yR.createOobTrace(n,r,i),t=void 0},5e3);e.onFirstInputDelay(e=>{t&&(clearTimeout(t),yR.createOobTrace(n,r,i,e))})}else yR.createOobTrace(n,r,i);return}},0),setTimeout(()=>{{var t=s;const e=BN.getInstance(),n=e.getEntriesByType("resource");for(const r of n)_R(t,r);return void e.setupObserver("resource",e=>_R(t,e))}},0),setTimeout(()=>{{var t=s;const e=BN.getInstance(),n=e.getEntriesByType("measure");for(const r of n)bR(t,r);return void e.setupObserver("measure",e=>bR(t,e))}},0))}function bR(e,t){const n=t.name;n.substring(0,DN.length)!==DN&&yR.createUserTimingTrace(e,n)}class IR{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),BN.getInstance().requiredApisAvailable()?X().then(e=>{e&&(lR||(uR(5500),lR=!0),sR(this).then(()=>wR(this),()=>wR(this)),this.initialized=!0)}).catch(e=>{UN.info("Environment doesn't support IndexedDB: "+e)}):UN.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){zN.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return zN.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){zN.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return zN.getInstance().dataCollectionEnabled}}vt(new o("performance",(e,{options:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("[DEFAULT]"!==n.name)throw FN.create("FB not default");if("undefined"==typeof window)throw FN.create("no window");e=window,VN=e;const i=new IR(n,r);return i._init(t),i},"PUBLIC")),r(NN,RN),r(NN,RN,"esm2017");class TR{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return t=_(this._delegate),new yR(t,e);var t}}(t=Vt).INTERNAL.registerComponent(new o("performance-compat",function(e){var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("performance").getImmediate();return new TR(t,e)},"PUBLIC")),t.registerVersion("@firebase/performance-compat","0.2.0-20221206221533");const ER="@firebase/remote-config",kR="0.4.0-20221206221533";class SR{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}const CR=new oe("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"}),AR=["1","true","t","yes","y","on"];class NR{constructor(e,t=""){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return"static"!==this._source&&0<=AR.indexOf(this._value.toLowerCase())}asNumber(){if("static"===this._source)return 0;let e=Number(this._value);return e=isNaN(e)?0:e}getSource(){return this._source}}async function RR(e){const t=_(e);var[e,n]=await Promise.all([t._storage.getLastSuccessfulFetchResponse(),t._storage.getActiveConfigEtag()]);return!!(e&&e.config&&e.eTag&&e.eTag!==n)&&(await Promise.all([t._storageCache.setActiveConfig(e.config),t._storage.setActiveConfigEtag(e.eTag)]),!0)}function xR(e){const t=_(e);return t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}async function DR(e){const t=_(e),n=new SR;setTimeout(async()=>{n.abort()},t.settings.fetchTimeoutMillis);try{await t._client.fetch({cacheMaxAgeMillis:t.settings.minimumFetchIntervalMillis,signal:n}),await t._storageCache.setLastFetchStatus("success")}catch(n){e=(e=n)instanceof ae&&-1!==e.code.indexOf("fetch-throttle")?"throttle":"failure";throw await t._storageCache.setLastFetchStatus(e),n}}function PR(e,t){const n=_(e);n._isInitializationComplete||n._logger.debug(`A value was requested for key "${t}" before SDK initialization completed.`+" Await on ensureInitialized if the intent was to get a previously activated value.");e=n._storageCache.getActiveConfig();return e&&void 0!==e[t]?new NR("remote",e[t]):n.defaultConfig&&void 0!==n.defaultConfig[t]?new NR("default",String(n.defaultConfig[t])):(n._logger.debug(`Returning static value for key "${t}".`+" Define a default or remote value if this is unintentional."),new NR("static"))}class OR{constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var t=Date.now()-t,n=t<=e;return this.logger.debug("Config fetch cache check."+` Cache age millis: ${t}.`+` Cache max age millis (minimumFetchIntervalMillis setting): ${e}.`+` Is cache hit: ${n}.`),n}async fetch(e){var[t,n]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(n&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return n;e.eTag=n&&n.eTag,n=await this.client.fetch(e);const r=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===n.status&&r.push(this.storage.setLastSuccessfulFetchResponse(n)),await Promise.all(r),n}}class MR{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}async fetch(n){var t,[e,r]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=`+this.apiKey,s={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":n.eTag||"*"},r={sdk_version:this.sdkVersion,app_instance_id:e,app_instance_id_token:r,app_id:this.appId,language_code:(t=navigator).languages&&t.languages[0]||t.language},r={method:"POST",headers:s,body:JSON.stringify(r)},i=fetch(i,r),r=new Promise((e,t)=>{n.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",t(e)})});let a;try{await Promise.race([i,r]),a=await i}catch(t){let e="fetch-client-network";throw"AbortError"===(null==t?void 0:t.name)&&(e="fetch-timeout"),CR.create(e,{originalErrorMessage:null==t?void 0:t.message})}let o=a.status;i=a.headers.get("ETag")||void 0;let c,l;if(200===a.status){let e;try{e=await a.json()}catch(t){throw CR.create("fetch-client-parse",{originalErrorMessage:null==t?void 0:t.message})}c=e.entries,l=e.state}if("INSTANCE_STATE_UNSPECIFIED"===l?o=500:"NO_CHANGE"===l?o=304:"NO_TEMPLATE"!==l&&"EMPTY_CONFIG"!==l||(c={}),304!==o&&200!==o)throw CR.create("fetch-status",{httpStatus:o});return{status:o,eTag:i,config:c}}}class LR{constructor(e,t){this.client=e,this.storage=t}async fetch(e){var t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(e,{throttleEndTimeMillis:t,backoffCount:n}){var i=e.signal,s=t;await new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(CR.create("fetch-throttle",{throttleEndTimeMillis:s}))})});try{var r=await this.client.fetch(e);return await this.storage.deleteThrottleMetadata(),r}catch(t){if(function(e){if(e instanceof ae&&e.customData)return 429===(e=Number(e.customData.httpStatus))||500===e||503===e||504===e}(t))return r={throttleEndTimeMillis:Date.now()+Pe(n),backoffCount:n+1},await this.storage.setThrottleMetadata(r),this.attemptFetch(e,r);throw t}}}class FR{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function UR(e,t){e=e.target.error||void 0;return CR.create(t,{originalErrorMessage:e&&(null==e?void 0:e.message)})}const qR="app_namespace_store";class VR{constructor(e,t,n,r=function(){return new Promise((t,n)=>{try{const e=indexedDB.open("firebase_remote_config",1);e.onerror=e=>{n(UR(e,"storage-open"))},e.onsuccess=e=>{t(e.target.result)},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(qR,{keyPath:"compositeKey"})}}catch(e){n(CR.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}})}()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(a){const o=await this.openDbPromise;return new Promise((t,n)=>{const e=o.transaction([qR],"readonly"),r=e.objectStore(qR);var i=this.createCompositeKey(a);try{const s=r.get(i);s.onerror=e=>{n(UR(e,"storage-get"))},s.onsuccess=e=>{e=e.target.result;t(e?e.value:void 0)}}catch(e){n(CR.create("storage-get",{originalErrorMessage:null==e?void 0:e.message}))}})}async set(a,o){const c=await this.openDbPromise;return new Promise((e,t)=>{const n=c.transaction([qR],"readwrite"),r=n.objectStore(qR);var i=this.createCompositeKey(a);try{const s=r.put({compositeKey:i,value:o});s.onerror=e=>{t(UR(e,"storage-set"))},s.onsuccess=()=>{e()}}catch(e){t(CR.create("storage-set",{originalErrorMessage:null==e?void 0:e.message}))}})}async delete(a){const o=await this.openDbPromise;return new Promise((e,t)=>{const n=o.transaction([qR],"readwrite"),r=n.objectStore(qR);var i=this.createCompositeKey(a);try{const s=r.delete(i);s.onerror=e=>{t(UR(e,"storage-delete"))},s.onsuccess=()=>{e()}}catch(e){t(CR.create("storage-delete",{originalErrorMessage:null==e?void 0:e.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class BR{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){var e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig();(e=await e)&&(this.lastFetchStatus=e),(t=await t)&&(this.lastSuccessfulFetchTimestampMillis=t),(n=await n)&&(this.activeConfig=n)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}vt(new o("remote-config",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),e=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw CR.create("registration-window");if(!J())throw CR.create("indexed-db-unavailable");var{projectId:r,apiKey:i,appId:s}=n.options;if(!r)throw CR.create("registration-project-id");if(!i)throw CR.create("registration-api-key");if(!s)throw CR.create("registration-app-id");t=t||"firebase";const a=new VR(s,n.name,t),o=new BR(a),c=new je(ER);return c.logLevel=h.ERROR,s=new MR(e,bt,t,r,i,s),s=new LR(s,a),s=new OR(s,a,o,c),xR(s=new FR(n,s,o,a,c)),s},"PUBLIC").setMultipleInstances(!0)),r(ER,kR),r(ER,kR,"esm2017");class jR{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return RR(this._delegate)}ensureInitialized(){return xR(this._delegate)}fetch(){return DR(this._delegate)}fetchAndActivate(){return async function(e){return await DR(e=_(e)),RR(e)}(this._delegate)}getAll(){{var n=this._delegate,e,t;const r=_(n);return[e={},t={}]=[r._storageCache.getActiveConfig(),r.defaultConfig],Object.keys(Object.assign(Object.assign({},e),t)).reduce((e,t)=>(e[t]=PR(n,t),e),{})}}getBoolean(e){return PR(_(this._delegate),e).asBoolean()}getNumber(e){return PR(_(this._delegate),e).asNumber()}getString(e){return PR(_(this._delegate),e).asString()}getValue(e){return PR(this._delegate,e)}setLogLevel(e){{var t;const n=_(this._delegate);switch(e){case"debug":n._logger.logLevel=h.DEBUG;break;case"silent":n._logger.logLevel=h.SILENT;break;default:n._logger.logLevel=h.ERROR}return}}}return(e=Vt).INTERNAL.registerComponent(new o("remoteConfig-compat",function(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),e=e.getProvider("remote-config").getImmediate({identifier:t});return new jR(n,e)},"PUBLIC").setMultipleInstances(!0).setServiceProps({isSupported:async function(){if(!J())return!1;try{return await X()}catch(e){return!1}}})),e.registerVersion("@firebase/remote-config-compat","0.2.0-20221206221533"),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),Vt.registerVersion("firebase","9.15.0-20221206221533","compat-cdn"),Vt});